{"version":3,"sources":["../node_modules/jspdf/dist sync","core/books.ts","../../../../src/core/books/books.js","../../../src/core/text-handling-functions.js","../../../src/core/basic-text-check.js","../../../src/core/basic-file-check.js","../../../src/core/usfm-js-check.js","../../../src/core/BCS-usfm-grammar-check.js","../../../src/core/utilities.js","../../../src/core/usfm-text-check.js","../../../src/core/markdown-text-check.js","../../../src/core/plain-text-check.js","../../../src/core/yaml-text-check.js","../../../src/core/manifest-text-check.js","../../../src/core/getApi.js","../../../src/core/ta-reference-check.js","../../../src/core/tn-links-check.js","../../../src/core/quote-check.js","../../../src/core/tn-table-row-check.js","../../../src/core/tn-table-text-check.js","../../../../src/demos/file-check/checkFile.js","../../../src/core/notice-processing-functions.js","../../../src/demos/RenderProcessedResults.js","../../../../src/demos/file-check/FileCheck.js","../../../../src/demos/repo-check/checkRepo.js","../../../../src/demos/book-package-check/checkBookPackage.js","../../../../src/demos/book-package-check/BookPackageCheck.js","../../../../src/demos/book-packages-check/checkBookPackages.js","../../../../src/demos/book-packages-check/BookPackagesCheck.js","../../../../src/demos/repo-check/RepoCheck.js","../../../src/core/annotation-row-check.js","../../../src/core/annotation-table-check.js","../../../src/core/book-package-check.js","BookPackageContentValidator.js","App.tsx","serviceWorker.ts","index.tsx"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","newTestament","list","i","data","length","testament","push","title","oldTestament","titlesToBoolean","ob","bookDataTitles","forEach","v","k","bookIdByTitle","bookTitleById","extraBookList","isValidBookID","bookId","b","isOptionalValidBookID","isExtraBookID","usfmNumberName","chaptersInBook","chapters","err","versesInChapter","chapter","verses","_testament","oftenMissingList","isOftenMissing","bookID","entry","isWhitespace","myString","test","countOccurrences","mainString","subString","allowOverlapping","n","pos","step","DEFAULT_EXTRACT_LENGTH","fieldName","fieldText","allowedLinks","optionalFieldLocation","optionalCheckingOptions","console","result","noticeList","priority","message","lineNumber","characterIndex","extract","location","ourAtString","addNotice6","extractLength","btcError","isNaN","halfLength","Math","halfLengthPlus","iy","checkList","punctChar","punctSet","leftChar","rightChar","lCount","rCount","filename","fileText","optionalFileLocation","bfcError","runUsfmJsCheck","convertOptions","jsonResult","toJSON","jsonKeys","Object","numJSONkeys","isValidUSFM","returnedJSON","runBCSGrammarCheck","strictnessString","givenLocation","usfmELerror","ourUsfmParser","grammar","parserResult","parserMessages","parseError","ourErrorObject","contextRE","errorLine","regexResult","lineNumberString","ourErrorMessage","parseWarnings","ourWarnings","warningString","adjustedString","error","warnings","ourParseInt","givenString","int","INTRO_LINE_START_MARKERS","CV_MARKERS","HEADING_TYPE_MARKERS","PARAGRAPH_MARKERS","NOTE_MARKERS","SPECIAL_MARKERS","MILESTONE_MARKERS","MARKERS_WITHOUT_CONTENT","concat","ALLOWED_LINE_START_MARKERS","DEPRECATED_MARKERS","MARKERS_WITH_COMPULSORY_CONTENT","COMPULSORY_MARKERS","EXPECTED_MARKERS","EXPECTED_BIBLE_BOOK_MARKERS","EXPECTED_PERIPHERAL_BOOK_MARKERS","givenText","ourLocation","successList","C","V","opener","closer","addNoticeCV8","fileLocation","checkUSFMCharacterFields","resultObject","doBasicFileChecks","doOurBasicFileChecks","compulsoryMarker","markerSet","expectedMarker","books","f","deprecatedMarker","marker","lineLocation","Vstr","rest","dbtcResultObject","doBasicTextChecks","fieldLocation","noticeEntry","doOurBasicTextChecks","checkUSFMLineInternals","allResults","lowercaseBookID","numChaptersThisBook","lines","lastC","lastV","lastIntC","lastIntV","lastMarker","lastRest","line","atString","intC","intV","vIndex","usfmICerror","usfmIVerror","bits","firstV","secondV","intFirstV","intSecondV","usfmV12error","restRest","parseInt","usfmIIVerror","thisLength","checkUSFMLineContents","checkUSFMFileContents","addSuccessMessage","mainUSFMCheck","someObject","someSubobject","someSubSubobject","expectedVersesPerChapterList","result1","chapterInt","usfmCIerror","CVlocation","discoveredVerseList","discoveredVerseWithTextList","verseNumberString","verseObjects","verseHasText","hasText","firstVString","secondVString","usfmVIerror","verseInt","usfmPIerror","CVCheck","grammarCheckResult","relaxedGrammarCheckResult","ourRunBCSGrammarCheck","MARKDOWN_VALIDATOR_VERSION","textName","markdownText","mdtcError","thisText","lineName","headerLevel","lastNumLeadingSpaces","numLeadingSpaces","thisHeaderLevel","checkMarkdownLineContents","lastLineContents","PLAIN_TEXT_VALIDATOR_VERSION","ptcError","cptResult","lineText","checkPlainLineContents","YAML_VALIDATOR_VERSION","YAMLText","ytcError","cytResult","allowedLinksInLine","formData","yaml","yamlError","checkYAMLLineContents","MANIFEST_VALIDATOR_VERSION","manifestText","mfcError","cmtResult","cYtResultObject","checkYAMLText","doOurYAMLTextChecks","formDataKeys","addNotice9","baseURL","apiPath","failedStore","driver","localforage","name","zipStore","cacheStore","Door43Api","setup","cache","store","maxAge","exclude","query","key","serialized","JSON","fetchFileFromServer","a","username","repository","path","branch","repositoryExists","repoExists","uri","Path","failMessage","cachedGet","getFileFromZip","file","getUID","user","uid","params","q","limit","repos","repo","zipUri","fetch","response","zipArrayBuffer","optionalPrefix","zipBlob","pathList","JSZip","zip","relativePath","zipPath","ctarResult","trcUNerror","trcBRerror","languageCode","trcLCerror","sectionName","trcSNerror","s","taRepoName","filepath","getFile","taFileContent","defaultLanguageCode","taRegex","RegExp","resultArray","twRegex","twRepoName","tnlcError","bibleRegex","tnCIerror","numVersesThisChapter","tnVIerror","ccError","vvError","bookNumberAndName","whichTestament","originalLanguageRepoLanguageCode","originalLanguageRepoCode","originalLanguageRepoName","qcoError","qcunError","originalUSFM","extra","repoCode","foundChapter","foundVerse","verseText","bookLine","ixW","ixEnd","field","adjusted_field","getPassage","colqResult","gcELerror","quoteBits","gcVTerror","numQuoteBits","bitIndex","partDescription","remainingBits","badChar","extraText","NUM_EXPECTED_TSV_FIELDS","EXPECTED_TN_HEADING_LINE","taLinkText","checkTNLinks","rowLocation","coqResultObject","addNotice6to9","ourCheckTNLinks","checkOriginalLanguageQuote","ourCheckTNOriginalLanguageQuote","checkTAReference","ourCheckTAReference","doOurMarkdownTextChecks","cmtResultObject","checkMarkdownText","drResult","givenRowLocation","ourRowLocation","tlcELerror","tlcNCerror","haveGoodBookID","fields","B","fieldID","supportReference","origQuote","occurrence","GLQuote","occurrenceNote","Number","haveGoodChapterNumber","tlcNVerror","indexOf","characterIndeX","TABLE_TEXT_VALIDATOR_VERSION","NUM_EXPECTED_TN_FIELDS","ttcError","tableText","lastB","fieldID_list","inString","withString","checkTN_TSVDataRow","firstResult","lastintC","lastintV","startTime","ourCFLocation","filenameMain","checkTN_TSVText","fileContent","checkFileResult","checkUSFMText","checkPlainText","checkManifestText","Date","DEFAULT_MAXIMUM_SIMILAR_MESSAGES","DEFAULT_CUTOFF_PRIORITY_LEVEL","DEFAULT_IGNORE_PRIORITY_NUMBER_LIST","DEFAULT_ERROR_PRIORITY_LEVEL","DEFAULT_SEVERE_PRIORITY_LEVEL","DEFAULT_MEDIUM_PRIORITY_LEVEL","processNoticesCommon","givenNoticeObject","optionalProcessingOptions","standardisedNoticeList","numberStore","duplicatePriorityList","thisGivenNotice","thisPriority","thisMsg","oldMsg","numIgnoredNotices","numSuppressedWarnings","processingOptions","gnoPropertyName","ignorePriorityNumberList","npfIPNLerror","sortBy","npfSBerror","cutoffPriorityLevel","npfCPLerror","BibleRegex","NotesRegex","bookList","notesList","thisParticularSuccessMessage","Set","thisParticularNotice","thisNewNotice","remainingNoticeList","thisNotice","newNoticeList","newNotice","allTotals","processNoticesToErrorsWarnings","maximumSimilarMessages","npfMSMerror","errorPriorityLevel","npfEPLerror","counter","thisID","numSuppressed","processNoticesToSevereMediumLow","severePriorityLevel","npfSPLerror","mediumPriorityLevel","nfpMPLerror","prioriyy","processNoticesToSingleList","RenderBCV","RenderSuccessesColoured","results","haveWarnings","e1","e2","listEntry","index","style","color","RenderProcessedArray","arrayType","myList","RenderGivenArray","array","colour","RenderWarningsGradient","thisColour","priorityValue","red","getGradientColour","RenderErrors","RenderWarnings","RenderErrorsAndWarnings","RenderSevere","RenderMedium","RenderLow","RenderSevereMediumLow","RenderSuccessesErrorsWarnings","haveErrorsOrWarnings","successCount","RenderSuccessesSevereMediumLow","RenderSuccessesWarningsGradient","RenderElapsedTime","elapsedTime","seconds","remainingTime","minutes","hours","withStyles","theme","root","props","repoName","checkingOptions","useState","setResultValue","useEffect","renderSummary","processedResults","checkFile","rawCFResults","processOptions","displayType","className","bookOrFileCode","cfBookID","file_content","addNotice10","doOurCheckFile","checkRepoResult","checkedFileCount","checkedFilenames","checkedFilenameExtensions","fetchRepositoryZipFile","zipFetchSucceeded","getFilelistFromZip","countString","totalCheckedSize","thisFilepath","thisFilename","thisFilenameExtension","ourBookID","repoFileContent","rawCRResults","checkRepo","checkTQbook","cfFilename","cfResultObject","ctqResult","generalLocation","thisPath","pathParts","tqFileContent","checkBookPackageResult","checkedRepoNames","repo_language_code","tqResultObject","BookPackageContentValidator","toLocaleString","join","size","checkBookPackage","rawCBPResults","checkType","language_code","checkedOptions","errorList","warningList","useStyles","makeStyles","createStyles","width","flexGrow","display","menuButton","marginRight","spacing","appBar","transition","transitions","create","easing","sharp","duration","leavingScreen","appBarShift","marginLeft","easeOut","enteringScreen","formControl","margin","button","instructions","marginTop","marginBottom","hide","drawer","flexShrink","drawerPaper","drawerHeader","alignItems","padding","mixins","toolbar","justifyContent","content","contentShift","alignItemsAndJustifyContent","offset","queryProcessedOnce","App","React","state","setState","activeStep","setActiveStep","skipped","setSkipped","steps","isStepSkipped","has","handleNext","newSkipped","values","delete","prevActiveStep","search","window","URLSearchParams","useQuery","bks","get","barrayIds","split","barrayTitles","x","alert","log","classes","useTheme","open","setOpen","clearFlag","clearF","setClearF","handleChange","event","target","checked","CssBaseline","AppBar","position","clsx","Toolbar","IconButton","aria-label","onClick","edge","Typography","variant","Drawer","anchor","paper","direction","Divider","FormGroup","row","FormControlLabel","control","Switch","onChange","handleChangeClearFlag","value","label","Paper","Stepper","map","stepProps","labelProps","completed","Step","StepLabel","Container","getStepContent","Button","disabled","Grid","container","item","xs","states","FormControl","required","component","FormLabel","t","Checkbox","FormHelperText","y","joinBookIds","toUpperCase","Boolean","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.338569f8.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 489;","import data from './books.json';\r\n\r\nexport interface bookDataIF {\r\n  \"id\": string;\r\n  \"title\": string;\r\n  \"usfm\": string;\r\n  \"testament\": string;\r\n  \"verseCount\": number;\r\n  \"chapters\": number[];\r\n}\r\n\r\ninterface bpStateIF { [x: string]: boolean[]; };\r\n\r\nexport const chaptersInBook = (bookId: string) => {\r\n    let chapters: number[];\r\n    chapters = bookData(bookId).chapters;\r\n    if ( chapters === undefined ) {\r\n      throw new Error(\"Error: chaptersInBook(): Invalid bookId\");\r\n    }\r\n    return chapters;\r\n};\r\n\r\nexport const versesInChapter = (bookId: string, chapter: number) => {\r\n  const verses = chaptersInBook(bookId)[chapter - 1];\r\n  return verses;\r\n};\r\n\r\nexport const bookData = (bookId: string) => {\r\n  const _bookData: bookDataIF = data.filter(row => row.id === bookId)[0];\r\n  return _bookData;\r\n};\r\n\r\nexport const testament = (bookId: string) => {\r\n  const _testament = bookData(bookId).testament;\r\n  return _testament;\r\n};\r\n\r\nexport const newTestament = () => {\r\n  let list: string[] = [];\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].testament === \"new\" ) {\r\n      list.push( data[i].title )\r\n    }\r\n  }\r\n  return list;\r\n}\r\n\r\nexport const oldTestament = () => {\r\n  let list: string[] = [];\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].testament === \"old\" ) {\r\n      list.push( data[i].title )\r\n    }\r\n  }\r\n  return list;\r\n}\r\n\r\nexport const bookDataTitles = () => {\r\n  let list: string[] = [];\r\n  for (let i=0; i < data.length; i++) {\r\n      list.push( data[i].title )\r\n  }\r\n  return list;\r\n}\r\n\r\nexport const titlesToBoolean = () => {\r\n  let ob: bpStateIF = {};\r\n  let list = bookDataTitles();\r\n  list.forEach((v,k) => {ob[v]= [false,false]});\r\n  return ob;\r\n}\r\n\r\nexport const bookIdByTitle = (title: string) => {\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].title === title ) {\r\n      return data[i].id;\r\n    }\r\n  }\r\n  return \"\";\r\n}\r\n\r\nexport const bookTitleById = (id: string) => {\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].id === id ) {\r\n      return data[i].title;\r\n    }\r\n  }\r\n  return \"\";\r\n}","const data = { \"gen\": {\"id\": \"gen\", \"title\": \"Genesis\", \"usfm\": \"01-GEN\", \"testament\": \"old\", \"verseCount\": 1533, \"chapters\": [31, 25, 24, 26, 32, 22, 24, 22, 29, 32, 32, 20, 18, 24, 21, 16, 27, 33, 38, 18, 34, 24, 20, 67, 34, 35, 46, 22, 35, 43, 55, 32, 20, 31, 29, 43, 36, 30, 23, 23, 57, 38, 34, 34, 28, 34, 31, 22, 33, 26]},\r\n\"exo\": {\"id\": \"exo\", \"title\": \"Exodus\", \"usfm\": \"02-EXO\", \"testament\": \"old\", \"verseCount\": 1213, \"chapters\": [22, 25, 22, 31, 23, 30, 25, 32, 35, 29, 10, 51, 22, 31, 27, 36, 16, 27, 25, 26, 36, 31, 33, 18, 40, 37, 21, 43, 46, 38, 18, 35, 23, 35, 35, 38, 29, 31, 43, 38]},\r\n\"lev\": {\"id\": \"lev\", \"title\": \"Leviticus\", \"usfm\": \"03-LEV\", \"testament\": \"old\", \"verseCount\": 859, \"chapters\": [17, 16, 17, 35, 19, 30, 38, 36, 24, 20, 47, 8, 59, 57, 33, 34, 16, 30, 37, 27, 24, 33, 44, 23, 55, 46, 34]},\r\n\"num\": {\"id\": \"num\", \"title\": \"Numbers\", \"usfm\": \"04-NUM\", \"testament\": \"old\", \"verseCount\": 1288, \"chapters\": [54, 34, 51, 49, 31, 27, 89, 26, 23, 36, 35, 16, 33, 45, 41, 50, 13, 32, 22, 29, 35, 41, 30, 25, 18, 65, 23, 31, 40, 16, 54, 42, 56, 29, 34, 13]},\r\n\"deu\": {\"id\": \"deu\", \"title\": \"Deuteronomy\", \"usfm\": \"05-DEU\", \"testament\": \"old\", \"verseCount\": 959, \"chapters\": [46, 37, 29, 49, 33, 25, 26, 20, 29, 22, 32, 32, 18, 29, 23, 22, 20, 22, 21, 20, 23, 30, 25, 22, 19, 19, 26, 68, 29, 20, 30, 52, 29, 12]},\r\n\"jos\": {\"id\": \"jos\", \"title\": \"Joshua\", \"usfm\": \"06-JOS\", \"testament\": \"old\", \"verseCount\": 658, \"chapters\": [18, 24, 17, 24, 15, 27, 26, 35, 27, 43, 23, 24, 33, 15, 63, 10, 18, 28, 51, 9, 45, 34, 16, 33]},\r\n\"jdg\": {\"id\": \"jdg\", \"title\": \"Judges\", \"usfm\": \"07-JDJ\", \"testament\": \"old\", \"verseCount\": 618, \"chapters\": [36, 23, 31, 24, 31, 40, 25, 35, 57, 18, 40, 15, 25, 20, 20, 31, 13, 31, 30, 48, 25]},\r\n\"rut\": {\"id\": \"rut\", \"title\": \"Ruth\", \"usfm\": \"08-RUT\", \"testament\": \"old\", \"verseCount\": 85, \"chapters\": [22, 23, 18, 22]},\r\n\"1sa\": {\"id\": \"1sa\", \"title\": \"1 Samuel\", \"usfm\": \"09-1SA\", \"testament\": \"old\", \"verseCount\": 810, \"chapters\": [28, 36, 21, 22, 12, 21, 17, 22, 27, 27, 15, 25, 23, 52, 35, 23, 58, 30, 24, 42, 15, 23, 29, 22, 44, 25, 12, 25, 11, 31, 13]},\r\n\"2sa\": {\"id\": \"2sa\", \"title\": \"2 Samuel\", \"usfm\": \"10-2SA\", \"testament\": \"old\", \"verseCount\": 695, \"chapters\": [27, 32, 39, 12, 25, 23, 29, 18, 13, 19, 27, 31, 39, 33, 37, 23, 29, 33, 43, 26, 22, 51, 39, 25]},\r\n\"1ki\": {\"id\": \"1ki\", \"title\": \"1 Kings\", \"usfm\": \"11-1KI\", \"testament\": \"old\", \"verseCount\": 816, \"chapters\": [53, 46, 28, 34, 18, 38, 51, 66, 28, 29, 43, 33, 34, 31, 34, 34, 24, 46, 21, 43, 29, 53]},\r\n\"2ki\": {\"id\": \"2ki\", \"title\": \"2 Kings\", \"usfm\": \"12-2KI\", \"testament\": \"old\", \"verseCount\": 719, \"chapters\": [18, 25, 27, 44, 27, 33, 20, 29, 37, 36, 21, 21, 25, 29, 38, 20, 41, 37, 37, 21, 26, 20, 37, 20, 30]},\r\n\"1ch\": {\"id\": \"1ch\", \"title\": \"1 Chronicles\", \"usfm\": \"13-1CH\", \"testament\": \"old\", \"verseCount\": 942, \"chapters\": [54, 55, 24, 43, 26, 81, 40, 40, 44, 14, 47, 40, 14, 17, 29, 43, 27, 17, 19, 8, 30, 19, 32, 31, 31, 32, 34, 21, 30]},\r\n\"2ch\": {\"id\": \"2ch\", \"title\": \"2 Chronicles\", \"usfm\": \"14-2CH\", \"testament\": \"old\", \"verseCount\": 822, \"chapters\": [17, 18, 17, 22, 14, 42, 22, 18, 31, 19, 23, 16, 22, 15, 19, 14, 19, 34, 11, 37, 20, 12, 21, 27, 28, 23, 9, 27, 36, 27, 21, 33, 25, 33, 27, 23]},\r\n\"ezr\": {\"id\": \"ezr\", \"title\": \"Ezra\", \"usfm\": \"15-EZR\", \"testament\": \"old\", \"verseCount\": 280, \"chapters\": [11, 70, 13, 24, 17, 22, 28, 36, 15, 44]},\r\n\"neh\": {\"id\": \"neh\", \"title\": \"Nehemiah\", \"usfm\": \"16-NEH\", \"testament\": \"old\", \"verseCount\": 406, \"chapters\": [11, 20, 32, 23, 19, 19, 73, 18, 38, 39, 36, 47, 31]},\r\n\"est\": {\"id\": \"est\", \"title\": \"Esther\", \"usfm\": \"17-EST\", \"testament\": \"old\", \"verseCount\": 167, \"chapters\": [22, 23, 15, 17, 14, 14, 10, 17, 32, 3]},\r\n\"job\": {\"id\": \"job\", \"title\": \"Job\", \"usfm\": \"18-JOB\", \"testament\": \"old\", \"verseCount\": 1070, \"chapters\": [22, 13, 26, 21, 27, 30, 21, 22, 35, 22, 20, 25, 28, 22, 35, 22, 16, 21, 29, 29, 34, 30, 17, 25, 6, 14, 23, 28, 25, 31, 40, 22, 33, 37, 16, 33, 24, 41, 30, 24, 34, 17]},\r\n\"psa\": {\"id\": \"psa\", \"title\": \"Psalms\", \"usfm\": \"19-PSA\", \"testament\": \"old\", \"verseCount\": 2461, \"chapters\": [6, 12, 8, 8, 12, 10, 17, 9, 20, 18, 7, 8, 6, 7, 5, 11, 15, 50, 14, 9, 13, 31, 6, 10, 22, 12, 14, 9, 11, 12, 24, 11, 22, 22, 28, 12, 40, 22, 13, 17, 13, 11, 5, 26, 17, 11, 9, 14, 20, 23, 19, 9, 6, 7, 23, 13, 11, 11, 17, 12, 8, 12, 11, 10, 13, 20, 7, 35, 36, 5, 24, 20, 28, 23, 10, 12, 20, 72, 13, 19, 16, 8, 18, 12, 13, 17, 7, 18, 52, 17, 16, 15, 5, 23, 11, 13, 12, 9, 9, 5, 8, 28, 22, 35, 45, 48, 43, 13, 31, 7, 10, 10, 9, 8, 18, 19, 2, 29, 176, 7, 8, 9, 4, 8, 5, 6, 5, 6, 8, 8, 3, 18, 3, 3, 21, 26, 9, 8, 24, 13, 10, 7, 12, 15, 21, 10, 20, 14, 9, 6]},\r\n\"pro\": {\"id\": \"pro\", \"title\": \"Proverbs\", \"usfm\": \"20-PRO\", \"testament\": \"old\", \"verseCount\": 915, \"chapters\": [33, 22, 35, 27, 23, 35, 27, 36, 18, 32, 31, 28, 25, 35, 33, 33, 28, 24, 29, 30, 31, 29, 35, 34, 28, 28, 27, 28, 27, 33, 31]},\r\n\"ecc\": {\"id\": \"ecc\", \"title\": \"Ecclesiastes\", \"usfm\": \"21-ECC\", \"testament\": \"old\", \"verseCount\": 222, \"chapters\": [18, 26, 22, 16, 20, 12, 29, 17, 18, 20, 10, 14]},\r\n\"sng\": {\"id\": \"sng\", \"title\": \"Song of Songs\", \"usfm\": \"22-SNG\", \"testament\": \"old\", \"verseCount\": 117, \"chapters\": [17, 17, 11, 16, 16, 13, 13, 14]},\r\n\"isa\": {\"id\": \"isa\", \"title\": \"Isaiah\", \"usfm\": \"23-ISA\", \"testament\": \"old\", \"verseCount\": 1292, \"chapters\": [31, 22, 26, 6, 30, 13, 25, 22, 21, 34, 16, 6, 22, 32, 9, 14, 14, 7, 25, 6, 17, 25, 18, 23, 12, 21, 13, 29, 24, 33, 9, 20, 24, 17, 10, 22, 38, 22, 8, 31, 29, 25, 28, 28, 25, 13, 15, 22, 26, 11, 23, 15, 12, 17, 13, 12, 21, 14, 21, 22, 11, 12, 19, 12, 25, 24]},\r\n\"jer\": {\"id\": \"jer\", \"title\": \"Jermiah\", \"usfm\": \"24-JER\", \"testament\": \"old\", \"verseCount\": 1364, \"chapters\": [19, 37, 25, 31, 31, 30, 34, 22, 26, 25, 23, 17, 27, 22, 21, 21, 27, 23, 15, 18, 14, 30, 40, 10, 38, 24, 22, 17, 32, 24, 40, 44, 26, 22, 19, 32, 21, 28, 18, 16, 18, 22, 13, 30, 5, 28, 7, 47, 39, 46, 64, 34]},\r\n\"lam\": {\"id\": \"lam\", \"title\": \"Lamentations\", \"usfm\": \"25-LAM\", \"testament\": \"old\", \"verseCount\": 154, \"chapters\": [22, 22, 66, 22, 22]},\r\n\"ezk\": {\"id\": \"ezk\", \"title\": \"Ezekiel\", \"usfm\": \"26-EZK\", \"testament\": \"old\", \"verseCount\": 1273, \"chapters\": [28, 10, 27, 17, 17, 14, 27, 18, 11, 22, 25, 28, 23, 23, 8, 63, 24, 32, 14, 49, 32, 31, 49, 27, 17, 21, 36, 26, 21, 26, 18, 32, 33, 31, 15, 38, 28, 23, 29, 49, 26, 20, 27, 31, 25, 24, 23, 35]},\r\n\"dan\": {\"id\": \"dan\", \"title\": \"Daniel\", \"usfm\": \"27-DAN\", \"testament\": \"old\", \"verseCount\": 357, \"chapters\": [21, 49, 30, 37, 31, 28, 28, 27, 27, 21, 45, 13]},\r\n\"hos\": {\"id\": \"hos\", \"title\": \"Hosea\", \"usfm\": \"28-HOS\", \"testament\": \"old\", \"verseCount\": 197, \"chapters\": [11, 23, 5, 19, 15, 11, 16, 14, 17, 15, 12, 14, 16, 9]},\r\n\"jol\": {\"id\": \"jol\", \"title\": \"Joel\", \"usfm\": \"29-JOL\", \"testament\": \"old\", \"verseCount\": 73, \"chapters\": [20, 32, 21]},\r\n\"amo\": {\"id\": \"amo\", \"title\": \"Amos\", \"usfm\": \"30-AMO\", \"testament\": \"old\", \"verseCount\": 146, \"chapters\": [15, 16, 15, 13, 27, 14, 17, 14, 15]},\r\n\"oba\": {\"id\": \"oba\", \"title\": \"Obadiah\", \"usfm\": \"31-OBA\", \"testament\": \"old\", \"verseCount\": 21, \"chapters\": [21]},\r\n\"jon\": {\"id\": \"jon\", \"title\": \"Jonah\", \"usfm\": \"32-JON\", \"testament\": \"old\", \"verseCount\": 48, \"chapters\": [17, 10, 10, 11]},\r\n\"mic\": {\"id\": \"mic\", \"title\": \"Micah\", \"usfm\": \"33-MIC\", \"testament\": \"old\", \"verseCount\": 105, \"chapters\": [16, 13, 12, 13, 15, 16, 20]},\r\n\"nam\": {\"id\": \"nam\", \"title\": \"Nahum\", \"usfm\": \"34-NAM\", \"testament\": \"old\", \"verseCount\": 47, \"chapters\": [15, 13, 19]},\r\n\"hab\": {\"id\": \"hab\", \"title\": \"Habakkuk\", \"usfm\": \"35-HAB\", \"testament\": \"old\", \"verseCount\": 56, \"chapters\": [17, 20, 19]},\r\n\"zep\": {\"id\": \"zep\", \"title\": \"Zephaniah\", \"usfm\": \"36-ZEP\", \"testament\": \"old\", \"verseCount\": 53, \"chapters\": [18, 15, 20]},\r\n\"hag\": {\"id\": \"hag\", \"title\": \"Haggai\", \"usfm\": \"37-HAG\", \"testament\": \"old\", \"verseCount\": 38, \"chapters\": [15, 23]},\r\n\"zec\": {\"id\": \"zec\", \"title\": \"Zechariah\", \"usfm\": \"38-ZEC\", \"testament\": \"old\", \"verseCount\": 211, \"chapters\": [21, 13, 10, 14, 11, 15, 14, 23, 17, 12, 17, 14, 9, 21]},\r\n\"mal\": {\"id\": \"mal\", \"title\": \"Malachi\", \"usfm\": \"39-MAL\", \"testament\": \"old\", \"verseCount\": 55, \"chapters\": [14, 17, 18, 6]},\r\n\"mat\": {\"id\": \"mat\", \"title\": \"Matthew\", \"usfm\": \"41-MAT\", \"testament\": \"new\", \"verseCount\": 1071, \"chapters\": [25, 23, 17, 25, 48, 34, 29, 34, 38, 42, 30, 50, 58, 36, 39, 28, 27, 35, 30, 34, 46, 46, 39, 51, 46, 75, 66, 20]},\r\n\"mrk\": {\"id\": \"mrk\", \"title\": \"Mark\", \"usfm\": \"42-MRK\", \"testament\": \"new\", \"verseCount\": 678, \"chapters\": [45, 28, 35, 41, 43, 56, 37, 38, 50, 52, 33, 44, 37, 72, 47, 20]},\r\n\"luk\": {\"id\": \"luk\", \"title\": \"Luke\", \"usfm\": \"43-LUK\", \"testament\": \"new\", \"verseCount\": 1151, \"chapters\": [80, 52, 38, 44, 39, 49, 50, 56, 62, 42, 54, 59, 35, 35, 32, 31, 37, 43, 48, 47, 38, 71, 56, 53]},\r\n\"jhn\": {\"id\": \"jhn\", \"title\": \"John\", \"usfm\": \"44-JHN\", \"testament\": \"new\", \"verseCount\": 879, \"chapters\": [51, 25, 36, 54, 47, 71, 53, 59, 41, 42, 57, 50, 38, 31, 27, 33, 26, 40, 42, 31, 25]},\r\n\"act\": {\"id\": \"act\", \"title\": \"Acts\", \"usfm\": \"45-ACT\", \"testament\": \"new\", \"verseCount\": 1007, \"chapters\": [26, 47, 26, 37, 42, 15, 60, 40, 43, 48, 30, 25, 52, 28, 41, 40, 34, 28, 41, 38, 40, 30, 35, 27, 27, 32, 44, 31]},\r\n\"rom\": {\"id\": \"rom\", \"title\": \"Romans\", \"usfm\": \"46-ROM\", \"testament\": \"new\", \"verseCount\": 433, \"chapters\": [32, 29, 31, 25, 21, 23, 25, 39, 33, 21, 36, 21, 14, 23, 33, 27]},\r\n\"1co\": {\"id\": \"1co\", \"title\": \"1 Corinthians\", \"usfm\": \"47-1CO\", \"testament\": \"new\", \"verseCount\": 437, \"chapters\": [31, 16, 23, 21, 13, 20, 40, 13, 27, 33, 34, 31, 13, 40, 58, 24]},\r\n\"2co\": {\"id\": \"2co\", \"title\": \"2 Corinthians\", \"usfm\": \"48-2CO\", \"testament\": \"new\", \"verseCount\": 257, \"chapters\": [24, 17, 18, 18, 21, 18, 16, 24, 15, 18, 33, 21, 14]},\r\n\"gal\": {\"id\": \"gal\", \"title\": \"Galations\", \"usfm\": \"49-GAL\", \"testament\": \"new\", \"verseCount\": 149, \"chapters\": [24, 21, 29, 31, 26, 18]},\r\n\"eph\": {\"id\": \"eph\", \"title\": \"Ephesians\", \"usfm\": \"50-EPH\", \"testament\": \"new\", \"verseCount\": 155, \"chapters\": [23, 22, 21, 32, 33, 24]},\r\n\"php\": {\"id\": \"php\", \"title\": \"Phillipians\", \"usfm\": \"51-PHP\", \"testament\": \"new\", \"verseCount\": 104, \"chapters\": [30, 30, 21, 23]},\r\n\"col\": {\"id\": \"col\", \"title\": \"Colossians\", \"usfm\": \"52-COL\", \"testament\": \"new\", \"verseCount\": 95, \"chapters\": [29, 23, 25, 18]},\r\n\"1th\": {\"id\": \"1th\", \"title\": \"1 Thessalonians\", \"usfm\": \"53-1TH\", \"testament\": \"new\", \"verseCount\": 89, \"chapters\": [10, 20, 13, 18, 28]},\r\n\"2th\": {\"id\": \"2th\", \"title\": \"2 Thessalonians\", \"usfm\": \"54-2TH\", \"testament\": \"new\", \"verseCount\": 47, \"chapters\": [12, 17, 18]},\r\n\"1ti\": {\"id\": \"1ti\", \"title\": \"1 Timothy\", \"usfm\": \"55-1TI\", \"testament\": \"new\", \"verseCount\": 113, \"chapters\": [20, 15, 16, 16, 25, 21]},\r\n\"2ti\": {\"id\": \"2ti\", \"title\": \"2 Timothy\", \"usfm\": \"56-2TI\", \"testament\": \"new\", \"verseCount\": 83, \"chapters\": [18, 26, 17, 22]},\r\n\"tit\": {\"id\": \"tit\", \"title\": \"Titus\", \"usfm\": \"57-TIT\", \"testament\": \"new\", \"verseCount\": 46, \"chapters\": [16, 15, 15]},\r\n\"phm\": {\"id\": \"phm\", \"title\": \"Philemon\", \"usfm\": \"58-PHM\", \"testament\": \"new\", \"verseCount\": 25, \"chapters\": [25]},\r\n\"heb\": {\"id\": \"heb\", \"title\": \"Hebrews\", \"usfm\": \"59-HEB\", \"testament\": \"new\", \"verseCount\": 303, \"chapters\": [14, 18, 19, 16, 14, 20, 28, 13, 28, 39, 40, 29, 25]},\r\n\"jas\": {\"id\": \"jas\", \"title\": \"James\", \"usfm\": \"60-JAS\", \"testament\": \"new\", \"verseCount\": 108, \"chapters\": [27, 26, 18, 17, 20]},\r\n\"1pe\": {\"id\": \"1pe\", \"title\": \"1 Peter\", \"usfm\": \"61-1PE\", \"testament\": \"new\", \"verseCount\": 105, \"chapters\": [25, 25, 22, 19, 14]},\r\n\"2pe\": {\"id\": \"2pe\", \"title\": \"2 Peter\", \"usfm\": \"62-2PE\", \"testament\": \"new\", \"verseCount\": 61, \"chapters\": [21, 22, 18]},\r\n\"1jn\": {\"id\": \"1jn\", \"title\": \"1 John\", \"usfm\": \"63-1JN\", \"testament\": \"new\", \"verseCount\": 105, \"chapters\": [10, 29, 24, 21, 21]},\r\n\"2jn\": {\"id\": \"2jn\", \"title\": \"2 John\", \"usfm\": \"64-2JN\", \"testament\": \"new\", \"verseCount\": 13, \"chapters\": [13]},\r\n\"3jn\": {\"id\": \"3jn\", \"title\": \"3 John\", \"usfm\": \"65-3JN\", \"testament\": \"new\", \"verseCount\": 15, \"chapters\": [15]},\r\n\"jud\": {\"id\": \"jud\", \"title\": \"Jude\", \"usfm\": \"66-JUD\", \"testament\": \"new\", \"verseCount\": 25, \"chapters\": [25]},\r\n\"rev\": {\"id\": \"rev\", \"title\": \"Revelation\", \"usfm\": \"67-REV\", \"testament\": \"new\", \"verseCount\": 404, \"chapters\": [20, 29, 22, 11, 14, 17, 17, 13, 21, 11, 19, 17, 18, 20, 8, 21, 18, 24, 21, 15, 27, 21]}\r\n}\r\n\r\n//import data from './books.json';\r\n// import * as opt from './optimize'\r\n\r\n// export interface bookDataIF {\r\n//   \"id\";\r\n//   \"title\";\r\n//   \"usfm\";\r\n//   \"testament\";\r\n//   \"verseCount\": number;\r\n//   \"chapters\": number[];\r\n// }\r\n\r\nconst extraBookList = ['FRT','BAK'];\r\nexport const isValidBookID = (bookId) => {\r\n  return bookId.toLowerCase() in data || extraBookList.indexOf(bookId) >= 0;\r\n}\r\nexport const isOptionalValidBookID = (bookId) => {\r\n  return !bookId || bookId.toLowerCase() in data || extraBookList.indexOf(bookId) >= 0;\r\n}\r\nexport const isExtraBookID = (bookId) => {\r\n  return extraBookList.indexOf(bookId) >= 0;\r\n}\r\n\r\n\r\nexport const usfmNumberName = (bookId) => {\r\n  try {return data[bookId.toLowerCase()].usfm;}\r\n  catch(err) {throw new Error(`usfmNumberName() given invalid bookId: '${bookId}'`);}\r\n}\r\n\r\nexport const chaptersInBook = (bookId) => {\r\n  let chapters;\r\n  try {\r\n    chapters = data[bookId.toLowerCase()].chapters;\r\n  } catch (err) {\r\n    throw new Error(`chaptersInBook() given invalid bookId: '${bookId}'`);\r\n  }\r\n  if (chapters === undefined) {\r\n    throw new Error(`chaptersInBook(): Invalid bookId: '${bookId}'`);\r\n  }\r\n  return chapters;\r\n};\r\n\r\nexport const versesInChapter = (bookId, chapter) => {\r\n  const verses = chaptersInBook(bookId)[chapter - 1];\r\n  if (verses === undefined) {\r\n    throw new Error(`versesInChapter(${bookId}) given invalid chapter: ${chapter}`);\r\n  }\r\n  return verses;\r\n};\r\n\r\n// export const bookData = (bookId) => {\r\n//   const _bookData: bookDataIF = data.filter(row => row.id === bookId)[0];\r\n//   return _bookData;\r\n// };\r\n\r\nexport const testament = (bookId) => {\r\n  const _testament = data[bookId.toLowerCase()].testament;\r\n  return _testament;\r\n};\r\n\r\n// export const newTestament = () => {\r\n//   let list[] = [];\r\n//   for (const i=0; i < data.length; i++) {\r\n//     if ( data[i].testament === \"new\" ) {\r\n//       list.push( data[i].title )\r\n//     }\r\n//   }\r\n//   return list;\r\n// }\r\n\r\n// export const oldTestament = () => {\r\n//   let list[] = [];\r\n//   for (const i=0; i < data.length; i++) {\r\n//     if ( data[i].testament === \"old\" ) {\r\n//       list.push( data[i].title )\r\n//     }\r\n//   }\r\n//   return list;\r\n// }\r\n\r\n// export const bookDataTitles = () => {\r\n//   let list[] = [];\r\n//   for (const i=0; i < data.length; i++) {\r\n//       list.push( data[i].title )\r\n//   }\r\n//   return list;\r\n// }\r\n\r\n// export const titlesToBoolean = () => {\r\n//   let ob: opt.bpStateIF = {};\r\n//   let list = bookDataTitles();\r\n//   list.forEach((v,k) => {ob[v]= [false,false]});\r\n//   return ob;\r\n// }\r\n\r\n// export const bookIdByTitle = (title) => {\r\n//   for (const i=0; i < data.length; i++) {\r\n//     if ( data[i].title === title ) {\r\n//       return data[i].id;\r\n//     }\r\n//   }\r\n//   return \"\";\r\n// }\r\n\r\nexport const bookTitleById = (id) => {\r\n  for (const i=0; i < data.length; i++) {\r\n    if ( data[i].id === id ) {\r\n      return data[i].title;\r\n    }\r\n  }\r\n  return \"\";\r\n}\r\n\r\nconst oftenMissingList = [\r\n  // See https://en.wikipedia.org/wiki/List_of_New_Testament_verses_not_included_in_modern_English_translations\r\n  ['NEH', 7, 68], // ?\r\n  ['MAT', 16, 3],\r\n  ['MAT', 17, 21],\r\n  ['MAT', 18, 11],\r\n  // ['MAT', 20, 16b],\r\n  ['MAT', 23, 14],\r\n  // ['MRK', 6, 11b],\r\n  ['MRK', 7, 16],\r\n  ['MRK', 9, 44], ['MRK', 9, 46],\r\n  ['MRK', 11, 26],\r\n  ['MRK', 15, 28],\r\n  ['MRK', 16, 9], ['MRK', 16, 10], ['MRK', 16, 11], ['MRK', 16, 12], ['MRK', 16, 13], ['MRK', 16, 14],\r\n    ['MRK', 16, 15], ['MRK', 16, 16], ['MRK', 16, 17], ['MRK', 16, 18], ['MRK', 16, 19], ['MRK', 16, 20],\r\n  // ['LUK', 4, 8b],\r\n  // ['LUK', 9, 55], ['LUK', 9, 56],\r\n  ['LUK', 17, 36],\r\n  ['LUK', 22, 43], // ?\r\n  ['LUK', 22, 44], // ?\r\n  ['LUK', 23, 17],\r\n  ['JHN', 5, 3], ['JHN', 5, 4],\r\n  ['JHN', 7, 53], // ?\r\n  ['JHN', 8, 1], // ?\r\n  ['ACT', 8, 37],\r\n  // ['ACT', 9, 5], ['ACT', 9, 6],\r\n  // ['ACT', 13, 42],\r\n  ['ACT', 15, 34],\r\n  // ['ACT', 23, 9b],\r\n  ['ACT', 24, 6], ['ACT', 24, 7], ['ACT', 24, 8],\r\n  ['ACT', 28, 29],\r\n  ['ROM', 16, 24],\r\n  ['2CO', 13, 14], // ?\r\n  ['1JN', 5, 7], ['1JN', 5, 8],\r\n];\r\n\r\n\r\nexport function isOftenMissing(bookID,C,V) {\r\n  function matchBCV(entry) { return entry[0]===bookID && entry[1]===C && entry[2]===V; }\r\n\r\n  return oftenMissingList.find(matchBCV) !== undefined;\r\n}\r\n","export function isWhitespace(myString) {\r\n    if (/^\\s+$/.test(myString)) return true;\r\n    return false;\r\n}\r\n\r\n\r\nexport function countOccurrences(mainString, subString, allowOverlapping = false) {\r\n    // Adapted from https://stackoverflow.com/questions/4009756/how-to-count-string-occurrence-in-string\r\n\r\n    mainString += '';\r\n    subString += '';\r\n    if (subString.length <= 0) return (mainString.length + 1);\r\n\r\n    let n = 0,\r\n        pos = 0,\r\n        step = allowOverlapping ? 1 : subString.length;\r\n\r\n    while (true) {\r\n        pos = mainString.indexOf(subString, pos);\r\n        if (pos >= 0) {\r\n            ++n;\r\n            pos += step;\r\n        } else break;\r\n    }\r\n    return n;\r\n}\r\n// end of countOccurrences function\r\n","import { isWhitespace, countOccurrences } from './text-handling-functions'\r\n\r\nconst CHECKER_VERSION_STRING = '0.1.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport function doBasicTextChecks(fieldName, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions) {\r\n    // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n    // fieldName (str): Used for identification\r\n    // fieldText (str): The field being checked\r\n    // allowedLinks (bool): doesn't check links -- only checks lack of links\r\n    // optionalFieldLocation (str): Used to inform where this field is located\r\n\r\n    // We assume that checking for compulsory fields is done elsewhere\r\n\r\n    // Returns a single notice list\r\n    //  The list contains arrays of five objects:\r\n    //      1/ the priority number 0..999 (usually 800+ are errors, lower are warnings)\r\n    //      2/ the error description string\r\n    //      3/ the 0-based index for the position in the string (or -1 if irrelevant)\r\n    //      4/ a short extract of the string containing the error (or empty-string if irrelevant)\r\n    //      5/ the detailed location string\r\n    //  (Returned in this way for more intelligent processing at a higher level)\r\n    // console.log(`doBasicTextChecks(${fieldName}, ${fieldText.length.toLocaleString()} chars, ${allowedLinks}, '${optionalFieldLocation}')…`);\r\n    console.assert(fieldName !== undefined, \"doBasicTextChecks: 'fieldName' parameter should be defined\");\r\n    console.assert(typeof fieldName === 'string', `doBasicTextChecks: 'fieldName' parameter should be a number not a '${typeof fieldName}': ${fieldName}`);\r\n    console.assert(fieldText !== undefined, \"doBasicTextChecks: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldText === 'string', `doBasicTextChecks: 'fieldText' parameter should be a number not a '${typeof fieldText}': ${fieldText}`);\r\n    console.assert(allowedLinks === true || allowedLinks === false, \"doBasicTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n    let result = { noticeList: [] };\r\n\r\n    function addNotice6({priority,message, lineNumber,characterIndex, extract, location}) {\r\n        // console.log(`dBTC Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"dBTCs addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `dBTCs addNotice6: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"dBTCs addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `dBTCs addNotice6: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex !== undefined, \"dBTCs addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `dBTCs addNotice6: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"dBTCs addNotice6: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `dBTCs addNotice6: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"dBTCs addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `dBTCs addNotice6: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        result.noticeList.push({priority, message, lineNumber, characterIndex,extract, location});\r\n    }\r\n\r\n\r\n    // Main code for doBasicTextChecks()\r\n    if (!fieldText) // Nothing to check\r\n        return result;\r\n\r\n    // Create our more detailed location string by prepending the fieldName\r\n    let ourAtString = ` in '${fieldName}'`;\r\n    if (optionalFieldLocation) {\r\n        if (optionalFieldLocation[0] !== ' ') ourAtString += ' ';\r\n        ourAtString += optionalFieldLocation;\r\n    }\r\n\r\n    if (isWhitespace(fieldText)) {\r\n        addNotice6({priority:638, message:\"Only found whitespace\", location:ourAtString});\r\n        return result;\r\n    }\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (btcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    let characterIndex = fieldText.indexOf('<<<<<<<');\r\n    if (characterIndex >= 0) {\r\n        const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n        const extract = (iy > halfLength ? '…' : '') + fieldText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '␣') + (iy + halfLengthPlus < fieldText.length ? '…' : '')\r\n        addNotice6({priority:993, message:\"Unresolved GIT conflict\", characterIndex, extract, location:ourAtString});\r\n    } else {\r\n        characterIndex = fieldText.indexOf('=======');\r\n        if (characterIndex >= 0) {\r\n            const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n            const extract = (iy > halfLength ? '…' : '') + fieldText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '␣') + (iy + halfLengthPlus < fieldText.length ? '…' : '')\r\n            addNotice6({priority:992, message:\"Unresolved GIT conflict\", characterIndex, extract, location:ourAtString});\r\n        } else {\r\n            characterIndex = fieldText.indexOf('>>>>>>>>');\r\n            if (characterIndex >= 0) {\r\n                const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n                const extract = (iy > halfLength ? '…' : '') + fieldText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '␣') + (iy + halfLengthPlus < fieldText.length ? '…' : '')\r\n                addNotice6({priority:991, message:\"Unresolved GIT conflict\", characterIndex, extract, location:ourAtString});\r\n            }\r\n        }\r\n    }\r\n\r\n    if (fieldText[0] === ' ') {\r\n        const extract = fieldText.substring(0, extractLength).replace(/ /g, '␣') + (fieldText.length > extractLength ? '…' : '');\r\n        addNotice6({priority:106, message:`Unexpected leading space${fieldText[1] === ' ' ? \"s\" : \"\"}`, characterIndex:0, extract, location:ourAtString});\r\n    }\r\n    if (fieldText.substring(0, 4) === '<br>' || fieldText.substring(0, 5) === '<br/>' || fieldText.substring(0, 6) === '<br />') {\r\n        const extract = fieldText.substring(0, extractLength) + (fieldText.length > extractLength ? '…' : '');\r\n        addNotice6({priority:107, message:\"Unexpected leading break\", characterIndex:0, extract, location:ourAtString});\r\n    }\r\n    if (fieldText[fieldText.length - 1] === ' ') {\r\n        const extract = (fieldText.length > extractLength ? '…' : '') + fieldText.substring(fieldText.length - 10).replace(/ /g, '␣');\r\n        addNotice6({priority:105, message:\"Unexpected trailing space(s)\", characterIndex:fieldText.length - 1, extract, location:ourAtString});\r\n    }\r\n    if (fieldText.substring(fieldText.length - 4) === '<br>' || fieldText.substring(fieldText.length - 5) === '<br/>' || fieldText.substring(fieldText.length - 6) === '<br />') {\r\n        const extract = (fieldText.length > extractLength ? '…' : '') + fieldText.substring(fieldText.length - 10);\r\n        addNotice6({priority:104, message:\"Unexpected trailing break\", characterIndex:fieldText.length - 1, extract, location:ourAtString});\r\n    }\r\n    if ((characterIndex= fieldText.indexOf('  ')) >= 0) {\r\n        const extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus).replace(/ /g, '␣') + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '')\r\n        addNotice6({priority:194, message:\"Unexpected double spaces\", characterIndex, extract, location:ourAtString});\r\n    }\r\n    if ((characterIndex = fieldText.indexOf('\\n')) >= 0) {\r\n        const extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '')\r\n        addNotice6({priority:583, message:\"Unexpected newLine character\", characterIndex, extract, location:ourAtString});\r\n    }\r\n    if ((characterIndex = fieldText.indexOf('\\r')) >= 0) {\r\n        const extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '')\r\n        addNotice6({priority:582, message:\"Unexpected carriageReturn character\", characterIndex, extract, location:ourAtString});\r\n    }\r\n    if ((characterIndex = fieldText.indexOf('\\xA0')) >= 0) { // non-break space\r\n        const extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus).replace(/\\xA0/g, '⍽') + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '')\r\n        addNotice6({priority:581, message:\"Unexpected non-break space character\", characterIndex, extract, location:ourAtString});\r\n    }\r\n    if ((characterIndex = fieldText.indexOf('\\u202F')) >= 0) { // narrow non-break space\r\n        const extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus).replace(/\\u202F/g, '⍽') + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '')\r\n        addNotice6({priority:580, message:\"Unexpected narrow non-break space character\", characterIndex, extract, location:ourAtString});\r\n    }\r\n    if ((characterIndex= fieldText.indexOf(' …')) >= 0) {\r\n        const extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '')\r\n        addNotice6({priority:179, message:\"Unexpected space before ellipse character\", characterIndex, extract, location:ourAtString});\r\n    }\r\n    if ((characterIndex= fieldText.indexOf('… ')) >= 0) {\r\n        const extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '')\r\n        addNotice6({priority:178, message:\"Unexpected space after ellipse character\", characterIndex, extract, location:ourAtString});\r\n    }\r\n    // Check for doubled punctuation chars (international)\r\n    // Doesn't check for doubled forward slash coz that might occur in a link, e.g., https://etc…\r\n    //  or doubled # coz that occurs in markdown\r\n    let checkList = '’\\'({}<>⟨⟩:,،、‒–—―…!‹›«»‐-?‘’“”\\'\";⁄·&*@•^†‡°¡¿※№÷×ºª%‰+−=‱¶′″‴§~_|‖¦©℗®℠™¤₳฿₵¢₡₢$₫₯֏₠€ƒ₣₲₴₭₺₾ℳ₥₦₧₱₰£៛₽₹₨₪৳₸₮₩¥';\r\n    if (!allowedLinks) checkList += '[].)' // Double square brackets can be part of markdown links, double periods can be part of a path\r\n    for (const punctChar of checkList) {\r\n        characterIndex = fieldText.indexOf(punctChar + punctChar);\r\n        if (characterIndex >= 0) {\r\n            let extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '')\r\n            addNotice6({priority:177, message:`Unexpected doubled ${punctChar} characters`, characterIndex, extract, location:ourAtString});\r\n        }\r\n    }\r\n    // Check for punctuation chars following space\r\n    for (const punctChar of '.\\')}>⟩:,،、‒–—―…!.‹›«»‐-?’”\\'\";/⁄·*@•^†‡°¡¿※#№÷×ºª%‰‱¶′″‴§~_|‖¦©℗®℠™¤₳฿₵¢₡₢$₫₯֏₠€ƒ₣₲₴₭₺₾ℳ₥₦₧₱₰£៛₽₹₨₪৳₸₮₩¥') {\r\n        characterIndex = fieldText.indexOf(' ' + punctChar);\r\n        if (characterIndex >= 0) {\r\n            let extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '')\r\n            addNotice6({priority:191, message:`Unexpected ${punctChar} character after space`, characterIndex, extract, location:ourAtString});\r\n        }\r\n    }\r\n    // Check for punctuation chars before space\r\n    //  Removed ' (can be normal, e.g., Jesus' cloak)\r\n    for (const punctChar of '[({<⟨،、‒–—―‹«‐‘“/⁄·@\\•^†‡°¡¿※№×ºª‰‱¶′″‴§~_|‖¦©℗℠™¤₳฿₵¢₡₢$₫₯֏₠€ƒ₣₲₴₭₺₾ℳ₥₦₧₱₰£៛₽₹₨₪৳₸₮₩¥') {\r\n        characterIndex = fieldText.indexOf(punctChar + ' ');\r\n        if (characterIndex >= 0) {\r\n            let extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '')\r\n            addNotice6({priority:192, message:`Unexpected space after ${punctChar} character`, characterIndex, extract, location:ourAtString});\r\n        }\r\n    }\r\n\r\n    // Check matched pairs\r\n    for (const punctSet of [['[', ']'], ['(', ')'], ['{', '}'],\r\n                            ['<', '>'], ['⟨', '⟩'], ['“', '”'],\r\n                            ['‹', '›'], ['«', '»'], ['**_', '_**']]) {\r\n        // Can't check '‘’' coz they might be used as apostrophe\r\n        const leftChar = punctSet[0], rightChar = punctSet[1];\r\n        const lCount = countOccurrences(fieldText, leftChar);\r\n        const rCount = countOccurrences(fieldText, rightChar);\r\n        if (lCount !== rCount)\r\n            addNotice6({priority:663, message:`Mismatched ${leftChar}${rightChar} characters`, extract:`(left=${lCount.toLocaleString()}, right=${rCount.toLocaleString()})`, location:ourAtString});\r\n    }\r\n\r\n    if (!allowedLinks) {\r\n        // Simple check that there aren't any\r\n        characterIndex = fieldText.indexOf('://');\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('http');\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('ftp');\r\n        // The following might have to be removed if text fields can contain email addresses\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('.org');\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('.com');\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('.info');\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('.bible');\r\n        if (characterIndex >= 0) {\r\n            let extract = `${characterIndex > halfLength ? '…' : ''}${fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus)}${characterIndex + halfLengthPlus < fieldText.length ? '…' : ''}`\r\n            addNotice6({priority:765, message:\"Unexpected link\", characterIndex, extract, location:ourAtString});\r\n        }\r\n    }\r\n    return result;\r\n}\r\n// end of doBasicTextChecks function\r\n\r\nexport default doBasicTextChecks;\r\n","import { isWhitespace, countOccurrences } from './text-handling-functions'\r\n\r\nconst CHECKER_VERSION_STRING = '0.1.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport function doBasicFileChecks(filename, fileText, optionalFileLocation, optionalCheckingOptions) {\r\n    // Does basic checks for small errors like mismatched punctuation pairs, etc.\r\n    //  (Used by usfm-text-check)\r\n\r\n    // filename (str): Used for identification\r\n    // fileText (str): The field being checked\r\n    // allowedLinks (bool): doesn't check links -- only checks lack of links\r\n    // optionalFileLocation (str): Used to inform where this field is located\r\n\r\n    // We assume that checking for compulsory fields is done elsewhere\r\n\r\n    // Returns a single notice list\r\n    //  The list contains arrays of five objects:\r\n    //      1/ the priority number 0..999 (usually 800+ are errors, lower are warnings)\r\n    //      2/ the error description string\r\n    //      3/ the 0-based index for the position in the string (or -1 if irrelevant)\r\n    //      4/ a short extract of the string containing the error (or empty-string if irrelevant)\r\n    //      5/ the detailed location string\r\n    //  (Returned in this way for more intelligent processing at a higher level)\r\n    // console.log(`doBasicFileChecks(${filename}, ${fileText.length.toLocaleString()} chars, ${allowedLinks}, '${optionalFileLocation}')…`);\r\n    console.assert(filename !== undefined, \"doBasicFileChecks: 'filename' parameter should be defined\");\r\n    console.assert(typeof filename === 'string', `doBasicFileChecks: 'filename' parameter should be a number not a '${typeof filename}': ${filename}`);\r\n    console.assert(fileText !== undefined, \"doBasicFileChecks: 'fileText' parameter should be defined\");\r\n    console.assert(typeof fileText === 'string', `doBasicFileChecks: 'fileText' parameter should be a number not a '${typeof fileText}': ${fileText}`);\r\n    // console.assert( allowedLinks===true || allowedLinks===false, \"doBasicFileChecks: allowedLinks parameter must be either true or false\");\r\n\r\n    let result = { noticeList: [] };\r\n\r\n    function addNotice6({priority,message, lineNumber,characterIndex, extract, location}) {\r\n        // console.log(`dBTC Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"dBTCs addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `dBTCs addNotice6: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"dBTCs addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `dBTCs addNotice6: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex !== undefined, \"dBTCs addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `dBTCs addNotice6: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"dBTCs addNotice6: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `dBTCs addNotice6: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"dBTCs addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `dBTCs addNotice6: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        result.noticeList.push({priority, message, lineNumber, characterIndex,extract, location});\r\n    }\r\n\r\n\r\n    // Main code for doBasicFileChecks()\r\n    if (!fileText) // Nothing to check\r\n        return result;\r\n\r\n    // Create our more detailed location string by prepending the filename\r\n    let ourAtString = ` in '${filename}'`;\r\n    if (optionalFileLocation) {\r\n        if (optionalFileLocation[0] !== ' ') ourAtString += ' ';\r\n        ourAtString += optionalFileLocation;\r\n    }\r\n\r\n    if (isWhitespace(fileText)) {\r\n        addNotice6({priority:638, message:\"Only found whitespace\", location:ourAtString});\r\n        return result;\r\n    }\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (bfcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    let characterIndex;\r\n    if ((characterIndex = fileText.indexOf('<<<<<<<')) >= 0) {\r\n        const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n        const extract = (iy > halfLength ? '…' : '') + fileText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '␣') + (iy + halfLengthPlus < fileText.length ? '…' : '')\r\n        addNotice6({priority:993, message:\"Unresolved GIT conflict\", characterIndex, extract, location:ourAtString});\r\n    } else if ((characterIndex = fileText.indexOf('=======')) >= 0) {\r\n        const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n        const extract = (iy > halfLength ? '…' : '') + fileText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '␣') + (iy + halfLengthPlus < fileText.length ? '…' : '')\r\n        addNotice6({priority:992, message:\"Unresolved GIT conflict\", characterIndex, extract, location:ourAtString});\r\n    } else if ((characterIndex = fileText.indexOf('>>>>>>>>')) >= 0) {\r\n        const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n        const extract = (iy > halfLength ? '…' : '') + fileText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '␣') + (iy + halfLengthPlus < fileText.length ? '…' : '')\r\n        addNotice6({priority:991, message:\"Unresolved GIT conflict\", characterIndex, extract, location:ourAtString});\r\n    }\r\n\r\n    // Check matched pairs\r\n    for (const punctSet of [['[', ']'], ['(', ')'], ['{', '}'],\r\n    ['<', '>'], ['⟨', '⟩'], ['“', '”'],\r\n    ['‹', '›'], ['«', '»'], ['**_', '_**']]) {\r\n        // Can't check '‘’' coz they might be used as apostrophe\r\n        const leftChar = punctSet[0], rightChar = punctSet[1];\r\n        const lCount = countOccurrences(fileText, leftChar);\r\n        const rCount = countOccurrences(fileText, rightChar);\r\n        if (lCount !== rCount)\r\n            addNotice6({priority:163, message:`Mismatched ${leftChar}${rightChar} characters`, extract:`(left=${lCount.toLocaleString()}, right=${rCount.toLocaleString()})`, location:ourAtString});\r\n    }\r\n\r\n    // if (!allowedLinks) {\r\n    //     // Simple check that there aren't any\r\n    //     ix = fileText.indexOf('://');\r\n    //     if (ix === -1) ix = fileText.indexOf('http');\r\n    //     if (ix === -1) ix = fileText.indexOf('ftp');\r\n    //     // The following might have to be removed if text fields can contain email addresses\r\n    //     if (ix === -1) ix = fileText.indexOf('.org');\r\n    //     if (ix === -1) ix = fileText.indexOf('.com');\r\n    //     if (ix === -1) ix = fileText.indexOf('.info');\r\n    //     if (ix === -1) ix = fileText.indexOf('.bible');\r\n    //     if (ix >= 0) {\r\n    //         let extract = (ix>halfLength ? '…' : '') + fileText.substring(ix-halfLength, ix+halfLengthPlus) + (ix+halfLengthPlus < fileText.length ? '…' : '')\r\n    //         addNotice6({765, \"Unexpected link\", ix,extract, ourAtString});\r\n    //     }\r\n    // }\r\n    return result;\r\n}\r\n// end of doBasicFileChecks function\r\n\r\nexport default doBasicFileChecks;\r\n","import { toJSON } from 'usfm-js';\r\n\r\n\r\nexport function runUsfmJsCheck(fileText, convertOptions) {\r\n    // Runs the USFM-JS converter as a check\r\n    //  which can be quite time-consuming on large, complex USFM files\r\n    // console.log(\"Running USFM-JS converter check (can take quite a while for a large book)…\");\r\n\r\n    const jsonResult = toJSON(fileText, convertOptions);\r\n    const jsonKeys = Object.keys(jsonResult); // Expect 'headers', 'chapters'\r\n    const numJSONkeys = jsonKeys.length;\r\n    // console.log(`  Finished USFM-JS converter check with ${numJSONkeys} json key(s)`);\r\n    // console.log(`  jsonResult: ${JSON.stringify(jsonResult)}`)\r\n    // NOTE: We don't know how to get the errors out yet\r\n\r\n    return { isValidUSFM: numJSONkeys >= 2, returnedJSON:jsonResult }; // Expect 'headers', 'chapters'\r\n}\r\n// end of runUsfmJsCheck function\r\n\r\n\r\nexport function checkUSFMToJSON(bookID, filename, givenText, givenLocation, optionalCheckingOptions) {\r\n    /*\r\n    This function is only used for the demonstration pages -- not for the core!\r\n\r\n    bookID is a three-character UPPERCASE USFM book identifier.\r\n\r\n        filename parameter can be an empty string if we don't have one.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`checkUSFMToJSON(${givenText.length.toLocaleString()} chars, '${givenLocation}')…`);\r\n\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (filename) ourLocation = ` in ${filename}${ourLocation}`;\r\n\r\n\r\n    const result = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkUSFMToJSON success: ${successString}`);\r\n        result.successList.push(successString);\r\n    }\r\n    function addNotice6to7({priority, message, lineNumber, characterIndex, extract, location}) {\r\n        /**\r\n        * @description - adds a new notice entry, adding bookID,C,V to the given fields\r\n        * @param {Number} priority - notice priority from 1 (lowest) to 999 (highest)\r\n        * @param {String} message - the text of the notice message\r\n        * @param {Number} characterIndex - where the issue occurs in the line (or -1 if unknown)\r\n        * @param {String} extract - short extract from the line centred on the problem (if available)\r\n        * @param {String} location - description of where the issue is located\r\n        */\r\n        // console.log(`checkUSFMToJSON notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cUSFMjs addNotice6to7: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cUSFMjs addNotice6to7: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cUSFMjs addNotice6to7: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cUSFMjs addNotice6to7: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex !== undefined, \"cUSFMjs addNotice6to7: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cUSFMjs addNotice6to7: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cUSFMjs addNotice6to7: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cUSFMjs addNotice6to7: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cUSFMjs addNotice6to7: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cUSFMjs addNotice6to7: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        result.noticeList.push({priority,message, bookID, lineNumber, characterIndex, extract, location});\r\n    }\r\n\r\n\r\n    // Set your options here -- change values or comment out lines\r\n    const convertOptions = {\r\n        'chunk': true,\r\n        'content-source': ourLocation,\r\n        'convertToInt': []\r\n        };\r\n    const convertCheckResult = runUsfmJsCheck(givenText, ourLocation, convertOptions);\r\n    // NOTE: We haven't figured out how to get ERRORS out of this parser yet\r\n\r\n    if (!convertCheckResult.isValidUSFM)\r\n        addNotice6to7({priority:943, message:`USFM3 toJSON Check doesn't pass`, location:ourLocation});\r\n\r\n    addSuccessMessage(`Checked USFM-JS`);\r\n    // console.log(`  checkUSFMToJSON returning with ${result.successList.length.toLocaleString()} success(es) and ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(`checkUSFMToJSON result is ${JSON.stringify(result)}`);\r\n    return result;\r\n}\r\n// end of checkUSFMToJSON function\r\n\r\n\r\nexport default checkUSFMToJSON;\r\n","import grammar from 'usfm-grammar';\r\nimport * as books from '../core/books/books';\r\n\r\n\r\nconst USFM_GRAMMAR_VALIDATOR_VERSION = '0.3.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport function runBCSGrammarCheck(strictnessString, fileText, givenLocation, optionalCheckingOptions) {\r\n    // Runs the BCS USFM Grammar checker\r\n    //  which can be quite time-consuming on large, complex USFM files\r\n    // console.log(`Running ${strictnessString} BCS USFM grammar check${givenLocation} (can take quite a while for a large book)…`);\r\n    console.assert(strictnessString === 'strict' || strictnessString === 'relaxed', `Unexpected strictnessString='${strictnessString}'`);\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (usfmELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength} cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    // Now create the parser and run the check\r\n    const ourUsfmParser = new grammar.USFMParser(fileText,\r\n        strictnessString === 'relaxed' ? grammar.LEVEL.RELAXED : null);\r\n    // Returns a Boolean indicating whether the input USFM text satisfies the grammar or not.\r\n    // This method is available in both default and relaxed modes.\r\n    // const parserResult = ourUsfmParser.validate();\r\n    const parserResult = ourUsfmParser.toJSON()\r\n    let parserMessages;\r\n    parserMessages = parserResult._messages; // Throw away the JSON (if any)\r\n    // console.log(`  Finished BCS USFM grammar check with messages: ${JSON.stringify(parserResult)}\\n and warnings: ${JSON.stringify(ourUsfmParser.warnings)}.`);\r\n    let parseError;\r\n    parseError = parserMessages._error;\r\n    // console.log(`  parseError: ${parseError}`);\r\n    let ourErrorMessage, lineNumberString, characterIndex, extract;\r\n    // NOTE: The following code is quite fragile\r\n    //  as it depends on the precise format of the error message return from USFMParser\r\n    let ourErrorObject = {};\r\n    if (parseError) {\r\n        const contextRE = /(\\d+?)\\s\\|\\s(.+)/g;\r\n        for (const errorLine of parseError.split('\\n')) {\r\n            // console.log(`BCS errorLine=${errorLine}`);\r\n            if (errorLine.startsWith('>')) {\r\n                const regexResult = contextRE.exec(errorLine.substring(1).trim());\r\n                // console.log(`  regexResult: ${JSON.stringify(regexResult)}`);\r\n                if (regexResult) {\r\n                    lineNumberString = regexResult[1];\r\n                    extract = regexResult[2];\r\n                }\r\n            }\r\n            else if (errorLine.endsWith('^')) {\r\n                characterIndex = errorLine.indexOf('^') - 8;\r\n                if (characterIndex < 0) characterIndex = 0; // Just in case\r\n                if (extract.length)\r\n                    extract = (characterIndex > halfLength ? '…' : '') + extract.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < extract.length ? '…' : '')\r\n            }\r\n            else ourErrorMessage = errorLine; // We only want the last one\r\n        }\r\n        // console.log(`  ourErrorMessage: '${ourErrorMessage}' lineNumberString=${lineNumberString} characterIndex=${characterIndex} extract='${extract}'`);\r\n        // NOTE: \\s5 fields are not valid USFM but we degrade the priority of those warnings\r\n        ourErrorObject = {priority:extract==='\\\\s5'? 294:994, message:`USFMGrammar: ${ourErrorMessage}`, characterIndex, extract, location:`in line ${lineNumberString}${givenLocation}`};\r\n    }\r\n\r\n    const parseWarnings = parserResult._warnings ? parserResult._warnings : ourUsfmParser.warnings;\r\n    // console.log(`  Warnings: ${JSON.stringify(parseWarnings)}`);\r\n    let ourWarnings = [];\r\n    for (const warningString of parseWarnings) {\r\n        // console.log(`warningString: '${warningString}'`);\r\n        // Clean up their warnings a little: Remove trailing spaces and periods\r\n        let adjustedString = warningString.trim(); // Removes the trailing space\r\n        if (adjustedString.endsWith('.')) adjustedString = adjustedString.substring(0, adjustedString.length - 1);\r\n        ourWarnings.push(adjustedString);\r\n    }\r\n\r\n    return { isValidUSFM: !parseError, error: ourErrorObject, warnings: ourWarnings };\r\n}\r\n// end of runBCSGrammarCheck function\r\n\r\n\r\nexport function checkUSFMGrammar(bookID, strictnessString, filename, givenText, givenLocation, optionalCheckingOptions) {\r\n    /*\r\n    This function is only used for the demonstration pages -- not for the core!\r\n\r\n    bookID is a three-character UPPERCASE USFM book identifier.\r\n\r\n    filename parameter can be an empty string if we don't have one.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    console.log(`checkUSFMGrammar(${givenText.length.toLocaleString()} chars, '${location}')…`);\r\n    console.assert(strictnessString === 'strict' || strictnessString === 'relaxed', `Unexpected strictnessString='${strictnessString}'`);\r\n\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (filename) ourLocation = ` in ${filename}${ourLocation}`;\r\n\r\n\r\n    const cugResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkUSFMGrammar success: ${successString}`);\r\n        cugResult.successList.push(successString);\r\n    }\r\n    function addNotice6to7({priority, message, lineNumber, characterIndex, extract, location}) {\r\n        /**\r\n        * @description - adds a new notice entry, adding bookID,C,V to the given fields\r\n        * @param {Number} priority - notice priority from 1 (lowest) to 999 (highest)\r\n        * @param {String} message - the text of the notice message\r\n        * @param {Number} characterIndex - where the issue occurs in the line (or -1 if unknown)\r\n        * @param {String} extract - short extract from the line centred on the problem (if available)\r\n        * @param {String} location - description of where the issue is located\r\n        */\r\n        // console.log(`checkUSFMGrammar notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cUSFMgr addNotice6to7: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cUSFMgr addNotice6to7: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cUSFMgr addNotice6to7: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cUSFMgr addNotice6to7: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex !== undefined, \"cUSFMgr addNotice6to7: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cUSFMgr addNotice6to7: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cUSFMgr addNotice6to7: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cUSFMgr addNotice6to7: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cUSFMgr addNotice6to7: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cUSFMgr addNotice6to7: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        cugResult.noticeList.push({priority,message, bookID,lineNumber, characterIndex,extract, location});\r\n    }\r\n\r\n\r\n    // Main code for checkUSFMGrammar function\r\n    if (books.isExtraBookID(bookID)) // doesn't work for these\r\n        return cugResult;\r\n\r\n    const grammarCheckResult = runBCSGrammarCheck(strictnessString, givenText, ourLocation, optionalCheckingOptions);\r\n    // console.log(`grammarCheckResult=${JSON.stringify(grammarCheckResult)}`);\r\n\r\n    if (!grammarCheckResult.isValidUSFM)\r\n        addNotice6to7({priority:944, message:`USFM3 Grammar Check (${strictnessString} mode) doesn't pass`, location:ourLocation});\r\n\r\n    // We only get one error if it fails\r\n    if (grammarCheckResult.error && grammarCheckResult.error[0])\r\n        addNotice6to7({priority:grammarCheckResult.error.priority, message:grammarCheckResult.error.message,\r\n            characterIndex:grammarCheckResult.error.characterIndex, extract:grammarCheckResult.error.extract,\r\n            location:grammarCheckResult.error.location});\r\n\r\n    // Display these warnings but with a lowish priority\r\n    for (const warningString of grammarCheckResult.warnings)\r\n        addNotice6to7({priority:101, message:`USFMGrammar: ${warningString}`, location:ourLocation});\r\n\r\n    addSuccessMessage(`Checked USFM Grammar (${strictnessString} mode) ${grammarCheckResult.isValidUSFM ? \"without errors\" : \" (but the USFM DIDN'T validate)\"}`);\r\n    // console.log(`  checkUSFMGrammar returning with ${result.successList.length.toLocaleString()} success(es) and ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(`checkUSFMGrammar result is ${JSON.stringify(result)}`);\r\n    return cugResult;\r\n}\r\n// end of checkUSFMGrammar function\r\n\r\n\r\nexport default checkUSFMGrammar;\r\n","// utilities\r\n\r\n// import { isUndefined } from 'lodash';\r\n\r\n\r\nexport function consoleLogObject(clTitle, clObject) {\r\n    // Print an object's componenets to the console\r\n    // Note: the following line succeeds even if length and/or size are undefined\r\n    let clOutput = `cLO: ${clTitle} ${typeof clObject} (length=${clObject.length}) (size=${clObject.size}):\\n`;\r\n    for (const clPropertyName in clObject) {\r\n        // console.log(\"   \", clTitle, clPropertyName); // for debugging only!\r\n        let thisPropertyContents = \"\" + clObject[clPropertyName];\r\n        if (thisPropertyContents.length > 50)\r\n            thisPropertyContents = `(${thisPropertyContents.length}) ${thisPropertyContents.substring(0, 50)}…`;\r\n        let oType = typeof clObject[clPropertyName];\r\n        // From https://stackoverflow.com/questions/12996871/why-does-typeof-array-with-objects-return-object-and-not-array#12996879\r\n        if (oType === \"object\" && Object.prototype.toString.call(clObject[clPropertyName]) === \"[object Array]\")\r\n            oType = \"array\";\r\n        clOutput += `  ${clPropertyName} (type=${oType})`;\r\n        let oLength;\r\n        try { oLength = clObject[clPropertyName].length; }\r\n        catch (olError) { oLength = \"null\" }\r\n        if (oLength !== undefined) clOutput += ` (length=${oLength})`;\r\n        if (thisPropertyContents !== undefined) clOutput += `: ${thisPropertyContents}\r\n`;\r\n    }\r\n    console.log(clOutput);\r\n}\r\n// end of consoleLogObject function\r\n\r\n\r\nexport function displayPropertyNames(givenTitle, givenObject) {\r\n    let output = `dPN: ${givenTitle} ${typeof givenObject}:\r\n`;\r\n    for (const propertyName in givenObject)\r\n        output += `  ${propertyName} (type=${typeof givenObject[propertyName]})\r\n`;\r\n    console.log(output);\r\n}\r\n// end of displayPropertyNames function\r\n\r\n\r\nexport function ourParseInt(givenString) {\r\n    /*\r\n    The regular parseInt() function is too forgiving\r\n\r\n    See https://stackoverflow.com/questions/1133770/how-to-convert-a-string-to-an-integer-in-javascript\r\n\r\n    This one throws an error if the entire field doesn't give an integer.\r\n    */\r\n\r\n    /* First attempt\r\n    const int1 = parseInt(givenString, 10); // Don't let the function guess the base (if the string has a leading zero)\r\n    const int2 = givenString * 1; // This one is less forgiving it seems\r\n    if (int1!==int2) console.log(`From '${givenString}' we got ${int1} (${typeof int1}) and ${int2} (${typeof int2})`)\r\n    if (isNaN(int2) || isNaN(int1)\r\n    || int2===undefined || int1==undefined\r\n    || int2!==int1)\r\n        throw \"String is not a simple integer\";\r\n    return int1;\r\n    */\r\n\r\n    // Optimised version\r\n    const int = givenString * 1; // This one is less forgiving it seems\r\n    if (isNaN(int)) throw \"String is not a simple integer\";\r\n    return int;\r\n}\r\n\r\n\r\n/*\r\n// function to convert an array to an object\r\n// with keys being 0..n\r\nexport const array_to_obj = ( ar => {\r\n  const ob = {};\r\n  Object.assign(ob,ar);\r\n  return ob;\r\n});\r\n\r\n// function to convert map to object\r\nexport const map_to_obj = ( mp => {\r\n  const ob = {};\r\n  mp.forEach((v,k) => {ob[k]=v});\r\n  return ob;\r\n});\r\n\r\n// function to convert object to a map\r\nexport const obj_to_map = ( ob => {\r\n  const mp = new Map();\r\n  Object.keys ( ob ).forEach (k => { mp.set(k, ob[k]) });\r\n  return mp;\r\n});\r\n\r\n// function to convert word frequency map\r\n// to an object suitable for MaterialTable\r\nexport const wf_to_mt = ( ob => {\r\n  const mt = {};\r\n  mt.title = \"Word Frequency\";\r\n  mt.columns = [\r\n      { title: \"Word\", field: \"word\" },\r\n      { title: \"Count\", field: \"check\" },\r\n  ];\r\n  mt.data = [];\r\n  Object.keys(ob).forEach ( w => {\r\n      mt.data.push({ word: w, check: ob[w] })\r\n  })\r\n\r\n  mt.options = { sorting: true, exportButton: true };\r\n\r\n  return mt;\r\n});\r\n\r\n// function to convert an array of words to\r\n// an object suitable for MaterialTable\r\nexport const aw_to_mt = ( ar => {\r\n  // first convert array to object\r\n  const ob = array_to_obj(ar);\r\n  const mt = {};\r\n  mt.title = \"All Words in Text Order\";\r\n  mt.columns = [\r\n      { title: \"Order\", field: \"order\" , type: \"numeric\"},\r\n      { title: \"Word\", field: \"word\" },\r\n  ];\r\n  mt.data = [];\r\n  Object.keys(ob).forEach ( n => {\r\n      mt.data.push({ order: n, word: ob[n] })\r\n  });\r\n\r\n  mt.options = { sorting: true };\r\n\r\n  return mt;\r\n});\r\n*/\r\n","import * as books from '../core/books/books';\r\nimport { isWhitespace, countOccurrences } from './text-handling-functions'\r\nimport doBasicTextChecks from './basic-text-check';\r\nimport doBasicFileChecks from './basic-file-check';\r\nimport { runUsfmJsCheck } from './usfm-js-check';\r\nimport { runBCSGrammarCheck } from './BCS-usfm-grammar-check';\r\nimport { ourParseInt, consoleLogObject } from './utilities';\r\n\r\n\r\nconst USFM_VALIDATOR_VERSION = '0.6.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\n// See http://ubsicap.github.io/usfm/master/index.html\r\nconst INTRO_LINE_START_MARKERS = ['id', 'usfm', 'ide', 'h',\r\n    'toc1', 'toc2', 'toc3',\r\n    'mt', 'mt1', 'mt2',\r\n    'mte', 'mte1', 'mte2',\r\n    'imt', 'imt1', 'imt2',\r\n    'is', 'is1', 'is2',\r\n    'ip', 'ipi', 'im', 'imi', 'ipq', 'imq', 'ipr',\r\n    'iq', 'iq1', 'iq2',\r\n    'ili', 'ili1', 'ili2',\r\n    'iot', 'io', 'io1', 'io2',\r\n    'iex', 'imte', 'imte1', 'imte2'];\r\nconst CV_MARKERS = ['c', 'v', 'ca', 'va'];\r\nconst HEADING_TYPE_MARKERS = [ // expected to contain text on the same line\r\n    's', 's1', 's2', 's3', 's4', 'sr',\r\n    'ms', 'ms1', 'mr',\r\n    'r', 'd', 'rem', 'sp', 'qs', 'cl',\r\n    'sd', 'sd1', 'sd2',\r\n    'pr', 'cls', 'pmo', 'pmc', 'pmr', 'pc',\r\n    'periph'];\r\nconst PARAGRAPH_MARKERS = ['p', 'q', 'q1', 'q2', 'q3', 'q4',\r\n    'm', 'mi',\r\n    'pi', 'pi1', 'pi2', 'pi3', 'pi4',\r\n    'li', 'li1', 'li2', 'li3', 'li4',\r\n    'lim', 'lim1', 'lim2', 'lim3', 'lim4',\r\n    'lh', 'lf',\r\n    'po', 'pm',\r\n    'ph', 'ph1', 'ph2', 'ph3', 'ph4',\r\n    'tr'];\r\nconst NOTE_MARKERS = ['f', 'x'];\r\nconst SPECIAL_MARKERS = ['w', 'zaln-s', 'k-s',\r\n    'qt-s', 'qt1-s', 'qt2-s',\r\n    'lit'];\r\nconst MILESTONE_MARKERS = ['ts\\\\*', 'ts-s', 'ts-e', 'k-e\\\\*']; // Is this a good way to handle it???\r\nconst MARKERS_WITHOUT_CONTENT = ['b', 'nb', 'ib', 'ie'].concat(MILESTONE_MARKERS);\r\nconst ALLOWED_LINE_START_MARKERS = [].concat(INTRO_LINE_START_MARKERS).concat(HEADING_TYPE_MARKERS)\r\n    .concat(CV_MARKERS).concat(PARAGRAPH_MARKERS)\r\n    .concat(NOTE_MARKERS).concat(SPECIAL_MARKERS).concat(MARKERS_WITHOUT_CONTENT)\r\n    .concat(MILESTONE_MARKERS);\r\nconst DEPRECATED_MARKERS = [\r\n    'h1', 'h2', 'h3', 'h4',\r\n    'pr',\r\n    'ph', 'ph1', 'ph2', 'ph3', 'ph4',\r\n    'addpn', 'pro', 'fdc', 'xdc'];\r\nconst MARKERS_WITH_COMPULSORY_CONTENT = [].concat(INTRO_LINE_START_MARKERS).concat(HEADING_TYPE_MARKERS)\r\n    .concat(CV_MARKERS).concat(NOTE_MARKERS).concat(SPECIAL_MARKERS);\r\nconst CHARACTER_MARKERS = ['add', 'bk', 'dc', 'k', 'nd', 'ord', 'pn', 'png', 'addpn',\r\n    'qt', 'sig', 'sls', 'tl', 'wj',\r\n    'rq', 'ior', 'iqt',\r\n    'em', 'bd', 'it', 'bdit', 'no', 'sc', 'sup',\r\n    'fig', 'ndx', 'rb', 'pro', 'w', 'wg', 'wh', 'wa', // NOTE that we have \\w in TWO places\r\n    'litl', 'lik',\r\n    'liv', 'liv1', 'liv2', 'liv3', 'liv4'];\r\nconst FOOTNOTE_INTERNAL_MARKERS = ['fr', 'fq', 'fqa', 'fk', 'fl', 'fw', 'fp', 'fv', 'ft', 'fdc', 'fm', 'xt'];\r\nconst XREF_INTERNAL_MARKERS = ['xo', 'xk', 'xq', 'xt', 'xta', 'xop', 'xot', 'xnt', 'xdc', 'rq'];\r\nconst COMPULSORY_MARKERS = ['id', 'ide'];\r\nconst EXPECTED_MARKERS = ['usfm', 'mt1'];\r\nconst EXPECTED_BIBLE_BOOK_MARKERS = ['h', 'toc1', 'toc2', 'toc3'];\r\nconst EXPECTED_PERIPHERAL_BOOK_MARKERS = ['periph'];\r\n\r\n\r\nfunction checkUSFMText(bookID, filename, givenText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all lines.\r\n\r\n    bookID is a three-character UPPERCASE USFM book identifier.\r\n\r\n    filename parameter can be an empty string if we don't have one.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`checkUSFMText(${bookID}, ${givenText.length.toLocaleString()} chars, '${location}')…`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (filename.length) ourLocation = ` in ${filename}${ourLocation}`;\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (usfmELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength} cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const result = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkUSFMText success: ${successString}`);\r\n        result.successList.push(successString);\r\n    }\r\n    function addNoticeCV8({priority, message, C, V, lineNumber, characterIndex, extract, location}) {\r\n        // console.log(`checkUSFMText addNoticeCV8: (priority=${priority}) ${C}:${V} ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cUSFM addNoticeCV8: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cUSFM addNoticeCV8: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cUSFM addNoticeCV8: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cUSFM addNoticeCV8: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(C !== undefined, \"cUSFM addNoticeCV8: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `cUSFM addNoticeCV8: 'C' parameter should be a string not a '${typeof C}': ${C}`);\r\n        // console.assert(V !== undefined, \"cUSFM addNoticeCV8: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `cUSFM addNoticeCV8: 'V' parameter should be a string not a '${typeof V}': ${V}`);\r\n        // console.assert(characterIndex !== undefined, \"cUSFM addNoticeCV8: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cUSFM addNoticeCV8: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cUSFM addNoticeCV8: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cUSFM addNoticeCV8: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cUSFM addNoticeCV8: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cUSFM addNoticeCV8: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        result.noticeList.push({priority,message, bookID, C, V, lineNumber, characterIndex, extract, location});\r\n    }\r\n\r\n\r\n    function ourRunBCSGrammarCheck(fileText, fileLocation) {\r\n        // Runs the BCS USFM Grammar checker\r\n        //  which can be quite time-consuming on large, complex USFM files\r\n        // console.log(\"Running our BCS USFM grammar check (can take quite a while for a large book)…\");\r\n\r\n        const grammarCheckResult = runBCSGrammarCheck('strict', fileText, fileLocation, optionalCheckingOptions);\r\n        // NOTE: We haven't figured out how to get ERRORS out of this parser yet\r\n        // console.log(`  Finished our BCS USFM grammar check with ${grammarCheckResult.isValidUSFM} and ${grammarCheckResult.warnings.length} warnings.`);\r\n        addSuccessMessage(`Checked USFM Grammar (strict mode) ${grammarCheckResult.isValidUSFM ? \"without errors\" : \" (but the USFM DIDN'T validate)\"}`);\r\n\r\n        // if (!grammarCheckResult.isValidUSFM) // TEMP DEGRADE TO WARNING 994 -> 544 ................XXXXXXXXXXXXXXXXXXXXXX\r\n            // Don't do this since we add the actual error message elsewhere now\r\n            // addNoticeCV8({priority:994, '', '', `USFM3 Grammar Check (strict mode) doesn't pass`, -1, \"\", location:fileLocation});\r\n\r\n        // We only get one error if it fails\r\n        if (grammarCheckResult.error && grammarCheckResult.error.priority)\r\n            // Prevent these false alarms (from Ohm schema issues)\r\n            if (!grammarCheckResult.error.extract\r\n            || (grammarCheckResult.error.extract.indexOf('emma=\"\"') < 0 && grammarCheckResult.error.message.indexOf('Expected \"c\", \"v\", ') < 0))\r\n                addNoticeCV8({priority:grammarCheckResult.error.priority, message:grammarCheckResult.error.message,\r\n                    characterIndex:grammarCheckResult.error.characterIndex, extract:grammarCheckResult.error.extract,\r\n                    location:grammarCheckResult.error.location});\r\n\r\n        // console.log(\"  Warnings:\", JSON.stringify(grammarCheckResult.warnings));\r\n        // Display these warnings but with a lower priority\r\n        for (const warningString of grammarCheckResult.warnings)\r\n            if (!warningString.startsWith(\"Empty lines present\") // we allow empty lines in our USFM\r\n                && !warningString.startsWith(\"Trailing spaces present at line end\") // we find these ourselves\r\n            )\r\n                addNoticeCV8({priority:102, message:`USFMGrammar: ${warningString}`, location:fileLocation});\r\n\r\n        if (!grammarCheckResult.isValidUSFM) {\r\n            const relaxedGrammarCheckResult = runBCSGrammarCheck('relaxed', fileText, fileLocation);\r\n            addSuccessMessage(`Checked USFM Grammar (relaxed mode) ${relaxedGrammarCheckResult.isValidUSFM ? \"without errors\" : \" (but the USFM DIDN'T validate)\"}`);\r\n            if (!relaxedGrammarCheckResult.isValidUSFM)\r\n                addNoticeCV8({priority:644, message:`USFM3 Grammar Check (relaxed mode) doesn't pass either`, location:fileLocation});\r\n\r\n        }\r\n    }\r\n    // end of ourRunBCSGrammarCheck function\r\n\r\n\r\n    function CVCheck(bookID, givenText, CVlocation) {\r\n        /*\r\n        This check uses the USFM-JS package to parse the USFM\r\n            and then it checks the results to make sure all expected verses are there.\r\n\r\n        This has the side advantage that it's using exactly the same code/package that's\r\n            used by tCore and tC Create.\r\n\r\n        Note that for verse bridges, USFM-JS returns the bridge, e.g., 24-25\r\n            AS WELL AS an entry for the bridged verses, e.g., 24 and 25.\r\n\r\n        Sadly this package doesn't return any errors or warnings from its parsing\r\n            so that's handle other ways in other places.\r\n\r\n        Note that this code below does NOT check for chapters and verses\r\n            being in the correct order. That's done elsewhere.\r\n        */\r\n        // console.log(\"Running CVCheck() using USFM-JS (can take quite a while for a large book)…\");\r\n\r\n\r\n        function hasText(verseObjects) {\r\n            for (const someObject of verseObjects) {\r\n                // console.log(\"someObject\", JSON.stringify(someObject));\r\n                if (someObject['type'] === 'text' && someObject['text'].length > 5)\r\n                    return true;\r\n                if (someObject['type'] === 'word' && someObject['text'].length > 2)\r\n                    return true;\r\n                if (someObject['type'] === 'milestone')\r\n                    for (const someSubobject of someObject['children']) {\r\n                        // console.log(\"someSubobject\", JSON.stringify(someSubobject));\r\n                        if (someSubobject['type'] === 'text' && someSubobject['text'].length > 5)\r\n                            return true;\r\n                        if (someSubobject['type'] === 'word' && someSubobject['text'].length > 2)\r\n                            return true;\r\n                        if (someSubobject['type'] === 'milestone')\r\n                            for (const someSubSubobject of someSubobject['children']) {\r\n                                // console.log(\"someSubSubobject\", JSON.stringify(someSubSubobject));\r\n                                if (someSubSubobject['type'] === 'text' && someSubSubobject['text'].length > 5)\r\n                                    return true;\r\n                                if (someSubSubobject['type'] === 'word' && someSubSubobject['text'].length > 2)\r\n                                    return true;\r\n                            }\r\n                    }\r\n            }\r\n            // console.log(`Returning false with ${typeof verseObjects} (${verseObjects.length}): ${JSON.stringify(verseObjects)}`);\r\n            return false;\r\n        }\r\n        // end of hasText function\r\n\r\n\r\n        // Main code for CVCheck function\r\n        let lowercaseBookID = bookID.toLowerCase();\r\n        let expectedVersesPerChapterList = [];\r\n        try {\r\n            expectedVersesPerChapterList = books.chaptersInBook(lowercaseBookID); // A list of integers -- numVerses for each chapter\r\n            // console.log(\"Got chapterList\", JSON.stringify(expectedVersesPerChapterList));\r\n        }\r\n        catch { }\r\n\r\n        // Try doing this using USFM-JS via runUsfmJsCheck()\r\n        const result1 = runUsfmJsCheck(givenText);\r\n        // console.log(\"Got a JSON result\", JSON.stringify(result1));\r\n        // console.log(\"Got a JSON headers result\", JSON.stringify(result1.returnedJSON.headers));\r\n        // console.log(\"Got a JSON chapters result\", JSON.stringify(result1.returnedJSON.chapters));\r\n        for (const chapterNumberString in result1.returnedJSON.chapters) {\r\n            // console.log(`chapterNumberString=${chapterNumberString}`);\r\n            // if (chapterNumberString === '3')\r\n            //     console.log(`chapter ${chapterNumberString} ${JSON.stringify(result1.returnedJSON.chapters[chapterNumberString])}`);\r\n            let chapterInt;\r\n            try {\r\n                chapterInt = ourParseInt(chapterNumberString);\r\n            } catch (usfmCIerror) {\r\n                console.log(`CVCheck couldn't convert ${bookID} chapter '${chapterNumberString}': ${usfmCIerror}`);\r\n            }\r\n            if (chapterInt < 1 || chapterInt > expectedVersesPerChapterList.length)\r\n                addNoticeCV8({priority:869, message:\"Chapter number out of range\", C:chapterNumberString, extract:`${bookID} ${chapterNumberString}`, location:CVlocation});\r\n            else {\r\n                let discoveredVerseList = [], discoveredVerseWithTextList = [];\r\n                // console.log(`Chapter ${chapterNumberString} verses ${Object.keys(result1.returnedJSON.chapters[chapterNumberString])}`);\r\n                for (const verseNumberString in result1.returnedJSON.chapters[chapterNumberString]) {\r\n                    if (verseNumberString === 'front') continue; // skip the rest here\r\n                    // if (chapterNumberString === '3')\r\n                    //     console.log(`verseNumberString=${verseNumberString}`);\r\n                    // if (chapterNumberString === '3' && verseNumberString === '14')\r\n                    //     console.log(`verse ${verseNumberString} ${JSON.stringify(result1.returnedJSON.chapters[chapterNumberString][verseNumberString])}`);\r\n                    const verseObjects = result1.returnedJSON.chapters[chapterNumberString][verseNumberString]['verseObjects'];\r\n                    // if (chapterNumberString === '3' && verseNumberString === '14')\r\n                    //     console.log(`verseObjects=${verseObjects}`);\r\n                    const verseHasText = hasText(verseObjects);\r\n                    if (verseNumberString.indexOf('-') >= 0) { // It's a verse bridge\r\n                        const bits = verseNumberString.split('-');\r\n                        const firstVString = bits[0], secondVString = bits[1];\r\n                        let intFirstV, intSecondV;\r\n                        try {\r\n                            intFirstV = ourParseInt(firstVString);\r\n                            intSecondV = ourParseInt(secondVString);\r\n                            for (let v = intFirstV; v <= intSecondV; v++) {\r\n                                discoveredVerseList.push(v);\r\n                                if (verseHasText)\r\n                                    discoveredVerseWithTextList.push(v);\r\n                            }\r\n                        } catch (usfmVIerror) {\r\n                            addNoticeCV8({priority:762, message:\"Unable to convert verse bridge numbers to integers\", C:chapterNumberString, V:verseNumberString, characterIndex:3, extract:verseNumberString, location:`${CVlocation} with ${usfmVIerror}`});\r\n                        }\r\n                    } else { // It's NOT a verse bridge\r\n                        let verseInt;\r\n                        try {\r\n                            verseInt = ourParseInt(verseNumberString);\r\n                            discoveredVerseList.push(verseInt);\r\n                        } catch (usfmPIerror) {\r\n                            console.log(`We couldn't convert ${bookID} ${chapterNumberString} verse '${verseNumberString}': ${usfmPIerror}`);\r\n                        }\r\n\r\n                        if (verseInt < 1 || verseInt > expectedVersesPerChapterList[chapterInt - 1])\r\n                            addNoticeCV8({priority:868, message:\"Verse number out of range\", C:chapterNumberString, V:verseNumberString, extract:`${bookID} ${chapterNumberString}:${verseNumberString}`, location:CVlocation});\r\n\r\n                        if (verseHasText)\r\n                            discoveredVerseWithTextList.push(verseInt);\r\n                    }\r\n                }\r\n\r\n                // Check that expected verses numbers were actually all there\r\n                // console.log(\"Doing missing verse check\");\r\n                for (let v = 1; v <= expectedVersesPerChapterList[chapterInt - 1]; v++) {\r\n                    if (discoveredVerseList.indexOf(v) < 0)\r\n                        if (books.isOftenMissing(bookID, chapterInt, v))\r\n                            addNoticeCV8({priority:67, C:chapterNumberString, V:`${v}`, message:\"Verse appears to be left out\", location:CVlocation});\r\n                        else\r\n                            addNoticeCV8({priority:867, C:chapterNumberString, V:`${v}`, message:\"Verse appears to be missing\", location:CVlocation});\r\n                    // Check for existing verses but missing text\r\n                    if (discoveredVerseWithTextList.indexOf(v) < 0) {\r\n                        // const firstVerseObject = result1.returnedJSON.chapters[chapterNumberString][v]['verseObjects'][0];\r\n                        // console.log(\"firstVerseObject\", JSON.stringify(firstVerseObject));\r\n                        addNoticeCV8({priority:866, C:chapterNumberString, V:`${v}`, message:\"Verse seems to have no text\", location:CVlocation});\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        addSuccessMessage(`Checked CV patterns for ${bookID}${CVlocation}`);\r\n    }\r\n    // end of CVCheck function\r\n\r\n\r\n    function doOurBasicTextChecks(C, V, fieldName, fieldText, allowedLinks, fieldLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} C - chapter number of the text being checked\r\n        * @param {String} V - verse number of the text being checked\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} fieldLocation - description of where the field is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        // console.log(`cUSFM doOurBasicTextChecks(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${fieldLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cUSFM doOurBasicTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cUSFM doOurBasicTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"cUSFM doOurBasicTextChecks: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cUSFM doOurBasicTextChecks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"cUSFM doOurBasicTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n        const dbtcResultObject = doBasicTextChecks(fieldName, fieldText, allowedLinks, fieldLocation, optionalCheckingOptions);\r\n\r\n        // Process results line by line to filter out potential false positives\r\n        //  for this particular kind of text field\r\n        for (const noticeEntry of dbtcResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `USFM doOurBasicTextChecks notice length=${Object.keys(noticeEntry).length}`);\r\n            if (!noticeEntry.message.startsWith(\"Mismatched () characters\") // 663 Mismatched left/right chars -- suppress these misleading warnings coz open quote can occur in one verse and close in another\r\n                && !noticeEntry.message.startsWith(\"Mismatched [] characters\")\r\n                && !noticeEntry.message.startsWith(\"Mismatched “” characters\")\r\n                && !noticeEntry.message.startsWith(\"Mismatched «» characters\")\r\n                && (!noticeEntry.message.startsWith(\"Unexpected | character after space\") || fieldText.indexOf('x-lemma') < 0) // inside \\zaln-s fields\r\n                && (!noticeEntry.message.startsWith(\"Unexpected doubled , characters\") || fieldText.indexOf('x-morph') < 0) // inside \\w fields\r\n                && (!noticeEntry.message.startsWith('Unexpected doubled \" characters') || fieldText.indexOf('x-morph') < 0) // inside \\w fields\r\n            )\r\n                addNoticeCV8({priority:noticeEntry.priority, C, V, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of doOurBasicTextChecks function\r\n\r\n\r\n    function doOurBasicFileChecks(filename, fileText, fileLocation, optionalCheckingOptions) {\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        console.assert(filename !== undefined, \"cUSFM doOurBasicFileChecks: 'filename' parameter should be defined\");\r\n        console.assert(typeof filename === 'string', `cUSFM doOurBasicFileChecks: 'filename' parameter should be a string not a '${typeof filename}'`);\r\n        console.assert(fileText !== undefined, \"cUSFM doOurBasicFileChecks: 'fileText' parameter should be defined\");\r\n        console.assert(typeof fileText === 'string', `cUSFM doOurBasicFileChecks: 'fileText' parameter should be a string not a '${typeof fileText}'`);\r\n\r\n        const resultObject = doBasicFileChecks(filename, fileText, fileLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        result.noticeList = result.noticeList.concat(resultObject.noticeList);\r\n        // If we need to put everything through addNoticeCV8, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        // for (const noticeEntry of resultObject.noticeList)\r\n        //     addNoticeCV8({priority:noticeEntry.priority, noticeEntry.message, noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7]);\r\n    }\r\n    // end of doOurBasicFileChecks function\r\n\r\n\r\n    function checkUSFMCharacterFields(filename, fileText, fileLocation) {\r\n        // Check matched pairs\r\n        for (const punctSet of [\r\n            // Character formatting\r\n            ['\\\\add ', '\\\\add*'], ['\\\\addpn ', '\\\\addpn*'],\r\n            ['\\\\bd ', '\\\\bd*'], ['\\\\bdit ', '\\\\bdit*'],\r\n            ['\\\\bk ', '\\\\bk*'],\r\n            ['\\\\dc ', '\\\\dc*'],\r\n            ['\\\\em ', '\\\\em*'],\r\n            ['\\\\fig ', '\\\\fig*'],\r\n            ['\\\\it ', '\\\\it*'],\r\n            ['\\\\k ', '\\\\k*'],\r\n            ['\\\\nd ', '\\\\nd*'], ['\\\\ndx ', '\\\\ndx*'],\r\n            ['\\\\no ', '\\\\no*'],\r\n            ['\\\\ord ', '\\\\ord*'],\r\n            ['\\\\pn ', '\\\\pn*'],\r\n            ['\\\\pro ', '\\\\pro*'],\r\n            ['\\\\qt ', '\\\\qt*'],\r\n            ['\\\\sc ', '\\\\sc*'],\r\n            ['\\\\sig ', '\\\\sig*'],\r\n            ['\\\\sls ', '\\\\sls*'],\r\n            ['\\\\tl ', '\\\\tl*'],\r\n            ['\\\\w ', '\\\\w*'],\r\n            ['\\\\wg ', '\\\\wg*'], ['\\\\wh ', '\\\\wh*'],\r\n            ['\\\\wj ', '\\\\wj*'],\r\n\r\n            ['\\\\ca ', '\\\\ca*'], ['\\\\va ', '\\\\va*'],\r\n\r\n            ['\\\\f ', '\\\\f*'], ['\\\\x ', '\\\\x*'],\r\n        ]) {\r\n            const opener = punctSet[0], closer = punctSet[1];\r\n            const lCount = countOccurrences(fileText, opener);\r\n            const rCount = countOccurrences(fileText, closer);\r\n            if (lCount !== rCount)\r\n                addNoticeCV8({priority:873, message:`Mismatched ${opener}${closer} fields`, extract:`(left=${lCount.toLocaleString()}, right=${rCount.toLocaleString()})`, location:fileLocation});\r\n        }\r\n    }\r\n    // end of checkUSFMCharacterFields function\r\n\r\n\r\n    function checkUSFMFileContents(filename, fileText, markerSet, fileLocation) {\r\n        // Does global checks on the file\r\n        // Note: These run the risk of duplicating messages that are found within individual lines.\r\n        //          However, it's common in USFM for parentheses to open '(' in one verse\r\n        //                      and close ')' in another. So the USFM line check can't check that.\r\n        //          Also, the USFM v3.0 spec seems to allow/require whitespace reduction,\r\n        //              i.e., newLines can conceivably appear WITHIN a footnote for example.\r\n\r\n        // Check markers like \\add ... \\add*, \\f .. \\f*\r\n        checkUSFMCharacterFields(filename, fileText, fileLocation)\r\n\r\n        // Now do the general global checks (e.g., for general punctuation)\r\n        doOurBasicFileChecks(filename, fileText, fileLocation);\r\n\r\n        for (const compulsoryMarker of COMPULSORY_MARKERS)\r\n            if (!markerSet.has(compulsoryMarker))\r\n                addNoticeCV8({priority:819, message:\"Missing compulsory USFM line\", extract:`missing \\\\${compulsoryMarker}`, location:fileLocation});\r\n        for (const expectedMarker of EXPECTED_MARKERS)\r\n            if (!markerSet.has(expectedMarker)\r\n            && (!expectedMarker.endsWith('1') || !markerSet.has(expectedMarker.substring(0, expectedMarker.length-1))))\r\n                addNoticeCV8({priority:519, message:\"Missing expected USFM line\", extract:`missing \\\\${expectedMarker}`, location:fileLocation});\r\n        if (books.isExtraBookID(bookID))\r\n        for (const expectedMarker of EXPECTED_PERIPHERAL_BOOK_MARKERS)\r\n            if (!markerSet.has(expectedMarker))\r\n                addNoticeCV8({priority:517, message:\"Missing expected USFM line\", extract:`missing \\\\${expectedMarker}`, location:fileLocation});\r\n        else\r\n        for (const expectedMarker of EXPECTED_BIBLE_BOOK_MARKERS)\r\n            if (!markerSet.has(expectedMarker))\r\n                addNoticeCV8({priority:518, message:\"Missing expected USFM line\", extract:`missing \\\\${expectedMarker}`, location:fileLocation});\r\n        for (const deprecatedMarker of DEPRECATED_MARKERS)\r\n            if (markerSet.has(deprecatedMarker))\r\n                addNoticeCV8({priority:218, message:\"Using deprecated USFM marker\", extract:`\\\\${deprecatedMarker}`, location:fileLocation});\r\n    }\r\n    // end of checkUSFMFileContents function\r\n\r\n\r\n    function checkUSFMLineInternals(C, V, marker, rest, lineLocation, optionalCheckingOptions) {\r\n        // Handles character formatting within the line contents\r\n        let adjustedRest = rest;\r\n\r\n        if (marker === 'c' && isNaN(rest))\r\n            addNoticeCV8({priority:822, C, V, message:\"Expected \\\\c field to contain an integer\", characterIndex:3, extract:'\\\\c ' + rest, location:lineLocation});\r\n        if (marker === 'v') {\r\n            let Vstr = (rest) ? rest.split(' ', 1)[0] : '?';\r\n            if (isNaN(Vstr) && Vstr.indexOf('-') < 0)\r\n                addNoticeCV8({priority:822, C, V, message:\"Expected \\\\v field to contain an integer\", characterIndex:3, extract:'\\\\v ' + rest, location:lineLocation});\r\n        }\r\n        const allowedLinks = (marker === 'w' || marker === 'k-s' || marker === 'SPECIAL1')\r\n            // (because we don't know what marker SPECIAL1 is, so default to \"no false alarms\")\r\n            && rest.indexOf('x-tw') >= 0;\r\n        if (rest) doOurBasicTextChecks(C, V, '\\\\' + marker, rest, allowedLinks, ' field ' + lineLocation, optionalCheckingOptions);\r\n    }\r\n    // end of checkUSFMLineInternals function\r\n\r\n\r\n    function checkUSFMLineContents(C, V, marker, rest, lineLocation) {\r\n        // Looks at the marker and determines what content is allowed/expected on the rest of the line\r\n        // 'SPECIAL1' is used internally here when a character other than a backslash starts a line\r\n        if (ALLOWED_LINE_START_MARKERS.indexOf(marker) >= 0 || marker === 'SPECIAL1') {\r\n            if (rest && MARKERS_WITHOUT_CONTENT.indexOf(marker) >= 0)\r\n                if (isWhitespace(rest))\r\n                    addNoticeCV8({priority:301, C, V, message:`Unexpected whitespace after \\\\${marker} marker`, characterIndex:marker.length, extract:rest, location:lineLocation});\r\n                else\r\n                    addNoticeCV8({priority:401, C, V, message:`Unexpected content after \\\\${marker} marker`, characterIndex:marker.length, extract:rest, location:lineLocation});\r\n            else if (MARKERS_WITH_COMPULSORY_CONTENT.indexOf(marker) >= 0 && !rest)\r\n                addNoticeCV8({priority:711, C, V, message:\"Expected compulsory content\", characterIndex:marker.length, location:` after \\\\${marker} marker${lineLocation}`});\r\n        } else // it's not a recognised line marker\r\n            // Lower priority of deprecated \\s5 markers (compared to all other unknown markers)\r\n            addNoticeCV8({priority:marker === 's5' ? 111 : 809, C, V, message:`${marker === 's5' ? 'Deprecated' : 'Unexpected'} '\\\\${marker}' marker at start of line`, characterIndex:1, location:lineLocation});\r\n        if (rest) checkUSFMLineInternals(marker, rest, lineLocation);\r\n    }\r\n    // end of checkUSFMLineContents function\r\n\r\n\r\n    function mainUSFMCheck(bookID, filename, givenText, location) {\r\n        // console.log(\"Running mainUSFMCheck() (can take quite a while for a large book)…\");\r\n\r\n        let ourLocation = location;\r\n        if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n\r\n        let lowercaseBookID = bookID.toLowerCase();\r\n        let numChaptersThisBook = 0;\r\n        try {\r\n            numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n        }\r\n        catch {\r\n            if (!books.isValidBookID(bookID)) // must not be in FRT, BAK, etc.\r\n                addNoticeCV8({priority:900, message:\"Bad function call: should be given a valid book abbreviation\", extract:bookID, location:` (not '${bookID}')${ourLocation}`});\r\n        }\r\n\r\n        let lines = givenText.split('\\n');\r\n        // console.log(`  '${ourLocation}' has ${lines.length.toLocaleString()} total lines`);\r\n\r\n        let lastB = '', lastC = '', lastV = '', C = '0', V = '0';\r\n        let lastIntC = 0, lastIntV = 0;\r\n        let numVersesThisChapter = 0;\r\n        let lastMarker = '', lastRest = '';\r\n        const markerSet = new Set();\r\n        for (let n = 1; n <= lines.length; n++) {\r\n            let line = lines[n - 1];\r\n            if (C === '0') V = n.toString();\r\n            let atString = ` on line ${n.toLocaleString()}${ourLocation}`;\r\n            // console.log(`line '${line}'${atString}`);\r\n            if (!line) {\r\n                // addNoticeCV8({priority:103, \"Unexpected blank line\", 0, '', location:atString});\r\n                continue;\r\n            }\r\n            let characterIndex;\r\n            if ((characterIndex = line.indexOf('\\r')) >= 0) {\r\n                const extract = ``; // TODO xxxxxxxxxxxxxxxxxxx................................\r\n                addNoticeCV8({priority:703, C, V, message:\"Unexpected CarriageReturn character\", lineNumber:n, characterIndex, extract, location:atString});\r\n            }\r\n\r\n            let marker, rest;\r\n            if (line[0] === '\\\\') {\r\n                marker = line.substring(1).split(' ', 1)[0];\r\n                rest = line.substring(marker.length + 2); // Skip backslash, marker, and space after marker\r\n                // console.log(`Line ${n}: marker='${marker}' rest='${rest}'`);\r\n            } else { // Line didn't start with a backslash\r\n                // NOTE: Some unfoldingWord USFM Bibles commonly have this\r\n                //          so it's not necessarily either an error or a warning\r\n                rest = line;\r\n                if (`([“‘`.indexOf(line[0]) < 0) { // These are the often expected characters\r\n                    addNoticeCV8({priority:980, C, V, message:\"Expected line to start with backslash\", lineNumber:n, characterIndex:0, extract:line[0], location:atString});\r\n                    if (line[1] === '\\\\') { // Let's drop the leading punctuation and try to check the rest of the line\r\n                        marker = line.substring(2).split(' ', 1)[0];\r\n                        rest = line.substring(marker.length + 2 + 1); // Skip leading character, backslash, marker, and space after marker\r\n                        // console.log(`USFM after ${line[0]} got '${marker}': '${rest}'`);\r\n                    }\r\n                    else\r\n                        marker = 'rem'; // to try to avoid consequential errors, but the rest of the line won't be checked\r\n                } else { // How do we handle an allowed line that doesn't start with a backslash?\r\n                    // Can't use 'rem' because we want the rest of the line checked\r\n                    marker = 'SPECIAL1'; // Handle as a special case\r\n                }\r\n            }\r\n            markerSet.add(marker); // Keep track of all line markers\r\n\r\n            // Handle C/V numbers including verse bridges\r\n            let intC, intV, vIndex;\r\n            if (marker === 'c') {\r\n                C = rest; V = '0';\r\n                try {\r\n                    intC = ourParseInt(C);\r\n                } catch (usfmICerror) {\r\n                    addNoticeCV8({priority:724, C, V, message:\"Unable to convert chapter number to integer\", lineNumber:n, characterIndex:3, extract:`${rest.substring(0, halfLength)}${rest.length > halfLength ? '…' : ''}`, location:atString});\r\n                    intC = -999; // Used to prevent consequential errors\r\n                }\r\n                if (C === lastC || (intC > 0 && intC !== lastIntC + 1))\r\n                    addNoticeCV8({priority:764, C, V, message:\"Chapter number didn't increment correctly\", lineNumber:n, characterIndex:3, extract:`${rest.substring(0, halfLength)}${rest.length > halfLength ? '…' : ''} (${lastC ? lastC : '0'} → ${C})`, location:atString});\r\n                lastC = C; lastV = '0';\r\n                lastIntC = intC; lastIntV = 0;\r\n            } else if (marker === 'v') {\r\n                V = (rest) ? rest.split(' ', 1)[0] : '?';\r\n                if (V.indexOf('-') < 0) { // no hyphen -> no verse bridge\r\n                    try {\r\n                        intV = ourParseInt(V);\r\n                    } catch (usfmIVerror) {\r\n                        addNoticeCV8({priority:723, C, V, message:\"Unable to convert verse number to integer\", lineNumber:n, characterIndex:3, extract:`${rest.substring(0, halfLength)}${rest.length > halfLength ? '…' : ''}`, location:atString});\r\n                        intV = -999; // Used to prevent consequential errors\r\n                    }\r\n                    if (V === lastV || (intV > 0 && intV !== lastIntV + 1))\r\n                        addNoticeCV8({priority:763, C, V, message:\"Verse number didn't increment correctly\", lineNumber:n, characterIndex:3, extract:`${rest.substring(0, halfLength)}${rest.length > halfLength ? '…' : ''} (${lastV ? lastV : '0'} → ${V})`, location:atString});\r\n                    lastV = V; lastIntV = intV;\r\n                } else { // handle verse bridge\r\n                    const bits = V.split('-');\r\n                    const firstV = bits[0], secondV = bits[1];\r\n                    let intFirstV, intSecondV;\r\n                    try {\r\n                        intFirstV = ourParseInt(firstV);\r\n                        intSecondV = ourParseInt(secondV);\r\n                    } catch (usfmV12error) {\r\n                        addNoticeCV8({priority:762, C, V, message:\"Unable to convert verse bridge numbers to integers\", lineNumber:n, characterIndex:3, extract:`${rest.substring(0, Math.max(9, extractLength))}${rest.length > extractLength ? '…' : ''}`, location:atString});\r\n                        intFirstV = -999; intSecondV = -998; // Used to prevent consequential errors\r\n                    }\r\n                    if (intSecondV <= intFirstV)\r\n                        addNoticeCV8({priority:769, C, V, message:\"Verse bridge numbers not in ascending order\", lineNumber:n, characterIndex:3, extract:`${rest.substring(0, Math.max(9, extractLength))}${rest.length > extractLength ? '…' : ''} (${firstV} → ${secondV})`, location:atString});\r\n                    else if (firstV === lastV || (intFirstV > 0 && intFirstV !== lastIntV + 1))\r\n                        addNoticeCV8({priority:765, C, V, message:\"Bridged verse numbers didn't increment correctly\", lineNumber:n, characterIndex:3, extract:`${rest.substring(0, Math.max(9, extractLength))}${rest.length > extractLength ? '…' : ''} (${lastV} → ${firstV})`, location:atString});\r\n                    lastV = secondV; lastIntV = intSecondV;\r\n                }\r\n            } else if ((vIndex = rest.indexOf('\\\\v ')) >= 0) {\r\n                // verse number marker follows another marker on the same line, so it's inside `rest`\r\n                const restRest = rest.substring(vIndex + 3);\r\n                // console.log(`Got restRest=${restRest}`);\r\n                try {\r\n                    intV = parseInt(restRest);\r\n                    // console.log(\"Got\", intV);\r\n                } catch (usfmIIVerror) {\r\n                    addNoticeCV8({priority:720, C, V, message:\"Unable to convert internal verse number to integer\", lineNumber:n, characterIndex:3, extract:`${restRest.substring(0, halfLength)}${restRest.length > halfLength ? '…' : ''}`, location:atString});\r\n                    intV = -999; // Used to prevent consequential errors\r\n                }\r\n                if (intV > 0 && intV !== lastIntV + 1)\r\n                    addNoticeCV8({priority:761, C, V, message:\"Verse number didn't increment correctly\", lineNumber:n, characterIndex:3, extract:`${restRest.substring(0, halfLength)}${restRest.length > halfLength ? '…' : ''} (${lastV ? lastV : '0'} → ${V})`, location:atString});\r\n                lastV = intV.toString(); lastIntV = intV;\r\n            }\r\n            atString = ` on line ${n.toLocaleString()}${ourLocation}`;\r\n\r\n            if (marker === 'id' && !rest.startsWith(bookID)) {\r\n                const thisLength = Math.max(4, extractLength);\r\n                const extract = `${rest.substring(0, thisLength)}${rest.length > thisLength ? '…' : ''}`;\r\n                addNoticeCV8({priority:987, C, V, message:\"Expected \\\\id line to start with book identifier\", lineNumber:n, characterIndex:4, extract, location:atString});\r\n            }\r\n            // Check the order of markers\r\n            // In headers\r\n            if (marker === 'toc2' && lastMarker !== 'toc1')\r\n                addNoticeCV8({priority:87, C, V, message:\"Expected \\\\toc2 line to follow \\\\toc1\", lineNumber:n, characterIndex:1, extract:`(not '${lastMarker}')`, location:atString});\r\n            else if (marker === 'toc3' && lastMarker !== 'toc2')\r\n                addNoticeCV8({priority:87, C, V, message:\"Expected \\\\toc3 line to follow \\\\toc2\", lineNumber:n, characterIndex:1, extract:`(not '${lastMarker}')`, location:atString});\r\n            // In chapters\r\n            else if ((PARAGRAPH_MARKERS.indexOf(marker) >= 0 || marker === 's5' || marker === 'ts\\\\*')\r\n                && PARAGRAPH_MARKERS.indexOf(lastMarker) >= 0\r\n                && !lastRest)\r\n                addNoticeCV8({priority:399, C, V, message:\"Useless paragraph marker\", lineNumber:n, characterIndex:1, extract:`('${lastMarker}' before '${marker}')`, location:atString});\r\n\r\n            // Do general checks\r\n            checkUSFMLineContents(C, V, marker, rest, atString);\r\n\r\n            lastMarker = marker; lastRest = rest;\r\n        }\r\n\r\n        // Do overall global checks of the entire text\r\n        checkUSFMFileContents(filename, givenText, markerSet, ourLocation) // Do this last so the results are lower in the lists\r\n\r\n        addSuccessMessage(`Checked all ${lines.length.toLocaleString()} line${lines.length === 1 ? '' : 's'} for ${bookID}${ourLocation}`)\r\n    }\r\n\r\n    /* function runSlowTask(which) {\r\n        // Ideally these should be run in parallel using multiprocessing\r\n        //  See https://hackernoon.com/multithreading-multiprocessing-and-the-nodejs-event-loop-5b2929bd450b\r\n        console.log(`runSlowTask(${which})`)\r\n        return (which === 1)\r\n            ? mainUSFMCheck(bookID, filename, givenText, location)\r\n            : runBCSGrammarCheck(filename, givenText, location);\r\n    }\r\n    // Main code for checkUSFMText()\r\n    console.log(\"Starting USFM checking tasks…\");\r\n    const tasks = [1,2].map(runSlowTask);\r\n    const allResults = await Promise.all(tasks);\r\n    console.log(`  Finished all tasks with ${JSON.stringify(allResults)}.`);\r\n    console.log(\"  Finished all tasks.\");\r\n    if (!allResults[1].isValidUSFM)\r\n        addNoticeCV8({priority:942, \"USFM Grammar check fails\", location});\r\n    console.log(\"  Warnings:\", JSON.stringify(allResults[1].warnings));\r\n    // Display these warnings but with a lower priority\r\n    for (const warningString of allResults[1].warnings)\r\n        addNoticeCV8({priority:103, `USFMGrammar: ${warningString.trim()}`, location});\r\n    */\r\n\r\n    // NOTE: If we're careful about how/when we add their notices to our global list,\r\n    //  we should be able to run these three slowish checks in parallel on different threads/processes\r\n    let allResults = [];\r\n    allResults.push(mainUSFMCheck(bookID, filename, givenText, ourLocation));\r\n    allResults.push(CVCheck(bookID, givenText, ourLocation));\r\n    if (!books.isExtraBookID(bookID))\r\n        allResults.push(ourRunBCSGrammarCheck(givenText, ourLocation));\r\n    // console.assert(allResults.length === 2);\r\n    // console.log(\"allResults\", JSON.stringify(allResults));\r\n    // if (!allResults[1].isValidUSFM)\r\n    //     addNoticeCV8({priority:941, \"USFM Grammar check fails\", location});\r\n    // console.log(\"  Warnings:\", JSON.stringify(allResults[1].warnings));\r\n    // // Display these warnings but with a lower priority\r\n    // for (const warningString of allResults[1].warnings)\r\n        // addNoticeCV8({priority:103, `USFMGrammar: ${warningString.trim()}`, location});\r\n\r\n    // console.log(`  checkUSFMText returning with ${result.successList.length.toLocaleString()} success(es) and ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(`checkUSFMText result is ${JSON.stringify(result)}`);\r\n    return result;\r\n}\r\n// end of checkUSFMText function\r\n\r\n\r\nexport default checkUSFMText;\r\n","import { isWhitespace, countOccurrences } from './text-handling-functions'\r\nimport doBasicTextChecks from './basic-text-check';\r\n\r\n\r\nconst MARKDOWN_VALIDATOR_VERSION = '0.3.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nfunction checkMarkdownText(textName, markdownText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire markdown file, i.e., all lines.\r\n\r\n    Note: This function does not check that any link targets in the markdown are valid links.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`checkMarkdownText(${textName}, ${markdownText.length}, ${givenLocation})…`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (textName) ourLocation = ` in ${textName}${ourLocation}`;\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (mdtcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(\"Using default extractLength=\" + extractLength);\r\n    }\r\n    // else\r\n        // console.log(\"Using supplied extractLength=\" + extractLength, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(\"Using halfLength=\" + halfLength, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const result = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(\"checkMarkdownText success: \" + successString);\r\n        result.successList.push(successString);\r\n    }\r\n    function addNotice6({priority,message, lineNumber,characterIndex, extract, location}) {\r\n        // console.log(`checkMarkdownText addNotice6: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? \" \" + extract : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cMdT addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cMdT addNotice6: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cMdT addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cMdT addNotice6: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex !== undefined, \"cMdT addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cMdT addNotice6: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cMdT addNotice6: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cMdT addNotice6: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cMdT addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cMdT addNotice6: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        result.noticeList.push({priority, message, lineNumber, characterIndex, extract, location});\r\n    }\r\n    // end of addNotice6 function\r\n\r\n    function doOurBasicTextChecks(fieldName, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} optionalFieldLocation - description of where the field is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        // console.log(`cMdT doOurBasicTextChecks(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${optionalFieldLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cMdT doOurBasicTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cMdT doOurBasicTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"cMdT doOurBasicTextChecks: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cMdT doOurBasicTextChecks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"cMdT doOurBasicTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n        const dbtcResultObject = doBasicTextChecks(fieldName, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(dbtcResultObject.noticeList);\r\n        // If we need to put everything through addNotice6, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of dbtcResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `MD doOurBasicTextChecks notice length=${Object.keys(noticeEntry).length}`);\r\n            if (!noticeEntry.message.startsWith(\"Unexpected doubled * characters\") // 577 Markdown allows this\r\n                && !noticeEntry.message.startsWith(\"Unexpected * character after space\") // 191\r\n            )\r\n                addNotice6({priority:noticeEntry.priority, message:noticeEntry.message,\r\n                    characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract,\r\n                    location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of doOurBasicTextChecks function\r\n\r\n\r\n    function checkMarkdownLineContents(lineName, lineText, lineLocation) {\r\n\r\n        // console.log(`checkMarkdownLineContents for '${lineName} ${lineText}' at${lineLocation}`);\r\n        let thisText = lineText\r\n\r\n        // Remove leading and trailing hash signs\r\n        thisText = thisText.replace(/^#+|#$/g, '')\r\n        // console.log(`After removing hashes have '${thisText}'`);\r\n\r\n        // Remove leading spaces\r\n        thisText = thisText.replace(/^ +/g, '')\r\n        // console.log(`After removing leading spaces have '${thisText}'`);\r\n\r\n        // // Remove leading asterisks\r\n        // thisText = thisText.replace(/^\\*/g,'')\r\n        // console.log(`After removing asterisks have '${thisText}'`);\r\n\r\n        // // Remove leading spaces again now\r\n        // thisText = thisText.replace(/^ +/g,'')\r\n        // console.log(`After removing more leading spaces have '${thisText}'`);\r\n\r\n        if (thisText)\r\n            doOurBasicTextChecks(lineName, thisText, true, lineLocation, optionalCheckingOptions);\r\n    }\r\n    // end of checkMarkdownLine function\r\n\r\n\r\n    // Main code for checkMarkdownText function\r\n    const lines = markdownText.split('\\n');\r\n    // console.log(`  '${location}' has ${lines.length.toLocaleString()} total lines`);\r\n\r\n    let headerLevel = 0;\r\n    let lastNumLeadingSpaces = 0;\r\n    let lastLineContents;\r\n    for (let n = 1; n <= lines.length; n++) {\r\n        const atString = ` in line ${n.toLocaleString()}${ourLocation}`;\r\n\r\n        const line = lines[n - 1];\r\n        let numLeadingSpaces;\r\n        if (line) {\r\n\r\n            const thisHeaderLevel = line.match(/^#*/)[0].length;\r\n            // console.log(`Got thisHeaderLevel=${thisHeaderLevel} for ${line}${atString}`);\r\n            if (thisHeaderLevel > headerLevel + 1)\r\n                addNotice6({priority:172, message:\"Header levels should only increment by one\", lineNumber:n, characterIndex:0, location:atString});\r\n            if (thisHeaderLevel > 0)\r\n                headerLevel = thisHeaderLevel;\r\n\r\n            numLeadingSpaces = line.match(/^ */)[0].length;\r\n            // console.log(`Got numLeadingSpaces=${numLeadingSpaces} for ${line}${atString}`);\r\n            if (numLeadingSpaces && lastNumLeadingSpaces && numLeadingSpaces !== lastNumLeadingSpaces)\r\n                addNotice6({priority:472, message:\"Nesting seems confused\", lineNumber:n, characterIndex:0, location:atString});\r\n\r\n            checkMarkdownLineContents(`line ${n.toLocaleString()}`, line, ourLocation);\r\n        } else {\r\n            // This is a blank line\r\n            numLeadingSpaces = 0;\r\n        }\r\n\r\n        lastLineContents = line;\r\n        lastNumLeadingSpaces = numLeadingSpaces;\r\n    }\r\n\r\n    addSuccessMessage(`Checked all ${lines.length.toLocaleString()} line${lines.length === 1 ? '' : 's'}${ourLocation}.`);\r\n    if (result.noticeList)\r\n        addSuccessMessage(`checkMarkdownText v${MARKDOWN_VALIDATOR_VERSION} finished with ${result.noticeList.length ? result.noticeList.length.toLocaleString() : \"zero\"} notice${result.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(\"No errors or warnings found by checkMarkdownText v\" + MARKDOWN_VALIDATOR_VERSION)\r\n    // console.log(`  checkMarkdownText returning with ${result.successList.length.toLocaleString()} success(es), ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkMarkdownText result is\", JSON.stringify(result));\r\n    return result;\r\n}\r\n// end of checkMarkdownText function\r\n\r\n\r\nexport default checkMarkdownText;\r\n","import { isWhitespace, countOccurrences } from './text-handling-functions'\r\nimport doBasicTextChecks from './basic-text-check';\r\n\r\n\r\nconst PLAIN_TEXT_VALIDATOR_VERSION = '0.1.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nfunction checkPlainText(textName, markdownText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all lines.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`checkPlainText(${textName}, ${markdownText.length}, ${location})…`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (textName) ourLocation = ` in ${textName}${ourLocation}`;\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (ptcError) {}\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength+1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const cptResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkPlainText success: ${successString}`);\r\n        cptResult.successList.push(successString);\r\n    }\r\n    /*\r\n    function addNotice9({priority,message, bookID,C,V, lineNumber, characterIndex, extract, location}) {\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // console.log(`checkPlainText notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority!==undefined, \"cPT addNotice9: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority==='number', `cPT addNotice9: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message!==undefined, \"cPT addNotice9: 'message' parameter should be defined\");\r\n        console.assert(typeof message==='string', `cPT addNotice9: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        console.assert(bookID !== undefined, \"cPT addNotice9: 'bookID' parameter should be defined\");\r\n        console.assert(typeof bookID === 'string', `cPT addNotice9: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n        console.assert(bookID.length === 3, `cPT addNotice9: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n        console.assert(books.isValidBookID(bookID), `cPT addNotice9: '${bookID}' is not a valid USFM book identifier`);\r\n        console.assert(C !== undefined, \"cPT addNotice9: 'C' parameter should be defined\");\r\n        console.assert(typeof C === 'string', `cPT addNotice9: 'C' parameter should be a string not a '${typeof C}'`);\r\n        console.assert(V !== undefined, \"cPT addNotice9: 'V' parameter should be defined\");\r\n        console.assert(typeof V === 'string', `cPT addNotice9: 'V' parameter should be a string not a '${typeof V}'`);\r\n        // console.assert(characterIndex!==undefined, \"cPT addNotice9: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex==='number', `cPT addNotice9: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract!==undefined, \"cPT addNotice9: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract==='string', `cPT addNotice9: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location!==undefined, \"cPT addNotice9: 'location' parameter should be defined\");\r\n        console.assert(typeof location==='string', `cPT addNotice9: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        cptResult.noticeList.push({priority,message, bookID,C,V, lineNumber, characterIndex, extract, location});\r\n    }\r\n    */\r\n\r\n    function doOurBasicTextChecks(fieldName, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} optionalFieldLocation - description of where the field is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        // console.log(`cPT doOurBasicTextChecks(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${fieldLocation}, …)`);\r\n        console.assert(fieldName!==undefined, \"cPT doOurBasicTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName==='string', `cPT doOurBasicTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText!==undefined, \"cPT doOurBasicTextChecks: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText==='string', `cPT doOurBasicTextChecks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert( allowedLinks===true || allowedLinks===false, \"cPT doOurBasicTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n        const resultObject = doBasicTextChecks(fieldName, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        cptResult.noticeList = cptResult.noticeList.concat(resultObject.noticeList);\r\n        // If we need to put everything through addNotice9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        // for (const noticeEntry of resultObject.noticeList)\r\n        //     addNotice9(noticeEntry.priority, noticeEntry[1], noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7]);\r\n    }\r\n    // end of doOurBasicTextChecks function\r\n\r\n    function checkPlainLineContents(lineName, lineText, lineLocation) {\r\n\r\n        // console.log(`checkPlainLineContents for '${lineName}', '${lineText}' at${lineLocation}`);\r\n        let thisText = lineText.trimStart(); // So we don't get \"leading space\" and \"doubled spaces\" errors\r\n\r\n        if (thisText)\r\n            doOurBasicTextChecks(lineName, thisText, false, lineLocation, optionalCheckingOptions);\r\n    }\r\n    // end of checkPlainLine function\r\n\r\n\r\n    // Main code for checkPlainText function\r\n    const lines = markdownText.split('\\n');\r\n    // console.log(`  '${location}' has ${lines.length.toLocaleString()} total lines`);\r\n\r\n    let headerLevel = 0;\r\n    let lastNumLeadingSpaces = 0;\r\n    let lastLineContents;\r\n    for (let n= 1; n <= lines.length; n++) {\r\n        const atString = ` in line ${n.toLocaleString()}${ourLocation}`;\r\n\r\n        const line = lines[n - 1];\r\n        if (line) {\r\n            checkPlainLineContents(`line ${n.toLocaleString()}`, line, ourLocation);\r\n        } else {\r\n            // This is a blank line\r\n        }\r\n\r\n        lastLineContents = line;\r\n    }\r\n\r\n    addSuccessMessage(`Checked all ${lines.length.toLocaleString()} line${lines.length==1?'':'s'}${ourLocation}.`);\r\n    if (cptResult.noticeList)\r\n        addSuccessMessage(`checkPlainText v${PLAIN_TEXT_VALIDATOR_VERSION} finished with ${cptResult.noticeList.length?cptResult.noticeList.length.toLocaleString():\"zero\"} notice${cptResult.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by checkPlainText v${PLAIN_TEXT_VALIDATOR_VERSION}`)\r\n    // console.log(`  checkPlainText returning with ${result.successList.length.toLocaleString()} success(es), ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkPlainText result is\", JSON.stringify(result));\r\n    return cptResult;\r\n}\r\n// end of checkPlainText function\r\n\r\n\r\nexport default checkPlainText;\r\n","// import { isWhitespace, countOccurrences } from './text-handling-functions'\r\nimport yaml from 'yaml';\r\nimport doBasicTextChecks from './basic-text-check';\r\n\r\n\r\nconst YAML_VALIDATOR_VERSION = '0.1.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nfunction checkYAMLText(textName, YAMLText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all lines.\r\n\r\n     Returns a result object containing a successList and a noticeList,\r\n        as well as the parsed YAML for further checking.\r\n\r\n     */\r\n    // console.log(`checkYAMLText(${textName}, ${YAMLText.length}, ${givenLocation})…`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (textName) ourLocation = ` in ${textName}${ourLocation}`;\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (ytcError) {}\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength+1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const cytResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkYAMLText success: ${successString}`);\r\n        cytResult.successList.push(successString);\r\n    }\r\n    function addNotice6({priority,message, lineNumber,characterIndex, extract, location}) {\r\n        // console.log(`checkYAMLText Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority!==undefined, \"cYt addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority==='number', `cManT addNotice6: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message!==undefined, \"cYt addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof message==='string', `cManT addNotice6: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex!==undefined, \"cYt addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex==='number', `cManT addNotice6: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract!==undefined, \"cYt addNotice6: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract==='string', `cManT addNotice6: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location!==undefined, \"cYt addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof location==='string', `cYt addNotice6: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        cytResult.noticeList.push({priority, message, lineNumber, characterIndex, extract, location});\r\n    }\r\n\r\n    function doOurBasicTextChecks(fieldName, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} optionalFieldLocation - description of where the field is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        // console.log(`cYt doOurBasicTextChecks(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${fieldLocation}, …)`);\r\n        console.assert(fieldName!==undefined, \"cYt doOurBasicTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName==='string', `cYt doOurBasicTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText!==undefined, \"cYt doOurBasicTextChecks: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText==='string', `cYt doOurBasicTextChecks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert( allowedLinks===true || allowedLinks===false, \"cYt doOurBasicTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n        const resultObject = doBasicTextChecks(fieldName, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions);\r\n\r\n        // Process results line by line\r\n        //  suppressing undesired errors\r\n        for (const noticeEntry of resultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `YAML doOurBasicTextChecks notice length=${Object.keys(noticeEntry).length}`);\r\n            if (noticeEntry.priority !== 191 // \"Unexpected XXX character after space\"\r\n              && noticeEntry.message !== \"Unexpected ' character after space\"\r\n            //   && noticeEntry.message !== \"Unexpected space after ' character\"\r\n              && noticeEntry.message !== \"Unexpected space after [ character\"\r\n              && (noticeEntry.message !== \"Unexpected doubled - characters\" || fieldText === '---')\r\n              )\r\n                addNotice6({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n    }\r\n}\r\n    // end of doOurBasicTextChecks function\r\n\r\n    function checkYAMLLineContents(lineName, lineText, lineLocation) {\r\n\r\n        // console.log(`checkYAMLLineContents for '${lineName} ${lineText}' at${lineLocation}`);\r\n        let thisText = lineText\r\n\r\n        // Remove leading spaces\r\n        thisText = thisText.replace(/^ +/g,'')\r\n        // console.log(`After removing leading spaces have '${thisText}'`);\r\n\r\n        // Remove leading hyphens\r\n        thisText = thisText.replace(/^\\-/g,'')\r\n        // console.log(`After removing hyphens have '${thisText}'`);\r\n\r\n        // Remove leading spaces again now\r\n        thisText = thisText.replace(/^ +/g,'')\r\n        // console.log(`After removing more leading spaces have '${thisText}'`);\r\n\r\n        const allowedLinksInLine = thisText.startsWith('url:') || thisText.startsWith('chapter_url:');\r\n        if (thisText)\r\n            doOurBasicTextChecks(lineName, thisText, allowedLinksInLine, lineLocation, optionalCheckingOptions);\r\n    }\r\n    // end of checkYAMLLine function\r\n\r\n\r\n    // Main code for checkYAMLText function\r\n    const lines = YAMLText.split('\\n');\r\n    // console.log(`  '${location}' has ${lines.length.toLocaleString()} total lines`);\r\n    let formData;\r\n    try {\r\n        formData = yaml.parse(YAMLText);\r\n        // console.log(\"yaml.parse(YAMLText) got formData\", JSON.stringify(formData));\r\n    }\r\n    catch(yamlError) {\r\n        // console.log(`ERROR: yaml parse error: ${yamlError.message}`);\r\n        addNotice6({priority:916, message:yamlError.message, location:ourLocation})\r\n    }\r\n    // Add the parsed YAML to our result\r\n    cytResult.formData = formData;\r\n\r\n    let lastNumLeadingSpaces = 0;\r\n    let lastLineContents;\r\n    for (let n= 1; n <= lines.length; n++) {\r\n        const atString = ` in line ${n.toLocaleString()}${ourLocation}`;\r\n\r\n        const line = lines[n - 1];\r\n        // let numLeadingSpaces;\r\n        // if (line) {\r\n        //     numLeadingSpaces = line.match(/^ */)[0].length;\r\n            // console.log(`Got numLeadingSpaces=${numLeadingSpaces} for ${line}${atString}`);\r\n        //     if (numLeadingSpaces && lastNumLeadingSpaces && numLeadingSpaces!=lastNumLeadingSpaces)\r\n        //         addNotice6({472, \"Nesting seems confused\", 0, '', atString);\r\n\r\n            checkYAMLLineContents(`line ${n.toLocaleString()}`, line, ourLocation);\r\n        // } else {\r\n        //     // This is a blank line\r\n        //     numLeadingSpaces = 0;\r\n        // }\r\n\r\n        // lastLineContents = line;\r\n        // lastNumLeadingSpaces = numLeadingSpaces;\r\n    }\r\n\r\n    addSuccessMessage(`Checked all ${lines.length.toLocaleString()} line${lines.length==1?'':'s'}${ourLocation}.`);\r\n    if (cytResult.noticeList)\r\n        addSuccessMessage(`checkYAMLText v${YAML_VALIDATOR_VERSION} finished with ${cytResult.noticeList.length?cytResult.noticeList.length.toLocaleString():\"zero\"} notice${cytResult.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by checkYAMLText v${YAML_VALIDATOR_VERSION}`)\r\n    // console.log(`  checkYAMLText returning with ${cytResult.successList.length.toLocaleString()} success(es), ${cytResult.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkYAMLText result is\", JSON.stringify(result));\r\n    return cytResult;\r\n}\r\n// end of checkYAMLText function\r\n\r\n\r\nexport default checkYAMLText;\r\n","import checkYAMLText from './yaml-text-check';\r\n\r\n\r\nconst MANIFEST_VALIDATOR_VERSION = '0.2.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nfunction checkManifestText(textName, manifestText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all lines.\r\n\r\n    See the specification at https://resource-container.readthedocs.io/en/latest/manifest.html.\r\n\r\n    Returns a result object containing a successList and a noticeList\r\n    */\r\n    // console.log(`checkManifestText(${textName}, ${manifestText.length}, ${givenLocation})…`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (textName) ourLocation = ` in ${textName}${ourLocation}`;\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (mfcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const cmtResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkManifestText success: ${successString}`);\r\n        cmtResult.successList.push(successString);\r\n    }\r\n    function addNotice9({priority,message, bookID,C,V, lineNumber, characterIndex, extract, location}) {\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // console.log(`checkManifestText Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cManT addNotice9: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cManT addNotice9: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cManT addNotice9: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cManT addNotice9: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        console.assert(bookID !== undefined, \"cManT addNotice9: 'bookID' parameter should be defined\");\r\n        console.assert(typeof bookID === 'string', `cManT addNotice9: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n        console.assert(bookID.length === 3, `cManT addNotice9: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n        console.assert(books.isValidBookID(bookID), `cManT addNotice9: '${bookID}' is not a valid USFM book identifier`);\r\n        // console.assert(C !== undefined, \"cManT addNotice9: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `cManT addNotice9: 'C' parameter should be a string not a '${typeof C}'`);\r\n        // console.assert(V !== undefined, \"cManT addNotice9: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `cManT addNotice9: 'V' parameter should be a string not a '${typeof V}'`);\r\n        // console.assert(characterIndex !== undefined, \"cManT addNotice9: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cManT addNotice9: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cManT addNotice9: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cManT addNotice9: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cManT addNotice9: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cManT addNotice9: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        cmtResult.noticeList.push({priority,message, bookID,C,V, lineNumber, characterIndex,extract, location});\r\n    }\r\n\r\n\r\n    function doOurYAMLTextChecks(textName, manifestText, givenLocation, optionalCheckingOptions) {\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        // console.log(`cManT doOurYAMLTextChecks(${textName}, (${fieldText.length}), ${allowedLinks}, ${fieldLocation}, …)`);\r\n        console.assert(textName !== undefined, \"cManT doOurYAMLTextChecks: 'textName' parameter should be defined\");\r\n        console.assert(typeof textName === 'string', `cManT doOurYAMLTextChecks: 'textName' parameter should be a string not a '${typeof textName}'`);\r\n        console.assert(manifestText !== undefined, \"cManT doOurYAMLTextChecks: 'manifestText' parameter should be defined\");\r\n        console.assert(typeof manifestText === 'string', `cManT doOurYAMLTextChecks: 'manifestText' parameter should be a string not a '${typeof manifestText}'`);\r\n        // console.assert( allowedLinks===true || allowedLinks===false, \"cManT doOurYAMLTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n        const cYtResultObject = checkYAMLText(textName, manifestText, givenLocation, optionalCheckingOptions);\r\n\r\n        // Concat is faster if we don't need to process each notice individually\r\n        cmtResult.successList = cmtResult.successList.concat(cYtResultObject.successList);\r\n        cmtResult.noticeList = cmtResult.noticeList.concat(cYtResultObject.noticeList);\r\n        /* // Process results line by line\r\n        //  suppressing undesired errors\r\n        for (const noticeEntry of cYtResultObject.noticeList)\r\n            if (noticeEntry.priority !== 191 // \"Unexpected XXX character after space\"\r\n              && noticeEntry.message !== \"Unexpected ' character after space\"\r\n              && noticeEntry.message !== \"Unexpected space after ' character\"\r\n              && noticeEntry.message !== \"Unexpected space after [ character\"\r\n              )\r\n                addNotice9(noticeEntry.priority, noticeEntry.message, noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7]);\r\n        */\r\n        return cYtResultObject.formData;\r\n    }\r\n    // end of doOurYAMLTextChecks function\r\n\r\n\r\n    // Main code for checkManifestText function\r\n    const formData = doOurYAMLTextChecks(textName, manifestText, ourLocation, optionalCheckingOptions);\r\n    if (formData) {\r\n        // console.log(\"formData\", JSON.stringify(formData));\r\n        const formDataKeys = Object.keys(formData);\r\n        // console.log(\"formData keys\", JSON.stringify(formDataKeys));\r\n\r\n        if (formDataKeys.indexOf('dublin_core') < 0)\r\n            addNotice9({priority:928, message:\"'dublin_core' key is missing\", location:ourLocation});\r\n        if (formDataKeys.indexOf('projects') < 0)\r\n            addNotice9({priority:929, message:\"'projects' key is missing\", location:ourLocation});\r\n        if (formDataKeys.indexOf('checking') < 0)\r\n            addNotice9({priority:148, message:\"'checking' key is missing\", location:ourLocation});\r\n    }\r\n\r\n    // addSuccessMessage(`Checked all ${lines.length.toLocaleString()} line${lines.length==1?'':'s'}${ourLocation}.`);\r\n    if (cmtResult.noticeList)\r\n        addSuccessMessage(`checkManifestText v${MANIFEST_VALIDATOR_VERSION} finished with ${cmtResult.noticeList.length ? cmtResult.noticeList.length.toLocaleString() : \"zero\"} notice${cmtResult.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by checkManifestText v${MANIFEST_VALIDATOR_VERSION}`)\r\n    // console.log(`  checkManifestText returning with ${cmtResult.successList.length.toLocaleString()} success(es), ${cmtResult.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkManifestText result is\", JSON.stringify(result));\r\n    return cmtResult;\r\n}\r\n// end of checkManifestText function\r\n\r\n\r\nexport default checkManifestText;\r\n","import Path from 'path';\r\n// import YAML from 'js-yaml-parser';\r\nimport localforage from 'localforage';\r\nimport { setup } from 'axios-cache-adapter';\r\nimport JSZip from 'jszip';\r\nimport { consoleLogObject } from '../core/utilities';\r\n\r\n\r\nconst baseURL = 'https://git.door43.org/';\r\nconst apiPath = 'api/v1';\r\n\r\n\r\nconst failedStore = localforage.createInstance({\r\n  driver: [localforage.INDEXEDDB],\r\n  name: 'failed-store',\r\n});\r\n\r\nconst zipStore = localforage.createInstance({\r\n  driver: [localforage.INDEXEDDB],\r\n  name: 'zip-store',\r\n});\r\n\r\nconst cacheStore = localforage.createInstance({\r\n  driver: [localforage.INDEXEDDB],\r\n  name: 'web-cache',\r\n});\r\n\r\nconst Door43Api = setup({\r\n  baseURL: baseURL,\r\n  cache: {\r\n    store: cacheStore,\r\n    maxAge: 5 * 60 * 1000, // 5-minutes\r\n    exclude: { query: false },\r\n    key: req => {\r\n      // if (req.params) debugger\r\n      let serialized = req.params instanceof URLSearchParams ?\r\n        req.params.toString() : JSON.stringify(req.params) || '';\r\n      return req.url + serialized;\r\n    },\r\n  },\r\n});\r\n\r\n\r\nexport async function clearCaches() {\r\n  console.log(\"Clearing localforage.INDEXEDDB zipStore and cacheStore caches…\");\r\n  // const tasks = [zipStore, cacheStore].map(localforage.clear);\r\n  // const results = await Promise.all(tasks);\r\n  // results.forEach(x => console.log(\"Done it\", x));\r\n  await failedStore.clear();\r\n  await zipStore.clear();\r\n  await cacheStore.clear();\r\n}\r\n\r\n\r\n/*\r\nconst resourceRepositories = ({languageId}) => {\r\n  return {\r\n    obs: languageId + '_obs',\r\n    'obs-tn': languageId + '_obs-tn',\r\n    'obs-tq': languageId + '_obs-tq',\r\n    'obs-sn': languageId + '_obs-sn',\r\n    'obs-sq': languageId + '_obs-sq',\r\n    ult: languageId + '_ult',\r\n    ust: languageId + '_ust',\r\n    irv: languageId + '_irv',\r\n    ulb: languageId + '_ulb',\r\n    udb: languageId + '_udb',\r\n    tn: languageId + '_tn',\r\n    ta: languageId + '_ta',\r\n    tw: languageId + '_tw',\r\n    ugnt: 'el-x-koine_ugnt',\r\n    uhb: 'hbo_uhb',\r\n    ugl: languageId + '_ugl',\r\n    uhal: languageId + '_uhal',\r\n  };\r\n};\r\n*/\r\n\r\n/*\r\nasync function fetchResourceManifests({username, languageId}) {\r\n  let manifests = {};\r\n  const _resourceRepositories = resourceRepositories({languageId});\r\n  const resourceIds = Object.keys(_resourceRepositories);\r\n  const promises = resourceIds.map(resourceId => {\r\n    const repository = _resourceRepositories[resourceId];\r\n    const _username = ['ugnt','uhb'].includes(resourceId) ? 'unfoldingword' : username;\r\n    return fetchManifest({username: _username, repository})\r\n  });\r\n  const manifestArray = await Promise.all(promises);\r\n  resourceIds.forEach((resourceId, index) => {\r\n    manifests[resourceId] = manifestArray[index];\r\n  });\r\n  return manifests;\r\n};\r\n\r\n\r\nasync function fetchManifest({username, repository}) {\r\n  console.log(`fetchManifest(${username}, ${repository})…`);\r\n  const yaml = await getFile({username, repository, path: 'manifest.yaml'});\r\n  const json = (yaml) ? YAML.safeLoad(yaml) : null;\r\n  return json;\r\n};\r\n*/\r\n\r\n// https://git.door43.org/unfoldingword/en_ult/raw/branch/master/manifest.yaml\r\nasync function fetchFileFromServer({ username, repository, path, branch = 'master' }) {\r\n  // console.log(`fetchFileFromServer(${username}, ${repository}, ${path}, ${branch})…`);\r\n  const repoExists = await repositoryExists({ username, repository });\r\n  if (repoExists) {\r\n    const uri = Path.join(username, repository, 'raw/branch', branch, path);\r\n    const failMessage = await failedStore.getItem(uri);\r\n    if (failMessage) {\r\n      // console.log(`fetchFileFromServer failed previously for ${uri}: ${failMessage}`);\r\n      return null;\r\n    }\r\n    try {\r\n      // console.log(\"URI=\",uri);\r\n      const data = await cachedGet({ uri });\r\n      // console.log(\"Got data\", data);\r\n      return data;\r\n    }\r\n    catch (fffsError) {\r\n      // console.log(`ERROR: fetchFileFromServer could not fetch ${path}: ${fffsError}`)\r\n      /* await */ failedStore.setItem(uri, fffsError.message);\r\n      return null;\r\n    }\r\n  } else {\r\n    // console.log(`ERROR: fetchFileFromServer repo '${repository}' does not exist!`);\r\n    /* await */ failedStore.setItem(uri, `Repo '${repository}' does not exist!`);\r\n    return null;\r\n  }\r\n};\r\n\r\n// This is the function that we call the most from the outside\r\nexport async function getFile({ username, repository, path, branch }) {\r\n  // console.log(`getFile(${username}, ${repository}, ${path}, ${branch})…`);\r\n  let file;\r\n  file = await getFileFromZip({ username, repository, path, branch });\r\n  if (!file) {\r\n    file = await fetchFileFromServer({ username, repository, path, branch });\r\n  }\r\n  return file;\r\n}\r\n\r\n\r\nasync function getUID({ username }) {\r\n  // console.log(`getUID(${username})…`);\r\n  const uri = Path.join(apiPath, 'users', username);\r\n  // console.log(`getUID uri=${uri}`);\r\n  const user = await cachedGet({ uri });\r\n  // console.log(`getUID user=${user}`);\r\n  const { id: uid } = user;\r\n  // console.log(`  getUID returning: ${uid}`);\r\n  return uid;\r\n}\r\nasync function repositoryExists({ username, repository }) {\r\n  // console.log(`repositoryExists(${username}, ${repository})…`);\r\n  const uid = await getUID({ username });\r\n  // console.log(`repositoryExists uid=${uid}`);\r\n  // Default limit is 10 -- way too small\r\n  const params = { q: repository, limit: 500, uid }; // Documentation says limit is 50, but larger numbers seem to work ok\r\n  // console.log(`repositoryExists params=${JSON.stringify(params)}`);\r\n  const uri = Path.join(apiPath, 'repos', `search`);\r\n  // console.log(`repositoryExists uri=${uri}`);\r\n  const { data: repos } = await cachedGet({ uri, params });\r\n  // console.log(`repositoryExists repos (${repos.length})=${repos}`);\r\n  // for (const thisRepo of repos) console.log(`  thisRepo (${JSON.stringify(Object.keys(thisRepo))}) =${JSON.stringify(thisRepo.name)}`);\r\n  const repo = repos.filter(repo => repo.name === repository)[0];\r\n  // console.log(`repositoryExists repo=${repo}`);\r\n  // console.log(`  repositoryExists returning: ${!!repo}`);\r\n  return !!repo;\r\n};\r\n\r\n\r\nasync function cachedGet({ uri, params }) {\r\n  // console.log(`cachedGet(${uri}, ${JSON.stringify(params)})…`);\r\n  // console.log(`  get querying: ${baseURL+uri}`);\r\n  const { data } = await Door43Api.get(baseURL + uri, { params });\r\n  // console.log(`  cachedGet returning: ${JSON.stringify(data)}`);\r\n  return data;\r\n};\r\n\r\nexport async function cachedGetURL({ uri, params }) {\r\n  // console.log(`cachedGetURL(${uri}, ${params})…`);\r\n  const { data } = await Door43Api.get(uri, { params });\r\n  // console.log(`  cachedGetURL returning: ${data}`);\r\n  return data;\r\n};\r\n\r\n\r\n/*\r\nfunction fetchRepositoriesZipFiles({username, languageId, branch}) {\r\n  const repositories = resourceRepositories({languageId});\r\n  const promises = Object.values(repositories).map(repository => {\r\n    return fetchRepositoryZipFile({username, repository, branch});\r\n  });\r\n  const zipArray = await Promise.all(promises);\r\n  return zipArray;\r\n};\r\n*/\r\n\r\n\r\n// https://git.door43.org/{username}/{repository}/archive/{branch}.zip\r\nexport async function fetchRepositoryZipFile({ username, repository, branch }) {\r\n  console.log(`fetchRepositoryZipFile(${username}, ${repository}, ${branch})…`);\r\n  const repoExists = await repositoryExists({ username, repository });\r\n  if (!repoExists) {\r\n    return null;\r\n  }\r\n  const uri = zipUri({ username, repository, branch });\r\n  const response = await fetch(uri);\r\n  if (response.status === 200 || response.status === 0) {\r\n    const zipArrayBuffer = await response.arrayBuffer(); // blob storage not supported on mobile\r\n    await zipStore.setItem(uri, zipArrayBuffer);\r\n    return true;\r\n  } else {\r\n    console.log(`ERROR: fetchRepositoryZipFile got response status: ${response.status}`);\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\nexport async function getFilelistFromZip({ username, repository, branch, optionalPrefix }) {\r\n  // console.log(`getFilelistFromZip(${username}, ${repository}, ${branch}, ${optionalPrefix})…`);\r\n\r\n  const uri = zipUri({ username, repository, branch });\r\n  let zipBlob = await zipStore.getItem(uri);\r\n\r\n  if (!zipBlob) { // Seems that we need to load the zip file first\r\n    const response = await fetch(uri);\r\n    if (response.status === 200 || response.status === 0) {\r\n      const zipArrayBuffer = await response.arrayBuffer(); // blob storage not supported on mobile\r\n      zipBlob = await zipStore.setItem(uri, zipArrayBuffer);\r\n    } else {\r\n      console.log(`ERROR: getFilelistFromZip got response status: ${response.status}`);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  const pathList = [];\r\n  try {\r\n    if (zipBlob) {\r\n      // console.log(`  Got zipBlob for uri=${uri}`);\r\n      const zip = await JSZip.loadAsync(zipBlob);\r\n      // console.log(`  Got zip`);\r\n      // Now we need to fetch the list of files from the repo\r\n      // zip.forEach(function (relativePath, fileObject) {\r\n      zip.forEach(function (relativePath) {\r\n        // console.log(`relPath=${relativePath}`)\r\n        // consoleLogObject('fileObject', fileObject);\r\n        if (!relativePath.endsWith('/')) // it's not a folder\r\n        {\r\n          if (relativePath.startsWith(`${repository}/`)) // remove repo name prefix\r\n            relativePath = relativePath.substring(repository.length + 1);\r\n          if (relativePath.length\r\n            && !relativePath.startsWith('.git') // skips files in these folders\r\n            && !relativePath.startsWith('.apps') // skips files in this folder\r\n            && (!optionalPrefix || relativePath.startsWith(optionalPrefix))) // it's the correct prefix\r\n            pathList.push(relativePath);\r\n        }\r\n      })\r\n    }\r\n    // else console.log(\"  getFilelistFromZip: No zipBlob\");\r\n  } catch (error) {\r\n    console.log(`ERROR: getFilelistFromZip got: ${error.message}`);\r\n  }\r\n\r\n  // console.log(`getFilelistFromZip is returning (${pathList.length}) entries: ${pathList}`);\r\n  return pathList;\r\n}\r\n\r\n\r\nasync function getFileFromZip({ username, repository, path, branch }) {\r\n  // console.log(`getFileFromZip(${username}, ${repository}, ${path}, ${branch})…`);\r\n  let file;\r\n  const uri = zipUri({ username, repository, branch });\r\n  const zipBlob = await zipStore.getItem(uri);\r\n  try {\r\n    if (zipBlob) {\r\n      // console.log(`  Got zipBlob for uri=${uri}`);\r\n      const zip = await JSZip.loadAsync(zipBlob);\r\n      const zipPath = Path.join(repository.toLowerCase(), path);\r\n      // console.log(`  zipPath=${zipPath}`);\r\n      file = await zip.file(zipPath).async('string');\r\n      // console.log(`    Got zipBlob ${file.length} bytes`);\r\n    }\r\n    // else console.log(\"  No zipBlob\");\r\n  } catch (error) {\r\n    console.log(`ERROR: getFileFromZip got: ${error.message}`);\r\n    file = null;\r\n  }\r\n  return file;\r\n};\r\n\r\n\r\nexport function zipUri({ username, repository, branch = 'master' }) {\r\n  // console.log(`zipUri(${username}, ${repository}, ${branch})…`);\r\n  const zipPath = Path.join(username, repository, 'archive', `${branch}.zip`);\r\n  const zipUri = baseURL + zipPath;\r\n  return zipUri;\r\n};\r\n\r\n\r\nexport async function fetchTree({ username, repository, sha = 'master' }) {\r\n  // console.log(`fetchTree(${username}, ${repository}, ${sha})…`);\r\n  try {\r\n    const uri = Path.join('api/v1/repos', username, repository, 'git/trees', sha);\r\n    // console.log(`  uri='${uri}'`);\r\n    const data = await cachedGet({ uri });\r\n    // console.log(`  data (${typeof data})`);\r\n    return data;\r\n    // const tree = JSON.parse(data); // RJH: Why was this here???\r\n    // console.log(`  tree (${typeof tree})`);\r\n    // return tree;\r\n  } catch (error) {\r\n    console.log(`ERROR: fetchTree got: ${error.message}`);\r\n    console.log(`  Data was: ${JSON.stringify(data)}`);\r\n    return null;\r\n  }\r\n};\r\n\r\n\r\n/*\r\nasync function recursiveTree({username, repository, path, sha}) {\r\n  console.log(\"recurse tree args:\",username,repository,path,sha)\r\n  let tree = {};\r\n  const pathArray = path.split();\r\n  const results = fetchTree({username, repository, sha});\r\n  const result = results.tree.filter(item => item.path === pathArray[0])[0];\r\n  if (result) {\r\n    if (result.type === 'tree') {\r\n      const childPath = pathArray.slice(1).join('/');\r\n      const children = recursiveTree({username, repository, path: childPath, sha: result.sha});\r\n      tree[result.path] = children;\r\n    } else if (result.type === 'blob') {\r\n      tree[result.path] = true;\r\n    }\r\n  }\r\n};\r\n\r\nasync function fileExists({username, repository, path, branch}) {\r\n  // get root listing\r\n  recursiveTree()\r\n  // get recursive path listing\r\n}\r\n*/\r\n","import * as books from '../core/books/books';\r\nimport { getFile } from '../core/getApi';\r\n// import { consoleLogObject } from '../core/utilities';\r\n\r\n\r\nconst TA_REFERENCE_VALIDATOR_VERSION = '0.2.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nasync function checkTAReference(fieldName, fieldText, givenLocation, optionalCheckingOptions) {\r\n    // This is for the case of the full SupportReference field being the article link\r\n    //  which is assumed to be in the translate part of the TA manual.\r\n\r\n    // We fetch the TA link from Door43 to test that it's really there\r\n    //  -- you can control this with:\r\n    //      optionalCheckingOptions.taRepoUsername\r\n    //      optionalCheckingOptions.taRepoBranch (or tag)\r\n    //      optionalCheckingOptions.taRepoLanguageCode\r\n    //      optionalCheckingOptions.taRepoSectionName\r\n\r\n    // console.log(`checkTAReference v${TA_REFERENCE_VALIDATOR_VERSION} (${fieldName}, (${fieldText.length}) '${fieldText}', ${givenLocation}, …)`);\r\n    console.assert(fieldName !== undefined, \"checkTAReference: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldName === 'string', `checkTAReference: 'fieldText' parameter should be a string not a '${typeof fieldName}'`);\r\n    console.assert(fieldText !== undefined, \"checkTAReference: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldText === 'string', `checkTAReference: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n    console.assert(givenLocation !== undefined, \"checkTAReference: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof givenLocation === 'string', `checkTAReference: 'fieldText' parameter should be a string not a '${typeof givenLocation}'`);\r\n    console.assert(fieldName === 'SupportReference', `Unexpected checkTAReference fieldName='${fieldName}'`); // so far\r\n\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (fieldName) ourLocation = ` in ${fieldName}${ourLocation}`;\r\n\r\n    const ctarResult = { noticeList: [] };\r\n\r\n    function addNotice6({priority,message, lineNumber,characterIndex, extract, location}) {\r\n        // console.log(`checkTAReference Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cTAref addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cTAref addNotice6: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cTAref addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cTAref addNotice6: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex !== undefined, \"cTAref addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cTAref addNotice6: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cTAref addNotice6: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cTAref addNotice6: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cTAref addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cTAref addNotice6: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        ctarResult.noticeList.push({priority, message, lineNumber, characterIndex, extract, location});\r\n    }\r\n\r\n\r\n    // Main code for checkTAReference\r\n    /*\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (trcELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, \"cf. default=\"+DEFAULT_EXTRACT_LENGTH);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, \"halfLengthPlus=\"+halfLengthPlus);\r\n    */\r\n\r\n    let username;\r\n    try {\r\n        username = optionalCheckingOptions.taRepoUsername;\r\n    } catch (trcUNerror) { }\r\n    if (!username) username = 'unfoldingWord'; // or Door43-Catalog ???\r\n    let branch;\r\n    try {\r\n        branch = optionalCheckingOptions.taRepoBranch;\r\n    } catch (trcBRerror) { }\r\n    if (!branch) branch = 'master';\r\n    let languageCode;\r\n    try {\r\n        languageCode = optionalCheckingOptions.taRepoLanguageCode;\r\n    } catch (trcLCerror) { }\r\n    if (!languageCode) languageCode = 'en';\r\n    let sectionName;\r\n    try {\r\n        sectionName = optionalCheckingOptions.taRepoSectionName;\r\n    } catch (trcSNerror) { }\r\n    if (!sectionName) sectionName = 'translate';\r\n    const taRepoName = `${languageCode}_ta`;\r\n    const filepath = `${sectionName}/${fieldText}/01.md`; // Other files are title.md, sub-title.md\r\n\r\n    // console.log(`Need to check against ${taRepoName}`);\r\n    let taFileContent; // Not really used here -- just to show that we got something valid\r\n    try {\r\n        taFileContent = await getFile({ username, repository: taRepoName, path: filepath, branch });\r\n        // console.log(\"Fetched fileContent for\", taRepoName, filepath, typeof fileContent, fileContent.length);\r\n    } catch (trcGCerror) {\r\n        console.log(\"ERROR: Failed to load\", username, taRepoName, filepath, branch, trcGCerror.message);\r\n        addNotice6({priority:888, message:`Error loading ${fieldName} TA link`, extract:fieldText, location:`${ourLocation} ${filepath}: ${trcGCerror}`});\r\n    }\r\n    if (!taFileContent)\r\n        addNotice6({priority:889, message:`Unable to find ${fieldName} TA link`, extract:fieldText, location:`${ourLocation} ${filepath}`});\r\n    else if ( taFileContent.length < 10)\r\n        addNotice6({priority:887, message:`Linked ${fieldName} TA article seems empty`, extract:fieldText, location:`${ourLocation} ${filepath}`});\r\n\r\n    // console.log(`checkTAReference is returning ${JSON.stringify(ctarResult)}`);\r\n    return ctarResult;\r\n}\r\n// end of checkTAReference function\r\n\r\n\r\nexport default checkTAReference;\r\n","import * as books from '../core/books/books';\r\nimport { getFile } from '../core/getApi';\r\nimport { ourParseInt } from './utilities';\r\n// import { consoleLogObject } from '../core/utilities';\r\n\r\n\r\nconst TN_LINKS_VALIDATOR_VERSION = '0.2.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nasync function checkTNLinks(bookID, fieldName, fieldText, givenLocation, optionalCheckingOptions) {\r\n    /* This is for the case of the OccurrenceNote field containing markdown links\r\n\r\n    bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n\r\n    These notes may contain links\r\n        to TA, e.g., “(See: [[rc://en/ta/man/translate/figs-metaphor]] and …”\r\n        to TWs, e.g., “(See: [[rc://en/tw/dict/bible/other/death]] and …”\r\n        To Bibles, e.g., “… how you translated this in [Revelation 3:11](../03/11.md).”\r\n\r\n    // We fetch the TA link from Door43 to test that it's really there\r\n    //  -- you can control this with:\r\n    //      optionalCheckingOptions.taRepoUsername\r\n    //      optionalCheckingOptions.taRepoBranch (or tag)\r\n    //      optionalCheckingOptions.taRepoDefaultLanguageCode\r\n    */\r\n\r\n    // console.log(`checkTNLinks v${TN_LINKS_VALIDATOR_VERSION} ${bookID} (${fieldName}, (${fieldText.length}) '${fieldText}', ${givenLocation}, …)`);\r\n    console.assert(bookID !== undefined, \"checkTNLinks: 'bookID' parameter should be defined\");\r\n    console.assert(typeof bookID === 'string', `checkTNLinks: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n    console.assert(bookID.length === 3, `checkTNLinks: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n    console.assert(books.isValidBookID(bookID), `checkTNLinks: '${bookID}' is not a valid USFM book identifier`);\r\n    console.assert(fieldName !== undefined, \"checkTNLinks: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldName === 'string', `checkTNLinks: 'fieldText' parameter should be a string not a '${typeof fieldName}'`);\r\n    console.assert(fieldText !== undefined, \"checkTNLinks: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldText === 'string', `checkTNLinks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n    console.assert(givenLocation !== undefined, \"checkTNLinks: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof givenLocation === 'string', `checkTNLinks: 'fieldText' parameter should be a string not a '${typeof givenLocation}'`);\r\n    console.assert(fieldName === 'OccurrenceNote' || fieldName === 'Annotation', `Unexpected checkTNLinks fieldName='${fieldName}'`);\r\n\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (fieldName) ourLocation = ` in ${fieldName}${ourLocation}`;\r\n\r\n    const ctarResult = { noticeList: [] };\r\n\r\n    function addNotice6({priority,message, lineNumber,characterIndex, extract, location}) {\r\n        // console.log(`checkTNLinks Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cTNlnk addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cTNlnk addNotice6: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cTNlnk addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cTNlnk addNotice6: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex !== undefined, \"cTNlnk addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cTNlnk addNotice6: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cTNlnk addNotice6: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cTNlnk addNotice6: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cTNlnk addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cTNlnk addNotice6: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        ctarResult.noticeList.push({priority, message, lineNumber, characterIndex, extract, location});\r\n    }\r\n\r\n\r\n    // Main code for checkTNLinks\r\n    /*\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (trcELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n    */\r\n\r\n    let username;\r\n    try {\r\n        username = optionalCheckingOptions.taRepoUsername;\r\n    } catch (trcUNerror) { }\r\n    if (!username) username = 'unfoldingWord'; // or Door43-Catalog ???\r\n    let branch;\r\n    try {\r\n        branch = optionalCheckingOptions.taRepoBranch;\r\n    } catch (trcBRerror) { }\r\n    if (!branch) branch = 'master';\r\n    let defaultLanguageCode;\r\n    try {\r\n        defaultLanguageCode = optionalCheckingOptions.taRepoLanguageCode;\r\n    } catch (trcLCerror) { }\r\n    if (!defaultLanguageCode) defaultLanguageCode = 'en';\r\n\r\n\r\n    // Check TA links like [[rc://en/ta/man/translate/figs-metaphor]]\r\n    let resultArray;\r\n    // console.log(\"checkTNLinks: Search for TA links\")\r\n    const taRegex = new RegExp('\\\\[\\\\[rc://([^ /]+?)/ta/man/([^ /]+?)/([^ \\\\]]+?)\\\\]\\\\]', 'g');\r\n    while (resultArray = taRegex.exec(fieldText)) {\r\n        // console.log(`  resultArray=${JSON.stringify(resultArray)}`);\r\n        console.assert(resultArray.length === 4, `Expected 4 fields (not ${resultArray.length})`)\r\n        let languageCode = resultArray[1];\r\n        if (!languageCode || languageCode === '*') languageCode = defaultLanguageCode;\r\n        const taRepoName = `${languageCode}_ta`;\r\n        // console.log(`Got taRepoName=${taRepoName}`);\r\n        const filepath = `${resultArray[2]}/${resultArray[3]}/01.md`; // Other files are title.md, sub-title.md\r\n        // console.log(`Got tA filepath=${filepath}`);\r\n\r\n        // console.log(`Need to check against ${taRepoName}`);\r\n        let taFileContent; // Not really used here -- just to show that we got something valid\r\n        try {\r\n            taFileContent = await getFile({ username, repository: taRepoName, path: filepath, branch });\r\n            // console.log(\"Fetched fileContent for\", taRepoName, filepath, typeof fileContent, fileContent.length);\r\n        } catch (trcGCerror) {\r\n            console.log(\"ERROR: Failed to load\", username, taRepoName, filepath, branch, trcGCerror.message);\r\n            addNotice6({priority:885, message:`Error loading ${fieldName} TA link`, extract:resultArray[0], location:`${ourLocation} ${filepath}: ${trcGCerror}`});\r\n        }\r\n        if (!taFileContent)\r\n            addNotice6({priority:886, message:`Unable to find ${fieldName} TA link`, extract:resultArray[0], location:`${ourLocation} ${filepath}`});\r\n        else if (taFileContent.length < 10)\r\n            addNotice6({priority:884, message:`Linked ${fieldName} TA article seems empty`, extract:resultArray[0], location:`${ourLocation} ${filepath}`});\r\n    }\r\n\r\n    // Check TW links like [[rc://en/tw/dict/bible/other/death]]\r\n    // console.log(\"checkTNLinks: Search for TW links\")\r\n    const twRegex = new RegExp('\\\\[\\\\[rc://([^ /]+?)/tw/dict/bible/([^ /]+?)/([^ \\\\]]+?)\\\\]\\\\]', 'g');\r\n    while (resultArray = twRegex.exec(fieldText)) {\r\n        // console.log(`  resultArray=${JSON.stringify(resultArray)}`);\r\n        console.assert(resultArray.length === 4, `Expected 4 fields (not ${resultArray.length})`)\r\n        let languageCode = resultArray[1];\r\n        if (!languageCode || languageCode === '*') languageCode = defaultLanguageCode;\r\n        const twRepoName = `${languageCode}_tw`;\r\n        // console.log(`Got twRepoName=${twRepoName}`);\r\n        const filepath = `bible/${resultArray[2]}/${resultArray[3]}.md`; // Other files are title.md, sub-title.md\r\n        // console.log(`Got tW filepath=${filepath}`);\r\n\r\n        // console.log(`Need to check against ${twRepoName}`);\r\n        let taFileContent; // Not really used here -- just to show that we got something valid\r\n        try {\r\n            taFileContent = await getFile({ username, repository: twRepoName, path: filepath, branch });\r\n            // console.log(\"Fetched fileContent for\", twRepoName, filepath, typeof fileContent, fileContent.length);\r\n        } catch (trcGCerror) {\r\n            console.log(\"ERROR: Failed to load\", username, twRepoName, filepath, branch, trcGCerror.message);\r\n            addNotice6({priority:882, message:`Error loading ${fieldName} TW link`, extract:resultArray[0], location:`${ourLocation} ${filepath}: ${trcGCerror}`});\r\n        }\r\n        if (!taFileContent)\r\n            addNotice6({priority:883, message:`Unable to find ${fieldName} TW link`, extract:resultArray[0], location:`${ourLocation} ${filepath}`});\r\n        else if (taFileContent.length < 10)\r\n            addNotice6({priority:881, message:`Linked ${fieldName} TW article seems empty`, extract:resultArray[0], location:`${ourLocation} ${filepath}`});\r\n    }\r\n\r\n    // Check Bible links like [Revelation 3:11](../03/11.md)\r\n    const lowercaseBookID = bookID.toLowerCase();\r\n    let numChaptersThisBook;\r\n    try {\r\n        numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n    } catch (tnlcError) {\r\n        addNotice6({priority:979, message:\"Invalid book identifier passed to checkTNLinks\", location:` '${bookID}' in first parameter: ${tnlcError}`});\r\n    }\r\n\r\n    // console.log(\"checkTNLinks: Search for Bible links\")\r\n    const bibleRegex = new RegExp('\\\\[(\\\\w+?) (\\\\d{1,3}):(\\\\d{1,3})\\\\]\\\\(\\\\.\\\\./(\\\\d{1,3})/(\\\\d{1,3})\\\\.md\\\\)', 'g');\r\n    while (resultArray = bibleRegex.exec(fieldText)) {\r\n        // console.log(`  resultArray=${JSON.stringify(resultArray)}`);\r\n        console.assert(resultArray.length === 6, `Expected 6 fields (not ${resultArray.length})`)\r\n\r\n        let chapterInt, verseInt;\r\n        try {\r\n            chapterInt = ourParseInt(resultArray[4]);\r\n        } catch (tnCIerror) {\r\n            console.log(`TN Link Check couldn't convert chapter '${resultArray[4]}': ${tnCIerror}`);\r\n            chapterInt = 1;\r\n        }\r\n        let numVersesThisChapter;\r\n        if (chapterInt < 1 || chapterInt > numChaptersThisBook)\r\n            addNotice6({priority:843, message:\"Invalid chapter number\", extract:resultArray[4], location:`${ourLocation}`});\r\n        else {\r\n            try {\r\n                numVersesThisChapter = books.versesInChapter(lowercaseBookID, chapterInt);\r\n            } catch (tnVIerror) {\r\n            console.log(`TN Link Check couldn't convert verse '${resultArray[5]}': ${tnVIerror}`);\r\n            verseInt = 1;\r\n            }\r\n        }\r\n        try {\r\n            if (ourParseInt(resultArray[2]) !== chapterInt)\r\n                addNotice6({priority:743, message:\"Chapter numbers of Bible link don't match\", extract:resultArray[0], location:`${ourLocation}`});\r\n        } catch (ccError) {\r\n            console.log(`TN Link Check couldn't compare chapter numbers: ${ccError}`);\r\n        }\r\n        try {\r\n            verseInt = ourParseInt(resultArray[5]);\r\n        } catch (tnVIerror) {\r\n            console.log(`TN Link Check couldn't convert verse '${resultArray[5]}': ${tnVIerror}`);\r\n        }\r\n        try {\r\n            if (ourParseInt(resultArray[3]) !== ourParseInt(verseInt))\r\n                addNotice6({priority:742, message:\"Verse numbers of Bible link don't match\", extract:resultArray[0], location:`${ourLocation}`});\r\n        } catch (vvError) {\r\n            console.log(`TN Link Check couldn't compare verse numbers: ${vvError}`);\r\n        }\r\n    }\r\n\r\n    // console.log(`checkTNLinks is returning ${JSON.stringify(ctarResult)}`);\r\n    return ctarResult;\r\n}\r\n// end of checkTNLinks function\r\n\r\n\r\nexport default checkTNLinks;\r\n","import * as books from '../core/books/books';\r\nimport { getFile } from '../core/getApi';\r\n// import { consoleLogObject } from '../core/utilities';\r\n\r\n\r\nconst QUOTE_VALIDATOR_VERSION = '0.3.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nasync function checkOriginalLanguageQuote(fieldName, fieldText, bookID, C, V, givenLocation, optionalCheckingOptions) {\r\n    // Checks that the Hebrew/Greek quote can be found in the original texts\r\n\r\n    // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n\r\n    // Note that the original language verse text can be passed in as\r\n    //      optionalCheckingOptions.originalLanguageVerseText.\r\n    // Alternatively, we can fetch it from Door43 -- you can control this with:\r\n    //      optionalCheckingOptions.originalLanguageRepoUsername\r\n    //      (UHB or UGNT will be used for the repo name)\r\n    //      optionalCheckingOptions.originalLanguageRepoBranch (or tag)\r\n\r\n    // console.log(`checkOriginalLanguageQuote v${QUOTE_VALIDATOR_VERSION} (${fieldName}, (${fieldText.length}) '${fieldText}', ${bookID} ${C}:${V} ${givenLocation}, …)`);\r\n    console.assert(fieldName !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldName === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof fieldName}'`);\r\n    console.assert(fieldText !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldText === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n    console.assert(bookID !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof bookID === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof bookID}'`);\r\n    console.assert(bookID.length === 3, `checkOriginalLanguageQuote: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n    console.assert(books.isValidBookID(bookID), `checkOriginalLanguageQuote: '${bookID}' is not a valid USFM book identifier`);\r\n    console.assert(C !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof C === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof C}'`);\r\n    console.assert(V !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof V === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof V}'`);\r\n    console.assert(givenLocation !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof givenLocation === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof givenLocation}'`);\r\n\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (fieldName) ourLocation = ` in ${fieldName}${ourLocation}`;\r\n\r\n    const colqResult = { noticeList: [] };\r\n\r\n    function addNotice6({priority,message, lineNumber,characterIndex, extract, location}) {\r\n        // console.log(`checkOriginalLanguageQuote Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cOLQ addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cOLQ addNotice6: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cOLQ addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cOLQ addNotice6: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex !== undefined, \"cOLQ addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cOLQ addNotice6: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cOLQ addNotice6: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cOLQ addNotice6: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cOLQ addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cOLQ addNotice6: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        colqResult.noticeList.push({priority, message, lineNumber, characterIndex, extract, location});\r\n    }\r\n\r\n    async function getPassage(bookID, C, V, optionalCheckingOptions) {\r\n        // console.log(`getPassage(${bookID}, ${C}, ${V})`);\r\n\r\n        const bookNumberAndName = books.usfmNumberName(bookID);\r\n        const whichTestament = books.testament(bookID); // returns 'old' or 'new'\r\n        const originalLanguageRepoLanguageCode = whichTestament === 'old' ? 'hbo' : 'el-x-koine';\r\n        const originalLanguageRepoCode = whichTestament === 'old' ? 'UHB' : 'UGNT';\r\n        const originalLanguageRepoName = `${originalLanguageRepoLanguageCode}_${originalLanguageRepoCode.toLowerCase()}`;\r\n        const filename = `${bookNumberAndName}.usfm`;\r\n\r\n        let username;\r\n        try {\r\n            username = optionalCheckingOptions.originalLanguageRepoUsername;\r\n        } catch (qcoError) { }\r\n        if (!username) username = 'unfoldingWord'; // or Door43-Catalog ???\r\n        let branch;\r\n        try {\r\n            branch = optionalCheckingOptions.originalLanguageRepoBranch;\r\n        } catch (qcunError) { }\r\n        if (!branch) branch = 'master';\r\n\r\n        let originalUSFM;\r\n        // console.log(`Need to check against ${originalLanguageRepoCode}`);\r\n        if (originalLanguageRepoCode === 'UHB') {\r\n            try {\r\n                originalUSFM = await getFile({ username, repository: originalLanguageRepoName, path: filename, branch });\r\n                // console.log(\"Fetched file_content for\", repoName, filename, typeof originalUSFM, originalUSFM.length);\r\n            } catch (gcUHBerror) {\r\n                console.log(\"ERROR: Failed to load\", username, originalLanguageRepoCode, filename, branch, gcUHBerror.message);\r\n                addNotice6({priority:996, message:\"Failed to load\", location:`${generalLocation} ${filename}: ${gcUHBerror}`, extra:repoCode});\r\n            }\r\n        } else if (originalLanguageRepoCode === 'UGNT') {\r\n            try {\r\n                originalUSFM = await getFile({ username, repository: originalLanguageRepoName, path: filename, branch });\r\n                // console.log(\"Fetched file_content for\", repoName, filename, typeof originalUSFM, originalUSFM.length);\r\n            } catch (gcUGNTerror) {\r\n                console.log(\"ERROR: Failed to load\", username, originalLanguageRepoCode, filename, branch, gcUGNTerror.message);\r\n                addNotice6({priority:996, message:\"Failed to load\", location:`${generalLocation} ${filename}: ${gcUGNTerror}`, extra:repoCode});\r\n            }\r\n        }\r\n\r\n        // Do global fixes\r\n        originalUSFM = originalUSFM.replace(/\\\\k-e\\\\\\*/g, ''); // Remove \\k-e self-closed milestones\r\n        originalUSFM = originalUSFM.replace(/\\\\k-s.+?\\\\\\*/g, ''); // Remove \\k-s self-closed milestones\r\n\r\n\r\n        // Now find the desired C:V\r\n        let foundChapter = false, foundVerse = false;\r\n        let verseText = '';\r\n        for (const bookLine of originalUSFM.split('\\n')) {\r\n            // console.log(\"bookLine\", bookLine);\r\n            if (!foundChapter && bookLine === `\\\\c ${C}`) {\r\n                foundChapter = true;\r\n                continue;\r\n            }\r\n            if (foundChapter && !foundVerse && bookLine.startsWith(`\\\\v ${V}`)) {\r\n                foundVerse = true;\r\n                bookLine = bookLine.substring(3 + V.length); // Delete verse number so below bit doesn't fail\r\n            }\r\n            if (foundVerse) {\r\n                if (bookLine.startsWith('\\\\v ') || bookLine.startsWith('\\\\c '))\r\n                    break; // Don't go into the next verse or chapter\r\n                verseText += (bookLine.startsWith('\\\\f ') ? '' : ' ') + bookLine;\r\n            }\r\n        }\r\n        verseText = verseText.replace(/\\\\p/g, '').trim().replace(/  /g, ' ')\r\n        // console.log(`Got verse text1: '${verseText}'`);\r\n\r\n        // Remove \\w fields (just leaving the actual Bible text words)\r\n        let ixW = verseText.indexOf('\\\\w ')\r\n        while (ixW !== -1) {\r\n            const ixEnd = verseText.indexOf('\\\\w*', ixW)\r\n            if (ixEnd !== -1) {\r\n                const field = verseText.substring(ixW + 3, ixEnd);\r\n                const bits = field.split('|');\r\n                const adjusted_field = bits[0];\r\n                verseText = verseText.substring(0, ixW) + adjusted_field + verseText.substring(ixEnd + 3);\r\n            } else {\r\n                console.log(`Missing \\\\w* in ${B} ${C}:${V} verseText: '${verseText}'`);\r\n                verseText = verseText.replace(/\\\\w /g, '', 1); // Attempt to limp on\r\n            }\r\n            ixW = verseText.indexOf('\\\\w ', ixW + 1); // Might be another one\r\n        }\r\n        // console.log(`Got verse text2: '${verseText}'`);\r\n\r\n        // Remove footnotes\r\n        verseText = verseText.replace(/\\\\f (.+?)\\\\f\\*/g, '');\r\n        // Remove alternative versifications\r\n        verseText = verseText.replace(/\\\\va (.+?)\\\\va\\*/g, '');\r\n        // console.log(`Got verse text3: '${verseText}'`);\r\n\r\n        // Final clean-up (shouldn't be necessary, but just in case)\r\n        verseText = verseText.replace(/  /g, ' ');\r\n        console.assert(verseText.indexOf('\\\\w') === -1, `getPassage: Should be no \\\\w in ${bookID} ${C}:${V} '${verseText}'`);\r\n        console.assert(verseText.indexOf('\\\\k') === -1, `getPassage: Should be no \\\\k in ${bookID} ${C}:${V} '${verseText}'`);\r\n        console.assert(verseText.indexOf('x-') === -1, `getPassage: Should be no x- in ${bookID} ${C}:${V} '${verseText}'`);\r\n        console.assert(verseText.indexOf('\\\\f') === -1, `getPassage: Should be no \\\\f in ${bookID} ${C}:${V} '${verseText}'`);\r\n        console.assert(verseText.indexOf('\\\\x') === -1, `getPassage: Should be no \\\\x in ${bookID} ${C}:${V} '${verseText}'`);\r\n        // console.log(`  getPassage(${bookID} ${C}:${V}) is returning '${verseText}'`);\r\n        return verseText;\r\n    }\r\n    // end of getPassage function\r\n\r\n\r\n    // Main code for checkOriginalLanguageQuote\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (gcELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n\r\n    // if fieldText.lstrip() !== fieldText:\r\n    //     addNotice6({priority:0, message:`Unexpected whitespace at start of {TNid} '{fieldText}'\")\r\n    // if fieldText.rstrip() !== fieldText:\r\n    //     addNotice6({priority:0, message:`Unexpected whitespace at end of {TNid} '{fieldText}'\")\r\n    // fieldText = fieldText.strip() # so we don't get consequential errors\r\n\r\n    let characterIndex;\r\n    if ((characterIndex = fieldText.indexOf('...')) >= 0) {\r\n        // console.log(`Bad ellipse characters in '${fieldText}'`);\r\n        const extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '');\r\n        addNotice6({priority:159, message:\"Should use proper ellipse character (not periods)\", characterIndex, extract, location:ourLocation});\r\n    }\r\n\r\n    let quoteBits;\r\n    if (fieldText.indexOf('…') >= 0) {\r\n        quoteBits = fieldText.split('…');\r\n        if ((characterIndex = fieldText.indexOf(' …')) >= 0 || (characterIndex = fieldText.indexOf('… ')) >= 0) {\r\n            // console.log(`Unexpected space(s) beside ellipse in '${fieldText}'`);\r\n            const extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '');\r\n            addNotice6({priority:158, message:\"Unexpected space(s) beside ellipse character\", characterIndex, extract, location:ourLocation});\r\n        }\r\n    } else if (fieldText.indexOf('...') >= 0) { // Yes, we still actually allow this\r\n        quoteBits = fieldText.split('...');\r\n        if ((characterIndex = fieldText.indexOf(' ...')) >= 0 || (characterIndex = fieldText.indexOf('... ')) >= 0) {\r\n            // console.log(`Unexpected space(s) beside ellipse characters in '${fieldText}'`);\r\n            const extract = (characterIndex > halfLength ? '…' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '…' : '');\r\n            addNotice6({priority:158, message:\"Unexpected space(s) beside ellipse characters\", characterIndex, extract, location:ourLocation});\r\n        }\r\n    }\r\n    // console.log(`Got quoteBits=${quoteBits}`);\r\n\r\n    // Find the verse text in the original language\r\n    let verseText;\r\n    try {\r\n        verseText = optionalCheckingOptions.originalLanguageVerseText;\r\n    } catch (gcVTerror) { }\r\n    if (!verseText) // not supplied, so then we need to get it ourselves\r\n        verseText = await getPassage(bookID, C, V, optionalCheckingOptions);\r\n    if (!verseText) {\r\n        addNotice6({priority:851, message:\"Unable to load original language verse text\", location:ourLocation});\r\n        return colqResult; // nothing else we can do here\r\n    }\r\n\r\n    // Now check if the quote can be found in the verse text\r\n    if (quoteBits) {\r\n        const numQuoteBits = quoteBits.length;\r\n        if (numQuoteBits >= 2) {\r\n            for (let bitIndex = 0; bitIndex < numQuoteBits; bitIndex++) {\r\n                if (verseText.indexOf(quoteBits[bitIndex]) < 0) { // this is what we really want to catch\r\n                    // If the quote has multiple parts, create a description of the current part\r\n                    let partDescription;\r\n                    if (numQuoteBits === 1) partDescription = '';\r\n                    else if (bitIndex === 0) partDescription = 'beginning';\r\n                    else if (bitIndex === numQuoteBits - 1) partDescription = 'end';\r\n                    else partDescription = `middle${numQuoteBits > 3 ? bitIndex : ''}`;\r\n                    // console.log(`721 Unable to find '${fieldText}' ${numQuoteBits === 1? '': `'${quoteBits[bitIndex]}' `}${partDescription? '('+partDescription+') ':''}in '${verseText}'`);\r\n                    const extract = `${quoteBits[bitIndex]}' ${partDescription? '('+partDescription+')':''}`;\r\n                    addNotice6({priority:721, message:\"Unable to find original language quote in verse text\", extract, location:ourLocation});\r\n                }\r\n            }\r\n        } else // < 2\r\n            addNotice6({priority:375, message:\"Ellipsis without surrounding snippet\", location:ourLocation});\r\n    } else { // Only a single quote (no ellipsis)\r\n        if (verseText.indexOf(fieldText) >= 0) {\r\n            // Double check that it doesn't start/stop in the middle of a word\r\n            // console.log(`Here with fieldText=${fieldText} and verseText=${verseText}`);\r\n            let remainingBits = verseText.split(fieldText);\r\n            // console.log(`remaingBits=${JSON.stringify(remainingBits)}`);\r\n            if (remainingBits.length > 2) // Join the extra bits back up\r\n                remainingBits = [remainingBits[0], remainingBits.slice(1).join('…')];\r\n            console.assert(remainingBits.length === 2, `remaining bits are ${remainingBits.length}`);\r\n            // Note: There's some Hebrew (RTL) characters at the beginning of the following regex\r\n            if (remainingBits[0] && remainingBits[0].slice(-1).search(/[^־A-Za-z\\s*\\(]/) !== -1) {\r\n                const badChar = remainingBits[0].slice(-1);\r\n                const badCharString = ` by '{badChar}' {unicodedata.name(badChar)}={hex(ord(badChar))}`;\r\n                // console.log(`Seems '${fieldText}' might not start at the beginning of a word—it's preceded ${badCharString} in '${verseText}'`);\r\n                const extract = `(${remainingBits[0].slice(-1)})` + fieldText.substring(0, extractLength-3) + (fieldText.length > extractLength-3 ? '…' : '');\r\n                addNotice6({priority:620, message:\"Seems original language quote might not start at the beginning of a word\", characterIndex:0, extract, location:ourLocation});\r\n            }\r\n            // Note: There's some Hebrew (RTL) characters at the beginning of the following regex\r\n            if (remainingBits[1] && remainingBits[1][0].search(/[^׃־A-Za-z\\s.,:;?!–)]/) !== -1) {\r\n                const badChar = remainingBits[1][0];\r\n                const badCharString = ` by '${badChar}' {unicodedata.name(badChar)}={hex(ord(badChar))}`;\r\n                // console.log(`Seems '${fieldText}' might not finish at the end of a word—it's followed ${badCharString} in '${verseText}'`);\r\n                const extract = (fieldText.length > extractLength-3 ? '…' : '') + fieldText.substring(fieldText.length-extractLength+3, fieldText.length) + `(${remainingBits[1][0]})`;\r\n                addNotice6({priority:621, message:\"Seems original language quote might not finish at the end of a word\", characterIndex:fieldText.length, extract, location:ourLocation});\r\n            }\r\n        } else { // can't find the given text\r\n            // console.log(`Unable to find '${fieldText}' in '${verseText}'`);\r\n            const extraText = fieldText.indexOf('\\u00A0') >= 0 ? \" (contains No-Break Space shown as '⍽')\" : \"\";\r\n            if (extraText) fieldText = fieldText.replace(/\\u00A0/g, '⍽');\r\n            const extract = fieldText.substring(0, halfLength) + (fieldText.length > 2*halfLength? '…':'') + fieldText.substring(fieldText.length-halfLength, fieldText.length);\r\n            // console.log(`722 fieldText='${fieldText}'${extraText}`);\r\n            // console.log(`722 verseText='${verseText}'`);\r\n            addNotice6({priority:722, message:\"Unable to find original language quote in verse text\", extract, location:ourLocation});\r\n\r\n        }\r\n    }\r\n\r\n    // console.log(`checkOriginalLanguageQuote is returning ${JSON.stringify(colqResult)}`);\r\n    return colqResult;\r\n}\r\n// end of checkOriginalLanguageQuote function\r\n\r\n\r\nexport default checkOriginalLanguageQuote;\r\n","import * as books from './books/books';\r\nimport doBasicTextChecks from './basic-text-check';\r\nimport checkMarkdownText from './markdown-text-check';\r\nimport checkTAReference from './ta-reference-check';\r\nimport checkTNLinks from './tn-links-check';\r\nimport checkOriginalLanguageQuote from './quote-check';\r\n\r\n\r\nconst TABLE_LINE_VALIDATOR_VERSION = '0.3.3';\r\n\r\nconst NUM_EXPECTED_TSV_FIELDS = 9; // so expects 8 tabs per line\r\nconst EXPECTED_TN_HEADING_LINE = 'Book\\tChapter\\tVerse\\tID\\tSupportReference\\tOrigQuote\\tOccurrence\\tGLQuote\\tOccurrenceNote';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nasync function checkTN_TSVDataRow(line, bookID, C, V, givenRowLocation, optionalCheckingOptions) {\r\n    /**\r\n    * @description - Checks one TSV data row of translation notes (TN)\r\n    * @param {String} line - the TSV line to be checked\r\n    * @param {String} bookID - 3-character UPPERCASE USFM book identifier\r\n    * @param {String} C - chapter number string\r\n    * @param {String} V - verse number string\r\n    * @param {String} givenRowLocation - description of where the line is located\r\n    * @param {Object} optionalCheckingOptions - may contain extractLength parameter\r\n    * @return {Object} - containing noticeList\r\n    */\r\n    /* This function is only for checking one data row\r\n          and the function doesn't assume that it has any previous context.\r\n\r\n        It's designed to be able to quickly show errors for a single row being displayed/edited.\r\n\r\n        Returns an object containing the noticeList.\r\n    */\r\n    // console.log(`checkTN_TSVDataRow(${bookID}, ${line}, ${givenRowLocation}, ${JSON.stringify(optionalCheckingOptions)})…`);\r\n    console.assert(line !== undefined, \"checkTN_TSVDataRow: 'line' parameter should be defined\");\r\n    console.assert(typeof line === 'string', `checkTN_TSVDataRow: 'line' parameter should be a string not a '${typeof line}'`);\r\n    console.assert(bookID !== undefined, \"checkTN_TSVDataRow: 'bookID' parameter should be defined\");\r\n    console.assert(typeof bookID === 'string', `checkTN_TSVDataRow: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n    console.assert(bookID.length === 3, `checkTN_TSVDataRow: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n    console.assert(books.isValidBookID(bookID), `checkTN_TSVDataRow: '${bookID}' is not a valid USFM book identifier`);\r\n    // console.assert(C !== undefined, \"checkTN_TSVDataRow: 'C' parameter should be defined\");\r\n    if (C) console.assert(typeof C === 'string', `checkTN_TSVDataRow: 'C' parameter should be a string not a '${typeof C}'`);\r\n    // console.assert(V !== undefined, \"checkTN_TSVDataRow: 'V' parameter should be defined\");\r\n    if (V) console.assert(typeof V === 'string', `checkTN_TSVDataRow: 'V' parameter should be a string not a '${typeof V}'`);\r\n    console.assert(givenRowLocation !== undefined, \"checkTN_TSVDataRow: 'givenRowLocation' parameter should be defined\");\r\n    console.assert(typeof givenRowLocation === 'string', `checkTN_TSVDataRow: 'givenRowLocation' parameter should be a string not a '${typeof givenRowLocation}'`);\r\n\r\n    let ourRowLocation = givenRowLocation;\r\n    if (ourRowLocation && ourRowLocation[0] !== ' ') ourRowLocation = ` ${ourRowLocation}`;\r\n\r\n    let drResult = { noticeList: [] };\r\n\r\n    function addNotice6to9({priority, message, lineNumber, characterIndex, extract, location}) {\r\n        /**\r\n        * @description - adds a new notice entry, adding bookID,C,V to the given fields\r\n        * @param {Number} priority - notice priority from 1 (lowest) to 999 (highest)\r\n        * @param {String} message - the text of the notice message\r\n        * @param {Number} characterIndex - where the issue occurs in the line (or -1 if unknown)\r\n        * @param {String} extract - short extract from the line centred on the problem (if available)\r\n        * @param {String} location - description of where the issue is located\r\n        */\r\n        // console.log(`TSV Row addNotice6to9: (priority=${priority}) ${message}, ${characterIndex}, ${extract}, ${location}`);\r\n        console.assert(priority !== undefined, \"cTSVrow addNotice6to9: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cTSVrow addNotice6to9: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cTSVrow addNotice6to9: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cTSVrow addNotice6to9: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex !== undefined, \"cTSVrow addNotice6to9: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cTSVrow addNotice6to9: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cTSVrow addNotice6to9: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cTSVrow addNotice6to9: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cTSVrow addNotice6to9: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cTSVrow addNotice6to9: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        // Also uses the given bookID,C,V, parameters from the main function call\r\n        drResult.noticeList.push({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location});\r\n    }\r\n\r\n    function doOurMarkdownTextChecks(fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given markdown field and processes the returned results\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} rowLocation - description of where the line is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does markdown checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n\r\n        // We don't currently use the allowedLinks parameter\r\n\r\n        // console.log(`cTSVrow doOurBasicTextChecks(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${fieldLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cTSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cTSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"cTSVrow doOurMarkdownTextChecks: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cTSVrow doOurMarkdownTextChecks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"cTSVrow doOurMarkdownTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n        const cmtResultObject = checkMarkdownText(fieldName, fieldText, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(cmtResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of cmtResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL doOurMarkdownTextChecks notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of doOurMarkdownTextChecks function\r\n\r\n    function doOurBasicTextChecks(fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} rowLocation - description of where the line is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`cTSVrow doOurBasicTextChecks(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${rowLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cTSVrow doOurBasicTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cTSVrow doOurBasicTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"cTSVrow doOurBasicTextChecks: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cTSVrow doOurBasicTextChecks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"cTSVrow doOurBasicTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n        const dbtcResultObject = doBasicTextChecks(fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(dbtcResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of dbtcResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL doOurBasicTextChecks notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of doOurBasicTextChecks function\r\n\r\n    async function ourCheckTAReference(fieldName, taLinkText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the TA reference can be found\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`cTSVrow ourCheckTAReference(${fieldName}, (${taLinkText.length}) '${taLinkText}', ${rowLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cTSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cTSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(taLinkText !== undefined, \"cTSVrow ourCheckTAReference: 'taLinkText' parameter should be defined\");\r\n        console.assert(typeof taLinkText === 'string', `cTSVrow ourCheckTAReference: 'taLinkText' parameter should be a string not a '${typeof taLinkText}'`);\r\n\r\n        const coqResultObject = await checkTAReference(fieldName, taLinkText, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTAReference notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of ourCheckTAReference function\r\n\r\n    async function ourCheckTNOriginalLanguageQuote(fieldName, fieldText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the Hebrew/Greek quote can be found in the original texts\r\n\r\n        // Uses the bookID,C,V values from the main function call\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`cTSVrow ourCheckTNOriginalLanguageQuote(${fieldName}, (${fieldText.length}) '${fieldText}', ${rowLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cTSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cTSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"cTSVrow ourCheckTNOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cTSVrow ourCheckTNOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n\r\n        const coqResultObject = await checkOriginalLanguageQuote(fieldName,fieldText, bookID,C,V, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTNOriginalLanguageQuote notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of ourCheckTNOriginalLanguageQuote function\r\n\r\n    async function ourCheckTNLinks(fieldName, taLinkText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the TA reference can be found\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`cTSVrow ourCheckTNLinks(${fieldName}, (${taLinkText.length}) '${taLinkText}', ${rowLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cTSVrow ourCheckTNLinks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cTSVrow ourCheckTNLinks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(taLinkText !== undefined, \"cTSVrow ourCheckTNLinks: 'taLinkText' parameter should be defined\");\r\n        console.assert(typeof taLinkText === 'string', `cTSVrow ourCheckTNLinks: 'taLinkText' parameter should be a string not a '${typeof taLinkText}'`);\r\n\r\n        const coqResultObject = await checkTNLinks(bookID, fieldName, taLinkText, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTNLinks notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of ourCheckTNLinks function\r\n\r\n\r\n    // Main code for checkTN_TSVDataRow function\r\n    if (line === EXPECTED_TN_HEADING_LINE) // Assume it must be ok\r\n        return drResult; // We can't detect if it's in the wrong place\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (tlcELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const lowercaseBookID = bookID.toLowerCase();\r\n    let numChaptersThisBook;\r\n    try {\r\n        numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n    } catch (tlcNCerror) {\r\n        addNotice6to9({priority:979, message:\"Invalid book identifier passed to checkTN_TSVDataRow\", location:` '${bookID}' in first parameter: ${tlcNCerror}`});\r\n    }\r\n    const haveGoodBookID = numChaptersThisBook !== undefined;\r\n\r\n    // let inString;\r\n    // if (rowLocation) inString = rowLocation;\r\n    // else inString = ` in line ${rowNumber.toLocaleString()}`;\r\n\r\n    let fields = line.split('\\t');\r\n    if (fields.length === NUM_EXPECTED_TSV_FIELDS) {\r\n        const [B, C, V, fieldID, supportReference, origQuote, occurrence, GLQuote, occurrenceNote] = fields;\r\n        // let withString = ` with '${fieldID}'${inString}`;\r\n        // let CV_withString = ` ${C}:${V}${withString}`;\r\n        // let atString = ` at ${B} ${C}:${V} (${fieldID})${inString}`;\r\n\r\n        // Check the fields one-by-one\r\n        if (B.length) {\r\n            if (B !== bookID)\r\n                addNotice6to9({priority:978, message:`Wrong '${B}' book identifier`, location:` (expected '${bookID}')${ourRowLocation}`});\r\n        }\r\n        else\r\n            addNotice6to9({priority:977, message:\"Missing book identifier\", characterIndex:0, location:ourRowLocation});\r\n\r\n        let numVersesThisChapter, haveGoodChapterNumber;\r\n        if (C.length) {\r\n            if (C === 'front') { }\r\n            else if (/^\\d+$/.test(C)) {\r\n                let intC = Number(C);\r\n                if (intC === 0) {\r\n                    addNotice6to9({priority:824, message:`Invalid zero chapter number`, extract:C, location:ourRowLocation});\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n                // TODO: Does this next section need rewriting (see verse check below)???\r\n                else if (intC > numChaptersThisBook) {\r\n                    addNotice6to9({priority:823, message:`Invalid large chapter number`, extract:C, location:ourRowLocation});\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n                try {\r\n                    numVersesThisChapter = books.versesInChapter(lowercaseBookID, intC);\r\n                    haveGoodChapterNumber = true;\r\n                } catch (tlcNVerror) {\r\n                    if (!haveGoodBookID)\r\n                        // addNotice6to9({priority:500, \"Invalid chapter number\", rowLocation);\r\n                        // else\r\n                        addNotice6to9({priority:822, message:\"Unable to check chapter number\", location:` '${C}'${ourRowLocation}`});\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n            }\r\n            else\r\n                addNotice6to9({priority:821, message:\"Bad chapter number\", location:` '${C}' with${ourRowLocation}`});\r\n        }\r\n        else\r\n            addNotice6to9({priority:820, message:\"Missing chapter number\", location:` ?:${V}${ourRowLocation}`});\r\n\r\n        if (V.length) {\r\n            if (V === 'intro') { }\r\n            else if (/^\\d+$/.test(V)) {\r\n                let intV = Number(V);\r\n                if (intV === 0)\r\n                    addNotice6to9({priority:814, message:`Invalid zero '${V}' verse number`, location:ourRowLocation});\r\n                else {\r\n                    if (haveGoodChapterNumber) {\r\n                        if (intV > numVersesThisChapter)\r\n                            addNotice6to9({priority:813, message:`Invalid large '${V}' verse number`, location:` for chapter ${C}${ourRowLocation}`});\r\n                    } else\r\n                        addNotice6to9({priority:812, message:\"Unable to check verse number\", location:` '${V}'${ourRowLocation}`});\r\n                }\r\n            }\r\n            else\r\n                addNotice6to9({priority:811, message:\"Bad verse number\", location:` '${V}'${ourRowLocation}`});\r\n        }\r\n        else\r\n            addNotice6to9({priority:810, message:\"Missing verse number\", location:` after ${C}:?${ourRowLocation}`});\r\n\r\n        if (!fieldID.length)\r\n            addNotice6to9({priority:779, message:\"Missing ID field\", location:ourRowLocation});\r\n        else {\r\n            if (fieldID.length !== 4)\r\n                addNotice6to9({priority:778, message:\"ID should be exactly 4 characters\", location:` (not ${fieldID.length})${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(fieldID[0]) < 0)\r\n                addNotice6to9({priority:176, message:\"ID should start with a lowercase letter or digit\", characterIndex:0, location:` (not '${fieldID[0]}')${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(fieldID[3]) < 0)\r\n                addNotice6to9({priority:175, message:\"ID should end with a lowercase letter or digit\", characterIndeX:3, location:` (not '${fieldID[3]}')${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(fieldID[1]) < 0)\r\n                addNotice6to9({priority:174, message:\"ID characters should only be lowercase letters, digits, or hypen\", characterIndex:1, location:` (not '${fieldID[1]}')${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(fieldID[2]) < 0)\r\n                addNotice6to9({priority:173, message:\"ID characters should only be lowercase letters, digits, or hypen\", characterIndex:2, location:` (not '${fieldID[2]}')${ourRowLocation}`});\r\n        }\r\n\r\n        if (supportReference.length) { // need to check UTN against UTA\r\n            doOurBasicTextChecks('SupportReference', supportReference, true, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTAReference('SupportReference', supportReference, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        // else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n        //     addNotice6to9({priority:277, message:\"Missing SupportReference field\", location:ourRowLocation});\r\n\r\n        if (origQuote.length) { // need to check UTN against UHB and UGNT\r\n            doOurBasicTextChecks('OrigQuote', origQuote, false, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTNOriginalLanguageQuote('OrigQuote', origQuote, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n            if (V !== 'intro')\r\n                addNotice6to9({priority:276, message:\"Missing OrigQuote field\", location:ourRowLocation});\r\n\r\n        if (occurrence.length) { // This should usually be a digit\r\n            if (occurrence === '0') { // zero means that it doesn't occur\r\n                if (origQuote.length)\r\n                    addNotice6to9({priority:550, message:\"Invalid zero occurrence field when we have an original quote\", location:ourRowLocation});\r\n                // if (V !== 'intro')\r\n                //     addNotice6to9({priority:500, message:\"Invalid zero occurrence field\", -1, \"\", rowLocation);\r\n            }\r\n            else if (occurrence === '-1') // TODO check the special conditions when this can occur???\r\n                ;\r\n            else if ('12345'.indexOf(occurrence) < 0) // it's not one of these integers\r\n                addNotice6to9({priority:792, message:`Invalid '${occurrence}' occurrence field`, location:ourRowLocation});\r\n        }\r\n\r\n        if (GLQuote.length) { // TODO: need to check UTN against ULT\r\n            if (V !== 'intro')\r\n                doOurBasicTextChecks('GLQuote', GLQuote, false, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n            if (V !== 'intro')\r\n                addNotice6to9({priority:275, message:\"Missing GLQuote field\", location:ourRowLocation});\r\n\r\n        if (occurrenceNote.length) {\r\n            doOurMarkdownTextChecks('OccurrenceNote', occurrenceNote, true, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTNLinks('OccurrenceNote', occurrenceNote, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n            addNotice6to9({priority:274, message:\"Missing OccurrenceNote field\", location:ourRowLocation});\r\n\r\n    } else\r\n        addNotice6to9({priority:861, message:`Found wrong number of TSV fields (expected ${NUM_EXPECTED_TSV_FIELDS})`, extract:`Found ${fields.length} field${fields.length === 1 ? '' : 's'}`, location:ourRowLocation});\r\n\r\n        // console.log(`  checkTN_TSVDataRow returning with ${drResult.noticeList.length.toLocaleString()} notice(s).`);\r\n        // console.log(\"checkTN_TSVDataRow result is\", JSON.stringify(drResult));\r\n        return drResult; // object with noticeList only\r\n}\r\n// end of checkTN_TSVDataRow function\r\n\r\nexport default checkTN_TSVDataRow;\r\n","import * as books from './books/books';\r\nimport checkTN_TSVDataRow from './tn-table-row-check';\r\n\r\n\r\nconst TABLE_TEXT_VALIDATOR_VERSION = '0.2.1';\r\n\r\nconst NUM_EXPECTED_TN_FIELDS = 9; // so expects 8 tabs per line\r\nconst EXPECTED_TN_HEADING_LINE = 'Book\\tChapter\\tVerse\\tID\\tSupportReference\\tOrigQuote\\tOccurrence\\tGLQuote\\tOccurrenceNote';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nasync function checkTN_TSVText(bookID, tableText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all rows.\r\n\r\n      It also has the advantage of being able to compare one row with the previous one.\r\n\r\n     bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`checkTN_TSVText(${bookID}, ${tableText.length}, ${location},${JSON.stringify(optionalCheckingOptions)})…`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    // if (bookID) ourLocation = ` in ${bookID}${ourLocation}`;\r\n\r\n    const result = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkTN_TSVText success: ${successString}`);\r\n        result.successList.push(successString);\r\n    }\r\n    function addNoticeCV8({priority,message, C,V, lineNumber, characterIndex, extract, location}) {\r\n        // console.log(`checkTN_TSVText notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"TSV addNoticeCV8: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `TSV addNoticeCV8: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"TSV addNoticeCV8: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `TSV addNoticeCV8: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(C !== undefined, \"TSV addNoticeCV8: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `TSV addNoticeCV8: 'C' parameter should be a string not a '${typeof C}': ${C}`);\r\n        // console.assert(V !== undefined, \"TSV addNoticeCV8: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `TSV addNoticeCV8: 'V' parameter should be a string not a '${typeof V}': ${V}`);\r\n        // console.assert(characterIndex !== undefined, \"TSV addNoticeCV8: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `TSV addNoticeCV8: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"TSV addNoticeCV8: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `TSV addNoticeCV8: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"TSV addNoticeCV8: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `TSV addNoticeCV8: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        result.noticeList.push({priority,message, bookID,C,V, lineNumber, characterIndex, extract, location});\r\n    }\r\n\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (ttcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    let lowercaseBookID = bookID.toLowerCase();\r\n    let numChaptersThisBook = 0;\r\n    try {\r\n        numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n    }\r\n    catch {\r\n        if (!books.isValidBookID(bookID)) // must not be in FRT, BAK, etc.\r\n            addNoticeCV8({priority:747, message:\"Bad function call: should be given a valid book abbreviation\", extract:bookID, location:` (not '${bookID}')${ourLocation}`});\r\n    }\r\n\r\n    let lines = tableText.split('\\n');\r\n    // console.log(`  '${location}' has ${lines.length.toLocaleString()} total lines (expecting ${NUM_EXPECTED_TN_FIELDS} fields in each line)`);\r\n\r\n    let lastB = '', lastC = '', lastV = '';\r\n    let fieldID_list = [];\r\n    let numVersesThisChapter = 0;\r\n    for (let n= 0; n < lines.length; n++) {\r\n        // console.log(`checkTN_TSVText checking line ${n}: ${JSON.stringify(lines[n])}`);\r\n        let inString = ` in line ${(n + 1).toLocaleString()}${ourLocation}`;\r\n        if (n === 0) {\r\n            if (lines[0] === EXPECTED_TN_HEADING_LINE)\r\n                addSuccessMessage(`Checked TSV header ${ourLocation}`);\r\n            else\r\n                addNoticeCV8({priority:746, message:\"Bad TSV header\", lineNumber:n+1, location:`${ourLocation}: '${lines[0]}'`});\r\n        }\r\n        else // not the header\r\n        {\r\n            let fields = lines[n].split('\\t');\r\n            if (fields.length === NUM_EXPECTED_TN_FIELDS) {\r\n                const [B, C, V, fieldID, _support_reference, _orig_quote, _occurrence, _GL_quote, _occurrenceNote] = fields;\r\n                const withString = ` with ID '${fieldID}'${inString}`;\r\n                // let CV_withString = ` ${C}:${V}${withString}`;\r\n                // let atString = ` at ${B} ${C}:${V} (${fieldID})${inString}`;\r\n\r\n                // Use the row check to do most basic checks\r\n                const firstResult = await checkTN_TSVDataRow(lines[n], bookID,C,V, withString, optionalCheckingOptions);\r\n                // Choose only ONE of the following\r\n                // This is the fast way of append the results from this field\r\n                result.noticeList = result.noticeList.concat(firstResult.noticeList);\r\n                // If we need to put everything through addNoticeCV8, e.g., for debugging or filtering\r\n                //  process results line by line\r\n                // for (const noticeEntry of firstResult.noticeList)\r\n                //     addNoticeCV8({priority:noticeEntry.priority, noticeEntry[1], noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7]});\r\n\r\n                // So here we only have to check against the previous and next fields for out-of-order problems\r\n                if (B) {\r\n                    if (B !== bookID)\r\n                        addNoticeCV8({priority:745, C,V, message:`Wrong '${B}' book identifier (expected '${bookID}')`, lineNumber:n+1, location:withString});\r\n                }\r\n                else\r\n                    addNoticeCV8({priority:744, C,V, message:\"Missing book identifier\", lineNumber:n+1, location:withString});\r\n\r\n                if (C) {\r\n                    if (C === 'front') { }\r\n                    else if (/^\\d+$/.test(C)) {\r\n                        let intC = Number(C);\r\n                        if (C !== lastC)\r\n                            numVersesThisChapter = books.versesInChapter(lowercaseBookID, intC);\r\n                        if (intC === 0)\r\n                            addNoticeCV8({priority:551, C,V, message:`Invalid zero '${C}' chapter number`, lineNumber:n+1, location:withString});\r\n                        if (intC > numChaptersThisBook)\r\n                            addNoticeCV8({priority:737, C,V, message:`Invalid large '${C}' chapter number`, lineNumber:n+1, location:withString});\r\n                        if (/^\\d+$/.test(lastC)) {\r\n                            let lastintC = Number(lastC);\r\n                            if (intC < lastintC)\r\n                                addNoticeCV8({priority:736, C,V, message:`Receding '${C}' chapter number after '${lastC}'`, lineNumber:n+1, location:withString});\r\n                            else if (intC > lastintC + 1)\r\n                                addNoticeCV8({priority:735, C,V, message:`Advancing '${C}' chapter number after '${lastC}'`, lineNumber:n+1, location:withString});\r\n                        }\r\n                    }\r\n                    else\r\n                        addNoticeCV8({priority:734, C,V, message:\"Bad chapter number\", lineNumber:n+1, location:withString});\r\n                }\r\n                else\r\n                    addNoticeCV8({priority:739, C,V, message:\"Missing chapter number\", lineNumber:n+1, location:` after ${lastC}:${V}${withString}`});\r\n\r\n                if (V) {\r\n                    if (V === 'intro') { }\r\n                    else if (/^\\d+$/.test(V)) {\r\n                        let intV = Number(V);\r\n                        if (intV === 0)\r\n                            addNoticeCV8({priority:552, C,V, message:`Invalid zero '${V}' verse number`, lineNumber:n+1, location:withString});\r\n                        if (intV > numVersesThisChapter)\r\n                            addNoticeCV8({priority:734, C,V, message:`Invalid large '${V}' verse number for chapter ${C}`, lineNumber:n+1, location:withString});\r\n                        if (/^\\d+$/.test(lastV)) {\r\n                            let lastintV = Number(lastV);\r\n                            if (intV < lastintV)\r\n                                addNoticeCV8({priority:733, C,V, message:`Receding '${V}' verse number after '${lastV}'`, lineNumber:n+1, location:withString});\r\n                            // else if (intV > lastintV + 1)\r\n                            //   addNoticeCV8({priority:556, `Skipped verses with '${V}' verse number after '${lastV}'${withString}`);\r\n                        }\r\n                    }\r\n                    else\r\n                        addNoticeCV8({priority:738, C,V, message:\"Bad verse number\", lineNumber:n+1, location:withString});\r\n\r\n                }\r\n                else\r\n                    addNoticeCV8({priority:790, C,V, message:\"Missing verse number\", lineNumber:n+1, location:` after ${C}:${lastV}${withString}`});\r\n\r\n                if (fieldID) {\r\n                    if (fieldID_list.indexOf(fieldID) >= 0)\r\n                        addNoticeCV8({priority:729, C,V, message:`Duplicate '${fieldID}' ID`, lineNumber:n+1, location:withString});\r\n                } else\r\n                    addNoticeCV8({priority:730, C,V, message:\"Missing ID\", lineNumber:n+1, location:withString});\r\n\r\n\r\n                if (B !== lastB || C !== lastC || V !== lastV) {\r\n                    fieldID_list = []; // ID's only need to be unique within each verse\r\n                    lastB = B; lastC = C; lastV = V;\r\n                }\r\n\r\n            } else\r\n                // if (n === lines.length - 1) // it's the last line\r\n                //     console.log(`  Line ${n}: Has ${fields.length} field(s) instead of ${NUM_EXPECTED_TN_FIELDS}: ${EXPECTED_TN_HEADING_LINE.replace(/\\t/g, ', ')}`);\r\n                // else\r\n                if (n !== lines.length - 1) // it's not the last line\r\n                    addNoticeCV8({priority:988, message:`Wrong number of tabbed fields (expected ${NUM_EXPECTED_TN_FIELDS})`, extract:`Found ${fields.length} field${fields.length===1?'':'s'}`, lineNumber:n+1, location:inString});\r\n        }\r\n    }\r\n    addSuccessMessage(`Checked all ${(lines.length - 1).toLocaleString()} data line${lines.length - 1 === 1 ? '' : 's'}${ourLocation}.`);\r\n    if (result.noticeList)\r\n        addSuccessMessage(`checkTN_TSVText v${TABLE_TEXT_VALIDATOR_VERSION} finished with ${result.noticeList.length?result.noticeList.length.toLocaleString():\"zero\"} notice${result.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by checkTN_TSVText v${TABLE_TEXT_VALIDATOR_VERSION}`)\r\n    // console.log(`  checkTN_TSVText returning with ${result.successList.length.toLocaleString()} success(es), ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkTN_TSVText result is\", JSON.stringify(result));\r\n    return result;\r\n}\r\n// end of checkTN_TSVText function\r\n\r\n\r\nexport default checkTN_TSVText;\r\n","import * as books from '../../core/books/books';\r\nimport checkUSFMText from '../../core/usfm-text-check';\r\nimport checkMarkdownText from '../../core/markdown-text-check';\r\nimport checkPlainText from '../../core/plain-text-check';\r\nimport checkYAMLText from '../../core/yaml-text-check';\r\nimport checkManifestText from '../../core/manifest-text-check';\r\nimport checkTN_TSVText from '../../core/tn-table-text-check';\r\n// import { consoleLogObject } from '../../core/utilities';\r\n\r\n\r\nconst CHECK_FILE_VERSION_STRING = '0.1.5';\r\n\r\n\r\nasync function checkFile(filename, fileContent, givenLocation, checkingOptions) {\r\n    // Determine the file type from the filename extension\r\n    //  and return the results of checking that kind of file\r\n    //     console.log(`I'm here in checkFile v${CHECK_FILE_VERSION_STRING}\r\n    //   with ${filename}, ${fileContent.length} chars, ${givenLocation}, ${JSON.stringify(checkingOptions)}`);\r\n    const startTime = new Date();\r\n\r\n    let ourCFLocation = givenLocation;\r\n    if (ourCFLocation[0] !== ' ') ourCFLocation = ' ' + ourCFLocation;\r\n\r\n    let checkFileResult;\r\n    if (filename.toLowerCase().endsWith('.tsv')) {\r\n        const filenameMain = filename.substring(0, filename.length - 4); // drop .tsv\r\n        // console.log(`Have TSV filenameMain=${filenameMain}`);\r\n        const bookID = filenameMain.substring(filenameMain.length - 3);\r\n        // console.log(`Have TSV bookcode=${bookID}`);\r\n        console.assert(books.isValidBookID(bookID), `checkFile: '${bookID}' is not a valid USFM book identifier`);\r\n        checkFileResult = await checkTN_TSVText(bookID, fileContent, ourCFLocation, checkingOptions);\r\n    }\r\n    else if (filename.toLowerCase().endsWith('.usfm')) {\r\n        const filenameMain = filename.substring(0, filename.length - 5); // drop .usfm\r\n        // console.log(`Have USFM filenameMain=${filenameMain}`);\r\n        const bookID = filenameMain.substring(filenameMain.length - 3);\r\n        // console.log(`Have USFM bookcode=${bookID}`);\r\n        console.assert(books.isValidBookID(bookID), `checkFile: '${bookID}' is not a valid USFM book identifier`);\r\n        checkFileResult = checkUSFMText(bookID, filename, fileContent, ourCFLocation, checkingOptions);\r\n    } else if (filename.toLowerCase().endsWith('.sfm')) {\r\n        const filenameMain = filename.substring(0, filename.length - 4); // drop .sfm\r\n        console.log(`Have SFM filenameMain=${filenameMain}`);\r\n        const bookID = filenameMain.substring(2, 5);\r\n        console.log(`Have SFM bookcode=${bookID}`);\r\n        console.assert(books.isValidBookID(bookID), `checkFile: '${bookID}' is not a valid USFM book identifier`);\r\n        checkFileResult = checkUSFMText(bookID, filename, fileContent, ourCFLocation, checkingOptions);\r\n    } else if (filename.toLowerCase().endsWith('.md'))\r\n        checkFileResult = checkMarkdownText(filename, fileContent, ourCFLocation, checkingOptions);\r\n    else if (filename.toLowerCase().endsWith('.txt'))\r\n        checkFileResult = checkPlainText(filename, fileContent, ourCFLocation, checkingOptions);\r\n    else if (filename.toLowerCase() === 'manifest.yaml')\r\n        checkFileResult = checkManifestText(filename, fileContent, ourCFLocation, checkingOptions);\r\n    else if (filename.toLowerCase().endsWith('.yaml'))\r\n        checkFileResult = checkYAMLText(filename, fileContent, ourCFLocation, checkingOptions);\r\n    else {\r\n        checkFileResult = checkPlainText(filename, fileContent, ourCFLocation, checkingOptions);\r\n        checkFileResult.noticeList.unshift([995, \"File extension is not recognized, so treated as plain text.\", -1, '', filename]);\r\n    }\r\n    // console.log(`checkFile got initial results with ${checkFileResult.successList.length} success message(s) and ${checkFileResult.noticeList.length} notice(s)`);\r\n\r\n    // Add some extra fields to our checkFileResult object\r\n    //  in case we need this information again later\r\n    checkFileResult.checkedFileCount = 1;\r\n    checkFileResult.checkedFilename = filename;\r\n    checkFileResult.checkedFilesize = fileContent.length;\r\n    checkFileResult.checkedOptions = checkingOptions;\r\n\r\n    checkFileResult.elapsedTime = (new Date() - startTime) / 1000; // seconds\r\n    return checkFileResult;\r\n};\r\n// end of checkFile()\r\n\r\nexport default checkFile;\r\n","// import { displayPropertyNames, consoleLogObject } from './utilities';\r\n\r\n\r\nconst NOTICE_PROCESSOR_VERSION_STRING = '0.5.1';\r\n\r\n// All of the following can be overriden with optionalProcessingOptions\r\nconst DEFAULT_MAXIMUM_SIMILAR_MESSAGES = 3; // Zero means no suppression of similar messages\r\nconst DEFAULT_CUTOFF_PRIORITY_LEVEL = 0; // This level or lower gets excluded from the lists\r\nconst DEFAULT_IGNORE_PRIORITY_NUMBER_LIST = [];\r\n\r\n// For processNoticesToErrorsWarnings\r\nconst DEFAULT_ERROR_PRIORITY_LEVEL = 700; // This level or higher becomes an error (cf. warnings)\r\n\r\n// For processNoticesToSevereMediumLow\r\nconst DEFAULT_SEVERE_PRIORITY_LEVEL = 800; // This level or higher becomes a severe error\r\nconst DEFAULT_MEDIUM_PRIORITY_LEVEL = 600; // This level or higher becomes a medium error\r\n\r\n// For processNoticesToSingleList\r\n// (no constants required)\r\n\r\n\r\nfunction processNoticesCommon(givenNoticeObject, optionalProcessingOptions) {\r\n    /**\r\n    * @description - Preprocesses the successList and noticeList\r\n    * @param {Object} givenNoticeObject - must contain a noticeList array\r\n    * @param {Object} optionalProcessingOptions - may contain parameters\r\n    * @return {Array} - noticeList, countObject, preResultObject\r\n    */\r\n    /*\r\n        Expects to get an object with:\r\n            successList: a list of strings describing what has been checked\r\n            noticeList: a list of components to notices, being:\r\n                priority: A notice priority number in the range 1-1000.\r\n                    Each different type of warning/error has a unique number\r\n                      (but not each instance of those warnings/errors).\r\n                    By default, notice priority numbers 700 and over are\r\n                      considered `errors` and 0-699 are considered `warnings`.\r\n                message: The actual general description text of the notice\r\n                The next three fields may be ommitted if irrelevant\r\n                 (since BCV is not relevant to all types of files/repos)\r\n                     bookID: book identifier 3-character UPPERCASE string\r\n                        (or empty string if not relevant)\r\n                    C: Chapter number string\r\n                        (or empty string if not relevant)\r\n                    V: Verse number string (can also be a bridge, e.g., '22-23')\r\n                        (or empty string if not relevant)\r\n                    lineNumber: A one-based integer indicating the line number in the file\r\n                    characterIndex: A zero-based integer index which indicates the position\r\n                      of the error on the line or in the text field as appropriate.\r\n                    -1 might still indicate that this characterIndex does not contain any useful information\r\n                        but this will be removed (rather the field won't be included at all)\r\n                extract: An extract of the checked text which indicates the area\r\n                      containing the problem.\r\n                    Where helpful, some character substitutions have already been made,\r\n                      for example, if the notice is about spaces,\r\n                      it is generally helpful to display spaces as a visible\r\n                      character in an attempt to best highlight the issue to the user.\r\n                 location: A string indicating the context of the notice,\r\n                        e.g., `in 'someBook.usfm'.\r\n                There is also an optional notice component (where multiple files/repos are checked)\r\n                extra: A string indicating an extra location component, e.g., repoCode or bookID\r\n                    This will probably need to be added to the message string but is left\r\n                        until now in order to allow the most display flexibility\r\n        Available options are:\r\n            cutoffPriorityLevel (integer; default is DEFAULT_CUTOFF_PRIORITY_LEVEL above)\r\n            maximumSimilarMessages (integer; default is DEFAULT_MAXIMUM_SIMILAR_MESSAGES above)\r\n            sortBy ('AsFound' or 'ByPriority', default is 'AsFound')\r\n            ignorePriorityNumberList (list of integers, default is empty list, list of notice priority numbers to be ignored)\r\n        Also, any other parameters are just passed through,\r\n            although filenameList might be abbreviated, e.g. for 100s of .md files.\r\n\r\n        Returns an array of three fields:\r\n            remainingNoticeList\r\n                A list of notice entries, each one containing exactly eight or nine fields (see above)\r\n                    i.e., notice entries originally containing five or six fields have had blank BCV fields inserted.\r\n            allTotals\r\n                A table of priority numbers with a count of notices for that priority.\r\n                    (May be used in further processing for possible removal of lots of similar messages)\r\n            resultObject\r\n                A prototype object which will be added to and then returned as the final result of the NEXT notice processing step.\r\n                Contains the following:\r\n                    successList -- a list of strings noting what has been checked\r\n                    numIgnored Notices (int)\r\n                    numSuppressedWarnings (int)\r\n                    processingOptions (a copy of the optionalProcessingOptions passed to these functions)\r\n                    Any other fields that were part of the givenNoticeObject passed to these functions. These might include:\r\n                        checkedFilenames -- list of strings\r\n                        checkedRepos -- list of strings\r\n                    depending on the type of check that was made.\r\n    */\r\n    //     console.log(`processNoticesCommon v${NOTICE_PROCESSOR_VERSION_STRING} with options=${JSON.stringify(optionalProcessingOptions)}\r\n    //   Given ${givenNoticeObject.successList.length.toLocaleString()} success string(s) plus ${givenNoticeObject.noticeList.length.toLocaleString()} notice(s)`);\r\n\r\n\r\n    const standardisedNoticeList = givenNoticeObject.noticeList;\r\n\r\n    if (givenNoticeObject.noticeList && givenNoticeObject.noticeList.length) {\r\n        // Check that notice priority numbers are unique (to detect programming errors)\r\n        // This section may be commented out of production code\r\n        const numberStore = {}, duplicatePriorityList = [];\r\n        for (const thisGivenNotice of standardisedNoticeList) {\r\n            const thisPriority = thisGivenNotice.priority, thisMsg = thisGivenNotice.message;\r\n            const oldMsg = numberStore[thisPriority];\r\n            if (oldMsg && oldMsg !== thisMsg && duplicatePriorityList.indexOf(thisPriority) < 0\r\n                // Some of the messages include the troubling character in the message\r\n                //    so we expect them to differ slightly\r\n                && !thisMsg.startsWith('Mismatched ')\r\n                && !thisMsg.startsWith('Unexpected doubled ')\r\n                && !thisMsg.startsWith('Unexpected space after ')\r\n                && !thisMsg.startsWith('Unexpected content after \\\\')\r\n                && !thisMsg.startsWith('USFMGrammar: ')\r\n                && !thisMsg.endsWith(' character after space')\r\n                && !thisMsg.endsWith(' marker at start of line')\r\n            ) {\r\n                console.log(`PROGRAMMING ERROR: priority ${thisPriority} has at least two different messages: '${oldMsg}' and '${thisMsg}'`);\r\n                duplicatePriorityList.push(thisPriority); // so that we only give the error once\r\n            }\r\n            numberStore[thisPriority] = thisMsg;\r\n        }\r\n    }\r\n\r\n    const resultObject = { // inititalise with our new fields\r\n        numIgnoredNotices: 0,\r\n        numSuppressedWarnings: 0,\r\n        processingOptions: optionalProcessingOptions, // Just helpfully includes what we were given (may be undefined)\r\n    };\r\n    // Copy across all the other properties that we aren't interested in\r\n    for (const gnoPropertyName in givenNoticeObject)\r\n        if (gnoPropertyName !== 'successList' && gnoPropertyName !== 'noticeList')\r\n            resultObject[gnoPropertyName] = givenNoticeObject[gnoPropertyName];\r\n\r\n    // Fetch our processing parameters\r\n    let ignorePriorityNumberList;\r\n    try {\r\n        ignorePriorityNumberList = optionalProcessingOptions.ignorePriorityNumberList;\r\n    } catch (npfIPNLerror) { }\r\n    if (ignorePriorityNumberList === undefined) {\r\n        ignorePriorityNumberList = DEFAULT_IGNORE_PRIORITY_NUMBER_LIST;\r\n        // console.log(`Using default ignorePriorityNumberList=${ignorePriorityNumberList}`);\r\n    }\r\n    else console.log(`Using supplied ignorePriorityNumberList=${ignorePriorityNumberList} cf. default=${DEFAULT_IGNORE_PRIORITY_NUMBER_LIST}`);\r\n    let sortBy;\r\n    try {\r\n        sortBy = optionalProcessingOptions.sortBy;\r\n    } catch (npfSBerror) { }\r\n    if (sortBy === undefined) {\r\n        sortBy = 'AsFound';\r\n        // console.log(`Using default sortBy='${sortBy}'`);\r\n    }\r\n    // else console.log(`Using supplied sortBy='${sortBy}' cf. default='AsFound'`);\r\n    let cutoffPriorityLevel;\r\n    try {\r\n        cutoffPriorityLevel = optionalProcessingOptions.cutoffPriorityLevel;\r\n    } catch (npfCPLerror) { }\r\n    if (cutoffPriorityLevel === undefined) {\r\n        cutoffPriorityLevel = DEFAULT_CUTOFF_PRIORITY_LEVEL;\r\n        // console.log(`Using default cutoffPriorityLevel=${cutoffPriorityLevel}`);\r\n    }\r\n    else console.log(`Using supplied cutoffPriorityLevel=${cutoffPriorityLevel} cf. default=${DEFAULT_CUTOFF_PRIORITY_LEVEL}`);\r\n    // if (cutoffPriorityLevel > errorPriorityLevel)\r\n    // resultObject.errorList.push({999, \"Cutoff level must not be higher than error level\", -1, `(${cutoffPriorityLevel} vs ${errorPriorityLevel})`, \" in processNoticesCommon options\"]);\r\n\r\n\r\n    if (givenNoticeObject.successList)\r\n        // Handle the successList\r\n        if (givenNoticeObject.successList.length < 5)\r\n            resultObject.successList = givenNoticeObject.successList;\r\n        else { // successList is fairly long -- maybe we can shorten it by combining multiple similar messages\r\n            const BibleRegex = /\\d\\d-(\\w\\w\\w).usfm/; // \"Checked JUD file: 66-JUD.usfm\"\r\n            const NotesRegex = /\\d\\d-(\\w\\w\\w).tsv/; // \"Checked EN_TN_01-GEN.TSV file: en_tn_01-GEN.tsv\"\r\n            resultObject.successList = [];\r\n            const bookList = [], notesList = [];\r\n            for (const thisParticularSuccessMessage of givenNoticeObject.successList) {\r\n                // console.log(\"thisParticularSuccessMessage\", thisParticularSuccessMessage);\r\n                let regexResult;\r\n                if ((regexResult = BibleRegex.exec(thisParticularSuccessMessage)) !== null\r\n                    // but don't do it for Book Package checks (in different repos)\r\n                    && thisParticularSuccessMessage.startsWith(`Checked ${regexResult[1]} file`)) {\r\n                    // console.log(\"regexResult\", JSON.stringify(regexResult));\r\n                    bookList.push(regexResult[1]);\r\n                }\r\n                else if ((regexResult = NotesRegex.exec(thisParticularSuccessMessage)) !== null\r\n                    // but don't do it for Book Package checks (in different repos)\r\n                    && thisParticularSuccessMessage.startsWith(`Checked ${regexResult[1]} file`)) {\r\n                    // console.log(\"regexResult\", JSON.stringify(regexResult));\r\n                    notesList.push(regexResult[1]);\r\n                }\r\n                else\r\n                    resultObject.successList.push(thisParticularSuccessMessage); // Just copy it across\r\n            }\r\n            // Put summary messages at the beginning of the list\r\n            if (bookList.length)\r\n                resultObject.successList.unshift(`Checked ${bookList.length} USFM Bible files: ${bookList.join(', ')}`);\r\n            else if (notesList.length)\r\n                resultObject.successList.unshift(`Checked ${notesList.length} TSV notes files: ${notesList.join(', ')}`);\r\n        }\r\n    else resultObject.successList = [];\r\n\r\n    // Handle the checkedFilenames list\r\n    //  which might have 100s or 1,000s of .md filenames\r\n    if (resultObject.checkedFilenames && resultObject.checkedFilenames.length > 10) {\r\n        // console.log(`Have ${resultObject.checkedFilenames.length} checkedFilenames`);\r\n        resultObject.checkedFilenames = [...new Set(resultObject.checkedFilenames)]; // Only keep unique ones\r\n        // console.log(`Now have ${resultObject.checkedFilenames.length} checkedFilenames`);\r\n        // console.log(JSON.stringify(resultObject.checkedFilenames));\r\n    }\r\n\r\n    // Specialised processing\r\n    // If have s5 marker warnings, add one summary error\r\n    // consoleLogObject('standardisedNoticeList', standardisedNoticeList);\r\n    for (const thisParticularNotice of standardisedNoticeList) {\r\n        // console.log(\"thisParticularNotice\", JSON.stringify(thisParticularNotice));\r\n        if (thisParticularNotice.message.indexOf('\\\\s5') >= 0) {\r\n            let thisNewNotice = { priority: 701, bookID: thisParticularNotice.bookID, message: \"\\\\s5 fields should be coded as \\\\ts\\\\* milestones\", characterIndex: -1, extract: '', location: ` in ${givenNoticeObject.checkType}` };\r\n            if (thisParticularNotice.extra && thisParticularNotice.extra.length)\r\n                thisNewNotice.extra = thisParticularNotice.extra; // Sometime we have an additional file identifier\r\n            standardisedNoticeList.push(thisNewNotice);\r\n            break;\r\n        }\r\n    }\r\n\r\n    // Remove any notices that they have asked us to ignore\r\n    let remainingNoticeList;\r\n    if (ignorePriorityNumberList.length) {\r\n        // console.log(\"Doing ignore of\", ignorePriorityNumberList.length,\"value(s)\");\r\n        remainingNoticeList = [];\r\n        for (const thisNotice of standardisedNoticeList)\r\n            if (ignorePriorityNumberList.indexOf(thisNotice.priority) >= 0)\r\n                resultObject.numIgnoredNotices++;\r\n            else\r\n                remainingNoticeList.push(thisNotice);\r\n    } else\r\n        remainingNoticeList = standardisedNoticeList;\r\n    if (resultObject.numIgnoredNotices)\r\n        console.log(`Ignored ${resultObject.numIgnoredNotices} notices`);\r\n\r\n    // Cut off the lowest priority notices if requested\r\n    if (cutoffPriorityLevel > 0) {\r\n        const newNoticeList = [];\r\n        for (const thisNotice of remainingNoticeList)\r\n            if (thisNotice.priority < cutoffPriorityLevel)\r\n                resultObject.numSuppressedWarnings++;\r\n            else newNoticeList.push(thisNotice);\r\n        remainingNoticeList = newNoticeList;\r\n    }\r\n    // if (cutoffPriorityLevel > errorPriorityLevel)\r\n    // resultObject.errorList.push({999, \"Cutoff level must not be higher than error level\", -1, `(${cutoffPriorityLevel} vs ${errorPriorityLevel})`, \" in processNoticesCommon options\"]);\r\n\r\n    // Sort the remainingNoticeList as required\r\n    if (sortBy === 'ByPriority')\r\n        remainingNoticeList.sort(function (a, b) { return b.priority - a.priority });\r\n    else if (sortBy !== 'AsFound')\r\n        console.log(`ERROR: Sorting '${sortBy}' is not implemented yet!!!`);\r\n\r\n    // Add in extra location info if it's there\r\n    // Default is to prepend it to the msg\r\n    //  This prevents errors/warnings from different repos or books from being combined\r\n    if (remainingNoticeList.length\r\n    && remainingNoticeList[0].extra && remainingNoticeList[0].extra.length) {\r\n        // console.log(`We need to add the extra location, e.g. '${remainingNoticeList[0][5]}': will prepend it to the messages`);\r\n        const newNoticeList = [];\r\n        for (const thisNotice of remainingNoticeList) {\r\n            console.assert(thisNotice.extra && thisNotice.extra.length, `Expect thisNotice to have an \"extra\" field: ${JSON.stringify(thisNotice)}`)\r\n            const newNotice = {\r\n                priority: thisNotice.priority,\r\n                message: `${thisNotice.extra} ${thisNotice.message}`,\r\n                characterIndex: thisNotice.characterIndex,\r\n                extract: thisNotice.extract,\r\n                location: thisNotice.location\r\n            };\r\n            if (thisNotice.bookID) newNotice.bookID = thisNotice.bookID;\r\n            if (thisNotice.C) newNotice.C = thisNotice.C;\r\n            if (thisNotice.V) newNotice.V = thisNotice.V;\r\n            newNoticeList.push(newNotice);\r\n        }\r\n        remainingNoticeList = newNoticeList;\r\n    }\r\n\r\n    // Count the number of occurrences of each message\r\n    //  ready for further processing\r\n    const allTotals = {};\r\n    for (const thisNotice of remainingNoticeList)\r\n        if (isNaN(allTotals[thisNotice.priority])) allTotals[thisNotice.priority] = 1;\r\n        else allTotals[thisNotice.priority]++;\r\n\r\n    return [remainingNoticeList, allTotals, resultObject];\r\n}\r\n// end of processNoticesCommon function\r\n\r\n\r\nexport function processNoticesToErrorsWarnings(givenNoticeObject, optionalProcessingOptions) {\r\n    /*\r\n        Available options are:\r\n            errorPriorityLevel (integer; default is DEFAULT_ERROR_PRIORITY_LEVEL above)\r\n            maximumSimilarMessages (integer; default is DEFAULT_MAXIMUM_SIMILAR_MESSAGES above)\r\n\r\n        Returns an object with:\r\n            successList: a list of strings describing what has been checked\r\n            errorList\r\n            warningList\r\n            numIgnoredNotices, numSuppressedErrors, numSuppressedWarnings\r\n            processingOptions: just helpfully passes on what we were given (may be undefined)\r\n        Also, any other parameters are just passed through,\r\n            although filenameList might be abbreviated, e.g. for 100s of .md files.\r\n    */\r\n    //     console.log(`processNoticesToErrorsWarnings v${NOTICE_PROCESSOR_VERSION_STRING} with options=${JSON.stringify(optionalProcessingOptions)}\r\n    //    Given ${givenNoticeObject.successList.length.toLocaleString()} success string(s) plus ${givenNoticeObject.noticeList.length.toLocaleString()} notice(s)`);\r\n\r\n    const [remainingNoticeList, allTotals, resultObject] = processNoticesCommon(givenNoticeObject, optionalProcessingOptions);\r\n\r\n    // Add the fields that we need here to the existing resultObject\r\n    resultObject.errorList = []; resultObject.warningList = [];\r\n    resultObject.numSuppressedErrors = 0; resultObject.numSuppressedWarnings = 0;\r\n\r\n    let maximumSimilarMessages;\r\n    try {\r\n        maximumSimilarMessages = optionalProcessingOptions.maximumSimilarMessages;\r\n    } catch (npfMSMerror) { }\r\n    if (typeof maximumSimilarMessages !== 'number' || isNaN(maximumSimilarMessages)) {\r\n        maximumSimilarMessages = DEFAULT_MAXIMUM_SIMILAR_MESSAGES;\r\n        // console.log(`Using default maximumSimilarMessages=${maximumSimilarMessages}`);\r\n    }\r\n    // else console.log(`Using supplied maximumSimilarMessages=${maximumSimilarMessages} cf. default=${DEFAULT_MAXIMUM_SIMILAR_MESSAGES}`);\r\n    let errorPriorityLevel;\r\n    try {\r\n        errorPriorityLevel = optionalProcessingOptions.errorPriorityLevel;\r\n    } catch (npfEPLerror) { }\r\n    if (errorPriorityLevel === undefined) {\r\n        errorPriorityLevel = DEFAULT_ERROR_PRIORITY_LEVEL;\r\n        // console.log(`Using default errorPriorityLevel=${errorPriorityLevel}`);\r\n    }\r\n    else console.log(`Using supplied errorPriorityLevel=${errorPriorityLevel} cf. default=${DEFAULT_ERROR_PRIORITY_LEVEL}`);\r\n\r\n    // Check for repeated notices that should be compressed\r\n    //  while simultaneously separating into error and warning lists\r\n    let counter = {};\r\n    for (const thisNotice of remainingNoticeList) {\r\n        const thisPriority = thisNotice.priority, thisMsg = thisNotice.message;\r\n        const thisID = thisPriority + thisMsg; // Could have identical worded messages but with different priorities\r\n        if (isNaN(counter[thisID])) counter[thisID] = 1;\r\n        else counter[thisID]++;\r\n        if (maximumSimilarMessages > 0 && counter[thisID] === maximumSimilarMessages + 1) {\r\n            if (thisPriority >= errorPriorityLevel) {\r\n                const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n                resultObject.errorList.push({priority:-1, bookID:'',C:'',V:'', message:thisMsg, characterIndex:-1,extract:'', location:` ◄ ${numSuppressed.toLocaleString()} MORE SIMILAR ERROR${numSuppressed === 1 ? '' : 'S'} SUPPRESSED`});\r\n                resultObject.numSuppressedErrors++;\r\n            } else {\r\n                const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n                resultObject.warningList.push({priority:-1, bookID:'',C:'',V:'', message:thisMsg, characterIndex:-1,extract:'', location:` ◄ ${numSuppressed.toLocaleString()} MORE SIMILAR WARNING${numSuppressed === 1 ? '' : 'S'} SUPPRESSED`});\r\n                resultObject.numSuppressedWarnings++;\r\n            }\r\n        } else if (maximumSimilarMessages > 0 && counter[thisID] > maximumSimilarMessages + 1) {\r\n            if (thisPriority >= errorPriorityLevel)\r\n                resultObject.numSuppressedErrors++;\r\n            else\r\n                resultObject.numSuppressedWarnings++;\r\n        } else if (thisPriority >= errorPriorityLevel)\r\n            resultObject.errorList.push(thisNotice);\r\n        else\r\n            resultObject.warningList.push(thisNotice);\r\n    }\r\n\r\n    // console.log(`processNoticesToErrorsWarnings is returning ${resultObject.successList.length} successes, ${resultObject.errorList.length} errors, and ${resultObject.warningList.length} warnings\r\n    //   numIgnoredNotices=${resultObject.numIgnoredNotices} numSuppressedErrors=${resultObject.numSuppressedErrors} numSuppressedWarnings=${resultObject.numSuppressedWarnings}`);\r\n    return resultObject;\r\n}\r\n// end of processNoticesToErrorsWarnings function\r\n\r\n\r\nexport function processNoticesToSevereMediumLow(givenNoticeObject, optionalProcessingOptions) {\r\n    /*\r\n        Available options are:\r\n            severePriorityLevel (integer; default is DEFAULT_SEVERE_PRIORITY_LEVEL above)\r\n            mediumPriorityLevel (integer; default is DEFAULT_MEDIUM_PRIORITY_LEVEL above)\r\n            maximumSimilarMessages (integer; default is DEFAULT_MAXIMUM_SIMILAR_MESSAGES above)\r\n\r\n        Returns an object with:\r\n            successList: a list of strings describing what has been checked\r\n            severeList\r\n            mediumList\r\n            lowList\r\n            numIgnoredNotices, numSevereSuppressed, numMediumSuppressed, numLowSuppressed\r\n            processingOptions: just helpfully passes on what we were given (may be undefined)\r\n        Also, any other parameters are just passed through,\r\n            although filenameList might be abbreviated, e.g. for 100s of .md files.\r\n    */\r\n    //     console.log(`processNoticesToSevereMediumLow v${NOTICE_PROCESSOR_VERSION_STRING} with options=${JSON.stringify(optionalProcessingOptions)}\r\n    //    Given ${givenNoticeObject.successList.length.toLocaleString()} success string(s) plus ${givenNoticeObject.noticeList.length.toLocaleString()} notice(s)`);\r\n\r\n    const [remainingNoticeList, allTotals, resultObject] = processNoticesCommon(givenNoticeObject, optionalProcessingOptions);\r\n\r\n    // Add the fields that we need here to the existing resultObject\r\n    resultObject.severeList = []; resultObject.mediumList = []; resultObject.lowList = [];\r\n    resultObject.numSevereSuppressed = 0; resultObject.numMediumSuppressed = 0; resultObject.numLowSuppressed = 0;\r\n\r\n    let maximumSimilarMessages;\r\n    try {\r\n        maximumSimilarMessages = optionalProcessingOptions.maximumSimilarMessages;\r\n    } catch (npfMSMerror) { }\r\n    if (typeof maximumSimilarMessages !== 'number' || isNaN(maximumSimilarMessages)) {\r\n        maximumSimilarMessages = DEFAULT_MAXIMUM_SIMILAR_MESSAGES;\r\n        // console.log(`Using default maximumSimilarMessages=${maximumSimilarMessages}`);\r\n    }\r\n    // else console.log(`Using supplied maximumSimilarMessages=${maximumSimilarMessages} cf. default=${DEFAULT_MAXIMUM_SIMILAR_MESSAGES}`);\r\n    let severePriorityLevel;\r\n    try {\r\n        severePriorityLevel = optionalProcessingOptions.severePriorityLevel;\r\n    } catch (npfSPLerror) { }\r\n    if (severePriorityLevel === undefined) {\r\n        severePriorityLevel = DEFAULT_SEVERE_PRIORITY_LEVEL;\r\n        // console.log(`Using default severePriorityLevel=${severePriorityLevel}`);\r\n    }\r\n    else console.log(`Using supplied severePriorityLevel=${severePriorityLevel} cf. default=${DEFAULT_SEVERE_PRIORITY_LEVEL}`);\r\n    let mediumPriorityLevel;\r\n    try {\r\n        mediumPriorityLevel = optionalProcessingOptions.mediumPriorityLevel;\r\n    } catch (nfpMPLerror) { }\r\n    if (mediumPriorityLevel === undefined) {\r\n        mediumPriorityLevel = DEFAULT_MEDIUM_PRIORITY_LEVEL;\r\n        // console.log(`Using default mediumPriorityLevel=${mediumPriorityLevel}`);\r\n    }\r\n    else console.log(`Using supplied mediumPriorityLevel=${mediumPriorityLevel} cf. default=${DEFAULT_MEDIUM_PRIORITY_LEVEL}`);\r\n\r\n    // Check for repeated notices that should be compressed\r\n    //  while simultaneously separating into error and warning lists\r\n    let counter = {};\r\n    for (const thisNotice of remainingNoticeList) {\r\n        const thisPriority = thisNotice.priority, thisMsg = thisNotice.message;\r\n        const thisID = thisPriority + thisMsg; // Could have identical worded messages but with different priorities\r\n        if (isNaN(counter[thisID])) counter[thisID] = 1;\r\n        else counter[thisID]++;\r\n        if (maximumSimilarMessages > 0 && counter[thisID] === maximumSimilarMessages + 1) {\r\n            if (thisPriority >= severePriorityLevel) {\r\n                const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n                resultObject.severeList.push({prioriyy:-1, bookID:'',C:'',V:'', message:thisMsg, characterIndex:-1,extract:'', location:` ◄ ${numSuppressed.toLocaleString()} MORE SIMILAR ERROR${numSuppressed === 1 ? '' : 'S'} SUPPRESSED`});\r\n                resultObject.numSevereSuppressed++;\r\n            } else if (thisPriority >= mediumPriorityLevel) {\r\n                const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n                resultObject.mediumList.push({priority:-1, bookID:'',C:'',V:'', message:thisMsg, characterIndex:-1,extract:'', location:` ◄ ${numSuppressed.toLocaleString()} MORE SIMILAR ERROR${numSuppressed === 1 ? '' : 'S'} SUPPRESSED`});\r\n                resultObject.numMediumSuppressed++;\r\n            } else {\r\n                const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n                resultObject.lowList.push({priority:-1, bookID:'',C:'',V:'', message:thisMsg, characterIndex:-1,extract:'', location:` ◄ ${numSuppressed.toLocaleString()} MORE SIMILAR WARNING${numSuppressed === 1 ? '' : 'S'} SUPPRESSED`});\r\n                resultObject.numLowSuppressed++;\r\n            }\r\n        } else if (maximumSimilarMessages > 0 && counter[thisID] > maximumSimilarMessages + 1) {\r\n            if (thisPriority >= severePriorityLevel)\r\n                resultObject.numSevereSuppressed++;\r\n            else if (thisPriority >= mediumPriorityLevel)\r\n                resultObject.numMediumSuppressed++;\r\n            else\r\n                resultObject.numLowSuppressed++;\r\n        } else if (thisPriority >= severePriorityLevel)\r\n            resultObject.severeList.push(thisNotice);\r\n        else if (thisPriority >= mediumPriorityLevel)\r\n            resultObject.mediumList.push(thisNotice);\r\n        else\r\n            resultObject.lowList.push(thisNotice);\r\n    }\r\n\r\n    // console.log(`processNoticesToSevereMediumLow is returning ${resultObject.successList.length} successes, ${resultObject.severeList.length} severe, ${resultObject.mediumList.length} medium, and ${resultObject.lowList.length} low\r\n    //   numIgnoredNotices=${resultObject.numIgnoredNotices} numSevereSuppressed=${resultObject.numSevereSuppressed} numMediumSuppressed=${resultObject.numMediumSuppressed} numLowSuppressed=${resultObject.numLowSuppressed}`);\r\n    return resultObject;\r\n}\r\n// end of processNoticesToSevereMediumLow function\r\n\r\n\r\nexport function processNoticesToSingleList(givenNoticeObject, optionalProcessingOptions) {\r\n    /*\r\n        Available options are:\r\n            severePriorityLevel (integer; default is DEFAULT_SEVERE_PRIORITY_LEVEL above)\r\n            mediumPriorityLevel (integer; default is DEFAULT_MEDIUM_PRIORITY_LEVEL above)\r\n            maximumSimilarMessages (integer; default is DEFAULT_MAXIMUM_SIMILAR_MESSAGES above)\r\n\r\n        Returns an object with:\r\n            successList: a list of strings describing what has been checked\r\n            warningList\r\n            numIgnoredNotices, numSevereSuppressed, numMediumSuppressed, numLowSuppressed\r\n            processingOptions: just helpfully passes on what we were given (may be undefined)\r\n        Also, any other parameters are just passed through,\r\n            although filenameList might be abbreviated, e.g. for 100s of .md files.\r\n    */\r\n    //     console.log(`processNoticesToSingleList v${NOTICE_PROCESSOR_VERSION_STRING} with options=${JSON.stringify(optionalProcessingOptions)}\r\n    //    Given ${givenNoticeObject.successList.length.toLocaleString()} success string(s) plus ${givenNoticeObject.noticeList.length.toLocaleString()} notice(s)`);\r\n\r\n    // We default to sorting ByPriority unless something else was specified\r\n    let sortBy;\r\n    try {\r\n        sortBy = optionalProcessingOptions.sortBy;\r\n    } catch (npfSBerror) { }\r\n    if (sortBy === undefined)\r\n        optionalProcessingOptions.sortBy = 'ByPriority';\r\n\r\n    const [remainingNoticeList, allTotals, resultObject] = processNoticesCommon(givenNoticeObject, optionalProcessingOptions);\r\n\r\n    // Add the fields that we need here to the existing resultObject\r\n    resultObject.warningList = []; resultObject.numSuppressedWarnings = 0;\r\n\r\n    let maximumSimilarMessages;\r\n    try {\r\n        maximumSimilarMessages = optionalProcessingOptions.maximumSimilarMessages;\r\n    } catch (npfMSMerror) { }\r\n    if (typeof maximumSimilarMessages !== 'number' || isNaN(maximumSimilarMessages)) {\r\n        maximumSimilarMessages = DEFAULT_MAXIMUM_SIMILAR_MESSAGES;\r\n        // console.log(`Using default maximumSimilarMessages=${maximumSimilarMessages}`);\r\n    }\r\n    // else console.log(`Using supplied maximumSimilarMessages=${maximumSimilarMessages} cf. default=${DEFAULT_MAXIMUM_SIMILAR_MESSAGES}`);\r\n\r\n    // Check for repeated notices that should be compressed\r\n    //  while simultaneously creating warning list\r\n    let counter = {};\r\n    for (const thisNotice of remainingNoticeList) {\r\n        const thisPriority = thisNotice.priority, thisMsg = thisNotice.message;\r\n        const thisID = thisPriority + thisMsg; // Could have identical worded messages but with different priorities\r\n        if (isNaN(counter[thisID])) counter[thisID] = 1;\r\n        else counter[thisID]++;\r\n        if (maximumSimilarMessages > 0 && counter[thisID] === maximumSimilarMessages + 1) {\r\n            const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n            resultObject.warningList.push({priority:thisPriority, bookID:'',C:'',V:'', message:thisMsg, characterIndex:-1,extract:'', location:` ◄ ${numSuppressed.toLocaleString()} MORE SIMILAR WARNING${numSuppressed === 1 ? '' : 'S'} SUPPRESSED`});\r\n            resultObject.numSuppressedWarnings++;\r\n        } else if (maximumSimilarMessages > 0 && counter[thisID] > maximumSimilarMessages + 1) {\r\n            resultObject.numSuppressedWarnings++;\r\n        } else\r\n            resultObject.warningList.push(thisNotice);\r\n    }\r\n\r\n    // console.log(`processNoticesToSingleList is returning ${resultObject.successList.length} successes, ${resultObject.warningList.length} warnings\r\n    //   numIgnoredNotices=${resultObject.numIgnoredNotices} numSuppressedWarnings=${resultObject.numSuppressedWarnings}`);\r\n    return resultObject;\r\n}\r\n// end of processNoticesToSingleList function\r\n","import React from 'react';\r\nimport { forwardRef } from 'react';\r\n\r\n// NOTE: The following line is currently giving compile warnings -- a problem in a dependency it seems\r\nimport MaterialTable from 'material-table';\r\n\r\n// import { consoleLogObject, displayPropertyNames } from '../core/utilities';\r\nconst tableIcons = {\r\n    Add: forwardRef((props, ref) => <AddBox {...props} ref={ref} />),\r\n    Check: forwardRef((props, ref) => <Check {...props} ref={ref} />),\r\n    Clear: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n    Delete: forwardRef((props, ref) => <DeleteOutline {...props} ref={ref} />),\r\n    DetailPanel: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n    Edit: forwardRef((props, ref) => <Edit {...props} ref={ref} />),\r\n    Export: forwardRef((props, ref) => <SaveAlt {...props} ref={ref} />),\r\n    Filter: forwardRef((props, ref) => <FilterList {...props} ref={ref} />),\r\n    FirstPage: forwardRef((props, ref) => <FirstPage {...props} ref={ref} />),\r\n    LastPage: forwardRef((props, ref) => <LastPage {...props} ref={ref} />),\r\n    NextPage: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n    PreviousPage: forwardRef((props, ref) => <ChevronLeft {...props} ref={ref} />),\r\n    ResetSearch: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n    Search: forwardRef((props, ref) => <Search {...props} ref={ref} />),\r\n    SortArrow: forwardRef((props, ref) => <ArrowDownward {...props} ref={ref} />),\r\n    ThirdStateCheck: forwardRef((props, ref) => <Remove {...props} ref={ref} />),\r\n    ViewColumn: forwardRef((props, ref) => <ViewColumn {...props} ref={ref} />)\r\n  };\r\n  /* end material box imports and icons */\r\n  \r\n\r\nexport function RenderLines({text}) {\r\n    /**\r\n    * @description - Displays a given piece of text (which can include newline characters)\r\n    * @param {String} text - text to render as numbered lines\r\n    * @return {String} - rendered HTML for the numbered list of lines\r\n    */\r\n   return <ol>\r\n        {text.split('\\n').map(function (line, index) {\r\n            return <li key={index}>{line}</li>;\r\n        })}\r\n    </ol>;\r\n}\r\n\r\n\r\nexport function RenderObject({ thisObject, excludeList }) {\r\n    /**\r\n    * @description - Displays whatever is in the object\r\n    * @param {Object} thisObject - object to render\r\n    * @param {Array} excludeList - optional list of object property names to be ignored\r\n    * @return {String} - rendered HTML for list of thisObject properties\r\n    */\r\n    // console.log(\"In RenderObject\");\r\n    // consoleLogObject('RenderObject settings', settings);\r\n    return <ul>\r\n        {\r\n            Object.keys(thisObject).map((key, index) => {\r\n                if (!excludeList || excludeList.indexOf(key) < 0)\r\n                    return (\r\n                        <li key={index}>&nbsp;&nbsp;&nbsp;&nbsp;\r\n                            <span><b>{key}</b>{Array.isArray(thisObject[key]) ? ` (${thisObject[key].length}) `:''}: {typeof thisObject[key] === 'object' ? JSON.stringify(thisObject[key]) : thisObject[key]}</span>\r\n                        </li>\r\n                    )\r\n        }, [])}\r\n    </ul>;\r\n}\r\n\r\n\r\nexport function RenderRawResults({ results }) {\r\n    /**\r\n    * @description - Displays the raw noticeList in a table\r\n    * @param {Object} results - object containing noticeList\r\n    * @return {String} - rendered HTML for table of notices\r\n    */\r\n    // This function is flexible enough to handle notice objects:\r\n    //      including bookID,C,V or not\r\n    //      including extra or not\r\n\r\n    // console.log(\"In RenderRawResults\");\r\n    // consoleLogObject('RenderRawResults results', results);\r\n    // displayPropertyNames('RenderRawResults results', results);\r\n\r\n    // Create a list of other property names\r\n    // let propertyList = [], newObject = {};\r\n    // for (const propertyName in results)\r\n    //     if (propertyName !== 'noticeList') {\r\n    //         newObject[propertyName] = results[propertyName];\r\n    //         propertyList.push(<p>{propertyName} = {results[propertyName]}</p>);\r\n    //     }\r\n    // consoleLogObject('propertyList', propertyList);\r\n\r\n    if (!results.noticeList || !results.noticeList.length)\r\n        return <>\r\n            <p><b>Raw Results</b> (no notices were produced):</p>\r\n            <RenderObject thisObject={results} excludeList={['noticeList']}/>\r\n        </>;\r\n\r\n    // If we get here, we have notices.\r\n    // let formattedData = [];\r\n    let haveBCV = false, haveExtra = false;\r\n    results.noticeList.map(function (noticeEntry) {\r\n        // console.log(`Render (${Object.keys(noticeEntry).length}) ${Object.keys(noticeEntry)}`);\r\n        if (noticeEntry.bookID && noticeEntry.bookID.length)\r\n            haveBCV = true;\r\n        if (noticeEntry.extra && noticeEntry.extra.length)\r\n            haveExtra = true;\r\n        // if (haveBCV && haveExtra) // no point in going any further\r\n        //     break; // but can't do this in map()\r\n    });\r\n\r\n    // Adjust the headers according to the column sets that we actually have\r\n    let headerData = [{ title: 'Priority', field: 'priority', type: 'numeric' }];\r\n    if (haveBCV)\r\n        headerData = headerData.concat([\r\n            { title: 'Book', field: 'bookID' },\r\n            { title: 'Chapter', field: 'C' },\r\n            { title: 'Verse', field: 'V' }\r\n        ]);\r\n    headerData = headerData.concat([\r\n        { title: 'Message', field: 'message' },\r\n        { title: 'Index', field: 'index', type: 'numeric' },\r\n        { title: 'Extract', field: 'extract' },\r\n        { title: 'Location', field: 'location' }\r\n    ]);\r\n    if (haveExtra) headerData.push({ title: 'Extra', field: 'extra' });\r\n\r\n    // Make the actual table and return it\r\n    return <>\r\n        <b>Raw Results</b>:\r\n        <RenderObject thisObject={results} />\r\n        <MaterialTable\r\n            icons={tableIcons}\r\n            title='Raw Notices'\r\n            columns={headerData}\r\n            data={results.noticeList}\r\n            options={ {sorting: true, exportButton: true, exportAllData: true} }\r\n        />\r\n    </>;\r\n}\r\n\r\n\r\nexport function RenderBCV({ bookID, C, V }) {\r\n    /**\r\n    * @description - Displays the bookcode and chapter/verse details if specified\r\n    * @param {String} bookID - (optional) 3-character UPPERCASE USFM bookcode or 'OBS'.\r\n    * @param {String} C - (optional) chapter info\r\n    * @param {String} V - (optional) verse info\r\n    * @return {String} - rendered HTML for the given reference\r\n    */\r\n    // These are all optional parameters - they may be undefined or blank if irrelevant\r\n    // console.log(`RenderBCV(${bookID}, ${C}, ${V})`);\r\n    if (!bookID && !C && !V) return null; // They're all undefined or blank!\r\n    // console.log(`RenderBCV2 ${bookID}, ${C}, ${V}`);\r\n    let result;\r\n    if (bookID && bookID.length) result = bookID;\r\n    if (C && C.length) result = `${result}${result.length ? ' ' : ''}${C}`;\r\n    if (V && V.length) result = `${result}${result.length ? ':' : ''}${V}`;\r\n    if (result.length) return ` ${V && V.length ? 'at' : 'in'} ${result}`;\r\n    return '';\r\n}\r\n\r\n\r\nexport function RenderSuccessesColoured({results}) {\r\n    // Display our array of success message strings in a nicer format\r\n    //\r\n    // Expects results to contain:\r\n    //      1/ successList\r\n    // console.log(\"In RenderSuccessesColoured with \", successList);\r\n    // consoleLogObject('RenderSuccessesColoured results', results);\r\n\r\n    let haveWarnings;\r\n    try { haveWarnings = results.errorList.length || results.warningList.length; }\r\n    catch (e1) {\r\n        try { haveWarnings = results.severeList.length || results.mediumList.length || results.lowList.length; }\r\n        catch (e2) { haveWarnings = results.warningList.length; }\r\n    }\r\n\r\n    return <ul>\r\n        {results.successList.map(function (listEntry, index) {\r\n            return <li key={index}>\r\n                <b style={{ color: haveWarnings ? 'limegreen' : 'green' }}>{listEntry}</b>\r\n            </li>;\r\n        })}\r\n    </ul>;\r\n}\r\n\r\nexport function RenderProcessedArray({arrayType, results}) {\r\n    // Display our array of 8-part lists in a nicer format\r\n    //  1/ priority number, 2/ bookID, 3/ C, 4/ V, 5/ message,\r\n    //      6/ index (integer), 7/ extract (optional), 8/ location\r\n    //\r\n    // console.log(\"In RenderProcessedArray with \", arrayType);\r\n    // consoleLogObject('RenderProcessedArray results', results);\r\n\r\n    if (arrayType === 's')\r\n        return <>\r\n            <RenderSuccessesColoured results={results} />\r\n        </>;\r\n    else { // not 's' (successList)\r\n        const myList = arrayType === 'e' ? results.errorList : results.warningList;\r\n        return <ul>\r\n            {myList.map(function (listEntry, index) {\r\n                return <li key={index}>\r\n                    <b style={{ color: arrayType === 'e' ? 'red' : 'orange' }}>{listEntry.message}</b>\r\n                    <RenderBCV bookID={listEntry.bookID} C={listEntry.C} V={listEntry.V} />\r\n                    {listEntry.characterIndex > 0 ? \" (at character \" + (listEntry.characterIndex + 1) + \" of line)\" : \"\"}\r\n                    <span style={{ color: 'DimGray' }}>{listEntry.extract ? \" around '\" + listEntry.extract + \"'\" : \"\"}</span>\r\n                    {listEntry.location}\r\n                    <small style={{ color: 'Gray' }}>{listEntry.priority >= 0 ? \" (Priority \" + listEntry.priority + \")\" : \"\"}</small>\r\n                </li>;\r\n            })}\r\n        </ul>;\r\n    }\r\n}\r\n\r\n\r\nexport function RenderGivenArray({array, colour}) {\r\n    // Display our array of 8-part lists in a nicer format\r\n    //  1/ priority number, 2/ bookID, 3/ C, 4/ V, 5/ message,\r\n    //      6/ index (integer), 7/ extract (optional), 8/ location\r\n    //\r\n    // console.log(\"In RenderGivenArray with \", arrayType);\r\n    // consoleLogObject('RenderGivenArray results', results);\r\n\r\n    return <ul>\r\n        {array.map(function (listEntry, index) {\r\n            return <li key={index}>\r\n                <b style={{ color: colour }}>{listEntry.message}</b>\r\n                <RenderBCV bookID={listEntry.bookID} C={listEntry.C} V={listEntry.V} />\r\n                {listEntry.characterIndex > 0 ? \" (at character \" + (listEntry.characterIndex + 1) + \" of line)\" : \"\"}\r\n                <span style={{ color: 'DimGray' }}>{listEntry.extract ? \" around '\" + listEntry.extract + \"'\" : \"\"}</span>\r\n                {listEntry.location}\r\n                <small style={{ color: 'Gray' }}>{listEntry.priority >= 0 ? \" (Priority \" + listEntry.priority + \")\" : \"\"}</small>\r\n            </li>;\r\n        })}\r\n    </ul>;\r\n}\r\n\r\n\r\nexport function getGradientColour(priorityValue) {\r\n    // priorityValue is in range 1..999\r\n    //\r\n    // Returns a colour value from red (highest priority) to orange (lower)\r\n    const red = `0${Math.floor(priorityValue * 255 / 999).toString(16)}`.slice(-2);\r\n    // const green = `0${Math.floor((1000-priorityValue) * 55 / 999).toString(16)}`.slice(-2);\r\n    // console.log(`getGradientColour(${priorityValue}) -> red='${red}' green='${green}'`)\r\n    return `#${red}0000`; // or `#${red}${green}00`\r\n}\r\n\r\n\r\nexport function RenderWarningsGradient({results}) {\r\n    // Display our array of 8-part lists in a nicer format\r\n    //  1/ priority number, 2/ bookID, 3/ C, 4/ V, 5/ message,\r\n    //      6/ index (integer), 7/ extract (optional), 8/ location\r\n    //\r\n    // Expects results to contain:\r\n    //      1/ warningList\r\n    // console.log(\"In RenderWarningsGradient with \", results.warningList);\r\n    // consoleLogObject('RenderWarningsGradient results', results);\r\n\r\n    return <ul>\r\n        {results.warningList.map(function (listEntry, index) {\r\n            const thisColour = getGradientColour(listEntry.priority);\r\n            return <li key={index}>\r\n                <b style={{ color: thisColour }}>{listEntry.message}</b>\r\n                <RenderBCV bookID={listEntry.bookID} C={listEntry.C} V={listEntry.V} />\r\n                {listEntry.characterIndex > 0 ? \" (at character \" + (listEntry.characterIndex + 1) + \" of line)\" : \"\"}\r\n                <span style={{ color: 'DimGray' }}>{listEntry.extract ? \" around '\" + listEntry.extract + \"'\" : \"\"}</span>\r\n                {listEntry.location}\r\n                <small style={{ color: 'Gray' }}>{listEntry.priority >= 0 ? \" (Priority \" + listEntry.priority + \")\" : \"\"}</small>\r\n            </li>;\r\n        })}\r\n    </ul>;\r\n}\r\n\r\n\r\nexport function RenderErrors({results}) {\r\n    // console.log(\"In RenderErrors\");\r\n    // consoleLogObject('RenderErrors results', results);\r\n    return <>\r\n        <b style={{ color: results.errorList.length ? 'red' : 'green' }}>{results.errorList.length.toLocaleString()} error{results.errorList.length === 1 ? '' : 's'}</b>{results.errorList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numSuppressedErrors ? \" (\" + results.numSuppressedErrors.toLocaleString() + \" similar one\" + (results.numSuppressedErrors === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        <RenderProcessedArray results={results} arrayType='e' />\r\n    </>;\r\n}\r\nexport function RenderWarnings({results}) {\r\n    // console.log(\"In RenderWarnings\");\r\n    // consoleLogObject('RenderWarnings results', results);\r\n    return <>\r\n        <b style={{ color: results.warningList.length ? 'orange' : 'green' }}>{results.warningList.length.toLocaleString()} warning{results.warningList.length === 1 ? '' : 's'}</b>{results.warningList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numSuppressedWarnings ? \" (\" + results.numSuppressedWarnings.toLocaleString() + \" similar one\" + (results.numSuppressedWarnings === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        <RenderProcessedArray results={results} arrayType='w' />\r\n    </>;\r\n}\r\nexport function RenderErrorsAndWarnings({results}) {\r\n    // console.log(\"In RenderErrorsAndWarnings\");\r\n    // consoleLogObject('RenderErrorsAndWarnings results', results);\r\n    return <>\r\n        <RenderErrors results={results} />\r\n        <RenderWarnings results={results} />\r\n    </>;\r\n}\r\n\r\n\r\nexport function RenderSevere({results}) {\r\n    // console.log(\"In RenderSevere\");\r\n    // consoleLogObject('RenderSevere results', results);\r\n    return <>\r\n        <b style={{ color: results.severeList.length ? 'red' : 'green' }}>{results.severeList.length.toLocaleString()} severe error{results.severeList.length === 1 ? '' : 's'}</b>{results.severeList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numSevereSuppressed ? \" (\" + results.numSevereSuppressed.toLocaleString() + \" similar one\" + (results.numSevereSuppressed === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        <RenderGivenArray array={results.severeList} colour='red' />\r\n    </>;\r\n}\r\nexport function RenderMedium({results}) {\r\n    // console.log(\"In RenderSevere\");\r\n    // consoleLogObject('RenderSevere results', results);\r\n    return <>\r\n        <b style={{ color: results.mediumList.length ? 'maroon' : 'green' }}>{results.mediumList.length.toLocaleString()} medium error{results.mediumList.length === 1 ? '' : 's'}</b>{results.mediumList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numMediumSuppressed ? \" (\" + results.numMediumSuppressed.toLocaleString() + \" similar one\" + (results.numMediumSuppressed === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        <RenderGivenArray array={results.mediumList} colour='maroon' />\r\n    </>;\r\n}\r\nexport function RenderLow({results}) {\r\n    // console.log(\"In RenderLow\");\r\n    // consoleLogObject('RenderLow results', results);\r\n    return <>\r\n        <b style={{ color: results.lowList.length ? 'orange' : 'green' }}>{results.lowList.length.toLocaleString()} other warning{results.lowList.length === 1 ? '' : 's'}</b>{results.lowList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numLowSuppressed ? \" (\" + results.numLowSuppressed.toLocaleString() + \" similar one\" + (results.numLowSuppressed === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        <RenderGivenArray array={results.lowList} colour='orange' />\r\n    </>;\r\n}\r\nexport function RenderSevereMediumLow({results}) {\r\n    // console.log(\"In RenderSevereMediumLow\");\r\n    // consoleLogObject('RenderSevereMediumLow results', results);\r\n    return <>\r\n        <RenderSevere results={results} />\r\n        <RenderMedium results={results} />\r\n        <RenderLow results={results} />\r\n    </>;\r\n}\r\n\r\n\r\nexport function RenderSuccessesErrorsWarnings({results}) {\r\n    // console.log(\"In RenderSuccessesErrorsWarnings\");\r\n\r\n    // consoleLogObject('RenderSuccessesErrorsWarnings results', results);\r\n\r\n    const haveErrorsOrWarnings = results.errorList.length || results.warningList.length;\r\n\r\n    let successCount;\r\n    if (results.successList.length === 1) successCount = 'One';\r\n    else if (results.successList.length === 2) successCount = 'Two';\r\n    else if (results.successList.length === 3) successCount = 'Three';\r\n    else if (results.successList.length === 4) successCount = 'Four';\r\n    else if (results.successList.length === 5) successCount = 'Five';\r\n    else successCount = results.successList.length.toLocaleString();\r\n\r\n    return <>\r\n        <b style={{ color: haveErrorsOrWarnings ? 'limegreen' : 'green' }}>{successCount.toLocaleString()} check{results.successList.length === 1 ? '' : 's'} completed</b>{results.successList.length ? ':' : ''}\r\n        <RenderSuccessesColoured results={results} />\r\n        {haveErrorsOrWarnings ? <RenderErrorsAndWarnings results={results} /> : \"\"}\r\n    </>;\r\n}\r\n\r\n\r\nexport function RenderSuccessesSevereMediumLow({results}) {\r\n    // console.log(\"In RenderSuccessesSevereMediumLow\");\r\n\r\n    // consoleLogObject('RenderSuccessesSevereMediumLow results', results);\r\n\r\n    const haveErrorsOrWarnings = results.severeList.length || results.mediumList.length || results.lowList.length;\r\n\r\n    let successCount;\r\n    if (results.successList.length === 1) successCount = 'One';\r\n    else if (results.successList.length === 2) successCount = 'Two';\r\n    else if (results.successList.length === 3) successCount = 'Three';\r\n    else if (results.successList.length === 4) successCount = 'Four';\r\n    else if (results.successList.length === 5) successCount = 'Five';\r\n    else successCount = results.successList.length.toLocaleString();\r\n\r\n    return <>\r\n        <b style={{ color: haveErrorsOrWarnings ? 'limegreen' : 'green' }}>{successCount.toLocaleString()} check{results.successList.length === 1 ? '' : 's'} completed</b>{results.successList.length ? ':' : ''}\r\n        <RenderSuccessesColoured results={results} />\r\n        {haveErrorsOrWarnings ? <RenderSevereMediumLow results={results} /> : \"\"}\r\n    </>;\r\n}\r\n\r\nexport function RenderSuccessesWarningsGradient({results}) {\r\n    // console.log(\"In RenderSuccessesWarningsGradient\");\r\n\r\n    // consoleLogObject('RenderSuccessesWarningsGradient results', results);\r\n\r\n    let successCount;\r\n    if (results.successList.length === 1) successCount = 'One';\r\n    else if (results.successList.length === 2) successCount = 'Two';\r\n    else if (results.successList.length === 3) successCount = 'Three';\r\n    else if (results.successList.length === 4) successCount = 'Four';\r\n    else if (results.successList.length === 5) successCount = 'Five';\r\n    else successCount = results.successList.length.toLocaleString();\r\n\r\n    return <>\r\n        <b style={{ color: results.warningList.length ? 'limegreen' : 'green' }}>{successCount.toLocaleString()} check{results.successList.length === 1 ? '' : 's'} completed</b>{results.successList.length ? ':' : ''}\r\n        <RenderSuccessesColoured results={results} />\r\n        <b style={{ color: results.warningList.length ? 'orange' : 'green' }}>{results.warningList.length.toLocaleString()} warning notice{results.warningList.length === 1 ? '' : 's'}</b>{results.warningList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numSuppressedWarnings ? \" (\" + results.numSuppressedWarnings.toLocaleString() + \" similar one\" + (results.numSuppressedWarnings === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        {results.warningList.length ? <RenderWarningsGradient results={results} /> : \"\"}\r\n    </>;\r\n}\r\n\r\n\r\nexport function RenderElapsedTime({elapsedTime}) {\r\n    const seconds = Math.round(elapsedTime % 60);\r\n    let remainingTime = Math.floor(elapsedTime / 60);\r\n    const minutes = Math.round(remainingTime % 60);\r\n    remainingTime = Math.floor(remainingTime / 60);\r\n    const hours = Math.round(remainingTime % 24);\r\n    remainingTime = Math.floor(remainingTime / 24);\r\n    console.assert(remainingTime === 0, `Elapsed time also contains ${remainingTime} days`);\r\n    return <>{hours ? `${hours} hour` : ''}{hours && hours !== 1 ? 's' : ''}{hours ? ', ' : ''}{minutes ? `${minutes} minute` : ''}{minutes && minutes !== 1 ? 's' : ''}{minutes ? ', ' : ''}{seconds} second{seconds === 1 ? '' : 's'}</>;\r\n}\r\n","import React, { useContext, useEffect, useState } from 'react';\r\n// import PropTypes from 'prop-types';\r\n// import ReactJson from 'react-json-view';\r\n// import { Paper, Button } from '@material-ui/core';\r\n// import { RepositoryContext, FileContext } from 'gitea-react-toolkit';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport { getFile } from '../../core/getApi';\r\nimport checkFile from './checkFile';\r\nimport { processNoticesToErrorsWarnings, processNoticesToSevereMediumLow, processNoticesToSingleList } from '../../core/notice-processing-functions';\r\nimport { RenderSuccessesErrorsWarnings, RenderSuccessesSevereMediumLow, RenderSuccessesWarningsGradient, RenderElapsedTime } from '../RenderProcessedResults';\r\nimport { ourParseInt, consoleLogObject } from '../../core/utilities';\r\n\r\n\r\nconst FILE_CHECK_VERSION_STRING = '0.1.2';\r\n\r\n\r\nfunction FileCheck(props) {\r\n\r\n    // console.log(`I'm here in FileCheck v${FILE_CHECK_VERSION_STRING}`);\r\n    // consoleLogObject(\"props\", props);\r\n\r\n    const username = props.username;\r\n    // console.log(`FileCheck username='${username}'`);\r\n    const repoName = props.repoName;\r\n    // console.log(`FileCheck repoName='${repoName}'`);\r\n    let branch = props.branch;\r\n    // console.log(`FileCheck branch='${branch}'`);\r\n    if (branch === undefined) branch = 'master';\r\n    const filename = props.filename;\r\n    // console.log(`filename='${filename}'`);\r\n\r\n    let givenLocation = props['location'] ? props['location'] : \"\";\r\n    if (givenLocation && givenLocation[0] !== \" \") givenLocation = ` ${givenLocation}`;\r\n    givenLocation = ` in ${repoName} repo${givenLocation}`;\r\n\r\n    const checkingOptions = { // Uncomment any of these to test them\r\n        // 'extractLength': 25,\r\n    };\r\n    // Or this allows the parameters to be specified as a FileCheck property\r\n    if (props.extractLength) checkingOptions.extractLength = ourParseInt(props.extractLength);\r\n\r\n    const [result, setResultValue] = useState(\"Waiting-FileCheck\");\r\n    useEffect(() => {\r\n        // Use an IIFE (Immediately Invoked Function Expression)\r\n        //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174\r\n        (async () => {\r\n            // console.log(\"Started FileCheck.unnamedFunction()\");\r\n\r\n            // Display our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Waiting for check results for <b>{filename}</b>…</p>);\r\n            // console.log(`About to call getFile(${username}, ${repoName}, ${filename}, ${branch})…`);\r\n            const fileContent = await getFile({ username: username, repository: repoName, path: filename, branch: branch });\r\n            const rawCFResults = await checkFile(filename, fileContent, givenLocation, checkingOptions);\r\n            // console.log(`FileCheck got initial results with ${rawCFResults.successList.length} success message(s) and ${rawCFResults.noticeList.length} notice(s)`);\r\n\r\n            // Add some extra fields to our rawCFResults object in case we need this information again later\r\n            rawCFResults.checkType = 'File';\r\n            rawCFResults.username = username;\r\n            rawCFResults.repoName = repoName;\r\n            rawCFResults.branch = props.branch;\r\n            rawCFResults.filename = filename;\r\n            rawCFResults.checkingOptions = checkingOptions;\r\n\r\n            // Now do our final handling of the result\r\n            let processOptions = { // Uncomment any of these to test them\r\n                // 'maximumSimilarMessages': 3, // default is 2\r\n                // 'errorPriorityLevel': 800, // default is 700\r\n                // 'cutoffPriorityLevel': 100, // default is 0\r\n                // 'sortBy': 'ByPriority', // default is 'AsFound'\r\n                // 'ignorePriorityNumberList': [123, 202], // default is []\r\n            };\r\n            // Or this allows the parameters to be specified as a FileCheck property\r\n            if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = ourParseInt(props.maximumSimilarMessages);\r\n            if (props.errorPriorityLevel) processOptions.errorPriorityLevel = ourParseInt(props.errorPriorityLevel);\r\n            if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);\r\n            if (props.sortBy) processOptions.sortBy = props.sortBy;\r\n            // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;\r\n\r\n            let displayType = 'ErrorsWarnings'; // default\r\n            if (props.displayType) displayType = props.displayType;\r\n\r\n            function renderSummary(processedResults) {\r\n                return (<>\r\n                    <p>Checked <b>{filename}</b> (from {username} {repoName} <i>{branch === undefined ? 'DEFAULT' : branch}</i> branch)</p>\r\n                    <p>&nbsp;&nbsp;&nbsp;&nbsp;Finished in <RenderElapsedTime elapsedTime={processedResults.elapsedTime} />.</p>\r\n                </>);\r\n            }\r\n\r\n            if (displayType === 'ErrorsWarnings') {\r\n                const processedResults = processNoticesToErrorsWarnings(rawCFResults, processOptions);\r\n//                 console.log(`${`FileCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)`}\r\n//   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n                if (processedResults.errorList.length || processedResults.warningList.length)\r\n                    setResultValue(<>\r\n                        <div>{renderSummary(processedResults)}\r\n                            {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n                        <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                    </>);\r\n                else // no errors or warnings\r\n                    setResultValue(<>\r\n                        <div>{renderSummary(processedResults)}\r\n                            {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n                        <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                    </>);\r\n            } else if (displayType === 'SevereMediumLow') {\r\n                const processedResults = processNoticesToSevereMediumLow(rawCFResults, processOptions);\r\n//                 console.log(`FileCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n//   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n                if (processedResults.severeList.length || processedResults.mediumList.length || processedResults.lowList.length)\r\n                    setResultValue(<>\r\n                        <div>{renderSummary(processedResults)}\r\n                            {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n                        <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                    </>);\r\n                else // no severe, medium, or low notices\r\n                    setResultValue(<>\r\n                        <div>{renderSummary(processedResults)}\r\n                            {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n                        <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                    </>);\r\n            } else if (displayType === 'SingleList') {\r\n                const processedResults = processNoticesToSingleList(rawCFResults, processOptions);\r\n//                 console.log(`FileCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n//   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n                if (processedResults.warningList.length)\r\n                    setResultValue(<>\r\n                        <div>{renderSummary(processedResults)}\r\n                            {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n                        <RenderSuccessesWarningsGradient results={processedResults} />\r\n                    </>);\r\n                else // no warnings\r\n                    setResultValue(<>\r\n                        <div>{renderSummary(processedResults)}\r\n                            {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n                        <RenderSuccessesWarningsGradient results={processedResults} />\r\n                    </>);\r\n            } else setResultValue(<b style={{ color: 'red' }}>Invalid displayType='{displayType}'</b>)\r\n        })(); // end of async part in unnamedFunction\r\n    }, []); // end of useEffect part\r\n\r\n    // {/* <div className={classes.root}> */}\r\n    return (\r\n        <div className=\"Fred\">\r\n            {result}\r\n        </div>\r\n    );\r\n};\r\n// end of FileCheck()\r\n\r\nconst styles = theme => ({\r\n    root: {\r\n    },\r\n});\r\n\r\nexport default withStyles(styles)(FileCheck);\r\n","import React from 'react';\r\nimport * as books from '../../core/books/books';\r\nimport checkFile from '../file-check/checkFile';\r\n// import { getFilelistFromFetchedTreemaps, getFilelistFromFetchedZip } from '../helpers';\r\n// import { fetchRepo, getBlobContent } from './helpers'\r\nimport { fetchRepositoryZipFile, getFilelistFromZip, getFile } from '../../core/getApi';\r\n// import { fetchTree, fetchRepositoryZipFile, getFile, cachedGetURL } from '../../core/getApi';\r\nimport { consoleLogObject } from '../../core/utilities';\r\n\r\n\r\nconst CHECK_REPO_VERSION_STRING = '0.4.1';\r\n\r\n\r\nasync function checkRepo(username, repoName, branch, givenLocation, setResultValue, checkingOptions) {\r\n    /*\r\n    checkRepo DOES NOT USE the Gitea React Toolkit to fetch the repo\r\n\r\n    It returns an object containing:\r\n        successList: an array of strings to tell the use exactly what has been checked\r\n        noticeList: an array of 9 (i.e., with extra bookOrFileCode parameter at end) notice components\r\n    */\r\n    // console.log(`I'm here in checkRepo v${CHECK_REPO_VERSION_STRING}\r\n    //   with ${username}, ${repoName}, ${branch}, ${givenLocation}, ${JSON.stringify(checkingOptions)}`);\r\n    const startTime = new Date();\r\n\r\n    if (branch === undefined) branch = 'master'; // Ideally we should ask what the default branch is\r\n\r\n    let checkRepoResult = {\r\n        successList: [], noticeList: [],\r\n        checkedFileCount: 0, checkedFilenames: [], checkedFilenameExtensions: []\r\n    };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // Adds the message to the result that we will later return\r\n        // console.log(`checkRepo success: ${successString}`);\r\n        checkRepoResult.successList.push(successString);\r\n    }\r\n    function addNotice10({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location, extra}) {\r\n        // Adds the notices to the result that we will later return\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // Note that bookID,C,V might all be empty strings (as some repos don't have BCV)\r\n        // console.log(`checkRepo addNotice10: (priority=${priority}) ${bookID} ${C}:${V} ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cR addNotice10: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cR addNotice10: 'priority' parameter should be a number not a '${typeof priority}'`);\r\n        console.assert(message !== undefined, \"cR addNotice10: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cR addNotice10: 'message' parameter should be a string not a '${typeof message}'`);\r\n        // console.assert(bookID !== undefined, \"cR addNotice10: 'bookID' parameter should be defined\");\r\n        if (bookID) {\r\n            console.assert(typeof bookID === 'string', `cR addNotice10: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n            console.assert(bookID.length === 3, `cR addNotice10: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n            console.assert(books.isOptionalValidBookID(bookID), `cR addNotice10: '${bookID}' is not a valid USFM book identifier`);\r\n        }\r\n        // console.assert(C !== undefined, \"cR addNotice10: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `cR addNotice10: 'C' parameter should be a string not a '${typeof C}'`);\r\n        // console.assert(V !== undefined, \"cR addNotice10: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `cR addNotice10: 'V' parameter should be a string not a '${typeof V}'`);\r\n        // console.assert(characterIndex !== undefined, \"cR addNotice10: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cR addNotice10: 'characterIndex' parameter should be a number not a '${typeof characterIndex}'`);\r\n        // console.assert(extract !== undefined, \"cR addNotice10: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cR addNotice10: 'extract' parameter should be a string not a '${typeof extract}'`);\r\n        console.assert(location !== undefined, \"cR addNotice10: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cR addNotice10: 'location' parameter should be a string not a '${typeof location}'`);\r\n        console.assert(extra !== undefined, \"cR addNotice10: 'extra' parameter should be defined\");\r\n        console.assert(typeof extra === 'string', `cR addNotice10: 'extra' parameter should be a string not a '${typeof extra}'`);\r\n        checkRepoResult.noticeList.push({ priority,message, bookID, C, V, lineNumber, characterIndex, extract, location, extra });\r\n    }\r\n\r\n\r\n    async function doOurCheckFile(bookOrFileCode, cfBookID, filename, file_content, fileLocation, optionalCheckingOptions) {\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n        // console.log(`checkRepo doOurCheckFile(${filename})…`);\r\n\r\n        // Updates the global list of notices\r\n        console.assert(bookOrFileCode !== undefined, \"doOurCheckFile: 'bookOrFileCode' parameter should be defined\");\r\n        console.assert(typeof bookOrFileCode === 'string', `doOurCheckFile: 'bookOrFileCode' parameter should be a string not a '${typeof bookOrFileCode}'`);\r\n        console.assert(cfBookID !== undefined, \"doOurCheckFile: 'cfBookID' parameter should be defined\");\r\n        console.assert(typeof cfBookID === 'string', `doOurCheckFile: 'cfBookID' parameter should be a string not a '${typeof cfBookID}'`);\r\n        console.assert(filename !== undefined, \"doOurCheckFile: 'filename' parameter should be defined\");\r\n        console.assert(typeof filename === 'string', `doOurCheckFile: 'filename' parameter should be a string not a '${typeof filename}'`);\r\n        console.assert(file_content !== undefined, \"doOurCheckFile: 'file_content' parameter should be defined\");\r\n        console.assert(typeof file_content === 'string', `doOurCheckFile: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n        console.assert(fileLocation !== undefined, \"doOurCheckFile: 'fileLocation' parameter should be defined\");\r\n        console.assert(typeof fileLocation === 'string', `doOurCheckFile: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n        const resultObject = await checkFile(filename, file_content, fileLocation, optionalCheckingOptions);\r\n        // console.log(\"checkFile() returned\", resultObject.successList.length, \"success message(s) and\", resultObject.noticeList.length, \"notice(s)\");\r\n        // for (const successEntry of resultObject.successList)\r\n        //     console.log(\"  \", successEntry);\r\n\r\n        // Process results line by line,  appending the bookOrFileCode as an extra field as we go\r\n        for (const noticeEntry of resultObject.noticeList)\r\n            // We add the bookOrFileCode as an extra value\r\n            addNotice10({priority:noticeEntry.priority, message:noticeEntry.message,\r\n                bookID:noticeEntry.bookID, C:noticeEntry.C, V:noticeEntry.V, lineNumber:noticeEntry.lineNumber,\r\n                characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract,\r\n                location:noticeEntry.location, extra:bookOrFileCode});\r\n    }\r\n    // end of doOurCheckFile function\r\n\r\n\r\n    // Main code for checkRepo()\r\n    // Put all this in a try/catch block coz otherwise it's difficult to debug/view errors\r\n    try {\r\n        let ourLocation = givenLocation;\r\n        if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n        // if (ourLocation.indexOf(username) < 0)\r\n        ourLocation = ` in ${username} ${repoName} ${givenLocation}`\r\n\r\n        // Update our \"waiting\" message\r\n        setResultValue(<p style={{ color: 'magenta' }}>Fetching zipped files from <b>{username}/{repoName}</b> repository…</p>);\r\n\r\n        // Let's fetch the zipped repo since it should be much more efficient than individual fetches\r\n        // console.log(`checkRepo: fetch zip file for ${repoName}…`);\r\n        const zipFetchSucceeded = await fetchRepositoryZipFile({ username, repository: repoName, branch });\r\n        if (!zipFetchSucceeded)\r\n            console.log(`checkRepo: misfetched zip file for repo with ${zipFetchSucceeded}`);\r\n        if (!zipFetchSucceeded) return checkRepoResult;\r\n        // Note: We don't stop for failure coz the code below will still work (fetching each file individually)\r\n\r\n        // Now we need to fetch the list of files from the repo\r\n        setResultValue(<p style={{ color: 'magenta' }}>Preprocessing file list from <b>{username}/{repoName}</b> repository…</p>);\r\n        // const pathList = await getFilelistFromFetchedTreemaps(username, repoName, branch);\r\n        const pathList = await getFilelistFromZip({ username, repository: repoName, branch });\r\n        // console.log(`Got pathlist (${pathList.length}) = ${pathList}`);\r\n\r\n        // So now we want to work through checking all the files in this repo\r\n        const countString = `${pathList.length.toLocaleString()} file${pathList.length === 1 ? '' : 's'}`;\r\n        let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0;\r\n        for (const thisFilepath of pathList) {\r\n            // console.log(`At top of loop: thisFilepath='${thisFilepath}'`);\r\n\r\n            // Update our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Waiting for check results for <b>{username}/{repoName}</b> repo: checked {checkedFileCount.toLocaleString()}/{countString}…</p>);\r\n\r\n            const thisFilename = thisFilepath.split('/').pop();\r\n            // console.log(`thisFilename=${thisFilename}`);\r\n            const thisFilenameExtension = thisFilename.split('.').pop();\r\n            // console.log(`thisFilenameExtension=${thisFilenameExtension}`);\r\n\r\n            // Default to the main filename without the extensions\r\n            let bookOrFileCode = thisFilename.substring(0, thisFilename.length - thisFilenameExtension.length - 1);\r\n            let ourBookID = \"\";\r\n            if (thisFilenameExtension === 'usfm') {\r\n                // const filenameMain = thisFilename.substring(0, thisFilename.length - 5); // drop .usfm\r\n                // console.log(`Have USFM filenameMain=${bookOrFileCode}`);\r\n                const bookID = bookOrFileCode.substring(bookOrFileCode.length - 3);\r\n                // console.log(`Have USFM bookcode=${bookID}`);\r\n                console.assert(books.isValidBookID(bookID), `checkRepo: '${bookID}' is not a valid USFM book identifier`);\r\n                bookOrFileCode = bookID;\r\n                ourBookID = bookID;\r\n            }\r\n            else if (thisFilenameExtension === 'tsv') {\r\n                // const filenameMain = thisFilename.substring(0, thisFilename.length - 4); // drop .tsv\r\n                // console.log(`Have TSV filenameMain=${bookOrFileCode}`);\r\n                const bookID = bookOrFileCode.substring(bookOrFileCode.length - 3);\r\n                // console.log(`Have TSV bookcode=${bookID}`);\r\n                console.assert(books.isValidBookID(bookID), `checkRepo: '${bookID}' is not a valid USFM book identifier`);\r\n                bookOrFileCode = bookID;\r\n                ourBookID = bookID;\r\n            }\r\n\r\n            // console.log(\"checkRepo: Try to load\", username, repoName, thisFilepath, branch);\r\n            let repoFileContent;\r\n            try {\r\n                repoFileContent = await getFile({ username, repository: repoName, path: thisFilepath, branch });\r\n                // console.log(\"Fetched file_content for\", repoName, thisPath, typeof repoFileContent, repoFileContent.length);\r\n            } catch (cRgfError) {\r\n                console.log(\"Failed to load\", username, repoName, thisFilepath, branch, `${cRgfError}`);\r\n                addNotice10({priority:996, bookID:ourBookID, message:\"Failed to load\", location:`${generalLocation} ${thisFilepath}: ${cRgfError}`, repoCode});\r\n                return;\r\n            }\r\n            if (repoFileContent) {\r\n                // console.log(`checkRepo checking ${thisFilename}`);\r\n                await doOurCheckFile(bookOrFileCode, ourBookID, thisFilename, repoFileContent, ourLocation, checkingOptions);\r\n                checkedFileCount += 1;\r\n                checkedFilenames.push(thisFilename);\r\n                checkedFilenameExtensions.add(thisFilenameExtension);\r\n                totalCheckedSize += repoFileContent.length;\r\n                // console.log(`checkRepo checked ${thisFilename}`);\r\n                if (thisFilenameExtension !== 'md') // There's often far, far too many of these\r\n                    addSuccessMessage(`Checked ${bookOrFileCode.toUpperCase()} file: ${thisFilename}`);\r\n            }\r\n        }\r\n\r\n        // Check that we processed a license and a manifest\r\n        if (checkedFilenames.indexOf('LICENSE.md') < 0)\r\n            addNotice10({priority:946, message:\"Missing LICENSE.md\", location:ourLocation, extra:'LICENSE'});\r\n        if (checkedFilenames.indexOf('manifest.yaml') < 0)\r\n            addNotice10({priority:947, message:\"Missing manifest.yaml\", location:ourLocation, extra:'MANIFEST'});\r\n\r\n        // Add some extra fields to our checkRepoResult object\r\n        //  in case we need this information again later\r\n        checkRepoResult.checkedFileCount = checkedFileCount;\r\n        checkRepoResult.checkedFilenames = checkedFilenames;\r\n        checkRepoResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n        checkRepoResult.checkedFilesizes = totalCheckedSize;\r\n        checkRepoResult.checkedRepoNames = [`${username}/${repoName}`];\r\n        // checkRepoResult.checkedOptions = checkingOptions; // This is done at the caller level\r\n\r\n        addSuccessMessage(`Checked ${username} repo: ${repoName}`);\r\n        // console.log(`checkRepo() is returning ${checkRepoResult.successList.length.toLocaleString()} success message(s) and ${checkRepoResult.noticeList.length.toLocaleString()} notice(s)`);\r\n    } catch (cRerror) {\r\n        console.log(`checkRepo main code block got error: ${cRerror.message}`);\r\n        setResultValue(<>\r\n            <p style={{ color: 'Red' }}>checkRepo main code block got error: <b>{cRerror.message}</b></p>\r\n        </>);\r\n\r\n    }\r\n    checkRepoResult.elapsedTime = (new Date() - startTime) / 1000; // seconds\r\n    return checkRepoResult;\r\n};\r\n// end of checkRepo()\r\n\r\n\r\nexport default checkRepo;\r\n","import React from 'react';\r\nimport * as books from '../../core/books/books';\r\nimport checkFile from '../file-check/checkFile';\r\nimport checkRepo from '../repo-check/checkRepo';\r\nimport { getFilelistFromZip, getFile } from '../../core/getApi';\r\n// import { consoleLogObject } from '../../core/utilities';\r\n\r\n\r\nconst CHECKER_VERSION_STRING = '0.3.1';\r\n\r\n\r\nasync function checkTQbook(username, repoName, branch, bookID, checkingOptions) {\r\n    // console.log(`checkTQbook(${username}, ${repoName}, ${branch}, ${bookID}, …)…`);\r\n\r\n    const repoCode = 'TQ';\r\n    const generalLocation = `in ${username} ${repoName} (${branch})`;\r\n\r\n    const ctqResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkBookPackage success: ${successString}`);\r\n        ctqResult.successList.push(successString);\r\n    }\r\n\r\n    function addNotice10({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location, extra}) {\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // console.log(`checkTQbook addNotice10: (priority=${priority}) ${bookID} ${C}:${V} ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cTQ addNotice10: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cTQ addNotice10: 'priority' parameter should be a number not a '${typeof priority}'`);\r\n        console.assert(message !== undefined, \"cTQ addNotice10: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cTQ addNotice10: 'message' parameter should be a string not a '${typeof message}'`);\r\n        console.assert(bookID !== undefined, \"cTQ addNotice10: 'bookID' parameter should be defined\");\r\n        console.assert(typeof bookID === 'string', `cTQ addNotice10: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n        console.assert(bookID.length === 3, `cTQ addNotice10: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n        console.assert(books.isValidBookID(bookID), `cTQ addNotice10: '${bookID}' is not a valid USFM book identifier`);\r\n        // console.assert(C !== undefined, \"cTQ addNotice10: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `cTQ addNotice10: 'C' parameter should be a string not a '${typeof C}'`);\r\n        // console.assert(V !== undefined, \"cTQ addNotice10: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `cTQ addNotice10: 'V' parameter should be a string not a '${typeof V}'`);\r\n        // console.assert(characterIndex !== undefined, \"cTQ addNotice10: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cTQ addNotice10: 'characterIndex' parameter should be a number not a '${typeof characterIndex}'`);\r\n        // console.assert(extract !== undefined, \"cTQ addNotice10: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cTQ addNotice10: 'extract' parameter should be a string not a '${typeof extract}'`);\r\n        console.assert(location !== undefined, \"cTQ addNotice10: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cTQ addNotice10: 'location' parameter should be a string not a '${typeof location}'`);\r\n        console.assert(extra !== undefined, \"cTQ addNotice10: 'extra' parameter should be defined\");\r\n        console.assert(typeof extra === 'string', `cTQ addNotice10: 'extra' parameter should be a string not a '${typeof extra}'`);\r\n        ctqResult.noticeList.push({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location, extra});\r\n    }\r\n\r\n\r\n    async function doOurCheckFile(repoCode, bookID, C, V, cfFilename, file_content, fileLocation, optionalCheckingOptions) {\r\n        // console.log(`checkBookPackage doOurCheckFile(${cfFilename})`);\r\n\r\n        // Updates the global list of notices\r\n        console.assert(repoCode !== undefined, \"cTQ doOurCheckFile: 'repoCode' parameter should be defined\");\r\n        console.assert(typeof repoCode === 'string', `cTQ doOurCheckFile: 'repoCode' parameter should be a string not a '${typeof repoCode}'`);\r\n        console.assert(cfFilename !== undefined, \"cTQ doOurCheckFile: 'cfFilename' parameter should be defined\");\r\n        console.assert(typeof cfFilename === 'string', `cTQ doOurCheckFile: 'cfFilename' parameter should be a string not a '${typeof cfFilename}'`);\r\n        console.assert(file_content !== undefined, \"cTQ doOurCheckFile: 'file_content' parameter should be defined\");\r\n        console.assert(typeof file_content === 'string', `cTQ doOurCheckFile: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n        console.assert(fileLocation !== undefined, \"cTQ doOurCheckFile: 'fileLocation' parameter should be defined\");\r\n        console.assert(typeof fileLocation === 'string', `cTQ doOurCheckFile: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n        const cfResultObject = await checkFile(cfFilename, file_content, fileLocation, optionalCheckingOptions);\r\n        // console.log(\"checkFile() returned\", cfResultObject.successList.length, \"success message(s) and\", cfResultObject.noticeList.length, \"notice(s)\");\r\n        // for (const successEntry of cfResultObject.successList) console.log(\"  doOurCheckFile:\", successEntry);\r\n\r\n        // Process results line by line,  appending the repoCode as an extra field as we go\r\n        for (const noticeEntry of cfResultObject.noticeList) {\r\n            // noticeEntry is an array of eight fields: 1=priority, 2=bookID, 3=C, 4=V, 5=msg, 6=characterIndex, 7=extract, 8=location\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `cTQ doOurCheckFile notice length=${Object.keys(noticeEntry).length}`);\r\n            // We add the repoCode as an extra value\r\n            addNotice10({priority:noticeEntry.priority, message:noticeEntry.message,\r\n                bookID, C, V, lineNumber:noticeEntry.lineNumber,\r\n                characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract,\r\n                location:noticeEntry.location, extra:repoCode});\r\n        }\r\n    }\r\n    // end of doOurCheckFile function\r\n\r\n\r\n    // Main code for checkTQbook\r\n    // We need to find an check all the markdown folders/files for this book\r\n    let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(['md']), totalCheckedSize = 0;\r\n    const pathList = await getFilelistFromZip({ username, repository: repoName, branch, optionalPrefix: `${bookID.toLowerCase()}/` });\r\n    // console.log(`  Got ${pathList.length} pathList entries`)\r\n    for (const thisPath of pathList) {\r\n        // console.log(\"checkTQbook: Try to load\", username, repoName, thisPath, branch);\r\n\r\n        console.assert(thisPath.endsWith('.md'), `Expected ${thisPath} to end with .md`);\r\n        const pathParts = thisPath.slice(0,-3).split('/');\r\n        const C = pathParts[pathParts.length-2].replace(/^0+(?=\\d)/, '');\r\n        const V = pathParts[pathParts.length-1].replace(/^0+(?=\\d)/, '');\r\n\r\n        let tqFileContent;\r\n        try {\r\n            tqFileContent = await getFile({ username, repository: repoName, path: thisPath, branch });\r\n            // console.log(\"Fetched file_content for\", repoName, thisPath, typeof tqFileContent, tqFileContent.length);\r\n            checkedFilenames.push(thisPath);\r\n            totalCheckedSize += tqFileContent.length;\r\n        } catch (tQerror) {\r\n            console.log(\"checkTQbook failed to load\", username, repoName, thisPath, branch, tQerror + '');\r\n            addNotice10({priority:996, bookID, C, V, message:\"Failed to load\", location:`${generalLocation} ${thisPath}: ${tQerror}`, extra:repoCode});\r\n            continue;\r\n        }\r\n\r\n        // We use the generalLocation here (does not include repo name)\r\n        //  so that we can adjust the returned strings ourselves\r\n        await doOurCheckFile(repoCode, bookID, C, V, thisPath, tqFileContent, generalLocation, checkingOptions); // Adds the notices to checkBookPackageResult\r\n        checkedFileCount += 1;\r\n        // addSuccessMessage(`Checked ${repoCode.toUpperCase()} file: ${thisPath}`);\r\n    }\r\n    addSuccessMessage(`Checked ${checkedFileCount.toLocaleString()} ${repoCode.toUpperCase()} file${checkedFileCount === 1 ? '' : 's'}`);\r\n\r\n    ctqResult.checkedFileCount = checkedFileCount;\r\n    ctqResult.checkedFilenames = checkedFilenames;\r\n    ctqResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n    ctqResult.checkedFilesizes = totalCheckedSize;\r\n    // console.log(`  checkTQbook returning ${JSON.stringify(ctqResult)}`);\r\n    return ctqResult;\r\n}\r\n// end of checkTQbook function\r\n\r\n\r\nasync function checkBookPackage(username, language_code, bookID, setResultValue, checkingOptions) {\r\n    /*\r\n    Note that bookID here can also be the 'OBS' pseudo bookID.\r\n    */\r\n    //     console.log(`I'm here in checkBookPackage v${CHECKER_VERSION_STRING}\r\n    //   with ${username}, ${language_code}, ${bookID}, ${JSON.stringify(checkingOptions)}`);\r\n    const startTime = new Date();\r\n\r\n    let checkBookPackageResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkBookPackage success: ${successString}`);\r\n        checkBookPackageResult.successList.push(successString);\r\n    }\r\n\r\n    function addNotice10({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location, extra}) {\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // console.log(`checkBookPackage addNotice10: (priority=${priority}) ${bookID} ${C}:${V} ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cBP addNotice10: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cBP addNotice10: 'priority' parameter should be a number not a '${typeof priority}'`);\r\n        console.assert(message !== undefined, \"cBP addNotice10: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cBP addNotice10: 'message' parameter should be a string not a '${typeof message}'`);\r\n        // console.assert(bookID !== undefined, \"cBP addNotice10: 'bookID' parameter should be defined\");\r\n        if (bookID) {\r\n            console.assert(typeof bookID === 'string', `cBP addNotice10: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n            console.assert(bookID.length === 3, `cBP addNotice10: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n            console.assert(books.isValidBookID(bookID), `cBP addNotice10: '${bookID}' is not a valid USFM book identifier`);\r\n        }\r\n        // console.assert(C !== undefined, \"cBP addNotice10: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `cBP addNotice10: 'C' parameter should be a string not a '${typeof C}'`);\r\n        // console.assert(V !== undefined, \"cBP addNotice10: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `cBP addNotice10: 'V' parameter should be a string not a '${typeof V}'`);\r\n        // console.assert(characterIndex !== undefined, \"cBP addNotice10: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cBP addNotice10: 'characterIndex' parameter should be a number not a '${typeof characterIndex}'`);\r\n        // console.assert(extract !== undefined, \"cBP addNotice10: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cBP addNotice10: 'extract' parameter should be a string not a '${typeof extract}'`);\r\n        console.assert(location !== undefined, \"cBP addNotice10: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cBP addNotice10: 'location' parameter should be a string not a '${typeof location}'`);\r\n        console.assert(extra !== undefined, \"cBP addNotice10: 'extra' parameter should be defined\");\r\n        console.assert(typeof extra === 'string', `cBP addNotice10: 'extra' parameter should be a string not a '${typeof extra}'`);\r\n        checkBookPackageResult.noticeList.push({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location, extra});\r\n    }\r\n\r\n\r\n    async function doOurCheckFile(repoCode, cfFilename, file_content, fileLocation, optionalCheckingOptions) {\r\n        // console.log(`checkBookPackage doOurCheckFile(${cfFilename})`);\r\n\r\n        // Updates the global list of notices\r\n        console.assert(repoCode !== undefined, \"cBP doOurCheckFile: 'repoCode' parameter should be defined\");\r\n        console.assert(typeof repoCode === 'string', `cBP doOurCheckFile: 'repoCode' parameter should be a string not a '${typeof repoCode}'`);\r\n        console.assert(cfFilename !== undefined, \"cBP doOurCheckFile: 'cfFilename' parameter should be defined\");\r\n        console.assert(typeof cfFilename === 'string', `cBP doOurCheckFile: 'cfFilename' parameter should be a string not a '${typeof cfFilename}'`);\r\n        console.assert(file_content !== undefined, \"cBP doOurCheckFile: 'file_content' parameter should be defined\");\r\n        console.assert(typeof file_content === 'string', `cBP doOurCheckFile: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n        console.assert(fileLocation !== undefined, \"cBP doOurCheckFile: 'fileLocation' parameter should be defined\");\r\n        console.assert(typeof fileLocation === 'string', `cBP doOurCheckFile: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n        const cfResultObject = await checkFile(cfFilename, file_content, fileLocation, optionalCheckingOptions);\r\n        // console.log(\"checkFile() returned\", cfResultObject.successList.length, \"success message(s) and\", cfResultObject.noticeList.length, \"notice(s)\");\r\n        // for (const successEntry of cfResultObject.successList) console.log(\"  doOurCheckFile:\", successEntry);\r\n\r\n        // Process results line by line,  appending the repoCode as an extra field as we go\r\n        for (const noticeEntry of cfResultObject.noticeList)\r\n            // noticeEntry is an object\r\n            // We add the repoCode as an extra value\r\n            addNotice10({priority:noticeEntry.priority, message:noticeEntry.message,\r\n                bookID:noticeEntry.bookID, C:noticeEntry.C, V:noticeEntry.V, lineNumber:noticeEntry.lineNumber,\r\n                characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract,\r\n                location:noticeEntry.location, extra:repoCode});\r\n    }\r\n    // end of doOurCheckFile function\r\n\r\n\r\n    /* async function doOurCheckRepo(username, repoName, branch, repoLocation, optionalCheckingOptions) {\r\n        // console.log(`checkBookPackage doOurCheckRepo(${username}, ${repoName}, ${branch})…`);\r\n\r\n        // Updates the global list of notices\r\n        console.assert(username !== undefined, \"cBP doOurCheckRepo: 'username' parameter should be defined\");\r\n        console.assert(typeof username === 'string', `cBP doOurCheckRepo: 'username' parameter should be a string not a '${typeof username}'`);\r\n        console.assert(repoName !== undefined, \"cBP doOurCheckRepo: 'repoName' parameter should be defined\");\r\n        console.assert(typeof repoName === 'string', `cBP doOurCheckRepo: 'repoName' parameter should be a string not a '${typeof repoName}'`);\r\n        console.assert(repoLocation !== undefined, \"cBP doOurCheckRepo: 'repoLocation' parameter should be defined\");\r\n        console.assert(typeof repoLocation === 'string', `cBP doOurCheckRepo: 'repoLocation' parameter should be a string not a '${typeof repoLocation}'`);\r\n\r\n        const crResultObject = await checkRepo(username, repoName, branch, repoLocation, setResultValue, optionalCheckingOptions)\r\n        console.log(`checkRepo() returned ${crResultObject.successList.length} success message(s) and ${crResultObject.noticeList.length} notice(s)`);\r\n        console.log(\"crResultObject keys\", JSON.stringify(Object.keys(crResultObject)));\r\n\r\n        // Concat is faster if we don't need to process each notice individually\r\n        checkBookPackageResult.successList = checkBookPackageResult.successList.concat(crResultObject.successList);\r\n        checkBookPackageResult.noticeList = checkBookPackageResult.noticeList.concat(crResultObject.noticeList);\r\n        // Process results line by line\r\n        // for (const noticeEntry of crResultObject.noticeList)\r\n        // noticeEntry is an array of eight fields: 1=priority, 2=bookID, 3=C, 4=V, 5=msg, 6=characterIndex, 7=extract, 8=location\r\n        // We add the repoCode as an extra value\r\n        // addNotice10({noticeEntry.priority, noticeEntry[1], noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7]);\r\n        // console.log(`doOurCheckRepo() finished.`)\r\n        return crResultObject;\r\n    }\r\n    // end of doOurCheckRepo function */\r\n\r\n\r\n    // Main code for checkBookPackage()\r\n    const generalLocation = ` ${language_code} ${bookID} book package from ${username}`;\r\n\r\n    // No point in passing the branch through as a parameter\r\n    //  coz if it's not 'master', it's unlikely to be common for all the repos\r\n    const branch = 'master'\r\n\r\n    if (bookID === 'OBS') {\r\n        // We use the generalLocation here (does not include repo name)\r\n        //  so that we can adjust the returned strings ourselves\r\n        // console.log(\"Calling OBS checkRepo()…\");\r\n        checkBookPackageResult = await checkRepo(username, `${language_code}_obs`, branch, generalLocation, setResultValue, checkingOptions); // Adds the notices to checkBookPackageResult\r\n        // console.log(`checkRepo() returned ${checkBookPackageResult.successList.length} success message(s) and ${checkBookPackageResult.noticeList.length} notice(s)`);\r\n        // console.log(\"crResultObject keys\", JSON.stringify(Object.keys(checkBookPackageResult)));\r\n\r\n        // Concat is faster if we don't need to process each notice individually\r\n        // checkBookPackageResult.successList = checkBookPackageResult.successList.concat(crResultObject.successList);\r\n        // checkBookPackageResult.noticeList = checkBookPackageResult.noticeList.concat(crResultObject.noticeList);\r\n        // checkedFileCount += crResultObject.fileCount;\r\n        addSuccessMessage(`Checked ${language_code} OBS repo from ${username}`);\r\n    } else {\r\n        // We also need to know the number for USFM books\r\n        let bookNumberAndName, whichTestament;\r\n        try {\r\n            bookNumberAndName = books.usfmNumberName(bookID);\r\n            whichTestament = books.testament(bookID); // returns 'old' or 'new'\r\n        } catch (bNNerror) {\r\n            if (books.isValidBookID(bookID)) // must be in FRT, BAK, etc.\r\n                whichTestament = 'other'\r\n            else {\r\n                addNotice10({priority:900, message:\"Bad function call: should be given a valid book abbreviation\", extract:bookID, location:` (not '${bookID}')${location}`});\r\n                return checkBookPackageResult;\r\n            }\r\n        }\r\n        // console.log(`bookNumberAndName='${bookNumberAndName}' (${whichTestament} testament)`);\r\n\r\n        // So now we want to work through checking this one specified Bible book in various repos:\r\n        //  UHB/UGNT, ULT, UST, TN, TQ\r\n        let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0, checkedRepoNames = [];\r\n        for (const repoCode of [(whichTestament === 'old' ? 'UHB' : 'UGNT'), 'ULT', 'UST', 'TN', 'TQ']) {\r\n            // console.log(`Let's try ${repoCode} (${language_code} ${bookID} from ${username})`);\r\n            const repoLocation = ` in ${repoCode.toUpperCase()}${generalLocation}`;\r\n\r\n            let repo_language_code = language_code;\r\n            if (repoCode === 'UHB') repo_language_code = 'hbo';\r\n            else if (repoCode === 'UGNT') repo_language_code = 'el-x-koine';\r\n            const repoName = `${repo_language_code}_${repoCode.toLowerCase()}`;\r\n\r\n            const fullRepoName = username + '/' + repoName;\r\n            // console.log(\"Let's try1\", bookID, \"from\", fullRepoName);\r\n\r\n            let filename;\r\n            if (repoCode === 'UHB' || repoCode === 'UGNT' || repoCode === 'ULT' || repoCode === 'UST') {\r\n                filename = `${bookNumberAndName}.usfm`;\r\n                checkedFilenameExtensions.add('usfm');\r\n            }\r\n            else if (repoCode === 'TN') {\r\n                filename = `${language_code}_tn_${bookNumberAndName}.tsv`;\r\n                checkedFilenameExtensions.add('tsv');\r\n            }\r\n\r\n            if (repoCode === 'TQ') {\r\n                // This resource might eventually be converted to TSV tables\r\n                const tqResultObject = await checkTQbook(username, repoName, branch, bookID, checkingOptions);\r\n                checkBookPackageResult.successList = checkBookPackageResult.successList.concat(tqResultObject.successList);\r\n                checkBookPackageResult.noticeList = checkBookPackageResult.noticeList.concat(tqResultObject.noticeList);\r\n                checkedFilenames = checkedFilenames.concat(tqResultObject.checkedFilenames);\r\n                checkedFilenameExtensions = new Set([...checkedFilenameExtensions, ...tqResultObject.checkedFilenameExtensions]);\r\n                checkedFileCount += tqResultObject.checkedFileCount;\r\n                totalCheckedSize += tqResultObject.totalCheckedSize;\r\n                checkedRepoNames.push(repoCode);\r\n            } else { // For repos other than TQ, we only have one file to check\r\n                // console.log(\"Try to load\", username, repoName, filename, branch);\r\n                let repoFileContent;\r\n                try {\r\n                    repoFileContent = await getFile({ username, repository: repoName, path: filename, branch });\r\n                    // console.log(\"Fetched file_content for\", repoName, filename, typeof repoFileContent, repoFileContent.length);\r\n                    checkedFilenames.push(filename);\r\n                    totalCheckedSize += repoFileContent.length;\r\n                    checkedRepoNames.push(repoCode);\r\n                } catch (cBPgfError) {\r\n                    console.log(\"ERROR: Failed to load\", username, repoName, filename, branch, cBPgfError + '');\r\n                    addNotice10({priority:996, message:\"Failed to load\", bookID, location:`${generalLocation} ${filename}: ${cBPgfError}`, extra:repoCode});\r\n                    continue;\r\n                }\r\n\r\n                // We use the generalLocation here (does not include repo name)\r\n                //  so that we can adjust the returned strings ourselves\r\n                await doOurCheckFile(repoCode, filename, repoFileContent, generalLocation, checkingOptions); // Adds the notices to checkBookPackageResult\r\n                checkedFileCount += 1;\r\n                addSuccessMessage(`Checked ${repoCode.toUpperCase()} file: ${filename}`);\r\n            }\r\n\r\n            // Update our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Waiting for check results for {username} {language_code} <b>{bookID}</b> book package: checked <b>{checkedRepoNames.length.toLocaleString()}</b>/5 repos…</p>);\r\n        }\r\n\r\n        // Add some extra fields to our checkFileResult object\r\n        //  in case we need this information again later\r\n        checkBookPackageResult.checkedFileCount = checkedFileCount;\r\n        checkBookPackageResult.checkedFilenames = checkedFilenames;\r\n        checkBookPackageResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n        checkBookPackageResult.checkedFilesizes = totalCheckedSize;\r\n        checkBookPackageResult.checkedRepoNames = checkedRepoNames;\r\n        // checkBookPackageResult.checkedOptions = checkingOptions; // This is done at the caller level\r\n    }\r\n\r\n    // console.log(\"checkBookPackage() is returning\", checkBookPackageResult.successList.length.toLocaleString(), \"success message(s) and\", checkBookPackageResult.noticeList.length.toLocaleString(), \"notice(s)\");\r\n    checkBookPackageResult.elapsedTime = (new Date() - startTime) / 1000; // seconds\r\n    return checkBookPackageResult;\r\n};\r\n// end of checkBookPackage()\r\n\r\nexport default checkBookPackage;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport * as books from '../../core/books/books';\r\nimport checkBookPackage from './checkBookPackage';\r\nimport { processNoticesToErrorsWarnings, processNoticesToSevereMediumLow, processNoticesToSingleList } from '../../core/notice-processing-functions';\r\nimport { RenderSuccessesErrorsWarnings, RenderSuccessesSevereMediumLow, RenderSuccessesWarningsGradient, RenderElapsedTime } from '../RenderProcessedResults';\r\nimport { ourParseInt, consoleLogObject } from '../../core/utilities';\r\n\r\n\r\nconst CHECKER_VERSION_STRING = '0.1.2';\r\n\r\n\r\nfunction BookPackageCheck(/*username, language_code, bookID,*/ props) {\r\n    // Check a single Bible book across many repositories\r\n    const [result, setResultValue] = useState(\"Waiting-CheckBookPackage\");\r\n\r\n    // console.log(`I'm here in BookPackageCheck v${CHECKER_VERSION_STRING}`);\r\n    // consoleLogObject(\"props\", props);\r\n    // consoleLogObject(\"props.classes\", props.classes);\r\n\r\n    let username = props.username;\r\n    // console.log(`username='${username}'`);\r\n    let language_code = props.language_code;\r\n    // console.log(`language_code='${language_code}'`);\r\n    let bookID = props.bookID;\r\n    // console.log(`bookID='${bookID}'`);\r\n    let branch = props.branch;\r\n    // console.log(`branch='${branch}'`);\r\n\r\n    if (bookID!=='OBS' && !books.isValidBookID(bookID))\r\n        return (<p>Please enter a valid USFM book identifier. ('{bookID}' is not valid.)</p>);\r\n\r\n     // Clear cached files if we've changed repo\r\n    //  autoClearCache(bookID); // This technique avoids the complications of needing a button\r\n\r\n     let checkingOptions = { // Uncomment any of these to test them\r\n        // 'extractLength': 25,\r\n        };\r\n    // Or this allows the parameters to be specified as a BookPackageCheck property\r\n    if (props.extractLength) checkingOptions.extractLength = ourParseInt(props.extractLength);\r\n\r\n    useEffect(() => {\r\n        // Use an IIFE (Immediately Invoked Function Expression)\r\n        //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174\r\n        (async () => {\r\n            // console.log(\"Started unnamedFunction()\");\r\n\r\n            // Display our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Waiting for check results for {username} {language_code} <b>{bookID}</b> book package…</p>);\r\n\r\n            const rawCBPResults = await checkBookPackage(username, language_code, bookID, setResultValue, checkingOptions);\r\n            // console.log(\"checkBookPackage() returned\", typeof rawCBPResults); //, JSON.stringify(rawCBPResults));\r\n\r\n            // Add some extra fields to our rawCBPResults object in case we need this information again later\r\n            rawCBPResults.checkType = 'BookPackage';\r\n            rawCBPResults.username = username;\r\n            rawCBPResults.language_code = language_code;\r\n            rawCBPResults.bookID = bookID;\r\n            rawCBPResults.checkedOptions = checkingOptions;\r\n\r\n            // console.log(\"Here with CBP rawCBPResults\", typeof rawCBPResults);\r\n            // Now do our final handling of the result -- we have some options available\r\n            let processOptions = { // Uncomment any of these to test them\r\n                // 'maximumSimilarMessages': 3, // default is 2\r\n                // 'errorPriorityLevel': 800, // default is 700\r\n                // 'cutoffPriorityLevel': 100, // default is 0\r\n                // 'sortBy': 'ByPriority', // default is 'AsFound'\r\n                // 'ignorePriorityNumberList': [123, 202], // default is []\r\n            };\r\n            // Or this allows the parameters to be specified as a BookPackageCheck property\r\n            if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = ourParseInt(props.maximumSimilarMessages);\r\n            if (props.errorPriorityLevel) processOptions.errorPriorityLevel = ourParseInt(props.errorPriorityLevel);\r\n            if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);\r\n            if (props.sortBy) processOptions.sortBy = props.sortBy;\r\n            // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;\r\n\r\n            let displayType = 'ErrorsWarnings'; // default\r\n            if (props.displayType) displayType = props.displayType;\r\n\r\n            function renderSummary(processedResults) {\r\n                return (<>\r\n                <p>Checked <b>{username} {language_code} {bookID}</b> (from <i>{branch === undefined ? 'DEFAULT' : branch}</i> branches)</p>\r\n                <p>&nbsp;&nbsp;&nbsp;&nbsp;Successfully checked {processedResults.checkedFileCount.toLocaleString()} file{processedResults.checkedFileCount==1?'':'s'} from {processedResults.checkedRepoNames.length} repo{processedResults.checkedRepoNames.length==1?'':'s'}: <b>{processedResults.checkedRepoNames.join(', ')}</b>\r\n                <br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;including {processedResults.checkedFilenameExtensions.length} file type{processedResults.checkedFilenameExtensions.size === 1 ? '' : 's'}: {processedResults.checkedFilenameExtensions.join(', ')}.</p>\r\n                <p>&nbsp;&nbsp;&nbsp;&nbsp;Finished in <RenderElapsedTime elapsedTime={processedResults.elapsedTime} />.</p>\r\n                </>);\r\n            }\r\n\r\n            if (displayType === 'ErrorsWarnings') {\r\n            const processedResults = processNoticesToErrorsWarnings(rawCBPResults, processOptions);\r\n//             console.log(`BookPackageCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n//   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n            // console.log(\"Here now in rendering bit!\");\r\n\r\n            if (processedResults.errorList.length || processedResults.warningList.length)\r\n                setResultValue(<>\r\n                    {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}\r\n                    <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                </>);\r\n            else // no errors or warnings\r\n                setResultValue(<>\r\n                    {renderSummary(processedResults)}\r\n                    {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}\r\n                    <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                </>);\r\n            } else if (displayType === 'SevereMediumLow') {\r\n                const processedResults = processNoticesToSevereMediumLow(rawCBPResults, processOptions);\r\n//             console.log(`BookPackageCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n//   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n                if (processedResults.severeList.length || processedResults.mediumList.length || processedResults.lowList.length)\r\n                setResultValue(<>\r\n                    {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}\r\n                        <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                    </>);\r\n                else // no severe, medium, or low notices\r\n                setResultValue(<>\r\n                    {renderSummary(processedResults)}\r\n                    {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}\r\n                        <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                    </>);\r\n            } else if (displayType === 'SingleList') {\r\n                const processedResults = processNoticesToSingleList(rawCBPResults, processOptions);\r\n//             console.log(`BookPackageCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n//   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n                if (processedResults.warningList.length)\r\n                setResultValue(<>\r\n                    {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}\r\n                        <RenderSuccessesWarningsGradient results={processedResults} />\r\n                    </>);\r\n                else // no warnings\r\n                setResultValue(<>\r\n                    {renderSummary(processedResults)}\r\n                    {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}\r\n                        <RenderSuccessesWarningsGradient results={processedResults} />\r\n                    </>);\r\n            } else setResultValue(<b style={{ color: 'red' }}>Invalid displayType='{displayType}'</b>)\r\n\r\n            // console.log(\"Finished rendering bit.\");\r\n        })(); // end of async part in unnamedFunction\r\n    }, []); // end of useEffect part\r\n\r\n    // {/* <div className={classes.root}> */}\r\n    return (\r\n        <div className=\"Fred\">\r\n        {result}\r\n        </div>\r\n    );\r\n}\r\n\r\n// BookPackageCheck.propTypes = {\r\n//   /** @ignore */\r\n//   username: PropTypes.object.isRequired,\r\n//   /** @ignore */\r\n//   language_code: PropTypes.object.isRequired,\r\n//   bookID: PropTypes.object.isRequired,\r\n//   props: PropTypes.object,\r\n// };\r\n\r\nconst styles = theme => ({\r\n  root: {\r\n  },\r\n});\r\n\r\n//export default withStyles(styles)(BookPackageCheck);\r\nexport default BookPackageCheck;\r\n","import React from 'react';\r\nimport * as books from '../../core/books/books';\r\nimport checkBookPackage from '../book-package-check/checkBookPackage';\r\nimport { getFile } from '../../core/getApi';\r\n// import { consoleLogObject } from '../../core/utilities';\r\n\r\nconst CHECKER_VERSION_STRING = '0.2.1';\r\n\r\n\r\nasync function checkBookPackages(username, language_code, bookIDList, setResultValue, checkingOptions) {\r\n    //     console.log(`I'm here in checkBookPackages v${CHECKER_VERSION_STRING}\r\n    //   with ${username}, ${language_code}, ${bookIDList}, ${JSON.stringify(checkingOptions)}`);\r\n    const startTime = new Date();\r\n\r\n    const checkBookPackagesResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkBookPackages success: ${successString}`);\r\n        checkBookPackagesResult.successList.push(successString);\r\n    }\r\n\r\n    function addNotice10({priority,message, bookID,C,V, lineNumber, characterIndex, extract, location, extra}) {\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // console.log(`checkBookPackages Notice: (priority=${priority}) ${extra} ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cBPs addNotice10: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cBPs addNotice10: 'priority' parameter should be a number not a '${typeof priority}'`);\r\n        console.assert(message !== undefined, \"cBPs addNotice10: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cBPs addNotice10: 'message' parameter should be a string not a '${typeof message}'`);\r\n        // console.assert(bookID !== undefined, \"cBPs addNotice10: 'bookID' parameter should be defined\");\r\n        if (bookID) {\r\n            console.assert(typeof bookID === 'string', `cBPs addNotice10: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n            console.assert(bookID.length === 3, `cBPs addNotice10: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n            console.assert(books.isValidBookID(bookID), `cBPs addNotice10: '${bookID}' is not a valid USFM book identifier`);\r\n        }\r\n        // console.assert(C !== undefined, \"cBPs addNotice10: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `cBPs addNotice10: 'C' parameter should be a string not a '${typeof C}'`);\r\n        // console.assert(V !== undefined, \"cBPs addNotice10: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `cBPs addNotice10: 'V' parameter should be a string not a '${typeof V}'`);\r\n        // console.assert(characterIndex !== undefined, \"cBPs addNotice10: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cBPs addNotice10: 'characterIndex' parameter should be a number not a '${typeof characterIndex}'`);\r\n        // console.assert(extract !== undefined, \"cBPs addNotice10: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cBPs addNotice10: 'extract' parameter should be a string not a '${typeof extract}'`);\r\n        console.assert(location !== undefined, \"cBPs addNotice10: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cBPs addNotice10: 'location' parameter should be a string not a '${typeof location}'`);\r\n        console.assert(extra !== undefined, \"cBPs addNotice10: 'extra' parameter should be defined\");\r\n        console.assert(typeof extra === 'string', `cBPs addNotice10: 'extra' parameter should be a string not a '${typeof extra}'`);\r\n        checkBookPackagesResult.noticeList.push({priority,message, bookID,C,V, lineNumber, characterIndex, extract, location, extra});\r\n    }\r\n\r\n\r\n    // Main code for checkBookPackages()\r\n    let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0, checkedRepoNames = new Set();\r\n    for (const bookID of bookIDList) {\r\n        // console.log(`checkBookPackages bookID: ${bookID}`);\r\n\r\n        // const generalLocation = ` ${language_code} ${bookID} book packages from ${username}`;\r\n        if (bookID !== 'OBS') {\r\n            let bookNumberAndName; //, whichTestament;\r\n            try {\r\n                bookNumberAndName = books.usfmNumberName(bookID);\r\n                // whichTestament = books.testament(bookID); // returns 'old' or 'new'\r\n            } catch (CBPsError) {\r\n                addNotice10({priority:900, message:\"Bad parameter: should be given a valid book abbreviation\", extract:bookIDList, location:` (not '${bookIDList}')${location}`});\r\n                return checkBookPackagesResult;\r\n            }\r\n            // console.log(`bookNumberAndName='${bookNumberAndName}' (${whichTestament} testament)`);\r\n        }\r\n\r\n        // We use the generalLocation here (does not include repo name)\r\n        //  so that we can adjust the returned strings ourselves\r\n        const cbpResultObject = await checkBookPackage(username, language_code, bookID, setResultValue, checkingOptions);\r\n        // console.log(`checkBookPackage() returned ${cbpResultObject.successList.length} success message(s) and ${cbpResultObject.noticeList.length} notice(s)`);\r\n\r\n        // Concat is faster if we don't need to process each success message individually\r\n        checkBookPackagesResult.successList = checkBookPackagesResult.successList.concat(cbpResultObject.successList);\r\n        // Process results line by line,  appending the repoCode/bookID as an extra field as we go\r\n        // for (const successEntry of cbpResultObject.successList) {\r\n        //     // console.log(\"  doOurCheckBookPackage:\", successEntry);\r\n        //     addSuccessMessage(successEntry);\r\n        // }\r\n\r\n        // Concat is faster if we don't need to process each notice individually\r\n        checkBookPackagesResult.noticeList = checkBookPackagesResult.noticeList.concat(cbpResultObject.noticeList);\r\n        // for (const noticeEntry of cbpResultObject.noticeList)\r\n        //     // noticeEntry is an array of eight fields: 1=priority, 2=bookID, 3=C, 4=V, 5=msg, 6=characterIndex, 7=extract, 8=location\r\n        //     // The extra value from checkBookPackage is the repo name\r\n        //     addNotice10({noticeEntry.priority, noticeEntry[1], noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7], noticeEntry[5]);\r\n\r\n        checkedFileCount += cbpResultObject.checkedFileCount;\r\n        checkedFilenames = [...checkedFilenames, ...cbpResultObject.checkedFilenames];\r\n        checkedFilenameExtensions = new Set([...checkedFilenameExtensions, ...cbpResultObject.checkedFilenameExtensions]);\r\n        totalCheckedSize += cbpResultObject.checkedFilesizes;\r\n        checkedRepoNames = new Set([...checkedRepoNames, ...cbpResultObject.checkedRepoNames]);\r\n\r\n        // addSuccessMessage(`${checkedFileCount.toLocaleString()}/ Checked ${bookID} book package`);\r\n\r\n        // Update our \"waiting\" message {checkedFileCount==1?'':'s'}\r\n        // setResultValue(<p style={{ color: 'magenta' }}>Waiting for check results for {username} {language_code} <b>{bookIDList}</b> book package: checked <b>{checkedFileCount.toLocaleString()}</b>/5 repos…</p>);\r\n    }\r\n\r\n    // Add some extra fields to our checkFileResult object\r\n    //  in case we need this information again later\r\n    checkBookPackagesResult.checkedFileCount = checkedFileCount;\r\n    checkBookPackagesResult.checkedFilenames = checkedFilenames;\r\n    checkBookPackagesResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n    checkBookPackagesResult.checkedFilesizes = totalCheckedSize;\r\n    checkedRepoNames = [...checkedRepoNames]; // Convert set to Array\r\n    const index = checkedRepoNames.indexOf(`${username}/${language_code}_obs`);\r\n    if (index !== -1) checkedRepoNames[index] = 'OBS'; // Looks tidier here\r\n    checkBookPackagesResult.checkedRepoNames = checkedRepoNames;\r\n    // checkBookPackagesResult.checkedOptions = checkingOptions; // This is done at the caller level\r\n\r\n    // console.log(\"checkBookPackages() is returning\", checkBookPackagesResult.successList.length.toLocaleString(), \"success message(s) and\", checkBookPackagesResult.noticeList.length.toLocaleString(), \"notice(s)\");\r\n    checkBookPackagesResult.elapsedTime = (new Date() - startTime) / 1000; // seconds\r\n    return checkBookPackagesResult;\r\n};\r\n// end of checkBookPackages()\r\n\r\nexport default checkBookPackages;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport * as books from '../../core/books/books';\r\nimport checkBookPackages from './checkBookPackages';\r\nimport { processNoticesToErrorsWarnings, processNoticesToSevereMediumLow, processNoticesToSingleList } from '../../core/notice-processing-functions';\r\nimport { RenderSuccessesErrorsWarnings, RenderSuccessesSevereMediumLow, RenderSuccessesWarningsGradient, RenderElapsedTime } from '../RenderProcessedResults';\r\nimport { ourParseInt, consoleLogObject } from '../../core/utilities';\r\n\r\n\r\nconst CHECKER_VERSION_STRING = '0.0.3';\r\n\r\n\r\nexport function BookPackagesCheck(/*username, language_code, bookIDs,*/ props) {\r\n    // Check a single Bible book across many repositories\r\n    const [result, setResultValue] = useState(\"Waiting-CheckBookPackages\");\r\n\r\n    // console.log(`I'm here in BookPackagesCheck v${CHECKER_VERSION_STRING}`);\r\n    // consoleLogObject(\"props\", props);\r\n    // consoleLogObject(\"props.classes\", props.classes);\r\n\r\n    let username = props.username;\r\n    // console.log(`username='${username}'`);\r\n    let language_code = props.language_code;\r\n    // console.log(`language_code='${language_code}'`);\r\n    let bookIDs = props.bookIDs;\r\n    // console.log(`bookIDs='${bookIDs}'`);\r\n    let branch = props.branch;\r\n    // console.log(`branch='${branch}'`);\r\n\r\n     // Clear cached files if we've changed repo\r\n    //  autoClearCache(bookIDs); // This technique avoids the complications of needing a button\r\n\r\n    let bookIDList = [];\r\n    for (let bookID of bookIDs.split(',')) {\r\n        bookID = bookID.trim();\r\n        if (!books.isValidBookID(bookID) && bookID!=='OBS')\r\n            return (<p>Please enter only valid USFM book identifiers separated by commas. ('{bookID}' is not valid.)</p>);\r\n        bookIDList.push(bookID);\r\n    }\r\n    // console.log(`bookIDList (${bookIDList.length}) = ${bookIDList.join(', ')}`);\r\n\r\n    let checkingOptions = { // Uncomment any of these to test them\r\n        // 'extractLength': 25,\r\n        };\r\n    // Or this allows the parameters to be specified as a BookPackagesCheck property\r\n    if (props.extractLength) checkingOptions.extractLength = ourParseInt(props.extractLength);\r\n\r\n    useEffect(() => {\r\n        // Use an IIFE (Immediately Invoked Function Expression)\r\n        //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174\r\n        (async () => {\r\n            // console.log(\"Started unnamedFunction()\");\r\n\r\n            // Display our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Waiting for check results for {username} {language_code} <b>{bookIDList.join(', ')}</b> book packages…</p>);\r\n\r\n            const rawCBPsResults = await checkBookPackages(username, language_code, bookIDList, setResultValue, checkingOptions);\r\n            // console.log(\"checkBookPackage() returned\", typeof rawCBPsResults); //, JSON.stringify(rawCBPsResults));\r\n\r\n            // Add some extra fields to our rawCBPsResults object in case we need this information again later\r\n            rawCBPsResults.checkType = 'BookPackages';\r\n            rawCBPsResults.username = username;\r\n            rawCBPsResults.language_code = language_code;\r\n            rawCBPsResults.bookIDs = bookIDs;\r\n            rawCBPsResults.bookIDList = bookIDList;\r\n            rawCBPsResults.checkedOptions = checkingOptions;\r\n\r\n            console.log(\"Here with CBPs rawCBPsResults\", typeof rawCBPsResults);\r\n            // Now do our final handling of the result -- we have some options available\r\n            let processOptions = { // Uncomment any of these to test them\r\n                // 'maximumSimilarMessages': 3, // default is 2\r\n                // 'errorPriorityLevel': 800, // default is 700\r\n                // 'cutoffPriorityLevel': 100, // default is 0\r\n                // 'sortBy': 'ByPriority', // default is 'AsFound'\r\n                // 'ignorePriorityNumberList': [123, 202], // default is []\r\n            };\r\n            // Or this allows the parameters to be specified as a BookPackagesCheck property\r\n            if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = ourParseInt(props.maximumSimilarMessages);\r\n            if (props.errorPriorityLevel) processOptions.errorPriorityLevel = ourParseInt(props.errorPriorityLevel);\r\n            if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);\r\n            if (props.sortBy) processOptions.sortBy = props.sortBy;\r\n            // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;\r\n\r\n            let displayType = 'ErrorsWarnings'; // default\r\n            if (props.displayType) displayType = props.displayType;\r\n\r\n            if (displayType === 'ErrorsWarnings') {\r\n            const processedResults = processNoticesToErrorsWarnings(rawCBPsResults, processOptions);\r\n            console.log(`BookPackagesCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n  numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n            // console.log(\"Here now in rendering bit!\");\r\n\r\n            function renderSummary() {\r\n                return (<>\r\n                <p>Checked <b>{username} {language_code} {bookIDList.join(', ')}</b> (from <i>{branch === undefined ? 'DEFAULT' : branch}</i> branches)</p>\r\n                <p>&nbsp;&nbsp;&nbsp;&nbsp;Successfully checked {processedResults.checkedFileCount.toLocaleString()} file{processedResults.checkedFileCount==1?'':'s'} from {username} {processedResults.checkedRepoNames.join(', ')}\r\n                <br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;including {processedResults.checkedFilenameExtensions.length} file type{processedResults.checkedFilenameExtensions.size === 1 ? '' : 's'}: {processedResults.checkedFilenameExtensions.join(', ')}.</p>\r\n                <p>&nbsp;&nbsp;&nbsp;&nbsp;Finished in <RenderElapsedTime elapsedTime={processedResults.elapsedTime} />.</p>\r\n                </>);\r\n            }\r\n\r\n            if (processedResults.errorList.length || processedResults.warningList.length)\r\n                setResultValue(<>\r\n                    <p>{renderSummary()}\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</p>\r\n                    <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                </>);\r\n            else // no errors or warnings\r\n                setResultValue(<>\r\n                    <p>{renderSummary()}\r\n                    {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</p>\r\n                    <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                </>);\r\n            } else if (displayType === 'SevereMediumLow') {\r\n                const processedResults = processNoticesToSevereMediumLow(rawCBPsResults, processOptions);\r\n//                 console.log(`FileCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n//   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, `numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()}`, `numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n                if (processedResults.severeList.length || processedResults.mediumList.length || processedResults.lowList.length)\r\n                    setResultValue(<>\r\n                        <p>Checked <b>{username} {language_code} {bookIDList.join(', ')}</b> (from <i>{branch === undefined ? 'DEFAULT' : branch}</i> branches)\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</p>\r\n                        <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                    </>);\r\n                else // no severe, medium, or low notices\r\n                    setResultValue(<>\r\n                        <p>Checked <b>{username} {language_code} {bookIDList.join(', ')}</b> (from <i>{branch === undefined ? 'DEFAULT' : branch}</i> branches)\r\n                        {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</p>\r\n                        <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                    </>);\r\n            } else if (displayType === 'SingleList') {\r\n                const processedResults = processNoticesToSingleList(rawCBPsResults, processOptions);\r\n                console.log(`FileCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n  numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, `numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()}`, `numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n                if (processedResults.warningList.length)\r\n                    setResultValue(<>\r\n                        <p>Checked <b>{username} {language_code} {bookIDList.join(', ')}</b> (from <i>{branch === undefined ? 'DEFAULT' : branch}</i> branches)\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</p>\r\n                        <RenderSuccessesWarningsGradient results={processedResults} />\r\n                    </>);\r\n                else // no warnings\r\n                    setResultValue(<>\r\n                        <p>Checked <b>{username} {language_code} {bookIDList.join(', ')}</b> (from <i>{branch === undefined ? 'DEFAULT' : branch}</i> branches)\r\n                        {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</p>\r\n                        <RenderSuccessesWarningsGradient results={processedResults} />\r\n                    </>);\r\n            } else setResultValue(<b style={{ color: 'red' }}>Invalid displayType='{displayType}'</b>)\r\n\r\n            // console.log(\"Finished rendering bit.\");\r\n        })(); // end of async part in unnamedFunction\r\n    }, []); // end of useEffect part\r\n\r\n    // {/* <div className={classes.root}> */}\r\n    return (\r\n        <div className=\"Fred\">\r\n        {result}\r\n        </div>\r\n    );\r\n}\r\n\r\n// BookPackagesCheck.propTypes = {\r\n//   /** @ignore */\r\n//   username: PropTypes.object.isRequired,\r\n//   /** @ignore */\r\n//   language_code: PropTypes.object.isRequired,\r\n//   bookIDs: PropTypes.object.isRequired,\r\n//   props: PropTypes.object,\r\n// };\r\n\r\nconst styles = theme => ({\r\n  root: {\r\n  },\r\n});\r\n\r\n//export default withStyles(styles)(BookPackagesCheck);\r\n","import React, { useState, useEffect } from 'react';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport checkRepo from './checkRepo';\r\nimport { processNoticesToErrorsWarnings, processNoticesToSevereMediumLow, processNoticesToSingleList } from '../../core/notice-processing-functions';\r\nimport { RenderSuccessesErrorsWarnings, RenderSuccessesSevereMediumLow, RenderSuccessesWarningsGradient, RenderElapsedTime } from '../RenderProcessedResults';\r\nimport { ourParseInt, consoleLogObject, displayPropertyNames } from '../../core/utilities';\r\n\r\n\r\nconst CHECKER_VERSION_STRING = '0.1.2';\r\n\r\n\r\nfunction RepoCheck(/*username, languageCode,*/ props) {\r\n    /*\r\n    Check an entire repository\r\n\r\n    Loads the zip file and the repo tree\r\n        and then checks all the individual files\r\n    */\r\n\r\n    // console.log(`I'm here in RepoCheck v${CHECKER_VERSION_STRING}`);\r\n    // consoleLogObject(\"props\", props);\r\n    // consoleLogObject(\"props.classes\", props.classes);\r\n\r\n    const username = props.username;\r\n    // console.log(`username='${username}'`);\r\n    const repoName = props.repoName;\r\n    // console.log(`repoName='${repoName}'`);\r\n    let branch = props.branch;\r\n    // console.log(`branch='${branch}'`);\r\n    if (branch === undefined) branch = 'master';\r\n\r\n    const languageCode = repoName.split('_', 1)[0];\r\n    // console.log(`languageCode='${languageCode}'`);\r\n\r\n    const checkingOptions = { // Uncomment any of these to test them\r\n        // 'extractLength': 25,\r\n    };\r\n    // Or this allows the parameters to be specified as a RepoCheck property\r\n    if (props.extractLength) checkingOptions.extractLength = ourParseInt(props.extractLength);\r\n\r\n    const [result, setResultValue] = useState(\"Waiting-checkRepo\");\r\n    useEffect(() => {\r\n        // Use an IIFE (Immediately Invoked Function Expression)\r\n        //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174\r\n        (async () => {\r\n            // console.log(\"Started unnamedFunction()\");\r\n\r\n            // Display our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Waiting for check results for <b>{repoName}</b> repo…</p>);\r\n\r\n            // Put all this in a try/catch block coz otherwise it's difficult to debug/view errors\r\n            try {\r\n                let rawCRResults = {};\r\n                try {\r\n                    rawCRResults = await checkRepo(username, repoName, branch, \"\", setResultValue, checkingOptions);\r\n                } catch (checkRepoError) {\r\n                    rawCRResults = { successList: [], noticeList: [] };\r\n                    rawCRResults.noticeList.push({priority:999, message:\"checkRepo function FAILED\", characterIndex:-1, extract:checkRepoError, location:repoName});\r\n                }\r\n                // console.log(\"checkRepo() returned\", typeof rawCRResults); //, JSON.stringify(rawCRResults));\r\n\r\n                // Add some extra fields to our rawCRResults object in case we need this information again later\r\n                rawCRResults.checkType = 'Repo';\r\n                rawCRResults.username = username;\r\n                rawCRResults.languageCode = languageCode;\r\n                rawCRResults.checkedOptions = checkingOptions;\r\n\r\n                // console.log(\"Here with RC rawCRResults\", typeof rawCRResults);\r\n                // Now do our final handling of the result -- we have some options available\r\n                let processOptions = { // Uncomment any of these to test them\r\n                    // 'maximumSimilarMessages': 3, // default is 2\r\n                    // 'errorPriorityLevel': 800, // default is 700\r\n                    // 'cutoffPriorityLevel': 100, // default is 0\r\n                    // 'sortBy': 'ByPriority', // default is 'AsFound'\r\n                    // 'ignorePriorityNumberList': [123, 202], // default is []\r\n                };\r\n                // Or this allows the parameters to be specified as a RepoCheck property\r\n                if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = ourParseInt(props.maximumSimilarMessages);\r\n                if (props.errorPriorityLevel) processOptions.errorPriorityLevel = ourParseInt(props.errorPriorityLevel);\r\n                if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);\r\n                if (props.sortBy) processOptions.sortBy = props.sortBy;\r\n                // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;\r\n\r\n                let displayType = 'ErrorsWarnings'; // default\r\n                if (props.displayType) displayType = props.displayType;\r\n\r\n                function renderSummary(processedResults) {\r\n                    return (<>\r\n                        <p>Checked <b>{username} {repoName}</b> (from <i>{branch === undefined ? 'DEFAULT' : branch}</i> branch)</p>\r\n                        <p>&nbsp;&nbsp;&nbsp;&nbsp;Successfully checked {processedResults.checkedFileCount.toLocaleString()} file{processedResults.checkedFileCount === 1 ? '' : 's'} from {repoName}: {processedResults.checkedFilenames.join(', ')}\r\n                            <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;including {processedResults.checkedFilenameExtensions.length} file type{processedResults.checkedFilenameExtensions.size === 1 ? '' : 's'}: {processedResults.checkedFilenameExtensions.join(', ')}.</p>\r\n                        <p>&nbsp;&nbsp;&nbsp;&nbsp;Finished in <RenderElapsedTime elapsedTime={processedResults.elapsedTime} />.</p>\r\n                    </>);\r\n                }\r\n\r\n                if (displayType === 'ErrorsWarnings') {\r\n                    const processedResults = processNoticesToErrorsWarnings(rawCRResults, processOptions);\r\n                    // displayPropertyNames(\"RC processedResults\", processedResults);\r\n                    //             console.log(`RepoCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n                    //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, \"numSuppressedErrors=\" + processedResults.numSuppressedErrors.toLocaleString(), \"numSuppressedWarnings=\" + processedResults.numSuppressedWarnings.toLocaleString());\r\n\r\n                    // console.log(\"Here now in rendering bit!\");\r\n\r\n                    if (processedResults.errorList.length || processedResults.warningList.length)\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n                            <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                        </>);\r\n                    else // no errors or warnings\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n                            <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                        </>);\r\n                } else if (displayType === 'SevereMediumLow') {\r\n                    const processedResults = processNoticesToSevereMediumLow(rawCRResults, processOptions);\r\n                    //             console.log(`RepoCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n                    //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, \"numSuppressedErrors=\" + processedResults.numSuppressedErrors.toLocaleString(), \"numSuppressedWarnings=\" + processedResults.numSuppressedWarnings.toLocaleString());\r\n\r\n                    if (processedResults.severeList.length || processedResults.mediumList.length || processedResults.lowList.length)\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n                            <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                        </>);\r\n                    else // no severe, medium, or low notices\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n                            <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                        </>);\r\n                } else if (displayType === 'SingleList') {\r\n                    const processedResults = processNoticesToSingleList(rawCRResults, processOptions);\r\n                    //             console.log(`RepoCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n                    //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, \"numSuppressedErrors=\" + processedResults.numSuppressedErrors.toLocaleString(), \"numSuppressedWarnings=\" + processedResults.numSuppressedWarnings.toLocaleString());\r\n\r\n                    if (processedResults.warningList.length)\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n                            <RenderSuccessesWarningsGradient results={processedResults} />\r\n                        </>);\r\n                    else // no warnings\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n                            <RenderSuccessesWarningsGradient results={processedResults} />\r\n                        </>);\r\n                } else setResultValue(<b style={{ color: 'red' }}>Invalid displayType='{displayType}'</b>)\r\n\r\n                // console.log(\"Finished rendering bit.\");\r\n            } catch (rcError) {\r\n                console.log(`RepoCheck main code block got error: ${rcError.message}`);\r\n                setResultValue(<>\r\n                    <p style={{ color: 'Red' }}>RepoCheck main code block got error: <b>{rcError.message}</b></p>\r\n                </>);\r\n            }\r\n        })(); // end of async part in unnamedFunction\r\n    }, []); // end of useEffect part\r\n\r\n    // {/* <div className={classes.root}> */}\r\n    return (\r\n        <div className=\"Fred\">\r\n            {result}\r\n        </div>\r\n    );\r\n}\r\n\r\n// RepoCheck.propTypes = {\r\n//   /** @ignore */\r\n//   username: PropTypes.object.isRequired,\r\n//   /** @ignore */\r\n//   languageCode: PropTypes.object.isRequired,\r\n//   props: PropTypes.object,\r\n// };\r\n\r\nconst styles = theme => ({\r\n    root: {\r\n    },\r\n});\r\n\r\nexport default withStyles(styles)(RepoCheck);\r\n","import * as books from './books/books';\r\nimport doBasicTextChecks from './basic-text-check';\r\nimport checkMarkdownText from './markdown-text-check';\r\nimport checkTAReference from './ta-reference-check';\r\nimport checkTNLinks from './tn-links-check';\r\nimport checkOriginalLanguageQuote from './quote-check';\r\n\r\n\r\nconst TABLE_LINE_VALIDATOR_VERSION = '0.1.0';\r\n\r\nconst NUM_EXPECTED_TSV_FIELDS = 7; // so expects 6 tabs per line\r\nconst EXPECTED_TN_HEADING_LINE = 'Reference\\tID\\tTags\\tSupportReference\\tQuote\\tOccurrence\\tAnnotation';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nasync function checkAnnotationTSVDataRow(annotationType, line, bookID, C, V, givenRowLocation, optionalCheckingOptions) {\r\n    /**\r\n    * @description - Checks one TSV data row of translation notes (TN)\r\n    * @param {String} annotationType - TN, TQ, TWL, SN, or SQ -- allows more specific checks\r\n    * @param {String} line - the TSV line to be checked\r\n    * @param {String} bookID - 3-character UPPERCASE USFM book identifier or 'OBS'\r\n    * @param {String} C - chapter number or (for OBS) story number string\r\n    * @param {String} V - verse number or (for OBS) frame number string\r\n    * @param {String} givenRowLocation - description of where the line is located\r\n    * @param {Object} optionalCheckingOptions - may contain extractLength parameter\r\n    * @return {Object} - containing noticeList\r\n    */\r\n    /* This function is only for checking one data row\r\n          and the function doesn't assume that it has any previous context.\r\n\r\n        annotationType is a 2-3 character string, being\r\n            TN, TQ, TWL, SN, or SQ\r\n                being translation or study notes, questions, or word-links.\r\n\r\n        bookID is a three-character UPPERCASE USFM book identifier or 'OBS'\r\n            so C and V are usually chapter number and verse number\r\n                but can be story number and frame number for OBS.\r\n\r\n        It's designed to be able to quickly show errors for a single row being displayed/edited.\r\n\r\n        Returns an object containing the noticeList.\r\n    */\r\n    // console.log(`checkAnnotationTSVDataRow(${annotationType}, ${line}, ${bookID} ${C}:${V} ${givenRowLocation}, ${JSON.stringify(optionalCheckingOptions)})…`);\r\n    console.assert(annotationType !== undefined, \"checkAnnotationTSVDataRow: 'annotationType' parameter should be defined\");\r\n    console.assert(typeof annotationType === 'string', `checkAnnotationTSVDataRow: 'annotationType' parameter should be a string not a '${typeof annotationType}'`);\r\n    console.assert(annotationType.length === 2 || annotationType.length === 3, `checkAnnotationTSVDataRow: 'annotationType' parameter should be 2-3 characters long not ${annotationType.length}`);\r\n    console.assert(line !== undefined, \"checkAnnotationTSVDataRow: 'line' parameter should be defined\");\r\n    console.assert(typeof line === 'string', `checkAnnotationTSVDataRow: 'line' parameter should be a string not a '${typeof line}'`);\r\n    console.assert(bookID !== undefined, \"checkAnnotationTSVDataRow: 'bookID' parameter should be defined\");\r\n    console.assert(typeof bookID === 'string', `checkAnnotationTSVDataRow: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n    console.assert(bookID.length === 3, `checkAnnotationTSVDataRow: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n    console.assert(books.isValidBookID(bookID), `checkAnnotationTSVDataRow: '${bookID}' is not a valid USFM book identifier`);\r\n    // console.assert(C !== undefined, \"checkAnnotationTSVDataRow: 'C' parameter should be defined\");\r\n    if (C) console.assert(typeof C === 'string', `checkAnnotationTSVDataRow: 'C' parameter should be a string not a '${typeof C}'`);\r\n    // console.assert(V !== undefined, \"checkAnnotationTSVDataRow: 'V' parameter should be defined\");\r\n    if (V) console.assert(typeof V === 'string', `checkAnnotationTSVDataRow: 'V' parameter should be a string not a '${typeof V}'`);\r\n    console.assert(givenRowLocation !== undefined, \"checkAnnotationTSVDataRow: 'givenRowLocation' parameter should be defined\");\r\n    console.assert(typeof givenRowLocation === 'string', `checkAnnotationTSVDataRow: 'givenRowLocation' parameter should be a string not a '${typeof givenRowLocation}'`);\r\n\r\n    let ourRowLocation = givenRowLocation;\r\n    if (ourRowLocation && ourRowLocation[0] !== ' ') ourRowLocation = ` ${ourRowLocation}`;\r\n\r\n    let adrResult = { noticeList: [] };\r\n\r\n    function addNotice6to9({priority, message, lineNumber, characterIndex, extract, location}) {\r\n        /**\r\n        * @description - adds a new notice entry, adding bookID,C,V to the given fields\r\n        * @param {Number} priority - notice priority from 1 (lowest) to 999 (highest)\r\n        * @param {String} message - the text of the notice message\r\n        * @param {Number} lineNumber - one-based line number (or -1 if unknown)\r\n        * @param {Number} characterIndex - zero-based index of where the issue occurs in the line (or -1 if unknown)\r\n        * @param {String} extract - short extract from the line centred on the problem (if available)\r\n        * @param {String} location - description of where the issue is located\r\n        */\r\n        // console.log(`Annotation TSV Row Notice: (priority=${priority}) ${message}, ${characterIndex}, ${extract}, ${location}`);\r\n        console.assert(priority !== undefined, \"cATSVrow addNotice6to9: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cATSVrow addNotice6to9: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cATSVrow addNotice6to9: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cATSVrow addNotice6to9: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(lineNumber !== undefined, \"cATSVrow addNotice6to9: 'lineNumber' parameter should be defined\");\r\n        // console.assert(typeof lineNumber === 'number', `cATSVrow addNotice6to9: 'lineNumber' parameter should be a number not a '${typeof lineNumber}': ${lineNumber}`);\r\n        // console.assert(characterIndex !== undefined, \"cATSVrow addNotice6to9: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cATSVrow addNotice6to9: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cATSVrow addNotice6to9: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cATSVrow addNotice6to9: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cATSVrow addNotice6to9: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cATSVrow addNotice6to9: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        // Also uses the given bookID,C,V, parameters from the main function call\r\n        adrResult.noticeList.push({ priority, message, bookID, C, V, lineNumber, characterIndex, extract, location });\r\n    }\r\n\r\n    function doOurMarkdownTextChecks(fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given markdown field and processes the returned results\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} rowLocation - description of where the line is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does markdown checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n\r\n        // We don't currently use the allowedLinks parameter\r\n\r\n        // console.log(`cATSVrow doOurBasicTextChecks(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${rowLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cATSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cATSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"cATSVrow doOurMarkdownTextChecks: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cATSVrow doOurMarkdownTextChecks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"cATSVrow doOurMarkdownTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n        const cmtResultObject = checkMarkdownText(fieldName, fieldText, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(cmtResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of cmtResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL doOurMarkdownTextChecks notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of doOurMarkdownTextChecks function\r\n\r\n    function doOurBasicTextChecks(fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} rowLocation - description of where the line is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`cATSVrow doOurBasicTextChecks(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${rowLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cATSVrow doOurBasicTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cATSVrow doOurBasicTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"cATSVrow doOurBasicTextChecks: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cATSVrow doOurBasicTextChecks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"cATSVrow doOurBasicTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n        const dbtcResultObject = doBasicTextChecks(fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(dbtcResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of dbtcResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL doOurBasicTextChecks notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of doOurBasicTextChecks function\r\n\r\n    async function ourCheckTAReference(fieldName, taLinkText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the TA reference can be found\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`cATSVrow ourCheckTAReference(${fieldName}, (${taLinkText.length}) '${taLinkText}', ${rowLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cATSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cATSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(taLinkText !== undefined, \"cATSVrow ourCheckTAReference: 'taLinkText' parameter should be defined\");\r\n        console.assert(typeof taLinkText === 'string', `cATSVrow ourCheckTAReference: 'taLinkText' parameter should be a string not a '${typeof taLinkText}'`);\r\n\r\n        const coqResultObject = await checkTAReference(fieldName, taLinkText, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTAReference notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of ourCheckTAReference function\r\n\r\n    async function ourCheckTNOriginalLanguageQuote(fieldName, fieldText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the Hebrew/Greek quote can be found in the original texts\r\n\r\n        // Uses the bookID,C,V values from the main function call\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`cATSVrow ourCheckTNOriginalLanguageQuote(${fieldName}, (${fieldText.length}) '${fieldText}', ${rowLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cATSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cATSVrow doOurMarkdownTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"cATSVrow ourCheckTNOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cATSVrow ourCheckTNOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n\r\n        const coqResultObject = await checkOriginalLanguageQuote(fieldName, fieldText, bookID, C, V, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTNOriginalLanguageQuote notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of ourCheckTNOriginalLanguageQuote function\r\n\r\n    async function ourCheckTNLinks(fieldName, taLinkText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the TA reference can be found\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`cATSVrow ourCheckTNLinks(${fieldName}, (${taLinkText.length}) '${taLinkText}', ${rowLocation}, …)`);\r\n        console.assert(fieldName !== undefined, \"cATSVrow ourCheckTNLinks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cATSVrow ourCheckTNLinks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(taLinkText !== undefined, \"cATSVrow ourCheckTNLinks: 'taLinkText' parameter should be defined\");\r\n        console.assert(typeof taLinkText === 'string', `cATSVrow ourCheckTNLinks: 'taLinkText' parameter should be a string not a '${typeof taLinkText}'`);\r\n\r\n        const coqResultObject = await checkTNLinks(bookID, fieldName, taLinkText, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTNLinks notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({priority:noticeEntry.priority, message:noticeEntry.message, characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract, location:noticeEntry.location});\r\n        }\r\n    }\r\n    // end of ourCheckTNLinks function\r\n\r\n\r\n    // Main code for checkAnnotationTSVDataRow function\r\n    if (line === EXPECTED_TN_HEADING_LINE) // Assume it must be ok\r\n        return adrResult; // We can't detect if it's in the wrong place\r\n\r\n    addNotice6to9({priority:998, message:\"checkAnnotationTSVDataRow() is still a placeholder -- not completed yet\", location:ourRowLocation});\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (tlcELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    let numChaptersThisBook;\r\n    if (bookID != 'OBS') {\r\n        const lowercaseBookID = bookID.toLowerCase();\r\n        try {\r\n            numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n        } catch (tlcNCerror) {\r\n            addNotice6to9({priority:979, message:\"Invalid book identifier passed to checkAnnotationTSVDataRow\", location:` '${bookID}' in first parameter: ${tlcNCerror}`});\r\n        }\r\n    }\r\n    const haveBibleBookID = numChaptersThisBook !== undefined;\r\n\r\n    // let inString;\r\n    // if (rowLocation) inString = rowLocation;\r\n    // else inString = ` in line ${rowNumber.toLocaleString()}`;\r\n\r\n    let fields = line.split('\\t');\r\n    if (fields.length === NUM_EXPECTED_TSV_FIELDS) {\r\n        const [reference, fieldID, tags, supportReference, quote, occurrence, annotation] = fields;\r\n        // let withString = ` with '${fieldID}'${inString}`;\r\n        // let CV_withString = ` ${C}:${V}${withString}`;\r\n        // let atString = ` at ${B} ${C}:${V} (${fieldID})${inString}`;\r\n\r\n        // Check the fields one-by-one\r\n        const [C, V] = reference.split(':')\r\n        let numVersesThisChapter, haveGoodChapterNumber;\r\n        if (C.length) {\r\n            if (C === 'front') { }\r\n            else if (/^\\d+$/.test(C)) {\r\n                let intC = Number(C);\r\n                if (intC === 0) {\r\n                    addNotice6to9({priority:824, message:`Invalid zero chapter number`, extract:C, location:ourRowLocation});\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n                // TODO: Does this next section need rewriting (see verse check below)???\r\n                else if (intC > numChaptersThisBook) {\r\n                    addNotice6to9({priority:823, message:`Invalid large chapter number`, extract:C, location:ourRowLocation});\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n                try {\r\n                    numVersesThisChapter = books.versesInChapter(lowercaseBookID, intC);\r\n                    haveGoodChapterNumber = true;\r\n                } catch (tlcNVerror) {\r\n                    if (!haveBibleBookID)\r\n                        // addNotice6to9({priority:500, message:\"Invalid chapter number\", rowLocation);\r\n                        // else\r\n                        addNotice6to9({priority:822, message:\"Unable to check chapter number\", location:` '${C}'${ourRowLocation}`});\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n            }\r\n            else\r\n                addNotice6to9({priority:821, message:\"Bad chapter number\", location:` '${C}' with${ourRowLocation}`});\r\n        }\r\n        else\r\n            addNotice6to9({priority:820, message:\"Missing chapter number\", location:` ?:${V}${ourRowLocation}`});\r\n\r\n        if (V.length) {\r\n            if (V === 'intro') { }\r\n            else if (/^\\d+$/.test(V)) {\r\n                let intV = Number(V);\r\n                if (intV === 0)\r\n                    addNotice6to9({priority:814, message:`Invalid zero '${V}' verse number`, location:ourRowLocation});\r\n                else {\r\n                    if (haveGoodChapterNumber) {\r\n                        if (intV > numVersesThisChapter)\r\n                            addNotice6to9({priority:813, message:`Invalid large '${V}' verse number`, location:` for chapter ${C}${ourRowLocation}`});\r\n                    } else\r\n                        addNotice6to9({priority:812, message:\"Unable to check verse number\", location:` '${V}'${ourRowLocation}`});\r\n                }\r\n            }\r\n            else\r\n                addNotice6to9({priority:811, message:\"Bad verse number\", location:` '${V}'${ourRowLocation}`});\r\n        }\r\n        else\r\n            addNotice6to9({priority:810, message:\"Missing verse number\", location:` after ${C}:?${ourRowLocation}`});\r\n\r\n        if (!fieldID.length)\r\n            addNotice6to9({priority:779, message:\"Missing ID field\", location:ourRowLocation});\r\n        else {\r\n            if (fieldID.length !== 4)\r\n                addNotice6to9({priority:778, message:\"ID should be exactly 4 characters\", location:` (not ${fieldID.length})${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(fieldID[0]) < 0)\r\n                addNotice6to9({priority:176, message:\"ID should start with a lowercase letter or digit\", characterIndex:0, location:` (not '${fieldID[0]}')${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(fieldID[3]) < 0)\r\n                addNotice6to9({priority:175, message:\"ID should end with a lowercase letter or digit\", characterIndex:3, location:` (not '${fieldID[3]}')${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(fieldID[1]) < 0)\r\n                addNotice6to9({priority:174, message:\"ID characters should only be lowercase letters, digits, or hypen\", characterIndex:1, location:` (not '${fieldID[1]}')${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(fieldID[2]) < 0)\r\n                addNotice6to9({priority:173, message:\"ID characters should only be lowercase letters, digits, or hypen\", characterIndex:2, location:` (not '${fieldID[2]}')${ourRowLocation}`});\r\n        }\r\n\r\n        if (tags.length)\r\n            ;\r\n\r\n        if (supportReference.length) { // need to check UTN against UTA\r\n            doOurBasicTextChecks('SupportReference', supportReference, true, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTAReference('SupportReference', supportReference, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        // else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n        //     addNotice6to9({priority:277, message:\"Missing SupportReference field\", location:ourRowLocation});\r\n\r\n        if (quote.length) { // need to check UTN against UHB and UGNT\r\n            doOurBasicTextChecks('Quote', quote, false, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTNOriginalLanguageQuote('Quote', quote, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n            if (V !== 'intro')\r\n                addNotice6to9({priority:276, message:\"Missing Quote field\", location:ourRowLocation});\r\n\r\n        if (occurrence.length) { // This should usually be a digit\r\n            if (occurrence === '0') { // zero means that it doesn't occur\r\n                if (quote.length)\r\n                    addNotice6to9({priority:550, message:\"Invalid zero occurrence field when we have an original quote\", location:ourRowLocation});\r\n                // if (V !== 'intro')\r\n                //     addNotice6to9({priority:500, message:\"Invalid zero occurrence field\", -1, \"\", rowLocation);\r\n            }\r\n            else if (occurrence === '-1') // TODO check the special conditions when this can occur???\r\n                ;\r\n            else if ('12345'.indexOf(occurrence) < 0) // it's not one of these integers\r\n                addNotice6to9({priority:792, message:`Invalid '${occurrence}' occurrence field`, location:ourRowLocation});\r\n        }\r\n\r\n        if (annotation.length) {\r\n            doOurMarkdownTextChecks('Annotation', annotation, true, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTNLinks('Annotation', annotation, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n            addNotice6to9({priority:274, message:`Missing ${annotationType} Annotation field`, location:ourRowLocation});\r\n\r\n    } else\r\n        addNotice6to9({priority:861, message:`Found wrong number of TSV fields (expected ${NUM_EXPECTED_TSV_FIELDS})`, extract:`Found ${fields.length} field${fields.length === 1 ? '' : 's'}`, location:ourRowLocation});\r\n\r\n    // console.log(`  checkAnnotationTSVDataRow returning with ${drResult.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkAnnotationTSVDataRow result is\", JSON.stringify(drResult));\r\n    return adrResult; // object with noticeList only\r\n}\r\n// end of checkAnnotationTSVDataRow function\r\n\r\nexport default checkAnnotationTSVDataRow;\r\n","import * as books from './books/books';\r\nimport checkAnnotationTSVDataRow from './annotation-row-check';\r\n\r\n\r\nconst TABLE_TEXT_VALIDATOR_VERSION = '0.2.1';\r\n\r\nconst NUM_EXPECTED_TN_FIELDS = 7; // so expects 6 tabs per line\r\nconst EXPECTED_TN_HEADING_LINE = 'Reference\\tID\\tTags\\tSupportReference\\tQuote\\tOccurrence\\tAnnotation';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nasync function CheckAnnotationRows(annotationType, bookID, tableText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all rows.\r\n\r\n      It also has the advantage of being able to compare one row with the previous one.\r\n\r\n     bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`CheckAnnotationRows(${annotationType}, ${bookID}, ${tableText.length}, ${location},${JSON.stringify(optionalCheckingOptions)})…`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    // if (bookID) ourLocation = ` in ${bookID}${ourLocation}`;\r\n\r\n    const result = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`CheckAnnotationRows success: ${successString}`);\r\n        result.successList.push(successString);\r\n    }\r\n    function addNoticeCV8({priority,message, C,V, lineNumber, characterIndex, extract, location}) {\r\n        // console.log(`CheckAnnotationRows notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"ATSV addNoticeCV8: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `TSV addNoticeCV8: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"ATSV addNoticeCV8: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `TSV addNoticeCV8: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(C !== undefined, \"ATSV addNoticeCV8: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `TSV addNoticeCV8: 'C' parameter should be a string not a '${typeof C}': ${C}`);\r\n        // console.assert(V !== undefined, \"ATSV addNoticeCV8: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `TSV addNoticeCV8: 'V' parameter should be a string not a '${typeof V}': ${V}`);\r\n        // console.assert(characterIndex !== undefined, \"ATSV addNoticeCV8: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `TSV addNoticeCV8: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"ATSV addNoticeCV8: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `TSV addNoticeCV8: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"ATSV addNoticeCV8: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `TSV addNoticeCV8: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        result.noticeList.push({priority,message, bookID,C,V, lineNumber, characterIndex, extract, location});\r\n    }\r\n\r\n\r\n    addNoticeCV8({priority:997, message:\"CheckAnnotationRows() is still a placeholder -- not completed yet\", location:ourLocation});\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (ttcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    let lowercaseBookID = bookID.toLowerCase();\r\n    let numChaptersThisBook = 0;\r\n    try {\r\n        numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n    }\r\n    catch {\r\n        if (!books.isValidBookID(bookID)) // must not be in FRT, BAK, etc.\r\n            addNoticeCV8({priority:747, message:\"Bad function call: should be given a valid book abbreviation\", extract:bookID, location:` (not '${bookID}')${ourLocation}`});\r\n    }\r\n\r\n    let lines = tableText.split('\\n');\r\n    // console.log(`  '${location}' has ${lines.length.toLocaleString()} total lines (expecting ${NUM_EXPECTED_TN_FIELDS} fields in each line)`);\r\n\r\n    let lastC = '', lastV = '';\r\n    let fieldID_list = [];\r\n    let numVersesThisChapter = 0;\r\n    for (let n= 0; n < lines.length; n++) {\r\n        // console.log(`CheckAnnotationRows checking line ${n}: ${JSON.stringify(lines[n])}`);\r\n        let inString = ` in line ${(n + 1).toLocaleString()}${ourLocation}`;\r\n        if (n === 0) {\r\n            if (lines[0] === EXPECTED_TN_HEADING_LINE)\r\n                addSuccessMessage(`Checked TSV header ${ourLocation}`);\r\n            else\r\n                addNoticeCV8({priority:746, message:\"Bad TSV header\", lineNumber:n+1, location:`${ourLocation}: '${lines[0]}'`});\r\n        }\r\n        else // not the header\r\n        {\r\n            let fields = lines[n].split('\\t');\r\n            if (fields.length === NUM_EXPECTED_TN_FIELDS) {\r\n                const [reference, fieldID, tags, _support_reference, _quote, _occurrence, _annotation] = fields;\r\n                const [C, V] = reference.split(':')\r\n                const withString = ` with ID '${fieldID}'${inString}`;\r\n                // let CV_withString = ` ${C}:${V}${withString}`;\r\n                // let atString = ` at ${Annotation} ${C}:${V} (${fieldID})${inString}`;\r\n\r\n                // Use the row check to do most basic checks\r\n                const firstResult = await checkAnnotationTSVDataRow(annotationType, lines[n], bookID,C,V, withString, optionalCheckingOptions);\r\n                // Choose only ONE of the following\r\n                // This is the fast way of append the results from this field\r\n                result.noticeList = result.noticeList.concat(firstResult.noticeList);\r\n                // If we need to put everything through addNoticeCV8, e.g., for debugging or filtering\r\n                //  process results line by line\r\n                // for (const noticeEntry of firstResult.noticeList)\r\n                //     addNoticeCV8({priority:noticeEntry.priority, noticeEntry[1], noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7]);\r\n\r\n                // So here we only have to check against the previous and next fields for out-of-order problems\r\n                if (C) {\r\n                    if (C === 'front') { }\r\n                    else if (/^\\d+$/.test(C)) {\r\n                        let intC = Number(C);\r\n                        if (C !== lastC)\r\n                            numVersesThisChapter = books.versesInChapter(lowercaseBookID, intC);\r\n                        if (intC === 0)\r\n                            addNoticeCV8({priority:551, C,V, message:`Invalid zero '${C}' chapter number`, lineNumber:n+1, location:withString});\r\n                        if (intC > numChaptersThisBook)\r\n                            addNoticeCV8({priority:737, C,V, message:`Invalid large '${C}' chapter number`, lineNumber:n+1, location:withString});\r\n                        if (/^\\d+$/.test(lastC)) {\r\n                            let lastintC = Number(lastC);\r\n                            if (intC < lastintC)\r\n                                addNoticeCV8({priority:736, C,V, message:`Receding '${C}' chapter number after '${lastC}'`, lineNumber:n+1, location:withString});\r\n                            else if (intC > lastintC + 1)\r\n                                addNoticeCV8({priority:735, C,V, message:`Advancing '${C}' chapter number after '${lastC}'`, lineNumber:n+1, location:withString});\r\n                        }\r\n                    }\r\n                    else\r\n                        addNoticeCV8({priority:734, C,V, message:\"Bad chapter number\", lineNumber:n+1, location:withString});\r\n                }\r\n                else\r\n                    addNoticeCV8({priority:739, C,V, message:\"Missing chapter number\", lineNumber:n+1, location:` after ${lastC}:${V}${withString}`});\r\n\r\n                if (V) {\r\n                    if (V === 'intro') { }\r\n                    else if (/^\\d+$/.test(V)) {\r\n                        let intV = Number(V);\r\n                        if (intV === 0)\r\n                            addNoticeCV8({priority:552, C,V, message:`Invalid zero '${V}' verse number`, lineNumber:n+1, location:withString});\r\n                        if (intV > numVersesThisChapter)\r\n                            addNoticeCV8({priority:734, C,V, message:`Invalid large '${V}' verse number for chapter ${C}`, lineNumber:n+1, location:withString});\r\n                        if (/^\\d+$/.test(lastV)) {\r\n                            let lastintV = Number(lastV);\r\n                            if (intV < lastintV)\r\n                                addNoticeCV8({priority:733, C,V, message:`Receding '${V}' verse number after '${lastV}'`, lineNumber:n+1, location:withString});\r\n                            // else if (intV > lastintV + 1)\r\n                            //   addNoticeCV8({priority:556, `Skipped verses with '${V}' verse number after '${lastV}'${withString}`);\r\n                        }\r\n                    }\r\n                    else\r\n                        addNoticeCV8({priority:738, C,V, message:\"Bad verse number\", lineNumber:n+1, location:withString});\r\n\r\n                }\r\n                else\r\n                    addNoticeCV8({priority:790, C,V, message:\"Missing verse number\", lineNumber:n+1, location:` after ${C}:${lastV}${withString}`});\r\n\r\n                if (fieldID) {\r\n                    if (fieldID_list.indexOf(fieldID) >= 0)\r\n                        addNoticeCV8({priority:729, C,V, message:`Duplicate '${fieldID}' ID`, lineNumber:n+1, location:withString});\r\n                } else\r\n                    addNoticeCV8({priority:730, C,V, message:\"Missing ID\", lineNumber:n+1, location:withString});\r\n\r\n\r\n                if (C !== lastC || V !== lastV) {\r\n                    fieldID_list = []; // ID's only need to be unique within each verse\r\n                    lastC = C; lastV = V;\r\n                }\r\n\r\n            } else\r\n                // if (n === lines.length - 1) // it's the last line\r\n                //     console.log(`  Line ${n}: Has ${fields.length} field(s) instead of ${NUM_EXPECTED_TN_FIELDS}: ${EXPECTED_TN_HEADING_LINE.replace(/\\t/g, ', ')}`);\r\n                // else\r\n                if (n !== lines.length - 1) // it's not the last line\r\n                    addNoticeCV8({priority:988, message:`Wrong number of tabbed fields (expected ${NUM_EXPECTED_TN_FIELDS})`, extract:`Found ${fields.length} field${fields.length===1?'':'s'}`, lineNumber:n+1, location:inString});\r\n        }\r\n    }\r\n    addSuccessMessage(`Checked all ${(lines.length - 1).toLocaleString()} data line${lines.length - 1 === 1 ? '' : 's'}${ourLocation}.`);\r\n    if (result.noticeList)\r\n        addSuccessMessage(`CheckAnnotationRows v${TABLE_TEXT_VALIDATOR_VERSION} finished with ${result.noticeList.length?result.noticeList.length.toLocaleString():\"zero\"} notice${result.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by CheckAnnotationRows v${TABLE_TEXT_VALIDATOR_VERSION}`)\r\n    // console.log(`  CheckAnnotationRows returning with ${result.successList.length.toLocaleString()} success(es), ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"CheckAnnotationRows result is\", JSON.stringify(result));\r\n    return result;\r\n}\r\n// end of CheckAnnotationRows function\r\n\r\n\r\nexport default CheckAnnotationRows;\r\n","import React from 'react';\r\nimport * as books from './books';\r\nimport checkUSFMText from './usfm-text-check';\r\nimport checkMarkdownText from './markdown-text-check';\r\nimport checkPlainText from './plain-text-check';\r\nimport checkYAMLText from './yaml-text-check';\r\nimport checkManifestText from './manifest-text-check';\r\nimport checkTN_TSVText from './tn-table-text-check';\r\n\r\nimport { fetchRepositoryZipFile, getFilelistFromZip, getFile } from './getApi';\r\n\r\n/*\r\n    checkRepo \r\n*/\r\nconst CHECK_REPO_VERSION_STRING = '0.4.1';\r\nasync function checkRepo(username, repoName, branch, givenLocation, setResultValue, checkingOptions) {\r\n    /*\r\n    checkRepo DOES NOT USE the Gitea React Toolkit to fetch the repo\r\n\r\n    It returns an object containing:\r\n        successList: an array of strings to tell the use exactly what has been checked\r\n        noticeList: an array of 9 (i.e., with extra bookOrFileCode parameter at end) notice components\r\n    */\r\n    // console.log(`I'm here in checkRepo v${CHECK_REPO_VERSION_STRING}\r\n    //   with ${username}, ${repoName}, ${branch}, ${givenLocation}, ${JSON.stringify(checkingOptions)}`);\r\n    const startTime = new Date();\r\n\r\n    if (branch === undefined) branch = 'master'; // Ideally we should ask what the default branch is\r\n\r\n    let checkRepoResult = {\r\n        successList: [], noticeList: [],\r\n        checkedFileCount: 0, checkedFilenames: [], checkedFilenameExtensions: []\r\n    };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // Adds the message to the result that we will later return\r\n        // console.log(`checkRepo success: ${successString}`);\r\n        checkRepoResult.successList.push(successString);\r\n    }\r\n    function addNotice10({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location, extra}) {\r\n        // Adds the notices to the result that we will later return\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // Note that bookID,C,V might all be empty strings (as some repos don't have BCV)\r\n        // console.log(`checkRepo addNotice10: (priority=${priority}) ${bookID} ${C}:${V} ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cR addNotice10: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cR addNotice10: 'priority' parameter should be a number not a '${typeof priority}'`);\r\n        console.assert(message !== undefined, \"cR addNotice10: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cR addNotice10: 'message' parameter should be a string not a '${typeof message}'`);\r\n        // console.assert(bookID !== undefined, \"cR addNotice10: 'bookID' parameter should be defined\");\r\n        if (bookID) {\r\n            console.assert(typeof bookID === 'string', `cR addNotice10: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n            console.assert(bookID.length === 3, `cR addNotice10: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n            console.assert(books.isOptionalValidBookID(bookID), `cR addNotice10: '${bookID}' is not a valid USFM book identifier`);\r\n        }\r\n        // console.assert(C !== undefined, \"cR addNotice10: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `cR addNotice10: 'C' parameter should be a string not a '${typeof C}'`);\r\n        // console.assert(V !== undefined, \"cR addNotice10: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `cR addNotice10: 'V' parameter should be a string not a '${typeof V}'`);\r\n        // console.assert(characterIndex !== undefined, \"cR addNotice10: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cR addNotice10: 'characterIndex' parameter should be a number not a '${typeof characterIndex}'`);\r\n        // console.assert(extract !== undefined, \"cR addNotice10: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cR addNotice10: 'extract' parameter should be a string not a '${typeof extract}'`);\r\n        console.assert(location !== undefined, \"cR addNotice10: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cR addNotice10: 'location' parameter should be a string not a '${typeof location}'`);\r\n        console.assert(extra !== undefined, \"cR addNotice10: 'extra' parameter should be defined\");\r\n        console.assert(typeof extra === 'string', `cR addNotice10: 'extra' parameter should be a string not a '${typeof extra}'`);\r\n        checkRepoResult.noticeList.push({ priority,message, bookID, C, V, lineNumber, characterIndex, extract, location, extra });\r\n    }\r\n\r\n\r\n    async function doOurCheckFile(bookOrFileCode, cfBookID, filename, file_content, fileLocation, optionalCheckingOptions) {\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n        // console.log(`checkRepo doOurCheckFile(${filename})…`);\r\n\r\n        // Updates the global list of notices\r\n        console.assert(bookOrFileCode !== undefined, \"doOurCheckFile: 'bookOrFileCode' parameter should be defined\");\r\n        console.assert(typeof bookOrFileCode === 'string', `doOurCheckFile: 'bookOrFileCode' parameter should be a string not a '${typeof bookOrFileCode}'`);\r\n        console.assert(cfBookID !== undefined, \"doOurCheckFile: 'cfBookID' parameter should be defined\");\r\n        console.assert(typeof cfBookID === 'string', `doOurCheckFile: 'cfBookID' parameter should be a string not a '${typeof cfBookID}'`);\r\n        console.assert(filename !== undefined, \"doOurCheckFile: 'filename' parameter should be defined\");\r\n        console.assert(typeof filename === 'string', `doOurCheckFile: 'filename' parameter should be a string not a '${typeof filename}'`);\r\n        console.assert(file_content !== undefined, \"doOurCheckFile: 'file_content' parameter should be defined\");\r\n        console.assert(typeof file_content === 'string', `doOurCheckFile: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n        console.assert(fileLocation !== undefined, \"doOurCheckFile: 'fileLocation' parameter should be defined\");\r\n        console.assert(typeof fileLocation === 'string', `doOurCheckFile: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n        const resultObject = await checkFile(filename, file_content, fileLocation, optionalCheckingOptions);\r\n        // console.log(\"checkFile() returned\", resultObject.successList.length, \"success message(s) and\", resultObject.noticeList.length, \"notice(s)\");\r\n        // for (const successEntry of resultObject.successList)\r\n        //     console.log(\"  \", successEntry);\r\n\r\n        // Process results line by line,  appending the bookOrFileCode as an extra field as we go\r\n        for (const noticeEntry of resultObject.noticeList)\r\n            // We add the bookOrFileCode as an extra value\r\n            addNotice10({priority:noticeEntry.priority, message:noticeEntry.message,\r\n                bookID:noticeEntry.bookID, C:noticeEntry.C, V:noticeEntry.V, lineNumber:noticeEntry.lineNumber,\r\n                characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract,\r\n                location:noticeEntry.location, extra:bookOrFileCode});\r\n    }\r\n    // end of doOurCheckFile function\r\n\r\n\r\n    // Main code for checkRepo()\r\n    // Put all this in a try/catch block coz otherwise it's difficult to debug/view errors\r\n    try {\r\n        let ourLocation = givenLocation;\r\n        if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n        // if (ourLocation.indexOf(username) < 0)\r\n        ourLocation = ` in ${username} ${repoName} ${givenLocation}`\r\n\r\n        // Update our \"waiting\" message\r\n        setResultValue(<p style={{ color: 'magenta' }}>Fetching zipped files from <b>{username}/{repoName}</b> repository…</p>);\r\n\r\n        // Let's fetch the zipped repo since it should be much more efficient than individual fetches\r\n        // console.log(`checkRepo: fetch zip file for ${repoName}…`);\r\n        const zipFetchSucceeded = await fetchRepositoryZipFile({ username, repository: repoName, branch });\r\n        if (!zipFetchSucceeded)\r\n            console.log(`checkRepo: misfetched zip file for repo with ${zipFetchSucceeded}`);\r\n        if (!zipFetchSucceeded) return checkRepoResult;\r\n        // Note: We don't stop for failure coz the code below will still work (fetching each file individually)\r\n\r\n        // Now we need to fetch the list of files from the repo\r\n        setResultValue(<p style={{ color: 'magenta' }}>Preprocessing file list from <b>{username}/{repoName}</b> repository…</p>);\r\n        // const pathList = await getFilelistFromFetchedTreemaps(username, repoName, branch);\r\n        const pathList = await getFilelistFromZip({ username, repository: repoName, branch });\r\n        // console.log(`Got pathlist (${pathList.length}) = ${pathList}`);\r\n\r\n        // So now we want to work through checking all the files in this repo\r\n        const countString = `${pathList.length.toLocaleString()} file${pathList.length === 1 ? '' : 's'}`;\r\n        let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0;\r\n        for (const thisFilepath of pathList) {\r\n            // console.log(`At top of loop: thisFilepath='${thisFilepath}'`);\r\n\r\n            // Update our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Waiting for check results for <b>{username}/{repoName}</b> repo: checked {checkedFileCount.toLocaleString()}/{countString}…</p>);\r\n\r\n            const thisFilename = thisFilepath.split('/').pop();\r\n            // console.log(`thisFilename=${thisFilename}`);\r\n            const thisFilenameExtension = thisFilename.split('.').pop();\r\n            // console.log(`thisFilenameExtension=${thisFilenameExtension}`);\r\n\r\n            // Default to the main filename without the extensions\r\n            let bookOrFileCode = thisFilename.substring(0, thisFilename.length - thisFilenameExtension.length - 1);\r\n            let ourBookID = \"\";\r\n            if (thisFilenameExtension === 'usfm') {\r\n                // const filenameMain = thisFilename.substring(0, thisFilename.length - 5); // drop .usfm\r\n                // console.log(`Have USFM filenameMain=${bookOrFileCode}`);\r\n                const bookID = bookOrFileCode.substring(bookOrFileCode.length - 3);\r\n                // console.log(`Have USFM bookcode=${bookID}`);\r\n                console.assert(books.isValidBookID(bookID), `checkRepo: '${bookID}' is not a valid USFM book identifier`);\r\n                bookOrFileCode = bookID;\r\n                ourBookID = bookID;\r\n            }\r\n            else if (thisFilenameExtension === 'tsv') {\r\n                // const filenameMain = thisFilename.substring(0, thisFilename.length - 4); // drop .tsv\r\n                // console.log(`Have TSV filenameMain=${bookOrFileCode}`);\r\n                const bookID = bookOrFileCode.substring(bookOrFileCode.length - 3);\r\n                // console.log(`Have TSV bookcode=${bookID}`);\r\n                console.assert(books.isValidBookID(bookID), `checkRepo: '${bookID}' is not a valid USFM book identifier`);\r\n                bookOrFileCode = bookID;\r\n                ourBookID = bookID;\r\n            }\r\n\r\n            // console.log(\"checkRepo: Try to load\", username, repoName, thisFilepath, branch);\r\n            let repoFileContent;\r\n            try {\r\n                repoFileContent = await getFile({ username, repository: repoName, path: thisFilepath, branch });\r\n                // console.log(\"Fetched file_content for\", repoName, thisPath, typeof repoFileContent, repoFileContent.length);\r\n            } catch (cRgfError) {\r\n                console.log(\"Failed to load\", username, repoName, thisFilepath, branch, `${cRgfError}`);\r\n                addNotice10({priority:996, bookID:ourBookID, message:\"Failed to load\", location:`${generalLocation} ${thisFilepath}: ${cRgfError}`, repoCode});\r\n                return;\r\n            }\r\n            if (repoFileContent) {\r\n                // console.log(`checkRepo checking ${thisFilename}`);\r\n                await doOurCheckFile(bookOrFileCode, ourBookID, thisFilename, repoFileContent, ourLocation, checkingOptions);\r\n                checkedFileCount += 1;\r\n                checkedFilenames.push(thisFilename);\r\n                checkedFilenameExtensions.add(thisFilenameExtension);\r\n                totalCheckedSize += repoFileContent.length;\r\n                // console.log(`checkRepo checked ${thisFilename}`);\r\n                if (thisFilenameExtension !== 'md') // There's often far, far too many of these\r\n                    addSuccessMessage(`Checked ${bookOrFileCode.toUpperCase()} file: ${thisFilename}`);\r\n            }\r\n        }\r\n\r\n        // Check that we processed a license and a manifest\r\n        if (checkedFilenames.indexOf('LICENSE.md') < 0)\r\n            addNotice10({priority:946, message:\"Missing LICENSE.md\", location:ourLocation, extra:'LICENSE'});\r\n        if (checkedFilenames.indexOf('manifest.yaml') < 0)\r\n            addNotice10({priority:947, message:\"Missing manifest.yaml\", location:ourLocation, extra:'MANIFEST'});\r\n\r\n        // Add some extra fields to our checkRepoResult object\r\n        //  in case we need this information again later\r\n        checkRepoResult.checkedFileCount = checkedFileCount;\r\n        checkRepoResult.checkedFilenames = checkedFilenames;\r\n        checkRepoResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n        checkRepoResult.checkedFilesizes = totalCheckedSize;\r\n        checkRepoResult.checkedRepoNames = [`${username}/${repoName}`];\r\n        // checkRepoResult.checkedOptions = checkingOptions; // This is done at the caller level\r\n\r\n        addSuccessMessage(`Checked ${username} repo: ${repoName}`);\r\n        // console.log(`checkRepo() is returning ${checkRepoResult.successList.length.toLocaleString()} success message(s) and ${checkRepoResult.noticeList.length.toLocaleString()} notice(s)`);\r\n    } catch (cRerror) {\r\n        console.log(`checkRepo main code block got error: ${cRerror.message}`);\r\n        setResultValue(<>\r\n            <p style={{ color: 'Red' }}>checkRepo main code block got error: <b>{cRerror.message}</b></p>\r\n        </>);\r\n\r\n    }\r\n    checkRepoResult.elapsedTime = (new Date() - startTime) / 1000; // seconds\r\n    return checkRepoResult;\r\n};\r\n// end of checkRepo()\r\n\r\n\r\n/*\r\n    checkFile\r\n*/\r\nconst CHECK_FILE_VERSION_STRING = '0.1.5';\r\nasync function checkFile(filename, fileContent, givenLocation, checkingOptions) {\r\n    // Determine the file type from the filename extension\r\n    //  and return the results of checking that kind of file\r\n    //     console.log(`I'm here in checkFile v${CHECK_FILE_VERSION_STRING}\r\n    //   with ${filename}, ${fileContent.length} chars, ${givenLocation}, ${JSON.stringify(checkingOptions)}`);\r\n    const startTime = new Date();\r\n\r\n    let ourCFLocation = givenLocation;\r\n    if (ourCFLocation[0] !== ' ') ourCFLocation = ' ' + ourCFLocation;\r\n\r\n    let checkFileResult;\r\n    if (filename.toLowerCase().endsWith('.tsv')) {\r\n        const filenameMain = filename.substring(0, filename.length - 4); // drop .tsv\r\n        // console.log(`Have TSV filenameMain=${filenameMain}`);\r\n        const bookID = filenameMain.substring(filenameMain.length - 3);\r\n        // console.log(`Have TSV bookcode=${bookID}`);\r\n        console.assert(books.isValidBookID(bookID), `checkFile: '${bookID}' is not a valid USFM book identifier`);\r\n        checkFileResult = await checkTN_TSVText(bookID, fileContent, ourCFLocation, checkingOptions);\r\n    }\r\n    else if (filename.toLowerCase().endsWith('.usfm')) {\r\n        const filenameMain = filename.substring(0, filename.length - 5); // drop .usfm\r\n        // console.log(`Have USFM filenameMain=${filenameMain}`);\r\n        const bookID = filenameMain.substring(filenameMain.length - 3);\r\n        // console.log(`Have USFM bookcode=${bookID}`);\r\n        console.assert(books.isValidBookID(bookID), `checkFile: '${bookID}' is not a valid USFM book identifier`);\r\n        checkFileResult = checkUSFMText(bookID, filename, fileContent, ourCFLocation, checkingOptions);\r\n    } else if (filename.toLowerCase().endsWith('.sfm')) {\r\n        const filenameMain = filename.substring(0, filename.length - 4); // drop .sfm\r\n        console.log(`Have SFM filenameMain=${filenameMain}`);\r\n        const bookID = filenameMain.substring(2, 5);\r\n        console.log(`Have SFM bookcode=${bookID}`);\r\n        console.assert(books.isValidBookID(bookID), `checkFile: '${bookID}' is not a valid USFM book identifier`);\r\n        checkFileResult = checkUSFMText(bookID, filename, fileContent, ourCFLocation, checkingOptions);\r\n    } else if (filename.toLowerCase().endsWith('.md'))\r\n        checkFileResult = checkMarkdownText(filename, fileContent, ourCFLocation, checkingOptions);\r\n    else if (filename.toLowerCase().endsWith('.txt'))\r\n        checkFileResult = checkPlainText(filename, fileContent, ourCFLocation, checkingOptions);\r\n    else if (filename.toLowerCase() === 'manifest.yaml')\r\n        checkFileResult = checkManifestText(filename, fileContent, ourCFLocation, checkingOptions);\r\n    else if (filename.toLowerCase().endsWith('.yaml'))\r\n        checkFileResult = checkYAMLText(filename, fileContent, ourCFLocation, checkingOptions);\r\n    else {\r\n        checkFileResult = checkPlainText(filename, fileContent, ourCFLocation, checkingOptions);\r\n        checkFileResult.noticeList.unshift([995, \"File extension is not recognized, so treated as plain text.\", -1, '', filename]);\r\n    }\r\n    // console.log(`checkFile got initial results with ${checkFileResult.successList.length} success message(s) and ${checkFileResult.noticeList.length} notice(s)`);\r\n\r\n    // Add some extra fields to our checkFileResult object\r\n    //  in case we need this information again later\r\n    checkFileResult.checkedFileCount = 1;\r\n    checkFileResult.checkedFilename = filename;\r\n    checkFileResult.checkedFilesize = fileContent.length;\r\n    checkFileResult.checkedOptions = checkingOptions;\r\n\r\n    checkFileResult.elapsedTime = (new Date() - startTime) / 1000; // seconds\r\n    return checkFileResult;\r\n};\r\n// end of checkFile()\r\n\r\n/*\r\n    checkTQbook\r\n*/\r\nconst CHECKER_VERSION_STRING = '0.3.1';\r\nasync function checkTQbook(username, repoName, branch, bookID, checkingOptions) {\r\n    const repoCode = 'TQ';\r\n    const generalLocation = `in ${username} ${repoName} (${branch})`;\r\n\r\n    const ctqResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkBookPackage success: ${successString}`);\r\n        ctqResult.successList.push(successString);\r\n    }\r\n\r\n    function addNotice10({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location, extra}) {\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // console.log(`checkTQbook addNotice10: (priority=${priority}) ${bookID} ${C}:${V} ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cTQ addNotice10: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cTQ addNotice10: 'priority' parameter should be a number not a '${typeof priority}'`);\r\n        console.assert(message !== undefined, \"cTQ addNotice10: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cTQ addNotice10: 'message' parameter should be a string not a '${typeof message}'`);\r\n        console.assert(bookID !== undefined, \"cTQ addNotice10: 'bookID' parameter should be defined\");\r\n        console.assert(typeof bookID === 'string', `cTQ addNotice10: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n        console.assert(bookID.length === 3, `cTQ addNotice10: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n        console.assert(books.isValidBookID(bookID), `cTQ addNotice10: '${bookID}' is not a valid USFM book identifier`);\r\n        // console.assert(C !== undefined, \"cTQ addNotice10: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `cTQ addNotice10: 'C' parameter should be a string not a '${typeof C}'`);\r\n        // console.assert(V !== undefined, \"cTQ addNotice10: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `cTQ addNotice10: 'V' parameter should be a string not a '${typeof V}'`);\r\n        // console.assert(characterIndex !== undefined, \"cTQ addNotice10: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cTQ addNotice10: 'characterIndex' parameter should be a number not a '${typeof characterIndex}'`);\r\n        // console.assert(extract !== undefined, \"cTQ addNotice10: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cTQ addNotice10: 'extract' parameter should be a string not a '${typeof extract}'`);\r\n        console.assert(location !== undefined, \"cTQ addNotice10: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cTQ addNotice10: 'location' parameter should be a string not a '${typeof location}'`);\r\n        console.assert(extra !== undefined, \"cTQ addNotice10: 'extra' parameter should be defined\");\r\n        console.assert(typeof extra === 'string', `cTQ addNotice10: 'extra' parameter should be a string not a '${typeof extra}'`);\r\n        ctqResult.noticeList.push({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location, extra});\r\n    }\r\n\r\n\r\n    async function doOurCheckFile(repoCode, bookID, C, V, cfFilename, file_content, fileLocation, optionalCheckingOptions) {\r\n        // console.log(`checkBookPackage doOurCheckFile(${cfFilename})`);\r\n\r\n        // Updates the global list of notices\r\n        console.assert(repoCode !== undefined, \"cTQ doOurCheckFile: 'repoCode' parameter should be defined\");\r\n        console.assert(typeof repoCode === 'string', `cTQ doOurCheckFile: 'repoCode' parameter should be a string not a '${typeof repoCode}'`);\r\n        console.assert(cfFilename !== undefined, \"cTQ doOurCheckFile: 'cfFilename' parameter should be defined\");\r\n        console.assert(typeof cfFilename === 'string', `cTQ doOurCheckFile: 'cfFilename' parameter should be a string not a '${typeof cfFilename}'`);\r\n        console.assert(file_content !== undefined, \"cTQ doOurCheckFile: 'file_content' parameter should be defined\");\r\n        console.assert(typeof file_content === 'string', `cTQ doOurCheckFile: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n        console.assert(fileLocation !== undefined, \"cTQ doOurCheckFile: 'fileLocation' parameter should be defined\");\r\n        console.assert(typeof fileLocation === 'string', `cTQ doOurCheckFile: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n        const cfResultObject = await checkFile(cfFilename, file_content, fileLocation, optionalCheckingOptions);\r\n        // console.log(\"checkFile() returned\", cfResultObject.successList.length, \"success message(s) and\", cfResultObject.noticeList.length, \"notice(s)\");\r\n        // for (const successEntry of cfResultObject.successList) console.log(\"  doOurCheckFile:\", successEntry);\r\n\r\n        // Process results line by line,  appending the repoCode as an extra field as we go\r\n        for (const noticeEntry of cfResultObject.noticeList) {\r\n            // noticeEntry is an array of eight fields: 1=priority, 2=bookID, 3=C, 4=V, 5=msg, 6=characterIndex, 7=extract, 8=location\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `cTQ doOurCheckFile notice length=${Object.keys(noticeEntry).length}`);\r\n            // We add the repoCode as an extra value\r\n            addNotice10({priority:noticeEntry.priority, message:noticeEntry.message,\r\n                bookID, C, V, lineNumber:noticeEntry.lineNumber,\r\n                characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract,\r\n                location:noticeEntry.location, extra:repoCode});\r\n        }\r\n    }\r\n    // end of doOurCheckFile function\r\n\r\n\r\n    // Main code for checkTQbook\r\n    // We need to find an check all the markdown folders/files for this book\r\n    let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(['md']), totalCheckedSize = 0;\r\n    const pathList = await getFilelistFromZip({ username, repository: repoName, branch, optionalPrefix: `${bookID.toLowerCase()}/` });\r\n    // console.log(`  Got ${pathList.length} pathList entries`)\r\n    for (const thisPath of pathList) {\r\n        // console.log(\"checkTQbook: Try to load\", username, repoName, thisPath, branch);\r\n\r\n        console.assert(thisPath.endsWith('.md'), `Expected ${thisPath} to end with .md`);\r\n        const pathParts = thisPath.slice(0,-3).split('/');\r\n        const C = pathParts[pathParts.length-2].replace(/^0+(?=\\d)/, '');\r\n        const V = pathParts[pathParts.length-1].replace(/^0+(?=\\d)/, '');\r\n\r\n        let tqFileContent;\r\n        try {\r\n            tqFileContent = await getFile({ username, repository: repoName, path: thisPath, branch });\r\n            // console.log(\"Fetched file_content for\", repoName, thisPath, typeof tqFileContent, tqFileContent.length);\r\n            checkedFilenames.push(thisPath);\r\n            totalCheckedSize += tqFileContent.length;\r\n        } catch (tQerror) {\r\n            console.log(\"checkTQbook failed to load\", username, repoName, thisPath, branch, tQerror + '');\r\n            addNotice10({priority:996, bookID, C, V, message:\"Failed to load\", location:`${generalLocation} ${thisPath}: ${tQerror}`, extra:repoCode});\r\n            continue;\r\n        }\r\n\r\n        // We use the generalLocation here (does not include repo name)\r\n        //  so that we can adjust the returned strings ourselves\r\n        await doOurCheckFile(repoCode, bookID, C, V, thisPath, tqFileContent, generalLocation, checkingOptions); // Adds the notices to checkBookPackageResult\r\n        checkedFileCount += 1;\r\n        // addSuccessMessage(`Checked ${repoCode.toUpperCase()} file: ${thisPath}`);\r\n    }\r\n    addSuccessMessage(`Checked ${checkedFileCount.toLocaleString()} ${repoCode.toUpperCase()} file${checkedFileCount === 1 ? '' : 's'}`);\r\n\r\n    ctqResult.checkedFileCount = checkedFileCount;\r\n    ctqResult.checkedFilenames = checkedFilenames;\r\n    ctqResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n    ctqResult.checkedFilesizes = totalCheckedSize;\r\n    // console.log(`  checkTQbook returning ${JSON.stringify(ctqResult)}`);\r\n    return ctqResult;\r\n}\r\n// end of checkTQbook function\r\n\r\n/*\r\n    checkBookPackage\r\n*/\r\nexport async function checkBookPackage(username, language_code, bookID, setResultValue, checkingOptions) {\r\n    /*\r\n    Note that bookID here can also be the 'OBS' pseudo bookID.\r\n    */\r\n    //     console.log(`I'm here in checkBookPackage v${CHECKER_VERSION_STRING}\r\n    //   with ${username}, ${language_code}, ${bookID}, ${JSON.stringify(checkingOptions)}`);\r\n    const startTime = new Date();\r\n\r\n    let checkBookPackageResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkBookPackage success: ${successString}`);\r\n        checkBookPackageResult.successList.push(successString);\r\n    }\r\n\r\n    function addNotice10({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location, extra}) {\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // console.log(`checkBookPackage addNotice10: (priority=${priority}) ${bookID} ${C}:${V} ${message}${characterIndex > 0 ? ` (at character ${characterIndex}${1})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cBP addNotice10: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cBP addNotice10: 'priority' parameter should be a number not a '${typeof priority}'`);\r\n        console.assert(message !== undefined, \"cBP addNotice10: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cBP addNotice10: 'message' parameter should be a string not a '${typeof message}'`);\r\n        // console.assert(bookID !== undefined, \"cBP addNotice10: 'bookID' parameter should be defined\");\r\n        if (bookID) {\r\n            console.assert(typeof bookID === 'string', `cBP addNotice10: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n            console.assert(bookID.length === 3, `cBP addNotice10: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n            console.assert(books.isValidBookID(bookID), `cBP addNotice10: '${bookID}' is not a valid USFM book identifier`);\r\n        }\r\n        // console.assert(C !== undefined, \"cBP addNotice10: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `cBP addNotice10: 'C' parameter should be a string not a '${typeof C}'`);\r\n        // console.assert(V !== undefined, \"cBP addNotice10: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `cBP addNotice10: 'V' parameter should be a string not a '${typeof V}'`);\r\n        // console.assert(characterIndex !== undefined, \"cBP addNotice10: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cBP addNotice10: 'characterIndex' parameter should be a number not a '${typeof characterIndex}'`);\r\n        // console.assert(extract !== undefined, \"cBP addNotice10: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cBP addNotice10: 'extract' parameter should be a string not a '${typeof extract}'`);\r\n        console.assert(location !== undefined, \"cBP addNotice10: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cBP addNotice10: 'location' parameter should be a string not a '${typeof location}'`);\r\n        console.assert(extra !== undefined, \"cBP addNotice10: 'extra' parameter should be defined\");\r\n        console.assert(typeof extra === 'string', `cBP addNotice10: 'extra' parameter should be a string not a '${typeof extra}'`);\r\n        checkBookPackageResult.noticeList.push({priority, message, bookID, C, V, lineNumber, characterIndex, extract, location, extra});\r\n    }\r\n\r\n\r\n    async function doOurCheckFile(repoCode, cfFilename, file_content, fileLocation, optionalCheckingOptions) {\r\n        // console.log(`checkBookPackage doOurCheckFile(${cfFilename})`);\r\n\r\n        // Updates the global list of notices\r\n        console.assert(repoCode !== undefined, \"cBP doOurCheckFile: 'repoCode' parameter should be defined\");\r\n        console.assert(typeof repoCode === 'string', `cBP doOurCheckFile: 'repoCode' parameter should be a string not a '${typeof repoCode}'`);\r\n        console.assert(cfFilename !== undefined, \"cBP doOurCheckFile: 'cfFilename' parameter should be defined\");\r\n        console.assert(typeof cfFilename === 'string', `cBP doOurCheckFile: 'cfFilename' parameter should be a string not a '${typeof cfFilename}'`);\r\n        console.assert(file_content !== undefined, \"cBP doOurCheckFile: 'file_content' parameter should be defined\");\r\n        console.assert(typeof file_content === 'string', `cBP doOurCheckFile: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n        console.assert(fileLocation !== undefined, \"cBP doOurCheckFile: 'fileLocation' parameter should be defined\");\r\n        console.assert(typeof fileLocation === 'string', `cBP doOurCheckFile: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n        const cfResultObject = await checkFile(cfFilename, file_content, fileLocation, optionalCheckingOptions);\r\n        // console.log(\"checkFile() returned\", cfResultObject.successList.length, \"success message(s) and\", cfResultObject.noticeList.length, \"notice(s)\");\r\n        // for (const successEntry of cfResultObject.successList) console.log(\"  doOurCheckFile:\", successEntry);\r\n\r\n        // Process results line by line,  appending the repoCode as an extra field as we go\r\n        for (const noticeEntry of cfResultObject.noticeList)\r\n            // noticeEntry is an object\r\n            // We add the repoCode as an extra value\r\n            addNotice10({priority:noticeEntry.priority, message:noticeEntry.message,\r\n                bookID:noticeEntry.bookID, C:noticeEntry.C, V:noticeEntry.V, lineNumber:noticeEntry.lineNumber,\r\n                characterIndex:noticeEntry.characterIndex, extract:noticeEntry.extract,\r\n                location:noticeEntry.location, extra:repoCode});\r\n    }\r\n    // end of doOurCheckFile function\r\n\r\n    // Main code for checkBookPackage()\r\n    const generalLocation = ` ${language_code} ${bookID} book package from ${username}`;\r\n\r\n    // No point in passing the branch through as a parameter\r\n    //  coz if it's not 'master', it's unlikely to be common for all the repos\r\n    const branch = 'master'\r\n\r\n    if (bookID === 'OBS') {\r\n        // We use the generalLocation here (does not include repo name)\r\n        //  so that we can adjust the returned strings ourselves\r\n        // console.log(\"Calling OBS checkRepo()…\");\r\n        checkBookPackageResult = await checkRepo(username, `${language_code}_obs`, branch, generalLocation, setResultValue, checkingOptions); // Adds the notices to checkBookPackageResult\r\n        // console.log(`checkRepo() returned ${checkBookPackageResult.successList.length} success message(s) and ${checkBookPackageResult.noticeList.length} notice(s)`);\r\n        // console.log(\"crResultObject keys\", JSON.stringify(Object.keys(checkBookPackageResult)));\r\n\r\n        // Concat is faster if we don't need to process each notice individually\r\n        // checkBookPackageResult.successList = checkBookPackageResult.successList.concat(crResultObject.successList);\r\n        // checkBookPackageResult.noticeList = checkBookPackageResult.noticeList.concat(crResultObject.noticeList);\r\n        // checkedFileCount += crResultObject.fileCount;\r\n        addSuccessMessage(`Checked ${language_code} OBS repo from ${username}`);\r\n    } else {\r\n        // We also need to know the number for USFM books\r\n        let bookNumberAndName, whichTestament;\r\n        try {\r\n            bookNumberAndName = books.usfmNumberName(bookID);\r\n            whichTestament = books.testament(bookID); // returns 'old' or 'new'\r\n        } catch (bNNerror) {\r\n            if (books.isValidBookID(bookID)) // must be in FRT, BAK, etc.\r\n                whichTestament = 'other'\r\n            else {\r\n                addNotice10({priority:900, message:\"Bad function call: should be given a valid book abbreviation\", extract:bookID, location:` (not '${bookID}')${location}`});\r\n                return checkBookPackageResult;\r\n            }\r\n        }\r\n        // console.log(`bookNumberAndName='${bookNumberAndName}' (${whichTestament} testament)`);\r\n\r\n        // So now we want to work through checking this one specified Bible book in various repos:\r\n        //  UHB/UGNT, ULT, UST, TN, TQ\r\n        let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0, checkedRepoNames = [];\r\n        for (const repoCode of [(whichTestament === 'old' ? 'UHB' : 'UGNT'), 'ULT', 'UST', 'TN', 'TQ']) {\r\n            // console.log(`Let's try ${repoCode} (${language_code} ${bookID} from ${username})`);\r\n            const repoLocation = ` in ${repoCode.toUpperCase()}${generalLocation}`;\r\n\r\n            let repo_language_code = language_code;\r\n            if (repoCode === 'UHB') repo_language_code = 'hbo';\r\n            else if (repoCode === 'UGNT') repo_language_code = 'el-x-koine';\r\n            const repoName = `${repo_language_code}_${repoCode.toLowerCase()}`;\r\n\r\n            const fullRepoName = username + '/' + repoName;\r\n            // console.log(\"Let's try1\", bookID, \"from\", fullRepoName);\r\n\r\n            let filename;\r\n            if (repoCode === 'UHB' || repoCode === 'UGNT' || repoCode === 'ULT' || repoCode === 'UST') {\r\n                filename = `${bookNumberAndName}.usfm`;\r\n                checkedFilenameExtensions.add('usfm');\r\n            }\r\n            else if (repoCode === 'TN') {\r\n                filename = `${language_code}_tn_${bookNumberAndName}.tsv`;\r\n                checkedFilenameExtensions.add('tsv');\r\n            }\r\n\r\n            if (repoCode === 'TQ') {\r\n                // This resource might eventually be converted to TSV tables\r\n                const tqResultObject = await checkTQbook(username, repoName, branch, bookID, checkingOptions);\r\n                checkBookPackageResult.successList = checkBookPackageResult.successList.concat(tqResultObject.successList);\r\n                checkBookPackageResult.noticeList = checkBookPackageResult.noticeList.concat(tqResultObject.noticeList);\r\n                checkedFilenames = checkedFilenames.concat(tqResultObject.checkedFilenames);\r\n                checkedFilenameExtensions = new Set([...checkedFilenameExtensions, ...tqResultObject.checkedFilenameExtensions]);\r\n                checkedFileCount += tqResultObject.checkedFileCount;\r\n                totalCheckedSize += tqResultObject.totalCheckedSize;\r\n                checkedRepoNames.push(repoCode);\r\n            } else { // For repos other than TQ, we only have one file to check\r\n                // console.log(\"Try to load\", username, repoName, filename, branch);\r\n                let repoFileContent;\r\n                try {\r\n                    repoFileContent = await getFile({ username, repository: repoName, path: filename, branch });\r\n                    // console.log(\"Fetched file_content for\", repoName, filename, typeof repoFileContent, repoFileContent.length);\r\n                    checkedFilenames.push(filename);\r\n                    totalCheckedSize += repoFileContent.length;\r\n                    checkedRepoNames.push(repoCode);\r\n                } catch (cBPgfError) {\r\n                    console.log(\"ERROR: Failed to load\", username, repoName, filename, branch, cBPgfError + '');\r\n                    addNotice10({priority:996, message:\"Failed to load\", bookID, location:`${generalLocation} ${filename}: ${cBPgfError}`, extra:repoCode});\r\n                    continue;\r\n                }\r\n\r\n                // We use the generalLocation here (does not include repo name)\r\n                //  so that we can adjust the returned strings ourselves\r\n                await doOurCheckFile(repoCode, filename, repoFileContent, generalLocation, checkingOptions); // Adds the notices to checkBookPackageResult\r\n                checkedFileCount += 1;\r\n                addSuccessMessage(`Checked ${repoCode.toUpperCase()} file: ${filename}`);\r\n            }\r\n\r\n            // Update our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Waiting for check results for {username} {language_code} <b>{bookID}</b> book package: checked <b>{checkedRepoNames.length.toLocaleString()}</b>/5 repos…</p>);\r\n        }\r\n\r\n        // Add some extra fields to our checkFileResult object\r\n        //  in case we need this information again later\r\n        checkBookPackageResult.checkedFileCount = checkedFileCount;\r\n        checkBookPackageResult.checkedFilenames = checkedFilenames;\r\n        checkBookPackageResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n        checkBookPackageResult.checkedFilesizes = totalCheckedSize;\r\n        checkBookPackageResult.checkedRepoNames = checkedRepoNames;\r\n        // checkBookPackageResult.checkedOptions = checkingOptions; // This is done at the caller level\r\n    }\r\n\r\n    checkBookPackageResult.elapsedTime = (new Date() - startTime) / 1000; // seconds\r\n    console.log(\"checkBookPackageResult:\",checkBookPackageResult)\r\n    return checkBookPackageResult;\r\n};\r\n// end of checkBookPackage()\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport {checkBookPackage} from 'uw-content-validation';\r\nimport { processNoticesToErrorsWarnings, processNoticesToSevereMediumLow, processNoticesToSingleList } from 'uw-content-validation';\r\nimport { RenderSuccessesErrorsWarnings, RenderSuccessesSevereMediumLow, RenderSuccessesWarningsGradient, RenderElapsedTime } from 'uw-content-validation';\r\n\r\n//const CHECKER_VERSION_STRING = '0.1.2';\r\nfunction BookPackageContentValidator({bookID}) {\r\n    const username = 'unfoldingword';\r\n    const language_code = 'en'\r\n    // Check a single Bible book across many repositories\r\n    const [result, setResultValue] = useState(\"Waiting-CheckBookPackage\");\r\n\r\n    let checkingOptions = { // Uncomment any of these to test them\r\n        // 'extractLength': 25,\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Use an IIFE (Immediately Invoked Function Expression)\r\n        //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174\r\n        (async () => {\r\n            // Display our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Waiting for check results for {username} {language_code} <b>{bookID}</b> book package…</p>);\r\n\r\n            const rawCBPResults = await checkBookPackage(username, language_code, bookID, setResultValue, checkingOptions);\r\n            // console.log(\"checkBookPackage() returned\", typeof rawCBPResults); //, JSON.stringify(rawCBPResults));\r\n\r\n            // Add some extra fields to our rawCBPResults object in case we need this information again later\r\n            rawCBPResults.checkType = 'BookPackage';\r\n            rawCBPResults.username = username;\r\n            rawCBPResults.language_code = language_code;\r\n            rawCBPResults.bookID = bookID;\r\n            rawCBPResults.checkedOptions = checkingOptions;\r\n\r\n            // Now do our final handling of the result -- we have some options available\r\n            let processOptions = { // Uncomment any of these to test them\r\n                // 'maximumSimilarMessages': 3, // default is 2\r\n                // 'errorPriorityLevel': 800, // default is 700\r\n                // 'cutoffPriorityLevel': 100, // default is 0\r\n                // 'sortBy': 'ByPriority', // default is 'AsFound'\r\n                // 'ignorePriorityNumberList': [123, 202], // default is []\r\n            };\r\n\r\n            let displayType = 'ErrorsWarnings'; // default\r\n\r\n            function renderSummary(processedResults) {\r\n                return (<>\r\n                <p>Checked <b>{username} {language_code} {bookID}</b> </p>\r\n                <p>&nbsp;&nbsp;&nbsp;&nbsp;Successfully checked {processedResults.checkedFileCount.toLocaleString()} \r\n                file{processedResults.checkedFileCount===1?'':'s'} \r\n                from {processedResults.checkedRepoNames.length} \r\n                repo{processedResults.checkedRepoNames.length===1?'':'s'}: \r\n                <b>{processedResults.checkedRepoNames.join(', ')}</b>\r\n                <br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;including {processedResults.checkedFilenameExtensions.length} \r\n                file type{processedResults.checkedFilenameExtensions.size === 1 ? '' : 's'}: \r\n                {processedResults.checkedFilenameExtensions.join(', ')}.\r\n                </p>\r\n                <p>&nbsp;&nbsp;&nbsp;&nbsp;Finished in <RenderElapsedTime elapsedTime={processedResults.elapsedTime} />.</p>\r\n                </>);\r\n            }\r\n\r\n            if (displayType === 'ErrorsWarnings') {\r\n                const processedResults = processNoticesToErrorsWarnings(rawCBPResults, processOptions);\r\n\r\n                if (processedResults.errorList.length || processedResults.warningList.length)\r\n                    setResultValue(<>\r\n                        {renderSummary(processedResults)}\r\n                            {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}\r\n                        <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                    </>);\r\n                else // no errors or warnings\r\n                    setResultValue(<>\r\n                        {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}\r\n                        <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                    </>);\r\n            } else if (displayType === 'SevereMediumLow') {\r\n                const processedResults = processNoticesToSevereMediumLow(rawCBPResults, processOptions);\r\n\r\n                if (processedResults.severeList.length || processedResults.mediumList.length || processedResults.lowList.length)\r\n                setResultValue(<>\r\n                    {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}\r\n                        <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                    </>);\r\n                else // no severe, medium, or low notices\r\n                setResultValue(<>\r\n                    {renderSummary(processedResults)}\r\n                    {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}\r\n                        <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                    </>);\r\n            } else if (displayType === 'SingleList') {\r\n                const processedResults = processNoticesToSingleList(rawCBPResults, processOptions);\r\n\r\n                if (processedResults.warningList.length)\r\n                setResultValue(<>\r\n                    {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}\r\n                        <RenderSuccessesWarningsGradient results={processedResults} />\r\n                    </>);\r\n                else // no warnings\r\n                setResultValue(<>\r\n                    {renderSummary(processedResults)}\r\n                    {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}\r\n                        <RenderSuccessesWarningsGradient results={processedResults} />\r\n                    </>);\r\n            } else setResultValue(<b style={{ color: 'red' }}>Invalid displayType='{displayType}'</b>)\r\n\r\n        })(); // end of async part in unnamedFunction\r\n        // eslint-disable-next-line\r\n    }, []); // end of useEffect part\r\n\r\n    // {/* <div className={classes.root}> */}\r\n    return (\r\n        <div className=\"Fred\">\r\n        {result}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default BookPackageContentValidator;\r\n","import React from 'react';\nimport clsx from 'clsx';\n//import { withStyles, makeStyles, useTheme, Theme, createStyles } from '@material-ui/core/styles';\nimport { makeStyles, useTheme, Theme, createStyles } from '@material-ui/core/styles';\nimport Paper from '@material-ui/core/Paper';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\n//import CircularProgress from '@material-ui/core/CircularProgress';\n//import Popover from '@material-ui/core/Popover';\n\nimport FormLabel from '@material-ui/core/FormLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormGroup from '@material-ui/core/FormGroup';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormHelperText from '@material-ui/core/FormHelperText';\n//import Checkbox, { CheckboxProps } from '@material-ui/core/Checkbox';\nimport Checkbox from '@material-ui/core/Checkbox';\n\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport Drawer from '@material-ui/core/Drawer';\nimport Divider from '@material-ui/core/Divider';\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\n\nimport Switch from '@material-ui/core/Switch';\n\n//import { green } from '@material-ui/core/colors';\nimport * as books from '../src/core/books';\nimport { Container, CssBaseline, Grid } from '@material-ui/core';\n\nimport BookPackageContentValidator from './BookPackageContentValidator';\n\n \nconst drawerWidth = 240;\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      width: '100%',\n      flexGrow: 1,\n      display: 'flex',\n    },\n    menuButton: {\n      marginRight: theme.spacing(2),\n    },\n    appBar: {\n      transition: theme.transitions.create(['margin', 'width'], {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.leavingScreen,\n      }),\n    },\n    appBarShift: {\n      width: `calc(100% - ${drawerWidth}px)`,\n      marginLeft: drawerWidth,\n      transition: theme.transitions.create(['margin', 'width'], {\n        easing: theme.transitions.easing.easeOut,\n        duration: theme.transitions.duration.enteringScreen,\n      }),\n    },\n    title: {\n      flexGrow: 1,\n    },\n    formControl: {\n      margin: theme.spacing(3),\n    },\n    button: {\n      marginRight: theme.spacing(1),\n    },\n    instructions: {\n      marginTop: theme.spacing(1),\n      marginBottom: theme.spacing(1),\n    },\n    hide: {\n      display: 'none',\n    },\n    drawer: {\n      width: drawerWidth,\n      flexShrink: 0,\n    },\n    drawerPaper: {\n      width: drawerWidth,\n    },\n    drawerHeader: {\n      display: 'flex',\n      alignItems: 'center',\n      padding: theme.spacing(0, 1),\n      ...theme.mixins.toolbar,\n      justifyContent: 'flex-end',\n    },\n    content: {\n      flexGrow: 1,\n      padding: theme.spacing(3),\n      transition: theme.transitions.create('margin', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.leavingScreen,\n      }),\n      marginLeft: -drawerWidth,\n    },\n    contentShift: {\n      transition: theme.transitions.create('margin', {\n        easing: theme.transitions.easing.easeOut,\n        duration: theme.transitions.duration.enteringScreen,\n      }),\n      marginLeft: 0,\n    },\n    alignItemsAndJustifyContent: {\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n    },  \n    offset: {...theme.mixins.toolbar},\n  }),\n);\n/*\nconst GreenCheckbox = withStyles({\n  root: {\n    color: green[400],\n    '&$checked': {\n      color: green[600],\n    },\n  },\n  checked: {},\n})((props: CheckboxProps) => <Checkbox color=\"default\" {...props} />);\n*/\ninterface bpStateIF { [x: string]: boolean[]; };\n\nfunction joinBookIds(state: bpStateIF ) {\n  const x = Object.keys(state);\n  let y: string[] = [];\n  for (let i=0; i<x.length; i++) {\n    if ( state[x[i]][0] ) {\n      y.push(books.bookIdByTitle(x[i]));\n    }\n  }\n  //return y.join();\n  return y;\n}\n\n    \nfunction getSteps() {\n  return ['Select Books', 'Content Validation Details'];\n}\n\nfunction getStepContent(step: number) {\n  switch (step) {\n    case 0:\n      return 'Select books, then click Next to generate book package details';\n    case 1:\n      return 'Content Validation Results';\n    default:\n      return 'Unknown step';\n  }\n}\n\n// A custom hook that builds on useLocation to parse\n// the query string for you.\nlet queryProcessedOnce = false;\nfunction useQuery() {\n  let search = window.location.search;\n  //console.log(\"url=\",window.location.origin,window.location.pathname)\n  return new URLSearchParams(search);\n}\n\nexport default function App() {\n  const [state, setState] = React.useState({ ...books.titlesToBoolean() }); \n  const [activeStep, setActiveStep] = React.useState(0);\n  const [skipped, setSkipped] = React.useState(new Set<number>());\n\n  /* ----------------------------------------------------------\n      Stepper\n  */\n  const steps = getSteps();\n\n  const isStepOptional = (step: number) => {\n    return false;\n  };\n\n  const isStepSkipped = (step: number) => {\n    return skipped.has(step);\n  };\n\n\n  const handleBack = () => {\n    setActiveStep(prevActiveStep => prevActiveStep - 1);\n  };\n\n  const handleSkip = () => {\n    if (!isStepOptional(activeStep)) {\n      // You probably want to guard against something like this,\n      // it should never occur unless someone's actively trying to break something.\n      throw new Error(\"You can't skip a step that isn't optional.\");\n    }\n\n    setActiveStep(prevActiveStep => prevActiveStep + 1);\n    setSkipped(prevSkipped => {\n      const newSkipped = new Set(prevSkipped.values());\n      newSkipped.add(activeStep);\n      return newSkipped;\n    });\n  };\n\n  /*\n  const handleReset = () => {\n    setActiveStep(0);\n    let states = Object.keys(state);\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = false;\n      state[states[i]][1] = false;\n    }\n  };\n  */\n  const handleNext = () => {\n    let newSkipped = skipped;\n    if (isStepSkipped(activeStep)) {\n      newSkipped = new Set(newSkipped.values());\n      newSkipped.delete(activeStep);\n    }\n\n    setActiveStep(prevActiveStep => prevActiveStep + 1);\n    setSkipped(newSkipped);\n  };\n\n  let query = useQuery();\n  if ( activeStep === 0 && queryProcessedOnce === false ) {\n    queryProcessedOnce = true;\n    let bks   = query.get(\"books\");\n    if ( bks !== null ) {\n      // user has launched the app with URL query parameters\n      let barrayIds = bks.split(',');\n      let barrayTitles: string[] = [];\n      for ( let i=0; i < barrayIds.length; i++ ) {\n        let x = books.bookTitleById(barrayIds[i]);\n        if ( x === \"\" ) {\n          alert(\"Invalid Book Id:\"+barrayIds[i]);\n          break;\n        }\n        barrayTitles.push(x);\n      }\n      for( let i=0; i < barrayTitles.length; i++) {\n        let name = barrayTitles[i];\n        console.log(\"name:\",name)\n        // set the state variables\n        state[name][0] = true;\n        state[name][1] = false;\n        let b: boolean[] = [];\n        b[0] = true;\n        b[1] = false;  \n      }\n      // skip to step 2...\n      //activeStep = 1; //works sort of\n      handleNext();\n      // for URL, always clear local cache\n      //dbsetup.bpstore.clear();\n    }\n  }\n\n\n  const classes = useStyles();\n  const theme = useTheme();\n\n  /* ----------------------------------------------------------\n      Popover\n  */\n  //const [anchorEl, setAnchorEl] = React.useState<HTMLButtonElement | null>(null);\n  /*\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n  const popen = Boolean(anchorEl);\n  const id = popen ? 'simple-popover' : undefined;\n  */\n\n\n  /* ----------------------------------------------------------\n      Menu drawer\n  */\n  const [open, setOpen] = React.useState(false);\n\n  const handleDrawerOpen = () => {\n    setOpen(true);\n  };\n\n  const handleDrawerClose = () => {\n    setOpen(false);\n  };\n\n  const handleSelectNoneOt = () => {\n    let states = books.oldTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = false;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = false;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  const handleSelectAllOt = () => {\n    let states = books.oldTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = true;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = true;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  const handleSelectNoneNt = () => {\n    let states = books.newTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = false;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = false;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  const handleSelectAllNt = () => {\n    let states = books.newTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = true;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = true;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  /* ----------------------------------------------------------\n      Switch for data refresh\n  */\n const [clearF, setClearF] = React.useState({\n    clearFlag: false,\n  });\n\n  const handleChangeClearFlag = (name: string) => (event: React.ChangeEvent<HTMLInputElement>) => {\n    setClearF({ ...clearF, [name]: event.target.checked });\n  };\n\n\n  \n  /* ----------------------------------------------------------\n      Form/checkbox stuff \n  */\n  // these are for the initial book seletion\n  const handleChange = (name: string) => (event: React.ChangeEvent<HTMLInputElement>) => {\n    let b: boolean[] = [];\n    b[0] = event.target.checked;\n    b[1] = false;\n    setState({ ...state, [name]: b });\n  };\n\n  /*\n  const handleFinishedChange = (name: string) => (event: React.ChangeEvent<HTMLInputElement>) => {\n    let b: boolean[] = [];\n    b[0] = true;\n    b[1] = event.target.checked;\n    setState({ ...state, [name]: b });\n  };\n  */\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <AppBar position=\"fixed\" \n          className={clsx(classes.appBar, {[classes.appBarShift]: open })}>\n        <Toolbar>\n          <IconButton\n            color=\"inherit\"\n            aria-label=\"open drawer\"\n            onClick={handleDrawerOpen}\n            edge=\"start\"\n            className={clsx(classes.menuButton, open && classes.hide)}\n          >\n            <MenuIcon />\n          </IconButton>\n          <Typography variant=\"h6\" className={classes.title}>\n            Book Package Content Validation\n          </Typography>\n        </Toolbar>\n      </AppBar>\n      <Drawer\n        className={classes.drawer}\n        variant=\"persistent\"\n        anchor=\"left\"\n        open={open}\n        classes={{\n          paper: classes.drawerPaper,\n        }}\n      >\n        <div className={classes.drawerHeader}>\n          <IconButton onClick={handleDrawerClose}>\n            {theme.direction === 'ltr' ? <ChevronLeftIcon /> : <ChevronRightIcon />}\n          </IconButton>\n        </div>\n        <Divider />\n        <FormGroup row>\n            <FormControlLabel\n              control={\n                <Switch checked={clearF.clearFlag} onChange={handleChangeClearFlag('clearFlag')} value=\"clearFlag\" color=\"primary\" />\n              }\n              label=\"Refresh Book Package Data\"\n            />\n        </FormGroup>\n        <Divider />\n      </Drawer> \n      <Paper>\n        <Typography> <br/> <br/> </Typography>\n        <Stepper activeStep={activeStep}>\n          {steps.map((label, index) => {\n            const stepProps: { completed?: boolean } = {};\n            const labelProps: { optional?: React.ReactNode } = {};\n            if (isStepOptional(index)) {\n              labelProps.optional = <Typography variant=\"caption\">Optional</Typography>;\n            }\n            if (isStepSkipped(index)) {\n              stepProps.completed = false;\n            }\n            return (\n              <Step key={label} {...stepProps}>\n                <StepLabel {...labelProps}>{label}</StepLabel>\n              </Step>\n            );\n          })}\n        </Stepper>\n        <Container>\n          <div className={classes.alignItemsAndJustifyContent}>\n          <Typography className={classes.instructions}>{getStepContent(activeStep)}</Typography>\n          </div>\n\n          <div className={classes.alignItemsAndJustifyContent}>\n            <Button disabled={activeStep === 0} onClick={handleBack} color=\"primary\" variant=\"contained\" className={classes.button}>\n              Back\n            </Button>\n\n            {isStepOptional(activeStep) && (\n              <Button variant=\"contained\" color=\"primary\" onClick={handleSkip} className={classes.button}>\n                Skip\n              </Button>\n            )}\n\n            <Button disabled={activeStep === 3} variant=\"contained\" color=\"primary\" onClick={handleNext} className={classes.button}>\n              Next\n            </Button>\n\n          </div>\n\n          <div className={classes.alignItemsAndJustifyContent}>\n            {(activeStep === 0) && (\n              <Grid container spacing={3}>\n                <Grid item xs={6}>\n                  <Paper>\n                    <Typography> <br/> </Typography>\n                    <div>\n                    <Button onClick={handleSelectAllOt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select All\n                    </Button>\n                    <Button onClick={handleSelectNoneOt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select None\n                    </Button>\n                    </div>\n                    <FormControl required component=\"fieldset\" className={classes.formControl}>\n                    <FormLabel component=\"legend\">Old Testament</FormLabel>\n                    <FormGroup>\n                      {books.oldTestament().map(t => \n                        <FormControlLabel\n                          control={<Checkbox checked={state[t][0]} onChange={handleChange(t)} value={t} />}\n                          label={t} key={t}\n                        />\n                      )}                \n                    </FormGroup>\n                    <FormHelperText />\n                    </FormControl>\n                  </Paper>\n                </Grid>\n                <Grid item xs={6}>\n                  <Paper>\n                    <Typography> <br/> </Typography>\n                    <div>\n                    <Button onClick={handleSelectAllNt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select All\n                    </Button>\n                    <Button onClick={handleSelectNoneNt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select None\n                    </Button>\n                    </div>\n\n                    <FormControl required component=\"fieldset\" className={classes.formControl}>\n                    <FormLabel component=\"legend\">New Testament</FormLabel>\n                    <FormGroup>\n                      {books.newTestament().map(t => \n                        <FormControlLabel\n                          control={<Checkbox checked={state[t][0]} onChange={handleChange(t)} value={t} />}\n                          label={t} key={t}\n                        />\n                      )}                \n                    </FormGroup>\n                    <FormHelperText />\n                    </FormControl>\n                  </Paper>\n                </Grid>\n              </Grid>\n            )}\n\n\n            {(activeStep === 1) && (\n              <div>\n                <Paper>\n                {\n                  joinBookIds(state).map(id => \n                    <div>\n                    <Typography variant=\"h6\" >Book Package for {id.toUpperCase()} </Typography>\n                    <BookPackageContentValidator bookID={id} />\n                    </div>\n                  )\n                }\n                </Paper>\n              </div>\n            )}\n\n\n          </div>\n        </Container>\n      </Paper>\n    </div>\n  );\n}\n\n/*\nhttp://localhost:3000/book-package-app/?books=mat,mrk,luk,jhn,act,rom,1co,2co,gal,eph,php,col,1th,2th,1ti,2ti,tit,phm,heb,jas,1pe,2pe,1jn,2jn,3jn,jud,rev\n\n<BookPackageCheck\n  username='unfoldingWord'\n  language_code='en'\n  // bookID can be a USFM bookID, e.g., GEN, MAT, 3JN\n  //  and can also be OBS (for Open Bible Stories)\n  bookID='TIT'\n\n  // Default displayType is 'ErrorsWarnings'\n  //  Alternatives are `SevereMediumLow', 'SingleList'\n  displayType='SevereMediumLow'\n\n  // Specifying maximumSimilarMessages and extractLength is just to show off options\n  //  -- those fields are not necessary (or normal) here\n  maximumSimilarMessages='3'\n  // extractLength='13' // Default is 10\n  />\n\n\n\n*/\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}