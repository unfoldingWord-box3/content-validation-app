{"version":3,"sources":["../../../src/core/field-text-check.js","../../../src/core/index.js","../../../src/core/utilities.js","../../../src/core/getApi.js","../../../src/demos/notice-processing-functions.js","../../../src/demos/RenderProcessedResults.js","../../../../src/core/books/index.js","../../../src/core/text-handling-functions.js","../../../src/core/markdown-text-check.js","../../../src/core/file-text-check.js","../../../src/core/plain-text-check.js","../../../src/core/tn-table-row-check.js","../../../src/core/ta-reference-check.js","../../../src/core/tn-links-check.js","../../../src/core/quote-check.js","../../../src/core/tn-table-text-check.js","../../../src/core/annotation-row-check.js","../../../src/core/usfm-text-check.js","../../../src/core/yaml-text-check.js","../node_modules/jspdf/dist sync","../../../src/demos/index.js","../../../../src/demos/file-check/index.js","../../../../src/demos/file-check/FileCheck.js","../../../src/core/annotation-table-check.js","../../../src/core/usfm-js-check.js","../../../src/core/BCS-usfm-grammar-check.js","../../../src/core/book-package-check.js","../../../src/core/manifest-text-check.js","../../../../src/demos/book-package-check/index.js","../../../../src/demos/book-package-check/BookPackageCheck.js","../../../../src/demos/book-packages-check/index.js","../../../../src/demos/book-packages-check/BookPackagesCheck.js","../../../../src/demos/book-packages-check/checkBookPackages.js","../../../../src/demos/repo-check/index.js","../../../../src/demos/repo-check/RepoCheck.js","fonts/SILEOTSR.ttf","core/books.ts","core/getApi.js","core/book-package-check.js","core/utilities.ts","ValidationNotices.js","BookPackageContentValidator.js","App.tsx","serviceWorker.ts","index.tsx","../../src/index.js","../../../../src/core/books/books.js"],"names":["fieldName","fieldText","allowedLinks","optionalFieldLocation","optionalCheckingOptions","console","result","noticeList","noticeObject","ourLocation","isWhitespace","addNotice6","priority","message","location","extractLength","btcError","isNaN","halfLength","Math","halfLengthPlus","characterIndex","iy","extract","checkList","punctChar","punctSet","leftChar","rightChar","leftCount","countOccurrences","rightCount","details","clTitle","clObject","clOutput","thisPropertyContents","oType","Object","oLength","olError","givenTitle","givenObject","output","givenString","int","baseURL","failedStore","localforage","driver","name","zipStore","cacheStore","Door43Api","setup","cache","store","maxAge","exclude","query","key","req","serialized","JSON","cachedUnzippedFiles","username","repository","path","branch","filePath","Path","getFile","file","clearCaches","getRepoName","languageCode","repoCode","repo_languageCode","repos","success","repos_","bookIDList","Array","bookID","whichTestament","books","origLang","repoName","fetchRepositoryZipFile","zipFetchSucceeded","fetchFileFromServer","repositoryExists","uri","cachedGet","data","getFileFromZip","getUID","user","uid","params","q","limit","repo","zipUri","fetch","response","zipArrayBuffer","optionalPrefix","zipBlob","pathList","JSZip","zip","relativePath","zipPath","sha","givenNoticeObject","optionalProcessingOptions","processNoticesCommon","remainingNoticeList","allTotals","resultObject","maximumSimilarMessages","npfMSMerror","errorPriorityLevel","npfEPLerror","counter","thisNotice","thisPriority","thisMsg","thisID","numSuppressed","severePriorityLevel","npfSPLerror","mediumPriorityLevel","nfpMPLerror","sortBy","npfSBerror","DEFAULT_IGNORE_PRIORITY_NUMBER_LIST","standardisedNoticeList","numberStore","duplicatePriorityList","thisGivenNotice","oldMsg","thisRepoName","thisFilename","thisLineNumber","thisRowID","thisFieldName","thisLocation","numIgnoredNotices","numSuppressedWarnings","processingOptions","gnoPropertyName","ignorePriorityNumberList","npfIPNLerror","cutoffPriorityLevel","npfCPLerror","BibleRegex","NotesRegex","UHBBookList","UGNTBookList","ULTBookList","USTBookList","TNBookList","USFMBookList","TSVNotesList","thisParticularSuccessMsg","regexResult","Set","thisParticularNotice","thisNewNotice","C","V","newNoticeList","a","b","thisExtra","newNotice","text","line","index","results","thisObject","excludeList","allPropertiesSet","haveOBS","haveBible","noticeEntry","noticePropertyName","noticePropertyValue","headerData","title","field","type","CName","VName","columns","options","sorting","exportButton","exportAllData","haveErrorsOrWarnings","successCount","style","color","elapsedSeconds","seconds","remainingTime","minutes","hours","RenderObject","displayObject","RenderMessage","detailsString","RenderBCV","RenderFileDetails","filename","lineNumber","rowID","resultStart","lineResult","resultEnd","RenderSuccessesColored","haveWarnings","e1","e2","listEntry","RenderProcessedArray","arrayType","myList","RenderGivenArray","array","getGradientcolor","priorityValue","red","RenderWarningsGradient","thiscolor","RenderErrors","RenderWarnings","RenderErrorsAndWarnings","RenderSevere","RenderMedium","RenderLow","RenderSevereMediumLow","myString","test","mainString","subString","allowOverlapping","n","pos","step","textName","markdownText","givenLocation","mdtcError","successList","checkTextField","thisText","ourCheckTextField","lineLocation","lines","headerLevel","lastNumLeadingSpaces","numLeadingSpaces","thisHeaderLevel","checkMarkdownLineContents","addSuccessMessage","fileText","optionalFileLocation","bfcError","plainText","ptcError","cptResult","lineText","checkPlainLineContents","EXPECTED_TN_HEADING_LINE","taLinkText","checkTNLinks","coqResultObject","addNotice6to9","ourCheckTNLinks","rowLocation","checkOriginalLanguageQuote","ourCheckTNOriginalLanguageQuote","checkTAReference","taRepoLanguageCode","ourCheckTAReference","ourMarkdownTextChecks","checkMarkdownText","drResult","givenRowLocation","ourRowLocation","tlcELerror","lowercaseBookID","numChaptersThisBook","tlcNCerror","haveGoodBookID","fields","B","supportReference","origQuote","occurrence","GLQuote","occurrenceNote","intC","Number","haveGoodChapterNumber","numVersesThisChapter","tlcNVerror","intV","indexOf","characterIndeX","ctarResult","trcUNerror","trcBRerror","trcLCerror","sectionName","trcSNerror","taRepoName","filepath","getFile_","getFileCached","taFileContent","defaultLanguageCode","taRegex","RegExp","resultArray","twRegex","twRepoName","tnlcError","bibleRegex","chapterInt","verseInt","ourParseInt","tnCIerror","tnVIerror","ccError","vvError","bookNumberAndName","originalLanguageRepoCode","originalLanguageRepoName","qcoError","qcunError","originalUSFM","extra","foundChapter","foundVerse","verseText","bookLine","ixW","ixEnd","bits","adjusted_field","getPassage","colqResult","gcELerror","quoteBits","gcVTerror","numQuoteBits","bitIndex","partDescription","remainingBits","noBreakSpaceText","addNoticeCV8","ttcError","tableText","lastB","lastC","lastV","rowIDList","uniqueRowList","checkTN_TSVDataRow","firstResult","uniqueID","lastintC","lastintV","adrResult","annotationType","haveBibleBookID","reference","tags","quote","annotation","givenText","usfmELerror","opener","closer","lCount","rCount","checkUSFMCharacterFields","checkTextfileContents","ourBasicFileChecks","compulsoryMarker","markerSet","expectedMarker","deprecatedMarker","marker","Vstr","rest","ALLOWED_LINE_START_MARKERS","MARKERS_WITHOUT_CONTENT","MARKERS_WITH_COMPULSORY_CONTENT","checkUSFMLineInternals","allResults","USFMline","foundMarker","char","lastIntC","lastIntV","lastMarker","lastRest","findStartMarker","vIndex","usfmICerror","usfmIVerror","firstV","secondV","intFirstV","intSecondV","usfmV12error","restRest","parseInt","usfmIIVerror","thisLength","PARAGRAPH_MARKERS","checkUSFMLineContents","checkUSFMFileContents","mainUSFMCheck","gotDeep","someObject","someSubobject","someSubSubobject","someSubSubSubobject","someSubSubSubSubobject","expectedVersesPerChapterList","result1","runUsfmJsCheck","usfmCIerror","discoveredVerseList","discoveredVerseWithTextList","verseNumberString","verseHasText","hasText","firstVString","secondVString","v","usfmVIerror","usfmPIerror","CVCheck","grammarCheckResult","runBCSGrammarCheck","warningString","relaxedGrammarCheckResult","ourRunBCSGrammarCheck","INTRO_LINE_START_MARKERS","CV_MARKERS","HEADING_TYPE_MARKERS","NOTE_MARKERS","SPECIAL_MARKERS","MILESTONE_MARKERS","concat","DEPRECATED_MARKERS","COMPULSORY_MARKERS","EXPECTED_MARKERS","EXPECTED_BIBLE_BOOK_MARKERS","EXPECTED_PERIPHERAL_BOOK_MARKERS","YAMLText","ytcError","cytResult","allowedLinksInLine","lineName","formData","yaml","yamlError","checkYAMLLineContents","webpackEmptyContext","e","Error","code","keys","resolve","module","exports","id","withStyles","theme","root","props","useState","setResultValue","useEffect","renderSummary","processedResults","rawCFResults","fileContent","checkFileContents","processOptions","displayType","processNoticesToErrorsWarnings","processNoticesToSevereMediumLow","processNoticesToSingleList","checkingOptions","className","rowID_list","checkAnnotationTSVDataRow","addNotice6to7","convertOptions","jsonResult","toJSON","isValidUSFM","returnedJSON","strictnessString","cugResult","ourUsfmParser","grammar","parserResult","ourErrorObject","parseError","contextRE","errorLine","lineNumberString","ourErrorMessage","adjustedPriority","notified","ourWarnings","adjustedString","error","warnings","checkRepo","bookOrFileCode","cfBookID","file_content","fileLocation","cfcResultObject","cfcNoticeEntry","addNotice10","ourCheckFileContents","checkRepoResult","startTime","checkedFileCount","checkedFilenames","checkedFilenameExtensions","getFilelistFromZip","countString","totalCheckedSize","thisFilepath","thisFilenameExtension","ourBookID","repoFileContent","Date","ourCFLocation","filenameMain","checkFileResult","checkTQbook","cfFilename","cfResultObject","ctqResult","generalLocation","filelistFromZip_","bookIdLc","thisPath","pathParts","tqFileContent","checkBookPackageResult","newCheckingOptions","checkedRepoNames","repoCodeList","ULT","UST","repoLocation","tqResultObject","manifestText","mfcError","cmtResult","cYtResultObject","checkYAMLText","ourYAMLTextChecks","formDataKeys","addNotice9","rawCBPResults","clearCacheAndPreloadRepos","checkBookPackage","bookIDs","bookIDInvalid","rawCBPsResults","checkBookPackagesResult","cbpResultObject","rawCRResults","bookData","bookId","filter","row","testament","newTestament","list","i","length","push","oldTestament","titlesToBoolean","ob","bookDataTitles","forEach","k","bookIdByTitle","bookTitleById","extraBookList","isOptionalValidBookID","toLowerCase","isValidBookID","_id","__id","toUpperCase","usfmNumberNameById","usfm","createInstance","INDEXEDDB","URLSearchParams","toString","stringify","url","join","getItem","log","setItem","get","status","arrayBuffer","loadAsync","endsWith","startsWith","substring","async","assert","undefined","successString","split","toLocaleString","pop","replace","add","checkedFilesizes","checkTN_TSVText","checkUSFMText","checkPlainText","checkManifestText","unshift","checkedFilename","checkedFilesize","checkedOptions","isArray","slice","stringToNumber","value","num","NaN","somewhatNumericalSort","aNum","bNum","aStr","bStr","notices_to_mt","renderLink","renderWithUnicodeLink","renderPriority","mt","render","rowData","customSort","sortChapterVerse","link","cellStyle","fontFamily","excerpt","width","_location","_link","lineNum","extension","view","namePrefix","repoUC","includes","getLink","charPos","sort","rows","newColumns","column","hasData","trimColumns","columnsButton","filtering","pageSize","tableIcons","Add","forwardRef","ref","Check","Clear","Delete","DetailPanel","Edit","Export","Filter","FirstPage","LastPage","NextPage","PreviousPage","ResetSearch","Search","SortArrow","ThirdStateCheck","ViewColumn","content","fontWeight","href","target","rel","match","getUnicodeRegEx","lastPos","exec","matchLen","unicode","util","Paper","icons","BookPackageContentValidator","language_code","Typography","checkType","ValidationNotices","useStyles","makeStyles","createStyles","flexGrow","display","menuButton","marginRight","spacing","appBar","transition","transitions","create","easing","sharp","duration","leavingScreen","appBarShift","marginLeft","easeOut","enteringScreen","formControl","margin","button","instructions","marginTop","marginBottom","hide","drawer","flexShrink","drawerPaper","drawerHeader","alignItems","padding","mixins","toolbar","justifyContent","contentShift","alignItemsAndJustifyContent","offset","queryProcessedOnce","App","React","state","setState","activeStep","setActiveStep","skipped","setSkipped","org","setOrg","lang","setLang","steps","isStepSkipped","has","handleNext","newSkipped","values","delete","prevActiveStep","search","window","useQuery","doInitialization","bks","barrayIds","barrayTitles","x","alert","classes","useTheme","open","setOpen","handleChange","event","checked","CssBaseline","AppBar","position","clsx","Toolbar","IconButton","aria-label","onClick","edge","variant","Drawer","anchor","paper","direction","Divider","Stepper","map","label","stepProps","labelProps","completed","Step","StepLabel","Container","getStepContent","Button","disabled","FormControl","component","FormLabel","RadioGroup","onChange","val","FormControlLabel","control","Radio","Grid","container","item","xs","states","required","FormGroup","t","Checkbox","FormHelperText","y","joinBookIds","Boolean","hostname","ReactDOM","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","oftenMissingList","entry","chaptersInBook","chapters","err","chapter","verses"],"mappings":"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","file":"static/js/main.dd061ebe.chunk.js","sourcesContent":["import { isWhitespace, countOccurrences } from './text-handling-functions'\r\n\r\n//const VALIDATOR_VERSION_STRING = '0.1.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport function checkTextField(fieldName, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions) {\r\n    // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n    // fieldName (str): Used for identification\r\n    // fieldText (str): The field being checked\r\n    // allowedLinks (bool): doesn't check links -- only checks lack of links\r\n    // optionalFieldLocation (str): Used to inform where this field is located\r\n\r\n    // We assume that checking for compulsory fields is done elsewhere\r\n\r\n    // Returns a single notice list\r\n    //  The list contains objects with the following fields:\r\n    //      priority (compulsory): the priority number 0..999 (usually 800+ are errors, lower are warnings)\r\n    //      message (compulsory): the error description string\r\n    //      characterIndeX: the 0-based index for the position in the string\r\n    //      extract: a short extract of the string containing the error (or empty-string if irrelevant)\r\n    //      location: the detailed location string\r\n    //  (Returned in this way for more intelligent processing at a higher level)\r\n    // console.log(`checkTextField(${fieldName}, ${fieldText.length.toLocaleString()} chars, ${allowedLinks}, '${optionalFieldLocation}')`);\r\n    console.assert(fieldName !== undefined, \"checkTextField: 'fieldName' parameter should be defined\");\r\n    console.assert(typeof fieldName === 'string', `checkTextField: 'fieldName' parameter should be a number not a '${typeof fieldName}': ${fieldName}`);\r\n    console.assert(fieldText !== undefined, \"checkTextField: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldText === 'string', `checkTextField: 'fieldText' parameter should be a number not a '${typeof fieldText}': ${fieldText}`);\r\n    console.assert(allowedLinks === true || allowedLinks === false, \"checkTextField: allowedLinks parameter must be either true or false\");\r\n\r\n    let result = { noticeList: [] };\r\n\r\n    function addNotice6(noticeObject) {\r\n        // console.log(`dBTC Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"dBTCs addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `dBTCs addNotice6: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"dBTCs addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `dBTCs addNotice6: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(characterIndex !== undefined, \"dBTCs addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `dBTCs addNotice6: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"dBTCs addNotice6: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `dBTCs addNotice6: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"dBTCs addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `dBTCs addNotice6: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        result.noticeList.push({ ...noticeObject, fieldName });\r\n    }\r\n\r\n\r\n    // Main code for checkTextField()\r\n    if (!fieldText) // Nothing to check\r\n        return result;\r\n\r\n    // Create our more detailed location string by prepending the fieldName\r\n    let ourLocation = optionalFieldLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n\r\n    if (isWhitespace(fieldText)) {\r\n        addNotice6({ priority: 638, message: \"Only found whitespace\", location: ourLocation });\r\n        return result;\r\n    }\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (btcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    let characterIndex = fieldText.indexOf('<<<<<<<');\r\n    if (characterIndex >= 0) {\r\n        const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n        const extract = (iy > halfLength ? '' : '') + fieldText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '') + (iy + halfLengthPlus < fieldText.length ? '' : '')\r\n        addNotice6({ priority: 993, message: \"Unresolved GIT conflict\", characterIndex, extract, location: ourLocation });\r\n    } else {\r\n        characterIndex = fieldText.indexOf('=======');\r\n        if (characterIndex >= 0) {\r\n            const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n            const extract = (iy > halfLength ? '' : '') + fieldText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '') + (iy + halfLengthPlus < fieldText.length ? '' : '')\r\n            addNotice6({ priority: 992, message: \"Unresolved GIT conflict\", characterIndex, extract, location: ourLocation });\r\n        } else {\r\n            characterIndex = fieldText.indexOf('>>>>>>>>');\r\n            if (characterIndex >= 0) {\r\n                const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n                const extract = (iy > halfLength ? '' : '') + fieldText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '') + (iy + halfLengthPlus < fieldText.length ? '' : '')\r\n                addNotice6({ priority: 991, message: \"Unresolved GIT conflict\", characterIndex, extract, location: ourLocation });\r\n            }\r\n        }\r\n    }\r\n\r\n    if (fieldText[0] === ' ') {\r\n        const extract = fieldText.substring(0, extractLength).replace(/ /g, '') + (fieldText.length > extractLength ? '' : '');\r\n        addNotice6({ priority: 106, message: `Unexpected leading space${fieldText[1] === ' ' ? \"s\" : \"\"}`, characterIndex: 0, extract, location: ourLocation });\r\n    }\r\n    if (fieldText.substring(0, 4) === '<br>' || fieldText.substring(0, 5) === '<br/>' || fieldText.substring(0, 6) === '<br />') {\r\n        const extract = fieldText.substring(0, extractLength) + (fieldText.length > extractLength ? '' : '');\r\n        addNotice6({ priority: 107, message: \"Unexpected leading break\", characterIndex: 0, extract, location: ourLocation });\r\n    }\r\n    if (fieldText[fieldText.length - 1] === ' ') {\r\n        const extract = (fieldText.length > extractLength ? '' : '') + fieldText.substring(fieldText.length - 10).replace(/ /g, '');\r\n        addNotice6({ priority: 105, message: \"Unexpected trailing space(s)\", characterIndex: fieldText.length - 1, extract, location: ourLocation });\r\n    }\r\n    if (fieldText.substring(fieldText.length - 4) === '<br>' || fieldText.substring(fieldText.length - 5) === '<br/>' || fieldText.substring(fieldText.length - 6) === '<br />') {\r\n        const extract = (fieldText.length > extractLength ? '' : '') + fieldText.substring(fieldText.length - 10);\r\n        addNotice6({ priority: 104, message: \"Unexpected trailing break\", characterIndex: fieldText.length - 1, extract, location: ourLocation });\r\n    }\r\n    if ((characterIndex = fieldText.indexOf('  ')) >= 0) {\r\n        const extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus).replace(/ /g, '') + (characterIndex + halfLengthPlus < fieldText.length ? '' : '')\r\n        addNotice6({ priority: 194, message: \"Unexpected double spaces\", characterIndex, extract, location: ourLocation });\r\n    }\r\n    if ((characterIndex = fieldText.indexOf('\\n')) >= 0) {\r\n        const extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '' : '')\r\n        addNotice6({ priority: 583, message: \"Unexpected newLine character\", characterIndex, extract, location: ourLocation });\r\n    }\r\n    if ((characterIndex = fieldText.indexOf('\\r')) >= 0) {\r\n        const extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '' : '')\r\n        addNotice6({ priority: 582, message: \"Unexpected carriageReturn character\", characterIndex, extract, location: ourLocation });\r\n    }\r\n    if ((characterIndex = fieldText.indexOf('\\xA0')) >= 0) { // non-break space\r\n        const extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus).replace(/\\xA0/g, '') + (characterIndex + halfLengthPlus < fieldText.length ? '' : '')\r\n        addNotice6({ priority: 581, message: \"Unexpected non-break space character\", characterIndex, extract, location: ourLocation });\r\n    }\r\n    if ((characterIndex = fieldText.indexOf('\\u202F')) >= 0) { // narrow non-break space\r\n        const extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus).replace(/\\u202F/g, '') + (characterIndex + halfLengthPlus < fieldText.length ? '' : '')\r\n        addNotice6({ priority: 580, message: \"Unexpected narrow non-break space character\", characterIndex, extract, location: ourLocation });\r\n    }\r\n    if ((characterIndex = fieldText.indexOf(' ')) >= 0) {\r\n        const extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '' : '')\r\n        addNotice6({ priority: 179, message: \"Unexpected space before ellipse character\", characterIndex, extract, location: ourLocation });\r\n    }\r\n    if ((characterIndex = fieldText.indexOf(' ')) >= 0) {\r\n        const extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '' : '')\r\n        addNotice6({ priority: 178, message: \"Unexpected space after ellipse character\", characterIndex, extract, location: ourLocation });\r\n    }\r\n    // Check for doubled punctuation chars (international)\r\n    // Doesn't check for doubled forward slash coz that might occur in a link, e.g., https://etc\r\n    //  or doubled # coz that occurs in markdown\r\n    let checkList = '\\'({}<>:,!-?\\'\";&*@^%+=~_|$';\r\n    if (!allowedLinks) checkList += '[].)' // Double square brackets can be part of markdown links, double periods can be part of a path\r\n    for (const punctChar of checkList) {\r\n        characterIndex = fieldText.indexOf(punctChar + punctChar);\r\n        if (characterIndex >= 0) {\r\n            let extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '' : '')\r\n            addNotice6({ priority: 177, message: `Unexpected doubled ${punctChar} characters`, characterIndex, extract, location: ourLocation });\r\n        }\r\n    }\r\n    // Check for punctuation chars following space\r\n    for (const punctChar of '.\\')}>:,!.-?\\'\";/*@^#%~_|$') {\r\n        characterIndex = fieldText.indexOf(' ' + punctChar);\r\n        if (characterIndex >= 0) {\r\n            let extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '' : '')\r\n            addNotice6({ priority: 191, message: `Unexpected ${punctChar} character after space`, characterIndex, extract, location: ourLocation });\r\n        }\r\n    }\r\n    // Check for punctuation chars before space\r\n    //  Removed ' (can be normal, e.g., Jesus' cloak)\r\n    for (const punctChar of '[({</@\\\\^~_|$') {\r\n        characterIndex = fieldText.indexOf(punctChar + ' ');\r\n        if (characterIndex >= 0) {\r\n            let extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '' : '')\r\n            addNotice6({ priority: 192, message: `Unexpected space after ${punctChar} character`, characterIndex, extract, location: ourLocation });\r\n        }\r\n    }\r\n\r\n    // Check matched pairs in the field\r\n    for (const punctSet of [['[', ']'], ['(', ')'], ['{', '}'],\r\n    ['<', '>'], ['', ''], ['', ''],\r\n    ['', ''], ['', ''], ['**_', '_**']]) {\r\n        // Can't check '' coz they might be used as apostrophe\r\n        const leftChar = punctSet[0], rightChar = punctSet[1];\r\n        const leftCount = countOccurrences(fieldText, leftChar);\r\n        const rightCount = countOccurrences(fieldText, rightChar);\r\n        if (leftCount !== rightCount)\r\n            // NOTE: These are higher priority than similar checks in a whole file which is less specific\r\n            addNotice6({ priority: leftChar === '' ? 163 : 563, message: `Mismatched ${leftChar}${rightChar} characters`, details: `(left=${leftCount.toLocaleString()}, right=${rightCount.toLocaleString()})`, location: ourLocation });\r\n    }\r\n\r\n    if (!allowedLinks) {\r\n        // Simple check that there aren't any\r\n        characterIndex = fieldText.indexOf('://');\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('http');\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('ftp');\r\n        // The following might have to be removed if text fields can contain email addresses\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('.org');\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('.com');\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('.info');\r\n        if (characterIndex === -1) characterIndex = fieldText.indexOf('.bible');\r\n        if (characterIndex >= 0) {\r\n            let extract = `${characterIndex > halfLength ? '' : ''}${fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus)}${characterIndex + halfLengthPlus < fieldText.length ? '' : ''}`\r\n            addNotice6({ priority: 765, message: \"Unexpected link\", characterIndex, extract, location: ourLocation });\r\n        }\r\n    }\r\n    return result;\r\n}\r\n// end of checkTextField function\r\n\r\n//export default checkTextField;\r\n","export * from './books/';\r\nexport * from './utilities';\r\nexport * from './getApi';\r\nexport * from './text-handling-functions';\r\nexport * from './field-text-check';\r\nexport * from './file-text-check';\r\nexport * from './markdown-text-check';\r\nexport * from './plain-text-check';\r\nexport * from './tn-table-row-check';\r\nexport * from './tn-table-text-check';\r\nexport * from './annotation-row-check';\r\nexport * from './annotation-table-check';\r\nexport * from './usfm-text-check';\r\nexport * from './book-package-check';\r\n","// utilities\r\n\r\n// import { isUndefined } from 'lodash';\r\n\r\n\r\nexport function consoleLogObject(clTitle, clObject) {\r\n    // Print an object's componenets to the console\r\n    // Note: the following line succeeds even if length and/or size are undefined\r\n    let clOutput = `cLO: ${clTitle} ${typeof clObject} (length=${clObject.length}) (size=${clObject.size}):\\n`;\r\n    for (const clPropertyName in clObject) {\r\n        // console.log(\"   \", clTitle, clPropertyName); // for debugging only!\r\n        let thisPropertyContents = \"\" + clObject[clPropertyName];\r\n        if (thisPropertyContents.length > 50)\r\n            thisPropertyContents = `(${thisPropertyContents.length}) ${thisPropertyContents.substring(0, 50)}`;\r\n        let oType = typeof clObject[clPropertyName];\r\n        // From https://stackoverflow.com/questions/12996871/why-does-typeof-array-with-objects-return-object-and-not-array#12996879\r\n        if (oType === \"object\" && Object.prototype.toString.call(clObject[clPropertyName]) === \"[object Array]\")\r\n            oType = \"array\";\r\n        clOutput += `  ${clPropertyName} (type=${oType})`;\r\n        let oLength;\r\n        try { oLength = clObject[clPropertyName].length; }\r\n        catch (olError) { oLength = \"null\" }\r\n        if (oLength !== undefined) clOutput += ` (length=${oLength})`;\r\n        if (thisPropertyContents !== undefined) clOutput += `: ${thisPropertyContents}\r\n`;\r\n    }\r\n    console.log(clOutput);\r\n}\r\n// end of consoleLogObject function\r\n\r\n\r\nexport function displayPropertyNames(givenTitle, givenObject) {\r\n    let output = `dPN: ${givenTitle} ${typeof givenObject}:\r\n`;\r\n    for (const propertyName in givenObject)\r\n        output += `  ${propertyName} (type=${typeof givenObject[propertyName]})\r\n`;\r\n    console.log(output);\r\n}\r\n// end of displayPropertyNames function\r\n\r\n\r\nexport function ourParseInt(givenString) {\r\n    /*\r\n    The regular parseInt() function is too forgiving\r\n\r\n    See https://stackoverflow.com/questions/1133770/how-to-convert-a-string-to-an-integer-in-javascript\r\n\r\n    This one throws an error if the entire field doesn't give an integer.\r\n    */\r\n\r\n    /* First attempt\r\n    const int1 = parseInt(givenString, 10); // Don't let the function guess the base (if the string has a leading zero)\r\n    const int2 = givenString * 1; // This one is less forgiving it seems\r\n    if (int1!==int2) console.log(`From '${givenString}' we got ${int1} (${typeof int1}) and ${int2} (${typeof int2})`)\r\n    if (isNaN(int2) || isNaN(int1)\r\n    || int2===undefined || int1==undefined\r\n    || int2!==int1)\r\n        throw \"String is not a simple integer\";\r\n    return int1;\r\n    */\r\n\r\n    // Optimised version\r\n    const int = givenString * 1; // This one is less forgiving it seems\r\n  // eslint-disable-next-line no-throw-literal\r\n    if (isNaN(int)) throw \"String is not a simple integer\";\r\n    return int;\r\n}\r\n\r\n\r\n/*\r\n// function to convert an array to an object\r\n// with keys being 0..n\r\nexport const array_to_obj = ( ar => {\r\n  const ob = {};\r\n  Object.assign(ob,ar);\r\n  return ob;\r\n});\r\n\r\n// function to convert map to object\r\nexport const map_to_obj = ( mp => {\r\n  const ob = {};\r\n  mp.forEach((v,k) => {ob[k]=v});\r\n  return ob;\r\n});\r\n\r\n// function to convert object to a map\r\nexport const obj_to_map = ( ob => {\r\n  const mp = new Map();\r\n  Object.keys ( ob ).forEach (k => { mp.set(k, ob[k]) });\r\n  return mp;\r\n});\r\n\r\n// function to convert word frequency map\r\n// to an object suitable for MaterialTable\r\nexport const wf_to_mt = ( ob => {\r\n  const mt = {};\r\n  mt.title = \"Word Frequency\";\r\n  mt.columns = [\r\n      { title: \"Word\", field: \"word\" },\r\n      { title: \"Count\", field: \"check\" },\r\n  ];\r\n  mt.data = [];\r\n  Object.keys(ob).forEach ( w => {\r\n      mt.data.push({ word: w, check: ob[w] })\r\n  })\r\n\r\n  mt.options = { sorting: true, exportButton: true };\r\n\r\n  return mt;\r\n});\r\n\r\n// function to convert an array of words to\r\n// an object suitable for MaterialTable\r\nexport const aw_to_mt = ( ar => {\r\n  // first convert array to object\r\n  const ob = array_to_obj(ar);\r\n  const mt = {};\r\n  mt.title = \"All Words in Text Order\";\r\n  mt.columns = [\r\n      { title: \"Order\", field: \"order\" , type: \"numeric\"},\r\n      { title: \"Word\", field: \"word\" },\r\n  ];\r\n  mt.data = [];\r\n  Object.keys(ob).forEach ( n => {\r\n      mt.data.push({ order: n, word: ob[n] })\r\n  });\r\n\r\n  mt.options = { sorting: true };\r\n\r\n  return mt;\r\n});\r\n*/\r\n","import Path from 'path';\r\n// import YAML from 'js-yaml-parser';\r\nimport localforage from 'localforage';\r\nimport { setup } from 'axios-cache-adapter';\r\nimport JSZip from 'jszip';\r\nimport * as books from './books';\r\n// import { consoleLogObject } from '../core/utilities';\r\n\r\n\r\nconst baseURL = 'https://git.door43.org/';\r\nconst apiPath = 'api/v1';\r\n\r\n\r\nconst failedStore = localforage.createInstance({\r\n  driver: [localforage.INDEXEDDB],\r\n  name: 'failed-store',\r\n});\r\n\r\nconst zipStore = localforage.createInstance({\r\n  driver: [localforage.INDEXEDDB],\r\n  name: 'zip-store',\r\n});\r\n\r\nconst cacheStore = localforage.createInstance({\r\n  driver: [localforage.INDEXEDDB],\r\n  name: 'web-cache',\r\n});\r\n\r\nconst Door43Api = setup({\r\n  baseURL: baseURL,\r\n  cache: {\r\n    store: cacheStore,\r\n    maxAge: 5 * 60 * 1000, // 5-minutes\r\n    exclude: { query: false },\r\n    key: req => {\r\n      // if (req.params) debugger\r\n      let serialized = req.params instanceof URLSearchParams ?\r\n        req.params.toString() : JSON.stringify(req.params) || '';\r\n      return req.url + serialized;\r\n    },\r\n  },\r\n});\r\n\r\n\r\nlet cachedUnzippedFiles = {};\r\n\r\n/**\r\n * adds caching of uncompressed files, calls getFile() if file is not cached\r\n * @param {String} username\r\n * @param {String} repository\r\n * @param {String} path\r\n * @param {String} branch\r\n * @return {Promise<*>}\r\n */\r\n// This is the function that we call the most from the outside\r\nexport async function getFileCached({ username, repository, path, branch }) {\r\n  const filePath = Path.join(username, repository, path, branch);\r\n  // console.log(`getFileCached(${username}, ${repository}, ${path}, ${branch})`);\r\n  if (cachedUnzippedFiles[filePath]) {\r\n    // console.log(`in cache - ${filePath}`);\r\n    return cachedUnzippedFiles[filePath];\r\n  }\r\n\r\n  let file = await getFile({ username, repository, path, branch });\r\n\r\n  if (file) {\r\n    cachedUnzippedFiles[filePath] = file;\r\n    // console.log(`saving to cache - ${filePath}`);\r\n  }\r\n\r\n  return file;\r\n}\r\n\r\n\r\nexport async function clearCaches() {\r\n  console.log(\"Clearing localforage.INDEXEDDB zipStore and cacheStore caches\");\r\n  // const tasks = [zipStore, cacheStore].map(localforage.clear);\r\n  // const results = await Promise.all(tasks);\r\n  // results.forEach(x => console.log(\"Done it\", x));\r\n  await failedStore.clear();\r\n  await zipStore.clear();\r\n  await cacheStore.clear();\r\n  cachedUnzippedFiles = {};\r\n}\r\n\r\n\r\nexport function getRepoName(languageCode, repoCode) {\r\n  /**\r\n  * @description - Creates and returns a Door43 repoName string\r\n  * @param {String} languageCode - the language code, e.g., 'en'\r\n  * @param {String} repoCode - the repo code, e.g., 'TQ'\r\n  * @return {String} - the Door43 repoName string\r\n  */\r\n//    console.log(`getRepoName('${languageCode}', '${repoCode}')`);\r\n let repo_languageCode = languageCode;\r\n  if (repoCode === 'UHB') repo_languageCode = 'hbo';\r\n  else if (repoCode === 'UGNT') repo_languageCode = 'el-x-koine';\r\n  const repoName = `${repo_languageCode}_${repoCode.toLowerCase()}`;\r\n  return repoName;\r\n}\r\n\r\n\r\n/**\r\n * clears the caches of stale data and preloads repo zips, before running book package checks\r\n *   this allows the calling app to clear cache and start loading repos in the backgound as soon as it starts up.  In this case it would not need to use await to wait for results.\r\n *   TRICKY: note that even if the user is super fast in selecting books and clicking next, it will not hurt anything.  getFile() would just be fetching files directly from repo until the zips are loaded.  After that the files would be pulled out of zipStore.\r\n * @param {string} username\r\n * @param {string} languageCode\r\n * @param {Array} bookIDList - one or more books that will be checked\r\n * @param {string} branch - optional, defaults to master\r\n * @param {Array} repos - optional, list of repos to pre-load\r\n * @return {Promise<Boolean>} resolves to true if file loads are successful\r\n */\r\n// TEMP: Removed TQ from default repos\r\nexport async function clearCacheAndPreloadRepos(username, languageCode, bookIDList, branch = 'master', repos = ['TA', 'TW']) {\r\n  console.log(`clearCacheAndPreloadRepos(${username}, ${languageCode}, ${bookIDList}, ${branch}, ${repos})`);\r\n  clearCaches(); // clear existing cached files so we know we have the latest\r\n  let success = true;\r\n  const repos_ = [...repos];\r\n\r\n  if (bookIDList && Array.isArray(bookIDList)) {\r\n    // make sure we have the original languages needed\r\n    for (const bookID of bookIDList) {\r\n      if (bookID !== 'OBS') {\r\n        const whichTestament = books.testament(bookID); // returns 'old' or 'new'\r\n        const origLang = whichTestament === 'old' ? 'UHB' : 'UGNT';\r\n        if (!repos_.includes(origLang))\r\n          repos_.unshift(origLang);\r\n      }\r\n    }\r\n  }\r\n\r\n  // load all the repos need\r\n  for (const repoCode of repos_) {\r\n    const repoName = getRepoName(languageCode, repoCode);\r\n    console.log(`clearCacheAndPreloadRepos: preloading zip file for ${repoName}`);\r\n    const zipFetchSucceeded = await fetchRepositoryZipFile({ username, repository: repoName, branch });\r\n    if (!zipFetchSucceeded) {\r\n      console.log(`clearCacheAndPreloadRepos: misfetched zip file for ${repoCode} repo with ${zipFetchSucceeded}`);\r\n      success = false;\r\n    }\r\n  }\r\n\r\n  return success;\r\n}\r\n\r\n\r\nasync function fetchFileFromServer({ username, repository, path, branch = 'master' }) {\r\n  // console.log(`fetchFileFromServer(${username}, ${repository}, ${path}, ${branch})`);\r\n  const repoExists = await repositoryExists({ username, repository });\r\n  let uri;\r\n  if (repoExists) {\r\n    uri = Path.join(username, repository, 'raw/branch', branch, path);\r\n    const failMessage = await failedStore.getItem(uri);\r\n    if (failMessage) {\r\n      // console.log(`fetchFileFromServer failed previously for ${uri}: ${failMessage}`);\r\n      return null;\r\n    }\r\n    try {\r\n      // console.log(\"URI=\",uri);\r\n      const data = await cachedGet({ uri });\r\n      // console.log(\"Got data\", data);\r\n      return data;\r\n    }\r\n    catch (fffsError) {\r\n      console.log(`ERROR: fetchFileFromServer could not fetch ${path}: ${fffsError}`)\r\n      /* await */ failedStore.setItem(uri, fffsError.message);\r\n      return null;\r\n    }\r\n  } else {\r\n    console.log(`ERROR: fetchFileFromServer repo '${repository}' does not exist!`);\r\n    /* await */ failedStore.setItem(uri, `Repo '${repository}' does not exist!`);\r\n    return null;\r\n  }\r\n};\r\n\r\n\r\nasync function getFile({ username, repository, path, branch }) {\r\n  console.log(`getFile(${username}, ${repository}, ${path}, ${branch})`);\r\n  let file;\r\n  file = await getFileFromZip({ username, repository, path, branch });\r\n  if (!file) {\r\n    file = await fetchFileFromServer({ username, repository, path, branch });\r\n  }\r\n  return file;\r\n}\r\n\r\n\r\nasync function getUID({ username }) {\r\n  // console.log(`getUID(${username})`);\r\n  const uri = Path.join(apiPath, 'users', username);\r\n  // console.log(`getUID uri=${uri}`);\r\n  const user = await cachedGet({ uri });\r\n  // console.log(`getUID user=${user}`);\r\n  const { id: uid } = user;\r\n  // console.log(`  getUID returning: ${uid}`);\r\n  return uid;\r\n}\r\nasync function repositoryExists({ username, repository }) {\r\n  // console.log(`repositoryExists(${username}, ${repository})`);\r\n  const uid = await getUID({ username });\r\n  // console.log(`repositoryExists uid=${uid}`);\r\n  // Default limit is 10 -- way too small\r\n  const params = { q: repository, limit: 500, uid }; // Documentation says limit is 50, but larger numbers seem to work ok\r\n  // console.log(`repositoryExists params=${JSON.stringify(params)}`);\r\n  const uri = Path.join(apiPath, 'repos', `search`);\r\n  // console.log(`repositoryExists uri=${uri}`);\r\n  const { data: repos } = await cachedGet({ uri, params });\r\n  // console.log(`repositoryExists repos (${repos.length})=${repos}`);\r\n  // for (const thisRepo of repos) console.log(`  thisRepo (${JSON.stringify(Object.keys(thisRepo))}) =${JSON.stringify(thisRepo.name)}`);\r\n  const repo = repos.filter(repo => repo.name === repository)[0];\r\n  // console.log(`repositoryExists repo=${repo}`);\r\n  // console.log(`  repositoryExists returning: ${!!repo}`);\r\n  return !!repo;\r\n};\r\n\r\n\r\nasync function cachedGet({ uri, params }) {\r\n  // console.log(`cachedGet(${uri}, ${JSON.stringify(params)})`);\r\n  // console.log(`  get querying: ${baseURL+uri}`);\r\n  const { data } = await Door43Api.get(baseURL + uri, { params });\r\n  // console.log(`  cachedGet returning: ${JSON.stringify(data)}`);\r\n  return data;\r\n};\r\n\r\nexport async function cachedGetURL({ uri, params }) {\r\n  // console.log(`cachedGetURL(${uri}, ${params})`);\r\n  const { data } = await Door43Api.get(uri, { params });\r\n  // console.log(`  cachedGetURL returning: ${data}`);\r\n  return data;\r\n};\r\n\r\n\r\n/*\r\nfunction fetchRepositoriesZipFiles({username, languageId, branch}) {\r\n  const repositories = resourceRepositories({languageId});\r\n  const promises = Object.values(repositories).map(repository => {\r\n    return fetchRepositoryZipFile({username, repository, branch});\r\n  });\r\n  const zipArray = await Promise.all(promises);\r\n  return zipArray;\r\n};\r\n*/\r\n\r\n\r\n// https://git.door43.org/{username}/{repository}/archive/{branch}.zip\r\nexport async function fetchRepositoryZipFile({ username, repository, branch }) {\r\n  console.log(`fetchRepositoryZipFile(${username}, ${repository}, ${branch})`);\r\n  const repoExists = await repositoryExists({ username, repository });\r\n  if (!repoExists) {\r\n    return null;\r\n  }\r\n  const uri = zipUri({ username, repository, branch });\r\n  const response = await fetch(uri);\r\n  if (response.status === 200 || response.status === 0) {\r\n    const zipArrayBuffer = await response.arrayBuffer(); // blob storage not supported on mobile\r\n    await zipStore.setItem(uri, zipArrayBuffer);\r\n    return true;\r\n  } else {\r\n    console.log(`ERROR: fetchRepositoryZipFile got response status: ${response.status}`);\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\nexport async function getFilelistFromZip({ username, repository, branch, optionalPrefix }) {\r\n  // console.log(`getFilelistFromZip(${username}, ${repository}, ${branch}, ${optionalPrefix})`);\r\n\r\n  const uri = zipUri({ username, repository, branch });\r\n  let zipBlob = await zipStore.getItem(uri);\r\n\r\n  if (!zipBlob) { // Seems that we need to load the zip file first\r\n    const response = await fetch(uri);\r\n    if (response.status === 200 || response.status === 0) {\r\n      const zipArrayBuffer = await response.arrayBuffer(); // blob storage not supported on mobile\r\n      zipBlob = await zipStore.setItem(uri, zipArrayBuffer);\r\n    } else {\r\n      console.log(`ERROR: getFilelistFromZip got response status: ${response.status}`);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  const pathList = [];\r\n  try {\r\n    if (zipBlob) {\r\n      // console.log(`  Got zipBlob for uri=${uri}`);\r\n      const zip = await JSZip.loadAsync(zipBlob);\r\n      // console.log(`  Got zip`);\r\n      // Now we need to fetch the list of files from the repo\r\n      // zip.forEach(function (relativePath, fileObject) {\r\n      zip.forEach(function (relativePath) {\r\n        // console.log(`relPath=${relativePath}`)\r\n        // consoleLogObject('fileObject', fileObject);\r\n        if (!relativePath.endsWith('/')) // it's not a folder\r\n        {\r\n          if (relativePath.startsWith(`${repository}/`)) // remove repo name prefix\r\n            relativePath = relativePath.substring(repository.length + 1);\r\n          if (relativePath.length\r\n            && !relativePath.startsWith('.git') // skips files in these folders\r\n            && !relativePath.startsWith('.apps') // skips files in this folder\r\n            && (!optionalPrefix || relativePath.startsWith(optionalPrefix))) // it's the correct prefix\r\n            pathList.push(relativePath);\r\n        }\r\n      })\r\n    }\r\n    // else console.log(\"  getFilelistFromZip: No zipBlob\");\r\n  } catch (error) {\r\n    console.log(`ERROR: getFilelistFromZip got: ${error.message}`);\r\n  }\r\n\r\n  // console.log(`getFilelistFromZip is returning (${pathList.length}) entries: ${pathList}`);\r\n  return pathList;\r\n}\r\n\r\n\r\nasync function getFileFromZip({ username, repository, path, branch }) {\r\n  // console.log(`getFileFromZip(${username}, ${repository}, ${path}, ${branch})`);\r\n  let file;\r\n  const uri = zipUri({ username, repository, branch });\r\n  const zipBlob = await zipStore.getItem(uri);\r\n  try {\r\n    if (zipBlob) {\r\n      // console.log(`  Got zipBlob for uri=${uri}`);\r\n      const zip = await JSZip.loadAsync(zipBlob);\r\n      const zipPath = Path.join(repository.toLowerCase(), path);\r\n      // console.log(`  zipPath=${zipPath}`);\r\n      file = await zip.file(zipPath).async('string');\r\n      // console.log(`    Got zipBlob ${file.length} bytes`);\r\n    }\r\n    // else console.log(\"  No zipBlob\");\r\n  } catch (error) {\r\n    console.log(`ERROR: getFileFromZip for ${username} ${repository} ${path} ${branch} got: ${error.message}`);\r\n    file = null;\r\n  }\r\n  return file;\r\n};\r\n\r\n\r\nexport function zipUri({ username, repository, branch = 'master' }) {\r\n  // console.log(`zipUri(${username}, ${repository}, ${branch})`);\r\n  const zipPath = Path.join(username, repository, 'archive', `${branch}.zip`);\r\n  const zipUri = baseURL + zipPath;\r\n  return zipUri;\r\n};\r\n\r\n\r\nexport async function fetchTree({ username, repository, sha = 'master' }) {\r\n  // console.log(`fetchTree(${username}, ${repository}, ${sha})`);\r\n  let data;\r\n  try {\r\n    const uri = Path.join('api/v1/repos', username, repository, 'git/trees', sha);\r\n    // console.log(`  uri='${uri}'`);\r\n    data = await cachedGet({ uri });\r\n    // console.log(`  data (${typeof data})`);\r\n    return data;\r\n    // const tree = JSON.parse(data); // RJH: Why was this here???\r\n    // console.log(`  tree (${typeof tree})`);\r\n    // return tree;\r\n  } catch (error) {\r\n    console.log(`ERROR: fetchTree got: ${error.message}`);\r\n    console.log(`  Data was: ${JSON.stringify(data)}`);\r\n    return null;\r\n  }\r\n};\r\n\r\n\r\n/*\r\nasync function recursiveTree({username, repository, path, sha}) {\r\n  console.log(\"recurse tree args:\",username,repository,path,sha)\r\n  let tree = {};\r\n  const pathArray = path.split();\r\n  const results = fetchTree({username, repository, sha});\r\n  const result = results.tree.filter(item => item.path === pathArray[0])[0];\r\n  if (result) {\r\n    if (result.type === 'tree') {\r\n      const childPath = pathArray.slice(1).join('/');\r\n      const children = recursiveTree({username, repository, path: childPath, sha: result.sha});\r\n      tree[result.path] = children;\r\n    } else if (result.type === 'blob') {\r\n      tree[result.path] = true;\r\n    }\r\n  }\r\n};\r\n\r\nasync function fileExists({username, repository, path, branch}) {\r\n  // get root listing\r\n  recursiveTree()\r\n  // get recursive path listing\r\n}\r\n*/\r\n","// import { displayPropertyNames, consoleLogObject } from './utilities';\r\n\r\n\r\n// const NOTICE_PROCESSOR_VERSION_STRING = '0.7.2';\r\n\r\n// All of the following can be overriden with optionalProcessingOptions\r\nconst DEFAULT_MAXIMUM_SIMILAR_MESSAGES = 3; // Zero means no suppression of similar messages\r\nconst DEFAULT_CUTOFF_PRIORITY_LEVEL = 0; // This level or lower gets excluded from the lists\r\nconst DEFAULT_IGNORE_PRIORITY_NUMBER_LIST = [];\r\n\r\n// For processNoticesToErrorsWarnings\r\nconst DEFAULT_ERROR_PRIORITY_LEVEL = 700; // This level or higher becomes an error (cf. warnings)\r\n\r\n// For processNoticesToSevereMediumLow\r\nconst DEFAULT_SEVERE_PRIORITY_LEVEL = 800; // This level or higher becomes a severe error\r\nconst DEFAULT_MEDIUM_PRIORITY_LEVEL = 600; // This level or higher becomes a medium error\r\n\r\n// For processNoticesToSingleList\r\n// (no constants required)\r\n\r\n\r\nfunction processNoticesCommon(givenNoticeObject, optionalProcessingOptions) {\r\n    /**\r\n    * @description - Preprocesses the successList and noticeList\r\n    * @param {Object} givenNoticeObject - must contain a noticeList array\r\n    * @param {Object} optionalProcessingOptions - may contain parameters\r\n    * @return {Array} - noticeList, countObject, preResultObject\r\n    */\r\n    /*\r\n        Expects to get an object with:\r\n            successList: a list of strings describing what has been checked\r\n            noticeList: a list of components to notices, being:\r\n                priority: A notice priority number in the range 1-1000.\r\n                    Each different type of warning/error has a unique number\r\n                      (but not each instance of those warnings/errors).\r\n                    By default, notice priority numbers 700 and over are\r\n                      considered `errors` and 0-699 are considered `warnings`.\r\n                message: The actual general description text of the notice\r\n                details: Extra notice information (if relevant)\r\n                The next three fields may be ommitted if irrelevant\r\n                 (since BCV is not relevant to all types of files/repos)\r\n                    bookID: book identifier 3-character UPPERCASE string\r\n                    C: Chapter number string\r\n                    V: Verse number string (can also be a bridge, e.g., '22-23')\r\n                repoName: repository name (if relevant)\r\n                filename: string (if relevant)\r\n                rowID: 4-character string (if relevant)\r\n                lineNumber: A one-based integer indicating the line number in the file\r\n                fieldName: string (if relevant)\r\n                characterIndex: A zero-based integer index which indicates the position\r\n                    of the error on the line or in the text field as appropriate.\r\n                extract: An extract of the checked text which indicates the area\r\n                      containing the problem.\r\n                    Where helpful, some character substitutions have already been made,\r\n                      for example, if the notice is about spaces,\r\n                      it is generally helpful to display spaces as a visible\r\n                      character in an attempt to best highlight the issue to the user.\r\n                 location: A string indicating the context of the notice,\r\n                        e.g., `in 'someBook.usfm'.\r\n                There is also an optional notice component (where multiple files/repos are checked)\r\n                extra: A string indicating an extra location component, e.g., repoCode or bookID\r\n                    This will probably need to be added to the message string but is left\r\n                        until now in order to allow the most display flexibility\r\n        Available options are:\r\n            cutoffPriorityLevel (integer; default is DEFAULT_CUTOFF_PRIORITY_LEVEL above)\r\n            maximumSimilarMessages (integer; default is DEFAULT_MAXIMUM_SIMILAR_MESSAGES above)\r\n            sortBy ('AsFound' or 'ByPriority', default is 'AsFound')\r\n            ignorePriorityNumberList (list of integers, default is empty list, list of notice priority numbers to be ignored)\r\n        Also, any other parameters are just passed through,\r\n            although filenameList might be abbreviated, e.g. for 100s of .md files.\r\n\r\n        Returns an array of three fields:\r\n            remainingNoticeList\r\n                A list of notice entries, each one containing exactly eight or nine fields (see above)\r\n                    i.e., notice entries originally containing five or six fields have had blank BCV fields inserted.\r\n            allTotals\r\n                A table of priority numbers with a count of notices for that priority.\r\n                    (May be used in further processing for possible removal of lots of similar messages)\r\n            resultObject\r\n                A prototype object which will be added to and then returned as the final result of the NEXT notice processing step.\r\n                Contains the following:\r\n                    successList -- a list of strings noting what has been checked\r\n                    numIgnored Notices (int)\r\n                    numSuppressedWarnings (int)\r\n                    processingOptions (a copy of the optionalProcessingOptions passed to these functions)\r\n                    Any other fields that were part of the givenNoticeObject passed to these functions. These might include:\r\n                        checkedFilenames -- list of strings\r\n                        checkedRepos -- list of strings\r\n                    depending on the type of check that was made.\r\n    */\r\n    //     console.log(`processNoticesCommon v${NOTICE_PROCESSOR_VERSION_STRING} with options=${JSON.stringify(optionalProcessingOptions)}\r\n    //   Given ${givenNoticeObject.successList.length.toLocaleString()} success string(s) plus ${givenNoticeObject.noticeList.length.toLocaleString()} notice(s)`);\r\n\r\n\r\n    const standardisedNoticeList = givenNoticeObject.noticeList;\r\n\r\n\r\n    // Run a check through the noticeList to help discover any programming errors that need fixing\r\n    // This section may be commented out of production code\r\n    if (givenNoticeObject.noticeList && givenNoticeObject.noticeList.length) {\r\n        const numberStore = {}, duplicatePriorityList = [];\r\n        for (const thisGivenNotice of standardisedNoticeList) {\r\n            const thisPriority = thisGivenNotice.priority, thisMsg = thisGivenNotice.message;\r\n            console.assert(typeof thisPriority === 'number' && thisPriority > 0 && thisPriority < 10000, `BAD PRIORITY for ${JSON.stringify(thisGivenNotice)}`);\r\n            console.assert(typeof thisMsg === 'string' && thisMsg.length > 10, `BAD MESSAGE for ${JSON.stringify(thisGivenNotice)}`);\r\n\r\n            // Check that notice priority numbers are unique (to detect programming errors)\r\n            const oldMsg = numberStore[thisPriority];\r\n            if (oldMsg && oldMsg !== thisMsg && duplicatePriorityList.indexOf(thisPriority) < 0\r\n                // Some of the messages include the troubling character in the message\r\n                //    so we expect them to differ slightly\r\n                && !thisMsg.startsWith('Mismatched ')\r\n                && !thisMsg.startsWith('Unexpected doubled ')\r\n                && !thisMsg.startsWith('Unexpected space after ')\r\n                && !thisMsg.startsWith('Unexpected content after \\\\')\r\n                && !thisMsg.startsWith('USFMGrammar: ')\r\n                && !thisMsg.endsWith(' character after space')\r\n                && !thisMsg.endsWith(' marker at start of line')\r\n            ) {\r\n                console.log(`PROGRAMMING ERROR: priority ${thisPriority} has at least two different messages: '${oldMsg}' and '${thisMsg}'`);\r\n                duplicatePriorityList.push(thisPriority); // so that we only give the error once\r\n            }\r\n\r\n            // Check fields for bad values, and also across fields for unexpected combinations\r\n            const thisRepoName = thisGivenNotice.repoName, thisFilename = thisGivenNotice.filename, thisLineNumber = thisGivenNotice.lineNumber,\r\n                thisRowID = thisGivenNotice.rowID, thisFieldName = thisGivenNotice.fieldName, thisLocation = thisGivenNotice.location\r\n            if (thisRepoName) {\r\n                console.assert(thisRepoName.indexOf(' ') < 0 && thisRepoName.indexOf('/') < 0 && thisRepoName.indexOf('\\\\') < 0, `repoName '${thisRepoName}' contains unexpected characters in ${JSON.stringify(thisGivenNotice)}`);\r\n                if (thisLocation)\r\n                    console.assert(thisLocation.indexOf(thisRepoName) < 0, `repoName is repeated in location in ${JSON.stringify(thisGivenNotice)}`);\r\n            }\r\n            if (thisFilename) {\r\n                console.assert(thisFilename.indexOf(':') < 0 && thisFilename.indexOf('\\\\') < 0, `filename '${thisFilename}' contains unexpected characters in ${JSON.stringify(thisGivenNotice)}`);\r\n                // NOTE: Some OBS messages have to include part of the part in the 'filename' (to prevent ambiguity) so we don't disallow forward slash\r\n                if (!thisRepoName || !thisRepoName.endsWith('_obs'))\r\n                    console.assert(thisFilename.indexOf('/') < 0, `filename '${thisFilename}' contains unexpected characters in ${JSON.stringify(thisGivenNotice)}`);\r\n                if (thisLocation)\r\n                    console.assert(thisLocation.indexOf(thisFilename) < 0, `filename is repeated in location in ${JSON.stringify(thisGivenNotice)}`);\r\n            }\r\n            if (thisRowID) {\r\n                console.assert(thisRowID.indexOf(' ') < 0 && thisRowID.indexOf('/') < 0 && thisRowID.indexOf('\\\\') < 0, `rowID '${thisRowID}' contains unexpected characters in ${JSON.stringify(thisGivenNotice)}`);\r\n                if (thisLocation)\r\n                    console.assert(thisLocation.indexOf(thisRowID) < 0, `rowID is repeated in location in ${JSON.stringify(thisGivenNotice)}`);\r\n            }\r\n            if (thisFieldName) {\r\n                console.assert(thisFieldName.indexOf(' ') < 0 && thisFieldName.indexOf('/') < 0 && thisFieldName.indexOf('\\\\') < 0, `fieldName '${thisFieldName}' contains unexpected characters in ${JSON.stringify(thisGivenNotice)}`);\r\n                if (thisLocation)\r\n                    console.assert(thisLocation.indexOf(thisFieldName) < 0, `fieldName is repeated in location in ${JSON.stringify(thisGivenNotice)}`);\r\n            }\r\n            if (thisLineNumber) {\r\n                console.assert(typeof thisLineNumber === 'number' && thisLineNumber > 0, `lineNumber '${thisLineNumber}' contains unexpected value in ${JSON.stringify(thisGivenNotice)}`);\r\n                // Note: lineNumber can occur in location, e.g., in 3 in '3JN' or 'Door43' so have to take extra care not to give false alarms\r\n                if (thisLocation && thisLineNumber > 4 && thisLineNumber!==43)\r\n                    // && (!thisGivenNotice.bookID || thisGivenNotice.bookID.indexOf(thisLineNumber + '') < 0)\r\n                    console.assert(thisLocation.indexOf(thisLineNumber + '') < 0 && thisLocation.indexOf(thisLineNumber.toLocaleString()) < 0, `lineNumber might be repeated in location in ${JSON.stringify(thisGivenNotice)}`);\r\n            }\r\n            numberStore[thisPriority] = thisMsg;\r\n        }\r\n    }\r\n\r\n\r\n    const resultObject = { // inititalise with our new fields\r\n        numIgnoredNotices: 0,\r\n        numSuppressedWarnings: 0,\r\n        processingOptions: optionalProcessingOptions, // Just helpfully includes what we were given (may be undefined)\r\n    };\r\n    // Copy across all the other properties that we aren't interested in\r\n    for (const gnoPropertyName in givenNoticeObject)\r\n        if (gnoPropertyName !== 'successList' && gnoPropertyName !== 'noticeList')\r\n            resultObject[gnoPropertyName] = givenNoticeObject[gnoPropertyName];\r\n\r\n    // Fetch our processing parameters\r\n    let ignorePriorityNumberList;\r\n    try {\r\n        ignorePriorityNumberList = optionalProcessingOptions.ignorePriorityNumberList;\r\n    } catch (npfIPNLerror) { }\r\n    if (ignorePriorityNumberList === undefined) {\r\n        ignorePriorityNumberList = DEFAULT_IGNORE_PRIORITY_NUMBER_LIST;\r\n        // console.log(`Using default ignorePriorityNumberList=${ignorePriorityNumberList}`);\r\n    }\r\n    else console.log(`Using supplied ignorePriorityNumberList=${ignorePriorityNumberList} cf. default=${DEFAULT_IGNORE_PRIORITY_NUMBER_LIST}`);\r\n    let sortBy;\r\n    try {\r\n        sortBy = optionalProcessingOptions.sortBy;\r\n    } catch (npfSBerror) { }\r\n    if (sortBy === undefined) {\r\n        sortBy = 'AsFound';\r\n        // console.log(`Using default sortBy='${sortBy}'`);\r\n    }\r\n    // else console.log(`Using supplied sortBy='${sortBy}' cf. default='AsFound'`);\r\n    let cutoffPriorityLevel;\r\n    try {\r\n        cutoffPriorityLevel = optionalProcessingOptions.cutoffPriorityLevel;\r\n    } catch (npfCPLerror) { }\r\n    if (cutoffPriorityLevel === undefined) {\r\n        cutoffPriorityLevel = DEFAULT_CUTOFF_PRIORITY_LEVEL;\r\n        // console.log(`Using default cutoffPriorityLevel=${cutoffPriorityLevel}`);\r\n    }\r\n    else console.log(`Using supplied cutoffPriorityLevel=${cutoffPriorityLevel} cf. default=${DEFAULT_CUTOFF_PRIORITY_LEVEL}`);\r\n    // if (cutoffPriorityLevel > errorPriorityLevel)\r\n    // resultObject.errorList.push({999, \"Cutoff level must not be higher than error level\", extract:`(${cutoffPriorityLevel} vs ${errorPriorityLevel})`, \" in processNoticesCommon options\"]);\r\n\r\n\r\n    if (givenNoticeObject.successList)\r\n        // Handle the successList\r\n        if (givenNoticeObject.successList.length < 5)\r\n            resultObject.successList = givenNoticeObject.successList;\r\n        else { // successList is fairly long -- maybe we can shorten it by combining multiple similar messages\r\n            const BibleRegex = /\\d\\d-(\\w\\w\\w).usfm/; // \"Checked JUD file: 66-JUD.usfm\"\r\n            const NotesRegex = /\\d\\d-(\\w\\w\\w).tsv/; // \"Checked EN_TN_01-GEN.TSV file: en_tn_01-GEN.tsv\"\r\n            resultObject.successList = [];\r\n            const UHBBookList = [], UGNTBookList = [], ULTBookList = [], USTBookList = [], TNBookList = [];\r\n            const USFMBookList = [], TSVNotesList = []\r\n            for (const thisParticularSuccessMsg of givenNoticeObject.successList) {\r\n                // console.log(\"thisParticularSuccessMessage\", thisParticularSuccessMessage);\r\n                let regexResult;\r\n                if (thisParticularSuccessMsg.startsWith('Checked UHB file: '))\r\n                    UHBBookList.push(thisParticularSuccessMsg.substring(18, thisParticularSuccessMsg.length))\r\n                else if (thisParticularSuccessMsg.startsWith('Checked UGNT file: '))\r\n                    UHBBookList.push(thisParticularSuccessMsg.substring(19, thisParticularSuccessMsg.length))\r\n                else if (thisParticularSuccessMsg.startsWith('Checked ULT file: '))\r\n                    ULTBookList.push(thisParticularSuccessMsg.substring(18, thisParticularSuccessMsg.length))\r\n                else if (thisParticularSuccessMsg.startsWith('Checked UST file: '))\r\n                    USTBookList.push(thisParticularSuccessMsg.substring(18, thisParticularSuccessMsg.length))\r\n                else if (thisParticularSuccessMsg.startsWith('Checked TN file: '))\r\n                    TNBookList.push(thisParticularSuccessMsg.substring(17, thisParticularSuccessMsg.length))\r\n                else if ((regexResult = BibleRegex.exec(thisParticularSuccessMsg)) !== null\r\n                    // but don't do it for Book Package checks (in different repos)\r\n                    && thisParticularSuccessMsg.startsWith(`Checked ${regexResult[1]} file`)) {\r\n                    // console.log(\"regexResult\", JSON.stringify(regexResult));\r\n                    USFMBookList.push(regexResult[1]);\r\n                }\r\n                else if ((regexResult = NotesRegex.exec(thisParticularSuccessMsg)) !== null\r\n                    // but don't do it for Book Package checks (in different repos)\r\n                    && thisParticularSuccessMsg.startsWith(`Checked ${regexResult[1]} file`)) {\r\n                    // console.log(\"regexResult\", JSON.stringify(regexResult));\r\n                    TSVNotesList.push(regexResult[1]);\r\n                }\r\n                else\r\n                    resultObject.successList.push(thisParticularSuccessMsg); // Just copy it across\r\n            }\r\n            // Put summary messages at the beginning of the list\r\n            if (TSVNotesList.length)\r\n                resultObject.successList.unshift(`Checked ${TSVNotesList.length} TSV notes files: ${TSVNotesList.join(', ')}`);\r\n            if (USFMBookList.length)\r\n                resultObject.successList.unshift(`Checked ${USFMBookList.length} USFM Bible files: ${USFMBookList.join(', ')}`);\r\n            if (TNBookList.length)\r\n                resultObject.successList.unshift(`Checked ${TNBookList.length} TN files: ${TNBookList.join(', ')}`);\r\n            if (USTBookList.length)\r\n                resultObject.successList.unshift(`Checked ${USTBookList.length} UST files: ${USTBookList.join(', ')}`);\r\n            if (ULTBookList.length)\r\n                resultObject.successList.unshift(`Checked ${ULTBookList.length} ULT files: ${ULTBookList.join(', ')}`);\r\n            if (UGNTBookList.length)\r\n                resultObject.successList.unshift(`Checked ${UGNTBookList.length} UGNT files: ${UGNTBookList.join(', ')}`);\r\n            if (UHBBookList.length)\r\n                resultObject.successList.unshift(`Checked ${UHBBookList.length} UHB files: ${UHBBookList.join(', ')}`);\r\n        }\r\n    else resultObject.successList = [];\r\n\r\n    // Handle the checkedFilenames list\r\n    //  which might have 100s or 1,000s of .md filenames\r\n    if (resultObject.checkedFilenames && resultObject.checkedFilenames.length > 10) {\r\n        // console.log(`Have ${resultObject.checkedFilenames.length} checkedFilenames`);\r\n        resultObject.checkedFilenames = [...new Set(resultObject.checkedFilenames)]; // Only keep unique ones\r\n        // console.log(`Now have ${resultObject.checkedFilenames.length} checkedFilenames`);\r\n        // console.log(JSON.stringify(resultObject.checkedFilenames));\r\n    }\r\n\r\n    // Specialised processing\r\n    // If have s5 marker warnings, add one summary error\r\n    // consoleLogObject('standardisedNoticeList', standardisedNoticeList);\r\n    for (const thisParticularNotice of standardisedNoticeList) {\r\n        // console.log(\"thisParticularNotice\", JSON.stringify(thisParticularNotice));\r\n        if (thisParticularNotice.message.indexOf('\\\\s5') >= 0) {\r\n            const thisNewNotice = {\r\n                ...thisParticularNotice, priority: 701, message: \"\\\\s5 fields should be coded as \\\\ts\\\\* milestones\", location: ` in ${givenNoticeObject.checkType}`,\r\n                // I think we need to delete these fields below as they were probably set in thisParticularNotice\r\n                C: undefined, V: undefined, characterIndex: undefined, extract: undefined\r\n            };\r\n            // if (thisParticularNotice.filename && thisParticularNotice.filename.length)\r\n            //     thisNewNotice.filename = thisParticularNotice.filename; // Sometimes we have an additional file identifier\r\n            // if (thisParticularNotice.repoName && thisParticularNotice.repoName.length)\r\n            //     thisNewNotice.repoName = thisParticularNotice.repoName; // Sometimes we have an additional file identifier\r\n            // if (thisParticularNotice.extra && thisParticularNotice.extra.length)\r\n            //     thisNewNotice.extra = thisParticularNotice.extra; // Sometimes we have an additional file identifier\r\n            standardisedNoticeList.push(thisNewNotice);\r\n            break;\r\n        }\r\n    }\r\n\r\n    // Remove any notices that they have asked us to ignore\r\n    let remainingNoticeList;\r\n    if (ignorePriorityNumberList.length) {\r\n        // console.log(\"Doing ignore of\", ignorePriorityNumberList.length,\"value(s)\");\r\n        remainingNoticeList = [];\r\n        for (const thisNotice of standardisedNoticeList)\r\n            if (ignorePriorityNumberList.indexOf(thisNotice.priority) >= 0)\r\n                resultObject.numIgnoredNotices++;\r\n            else\r\n                remainingNoticeList.push(thisNotice);\r\n    } else\r\n        remainingNoticeList = standardisedNoticeList;\r\n    if (resultObject.numIgnoredNotices)\r\n        console.log(`Ignored ${resultObject.numIgnoredNotices} notices`);\r\n\r\n    // Cut off the lowest priority notices if requested\r\n    if (cutoffPriorityLevel > 0) {\r\n        const newNoticeList = [];\r\n        for (const thisNotice of remainingNoticeList)\r\n            if (thisNotice.priority < cutoffPriorityLevel)\r\n                resultObject.numSuppressedWarnings++;\r\n            else newNoticeList.push(thisNotice);\r\n        remainingNoticeList = newNoticeList;\r\n    }\r\n    // if (cutoffPriorityLevel > errorPriorityLevel)\r\n    // resultObject.errorList.push({999, \"Cutoff level must not be higher than error level\", extract:`(${cutoffPriorityLevel} vs ${errorPriorityLevel})`, \" in processNoticesCommon options\"]);\r\n\r\n    // Sort the remainingNoticeList as required\r\n    if (sortBy === 'ByPriority')\r\n        remainingNoticeList.sort(function (a, b) { return b.priority - a.priority });\r\n    else if (sortBy !== 'AsFound')\r\n        console.log(`ERROR: Sorting '${sortBy}' is not implemented yet!!!`);\r\n\r\n    /*\r\n    // Add additional information fields to the location\r\n    const newNoticeList = [];\r\n    for (const thisNotice of remainingNoticeList) {\r\n        const newNotice = thisNotice;\r\n        if (newNotice.location) newNotice.location = newNotice.location.trim(); // Remove any leading spaces\r\n        else newNotice.location = '';\r\n        if (newNotice.repoName) newNotice.location = `in ${newNotice.filename} repoName ${newNotice.location}`\r\n        if (newNotice.filename) newNotice.location = `in file ${newNotice.filename} ${newNotice.location}`;\r\n        if (newNotice.rowID) newNotice.location = `with ID ${newNotice.rowID} ${newNotice.location}`;\r\n        if (newNotice.lineNumber) newNotice.location = `in line ${newNotice.lineNumber} ${newNotice.location}`;\r\n        if (newNotice.fieldName) newNotice.location = `in ${newNotice.fieldName} field ${newNotice.location}`;\r\n        // Default is to prepend extra to the message\r\n        //  This prevents errors/warnings from different repos or books from being combined\r\n        if (newNotice.extra) newNotice.message = `${newNotice.extra} ${newNotice.message}`;\r\n        newNoticeList.push(newNotice);\r\n    }\r\n    */\r\n\r\n    // Add in extra location info if it's there\r\n    // Default is to prepend it to the msg\r\n    //  This prevents errors/warnings from different repos or books from being combined\r\n    if (remainingNoticeList.length\r\n        && remainingNoticeList[0].extra && remainingNoticeList[0].extra.length) {\r\n        // console.log(`We need to add the extra location, e.g. '${remainingNoticeList[0][5]}': will prepend it to the messages`);\r\n        const newNoticeList = [];\r\n        for (const thisNotice of remainingNoticeList) {\r\n            const thisExtra = thisNotice.extra;\r\n            console.assert(thisExtra && thisExtra.length, `Expect thisNotice to have an \"extra\" field: ${JSON.stringify(thisNotice)}`)\r\n            const newNotice = { ...thisNotice };\r\n            // We don't need the extra field if we've already got this info\r\n            if (thisExtra !== thisNotice.repoName && thisExtra !== thisNotice.bookID)\r\n                newNotice.message = `${thisNotice.extra} ${thisNotice.message}`;\r\n            delete newNotice.extra; // since we've used it (if it existed)\r\n            newNoticeList.push(newNotice);\r\n        }\r\n        remainingNoticeList = newNoticeList;\r\n    }\r\n\r\n    // Count the number of occurrences of each message\r\n    //  ready for further processing\r\n    const allTotals = {};\r\n    for (const thisNotice of remainingNoticeList)\r\n        if (isNaN(allTotals[thisNotice.priority])) allTotals[thisNotice.priority] = 1;\r\n        else allTotals[thisNotice.priority]++;\r\n\r\n    return [remainingNoticeList, allTotals, resultObject];\r\n}\r\n// end of processNoticesCommon function\r\n\r\n\r\nexport function processNoticesToErrorsWarnings(givenNoticeObject, optionalProcessingOptions) {\r\n    /*\r\n        Available options are:\r\n            errorPriorityLevel (integer; default is DEFAULT_ERROR_PRIORITY_LEVEL above)\r\n            maximumSimilarMessages (integer; default is DEFAULT_MAXIMUM_SIMILAR_MESSAGES above)\r\n\r\n        Returns an object with:\r\n            successList: a list of strings describing what has been checked\r\n            errorList\r\n            warningList\r\n            numIgnoredNotices, numSuppressedErrors, numSuppressedWarnings\r\n            processingOptions: just helpfully passes on what we were given (may be undefined)\r\n        Also, any other parameters are just passed through,\r\n            although filenameList might be abbreviated, e.g. for 100s of .md files.\r\n    */\r\n    //     console.log(`processNoticesToErrorsWarnings v${NOTICE_PROCESSOR_VERSION_STRING} with options=${JSON.stringify(optionalProcessingOptions)}\r\n    //    Given ${givenNoticeObject.successList.length.toLocaleString()} success string(s) plus ${givenNoticeObject.noticeList.length.toLocaleString()} notice(s)`);\r\n\r\n    const [remainingNoticeList, allTotals, resultObject] = processNoticesCommon(givenNoticeObject, optionalProcessingOptions);\r\n\r\n    // Add the fields that we need here to the existing resultObject\r\n    resultObject.errorList = []; resultObject.warningList = [];\r\n    resultObject.numSuppressedErrors = 0; resultObject.numSuppressedWarnings = 0;\r\n\r\n    let maximumSimilarMessages;\r\n    try {\r\n        maximumSimilarMessages = optionalProcessingOptions.maximumSimilarMessages;\r\n    } catch (npfMSMerror) { }\r\n    if (typeof maximumSimilarMessages !== 'number' || isNaN(maximumSimilarMessages)) {\r\n        maximumSimilarMessages = DEFAULT_MAXIMUM_SIMILAR_MESSAGES;\r\n        // console.log(`Using default maximumSimilarMessages=${maximumSimilarMessages}`);\r\n    }\r\n    // else console.log(`Using supplied maximumSimilarMessages=${maximumSimilarMessages} cf. default=${DEFAULT_MAXIMUM_SIMILAR_MESSAGES}`);\r\n    let errorPriorityLevel;\r\n    try {\r\n        errorPriorityLevel = optionalProcessingOptions.errorPriorityLevel;\r\n    } catch (npfEPLerror) { }\r\n    if (errorPriorityLevel === undefined) {\r\n        errorPriorityLevel = DEFAULT_ERROR_PRIORITY_LEVEL;\r\n        // console.log(`Using default errorPriorityLevel=${errorPriorityLevel}`);\r\n    }\r\n    else console.log(`Using supplied errorPriorityLevel=${errorPriorityLevel} cf. default=${DEFAULT_ERROR_PRIORITY_LEVEL}`);\r\n\r\n    // Check for repeated notices that should be compressed\r\n    //  while simultaneously separating into error and warning lists\r\n    let counter = {};\r\n    for (const thisNotice of remainingNoticeList) {\r\n        const thisPriority = thisNotice.priority, thisMsg = thisNotice.message;\r\n        const thisID = thisPriority + thisMsg; // Could have identical worded messages but with different priorities\r\n        if (isNaN(counter[thisID])) counter[thisID] = 1;\r\n        else counter[thisID]++;\r\n        if (maximumSimilarMessages > 0 && counter[thisID] === maximumSimilarMessages + 1) {\r\n            if (thisPriority >= errorPriorityLevel) {\r\n                const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n                resultObject.errorList.push({ priority: -1, message: thisMsg, location: `  ${numSuppressed.toLocaleString()} MORE SIMILAR ERROR${numSuppressed === 1 ? '' : 'S'} SUPPRESSED` });\r\n                resultObject.numSuppressedErrors++;\r\n            } else {\r\n                const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n                resultObject.warningList.push({ priority: -1, message: thisMsg, location: `  ${numSuppressed.toLocaleString()} MORE SIMILAR WARNING${numSuppressed === 1 ? '' : 'S'} SUPPRESSED` });\r\n                resultObject.numSuppressedWarnings++;\r\n            }\r\n        } else if (maximumSimilarMessages > 0 && counter[thisID] > maximumSimilarMessages + 1) {\r\n            if (thisPriority >= errorPriorityLevel)\r\n                resultObject.numSuppressedErrors++;\r\n            else\r\n                resultObject.numSuppressedWarnings++;\r\n        } else if (thisPriority >= errorPriorityLevel)\r\n            resultObject.errorList.push(thisNotice);\r\n        else\r\n            resultObject.warningList.push(thisNotice);\r\n    }\r\n\r\n    // console.log(`processNoticesToErrorsWarnings is returning ${resultObject.successList.length} successes, ${resultObject.errorList.length} errors, and ${resultObject.warningList.length} warnings\r\n    //   numIgnoredNotices=${resultObject.numIgnoredNotices} numSuppressedErrors=${resultObject.numSuppressedErrors} numSuppressedWarnings=${resultObject.numSuppressedWarnings}`);\r\n    return resultObject;\r\n}\r\n// end of processNoticesToErrorsWarnings function\r\n\r\n\r\nexport function processNoticesToSevereMediumLow(givenNoticeObject, optionalProcessingOptions) {\r\n    /*\r\n        Available options are:\r\n            severePriorityLevel (integer; default is DEFAULT_SEVERE_PRIORITY_LEVEL above)\r\n            mediumPriorityLevel (integer; default is DEFAULT_MEDIUM_PRIORITY_LEVEL above)\r\n            maximumSimilarMessages (integer; default is DEFAULT_MAXIMUM_SIMILAR_MESSAGES above)\r\n\r\n        Returns an object with:\r\n            successList: a list of strings describing what has been checked\r\n            severeList\r\n            mediumList\r\n            lowList\r\n            numIgnoredNotices, numSevereSuppressed, numMediumSuppressed, numLowSuppressed\r\n            processingOptions: just helpfully passes on what we were given (may be undefined)\r\n        Also, any other parameters are just passed through,\r\n            although filenameList might be abbreviated, e.g. for 100s of .md files.\r\n    */\r\n    //     console.log(`processNoticesToSevereMediumLow v${NOTICE_PROCESSOR_VERSION_STRING} with options=${JSON.stringify(optionalProcessingOptions)}\r\n    //    Given ${givenNoticeObject.successList.length.toLocaleString()} success string(s) plus ${givenNoticeObject.noticeList.length.toLocaleString()} notice(s)`);\r\n\r\n    const [remainingNoticeList, allTotals, resultObject] = processNoticesCommon(givenNoticeObject, optionalProcessingOptions);\r\n\r\n    // Add the fields that we need here to the existing resultObject\r\n    resultObject.severeList = []; resultObject.mediumList = []; resultObject.lowList = [];\r\n    resultObject.numSevereSuppressed = 0; resultObject.numMediumSuppressed = 0; resultObject.numLowSuppressed = 0;\r\n\r\n    let maximumSimilarMessages;\r\n    try {\r\n        maximumSimilarMessages = optionalProcessingOptions.maximumSimilarMessages;\r\n    } catch (npfMSMerror) { }\r\n    if (typeof maximumSimilarMessages !== 'number' || isNaN(maximumSimilarMessages)) {\r\n        maximumSimilarMessages = DEFAULT_MAXIMUM_SIMILAR_MESSAGES;\r\n        // console.log(`Using default maximumSimilarMessages=${maximumSimilarMessages}`);\r\n    }\r\n    // else console.log(`Using supplied maximumSimilarMessages=${maximumSimilarMessages} cf. default=${DEFAULT_MAXIMUM_SIMILAR_MESSAGES}`);\r\n    let severePriorityLevel;\r\n    try {\r\n        severePriorityLevel = optionalProcessingOptions.severePriorityLevel;\r\n    } catch (npfSPLerror) { }\r\n    if (severePriorityLevel === undefined) {\r\n        severePriorityLevel = DEFAULT_SEVERE_PRIORITY_LEVEL;\r\n        // console.log(`Using default severePriorityLevel=${severePriorityLevel}`);\r\n    }\r\n    else console.log(`Using supplied severePriorityLevel=${severePriorityLevel} cf. default=${DEFAULT_SEVERE_PRIORITY_LEVEL}`);\r\n    let mediumPriorityLevel;\r\n    try {\r\n        mediumPriorityLevel = optionalProcessingOptions.mediumPriorityLevel;\r\n    } catch (nfpMPLerror) { }\r\n    if (mediumPriorityLevel === undefined) {\r\n        mediumPriorityLevel = DEFAULT_MEDIUM_PRIORITY_LEVEL;\r\n        // console.log(`Using default mediumPriorityLevel=${mediumPriorityLevel}`);\r\n    }\r\n    else console.log(`Using supplied mediumPriorityLevel=${mediumPriorityLevel} cf. default=${DEFAULT_MEDIUM_PRIORITY_LEVEL}`);\r\n\r\n    // Check for repeated notices that should be compressed\r\n    //  while simultaneously separating into error and warning lists\r\n    let counter = {};\r\n    for (const thisNotice of remainingNoticeList) {\r\n        const thisPriority = thisNotice.priority, thisMsg = thisNotice.message;\r\n        const thisID = thisPriority + thisMsg; // Could have identical worded messages but with different priorities\r\n        if (isNaN(counter[thisID])) counter[thisID] = 1;\r\n        else counter[thisID]++;\r\n        if (maximumSimilarMessages > 0 && counter[thisID] === maximumSimilarMessages + 1) {\r\n            if (thisPriority >= severePriorityLevel) {\r\n                const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n                resultObject.severeList.push({ priority: -1, message: thisMsg, location: `  ${numSuppressed.toLocaleString()} MORE SIMILAR ERROR${numSuppressed === 1 ? '' : 'S'} SUPPRESSED` });\r\n                resultObject.numSevereSuppressed++;\r\n            } else if (thisPriority >= mediumPriorityLevel) {\r\n                const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n                resultObject.mediumList.push({ priority: -1, message: thisMsg, location: `  ${numSuppressed.toLocaleString()} MORE SIMILAR ERROR${numSuppressed === 1 ? '' : 'S'} SUPPRESSED` });\r\n                resultObject.numMediumSuppressed++;\r\n            } else {\r\n                const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n                resultObject.lowList.push({ priority: -1, message: thisMsg, location: `  ${numSuppressed.toLocaleString()} MORE SIMILAR WARNING${numSuppressed === 1 ? '' : 'S'} SUPPRESSED` });\r\n                resultObject.numLowSuppressed++;\r\n            }\r\n        } else if (maximumSimilarMessages > 0 && counter[thisID] > maximumSimilarMessages + 1) {\r\n            if (thisPriority >= severePriorityLevel)\r\n                resultObject.numSevereSuppressed++;\r\n            else if (thisPriority >= mediumPriorityLevel)\r\n                resultObject.numMediumSuppressed++;\r\n            else\r\n                resultObject.numLowSuppressed++;\r\n        } else if (thisPriority >= severePriorityLevel)\r\n            resultObject.severeList.push(thisNotice);\r\n        else if (thisPriority >= mediumPriorityLevel)\r\n            resultObject.mediumList.push(thisNotice);\r\n        else\r\n            resultObject.lowList.push(thisNotice);\r\n    }\r\n\r\n    // console.log(`processNoticesToSevereMediumLow is returning ${resultObject.successList.length} successes, ${resultObject.severeList.length} severe, ${resultObject.mediumList.length} medium, and ${resultObject.lowList.length} low\r\n    //   numIgnoredNotices=${resultObject.numIgnoredNotices} numSevereSuppressed=${resultObject.numSevereSuppressed} numMediumSuppressed=${resultObject.numMediumSuppressed} numLowSuppressed=${resultObject.numLowSuppressed}`);\r\n    return resultObject;\r\n}\r\n// end of processNoticesToSevereMediumLow function\r\n\r\n\r\nexport function processNoticesToSingleList(givenNoticeObject, optionalProcessingOptions) {\r\n    /*\r\n        Available options are:\r\n            severePriorityLevel (integer; default is DEFAULT_SEVERE_PRIORITY_LEVEL above)\r\n            mediumPriorityLevel (integer; default is DEFAULT_MEDIUM_PRIORITY_LEVEL above)\r\n            maximumSimilarMessages (integer; default is DEFAULT_MAXIMUM_SIMILAR_MESSAGES above)\r\n\r\n        Returns an object with:\r\n            successList: a list of strings describing what has been checked\r\n            warningList\r\n            numIgnoredNotices, numSevereSuppressed, numMediumSuppressed, numLowSuppressed\r\n            processingOptions: just helpfully passes on what we were given (may be undefined)\r\n        Also, any other parameters are just passed through,\r\n            although filenameList might be abbreviated, e.g. for 100s of .md files.\r\n    */\r\n    //     console.log(`processNoticesToSingleList v${NOTICE_PROCESSOR_VERSION_STRING} with options=${JSON.stringify(optionalProcessingOptions)}\r\n    //    Given ${givenNoticeObject.successList.length.toLocaleString()} success string(s) plus ${givenNoticeObject.noticeList.length.toLocaleString()} notice(s)`);\r\n\r\n    // We default to sorting ByPriority unless something else was specified\r\n    let sortBy;\r\n    try {\r\n        sortBy = optionalProcessingOptions.sortBy;\r\n    } catch (npfSBerror) { }\r\n    if (sortBy === undefined)\r\n        optionalProcessingOptions.sortBy = 'ByPriority';\r\n\r\n    const [remainingNoticeList, allTotals, resultObject] = processNoticesCommon(givenNoticeObject, optionalProcessingOptions);\r\n\r\n    // Add the fields that we need here to the existing resultObject\r\n    resultObject.warningList = []; resultObject.numSuppressedWarnings = 0;\r\n\r\n    let maximumSimilarMessages;\r\n    try {\r\n        maximumSimilarMessages = optionalProcessingOptions.maximumSimilarMessages;\r\n    } catch (npfMSMerror) { }\r\n    if (typeof maximumSimilarMessages !== 'number' || isNaN(maximumSimilarMessages)) {\r\n        maximumSimilarMessages = DEFAULT_MAXIMUM_SIMILAR_MESSAGES;\r\n        // console.log(`Using default maximumSimilarMessages=${maximumSimilarMessages}`);\r\n    }\r\n    // else console.log(`Using supplied maximumSimilarMessages=${maximumSimilarMessages} cf. default=${DEFAULT_MAXIMUM_SIMILAR_MESSAGES}`);\r\n\r\n    // Check for repeated notices that should be compressed\r\n    //  while simultaneously creating warning list\r\n    let counter = {};\r\n    for (const thisNotice of remainingNoticeList) {\r\n        const thisPriority = thisNotice.priority, thisMsg = thisNotice.message;\r\n        const thisID = thisPriority + thisMsg; // Could have identical worded messages but with different priorities\r\n        if (isNaN(counter[thisID])) counter[thisID] = 1;\r\n        else counter[thisID]++;\r\n        if (maximumSimilarMessages > 0 && counter[thisID] === maximumSimilarMessages + 1) {\r\n            const numSuppressed = allTotals[thisPriority] - maximumSimilarMessages;\r\n            resultObject.warningList.push({ priority: thisPriority, message: thisMsg, location: `  ${numSuppressed.toLocaleString()} MORE SIMILAR WARNING${numSuppressed === 1 ? '' : 'S'} SUPPRESSED` });\r\n            resultObject.numSuppressedWarnings++;\r\n        } else if (maximumSimilarMessages > 0 && counter[thisID] > maximumSimilarMessages + 1) {\r\n            resultObject.numSuppressedWarnings++;\r\n        } else\r\n            resultObject.warningList.push(thisNotice);\r\n    }\r\n\r\n    // console.log(`processNoticesToSingleList is returning ${resultObject.successList.length} successes, ${resultObject.warningList.length} warnings\r\n    //   numIgnoredNotices=${resultObject.numIgnoredNotices} numSuppressedWarnings=${resultObject.numSuppressedWarnings}`);\r\n    return resultObject;\r\n}\r\n// end of processNoticesToSingleList function\r\n","import React from 'react';\r\n// import { forwardRef } from 'react';\r\n\r\n// NOTE: The following line is currently giving compile warnings -- a problem in a dependency it seems\r\nimport MaterialTable from 'material-table';\r\n\r\n// import { consoleLogObject, displayPropertyNames } from '../core/utilities';\r\n\r\n\r\n// Note from RJH: I commented out these fields because 1/ they seemed to cause warnings/errors,\r\n//  2/ I didn't understand what they do anyway.\r\n// so feel free to uncomment it if it makes the table work better.\r\n/*\r\nconst tableIcons = {\r\n    Add: forwardRef((props, ref) => <AddBox {...props} ref={ref} />),\r\n    Check: forwardRef((props, ref) => <Check {...props} ref={ref} />),\r\n    Clear: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n    Delete: forwardRef((props, ref) => <DeleteOutline {...props} ref={ref} />),\r\n    DetailPanel: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n    Edit: forwardRef((props, ref) => <Edit {...props} ref={ref} />),\r\n    Export: forwardRef((props, ref) => <SaveAlt {...props} ref={ref} />),\r\n    Filter: forwardRef((props, ref) => <FilterList {...props} ref={ref} />),\r\n    FirstPage: forwardRef((props, ref) => <FirstPage {...props} ref={ref} />),\r\n    LastPage: forwardRef((props, ref) => <LastPage {...props} ref={ref} />),\r\n    NextPage: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n    PreviousPage: forwardRef((props, ref) => <ChevronLeft {...props} ref={ref} />),\r\n    ResetSearch: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n    Search: forwardRef((props, ref) => <Search {...props} ref={ref} />),\r\n    SortArrow: forwardRef((props, ref) => <ArrowDownward {...props} ref={ref} />),\r\n    ThirdStateCheck: forwardRef((props, ref) => <Remove {...props} ref={ref} />),\r\n    ViewColumn: forwardRef((props, ref) => <ViewColumn {...props} ref={ref} />)\r\n  };\r\n  /* end material box imports and icons */\r\n\r\n\r\nexport function RenderLines({ text }) {\r\n    /**\r\n    * @description - Displays a given piece of text (which can include newline characters)\r\n    * @param {String} text - text to render as numbered lines\r\n    * @return {String} - rendered HTML for the numbered list of lines\r\n    */\r\n    return <ol>\r\n        {text.split('\\n').map(function (line, index) {\r\n            return <li key={index}>{line}</li>;\r\n        })}\r\n    </ol>;\r\n}\r\n\r\n\r\nconst MAX_ARRAY_ITEMS_TO_DISPLAY = 8; // Or do we want this as a parameter?\r\nexport function RenderObject({ thisObject, excludeList }) {\r\n    /**\r\n    * @description - Displays whatever is in the object\r\n    * @param {Object} thisObject - object to render\r\n    * @param {Array} excludeList - optional list of object property names to be ignored\r\n    * @return {String} - rendered HTML for list of thisObject properties\r\n    */\r\n    // console.log(\"In RenderObject\");\r\n    // consoleLogObject('RenderObject settings', settings);\r\n    return <ul>\r\n        {\r\n            Object.keys(thisObject).map((key, keyIndex) => {\r\n                if (!excludeList || excludeList.indexOf(key) < 0) {\r\n                    let displayObject = thisObject[key];\r\n                    if (Array.isArray(displayObject) && displayObject.length > MAX_ARRAY_ITEMS_TO_DISPLAY)\r\n                        displayObject = `(only first ${MAX_ARRAY_ITEMS_TO_DISPLAY} displayed here) ${JSON.stringify(displayObject.slice(0, MAX_ARRAY_ITEMS_TO_DISPLAY))}, etc`;\r\n                    return (\r\n                        <li key={keyIndex}>&nbsp;&nbsp;&nbsp;&nbsp;\r\n                            <span><b>{key}</b>{Array.isArray(thisObject[key]) ? ` (${thisObject[key].length.toLocaleString()}) ` : ''}: {typeof displayObject === 'object' ? JSON.stringify(displayObject) : displayObject}</span>\r\n                        </li>\r\n                    )\r\n                }\r\n                return null;\r\n            }, [])}\r\n    </ul>;\r\n}\r\n\r\n\r\nexport function RenderRawResults({ results }) {\r\n    /**\r\n    * @description - Displays the raw noticeList in a table\r\n    * @param {Object} results - object containing noticeList\r\n    * @return {String} - rendered HTML for table of notices\r\n    */\r\n    // This function is flexible enough to handle notice objects:\r\n    //      including bookID,C,V or not\r\n    //      including repoName, filename, lineNumber or not\r\n    //      including extra or not\r\n\r\n    // console.log(\"In RenderRawResults\");\r\n    // consoleLogObject('RenderRawResults results', results);\r\n    // displayPropertyNames('RenderRawResults results', results);\r\n\r\n    // Create a list of other property names\r\n    // let propertyList = [], newObject = {};\r\n    // for (const propertyName in results)\r\n    //     if (propertyName !== 'noticeList') {\r\n    //         newObject[propertyName] = results[propertyName];\r\n    //         propertyList.push(<p>{propertyName} = {results[propertyName]}</p>);\r\n    //     }\r\n    // consoleLogObject('propertyList', propertyList);\r\n\r\n    if (!results.noticeList || !results.noticeList.length)\r\n        return <>\r\n            <p><b>Raw Results</b> (no notices were produced):</p>\r\n            <RenderObject thisObject={results} excludeList={['noticeList']} />\r\n        </>;\r\n    // If we get here, we have notices.\r\n    // console.log(`Got ${results.noticeList.length} notices`);\r\n\r\n    // Discover what fields we have in our notice objects (in order to set our table headers below)\r\n    const allPropertiesSet = new Set();\r\n    let haveOBS = false, haveBible = false;\r\n    // console.log( \"allPropertiesSet-A\", JSON.stringify([...allPropertiesSet]));\r\n    for (const noticeEntry of results.noticeList)\r\n        // console.log(\"noticeEntry\", JSON.stringify(noticeEntry));\r\n        // console.log(`Found (${Object.keys(noticeEntry).length}) ${Object.keys(noticeEntry)}`);\r\n        for (const [noticePropertyName, noticePropertyValue] of Object.entries(noticeEntry))\r\n            // console.log(\"  Found\", noticePropertyName, \"=\", noticeEntry[noticePropertyName]);\r\n            if (noticePropertyValue !== undefined) {\r\n                allPropertiesSet.add(noticePropertyName);\r\n                if (noticePropertyName === 'bookID' && noticePropertyValue) {\r\n                    if (noticePropertyValue === 'OBS') haveOBS = true;\r\n                    else haveBible = true;\r\n                }\r\n            }\r\n    // console.log( \"allPropertiesSet-Z\", JSON.stringify([...allPropertiesSet]));\r\n\r\n    // Adjust the headers according to the column sets that we actually have in the noticeList\r\n    let headerData = [\r\n        { title: 'Priority', field: 'priority', type: 'numeric' },\r\n        { title: 'Message', field: 'message' },\r\n    ];\r\n    if (allPropertiesSet.has('details')) headerData = headerData.concat([{ title: 'Details', field: 'details' }]);\r\n    if (allPropertiesSet.has('bookID')) headerData = headerData.concat([{ title: 'Book', field: 'bookID' }]);\r\n    if (allPropertiesSet.has('C') || allPropertiesSet.has('V')) {\r\n        let CName = '???', VName = '???';\r\n        if (haveBible && !haveOBS) { CName = 'Chapter'; VName = 'Verse'; }\r\n        else if (haveOBS && !haveBible) { CName = 'Story'; VName = 'Frame'; }\r\n        else if (haveBible && haveOBS) { CName = 'Chapter/Story'; VName = 'Verse/Frame'; }\r\n        headerData = headerData.concat([\r\n            { title: CName, field: 'C' },\r\n            { title: VName, field: 'V' }\r\n        ]);\r\n    }\r\n    if (allPropertiesSet.has('rowID')) headerData = headerData.concat([{ title: 'ID', field: 'rowID' }]);\r\n    if (allPropertiesSet.has('repoName')) headerData = headerData.concat([{ title: 'Repo', field: 'repoName' }]);\r\n    if (allPropertiesSet.has('filename')) headerData = headerData.concat([{ title: 'Filename', field: 'filename' }]);\r\n    if (allPropertiesSet.has('fieldName')) headerData = headerData.concat([{ title: 'Field', field: 'fieldName' }]);\r\n    if (allPropertiesSet.has('lineNumber')) headerData = headerData.concat([{ title: 'Line', field: 'lineNumber' }]);\r\n    if (allPropertiesSet.has('characterIndex')) headerData = headerData.concat([{ title: 'CharIndex', field: 'characterIndex' }]);\r\n    if (allPropertiesSet.has('extract')) headerData = headerData.concat([{ title: 'Extract', field: 'extract' }]);\r\n    if (allPropertiesSet.has('location')) headerData = headerData.concat([{ title: 'Location', field: 'location' }]);\r\n    if (allPropertiesSet.has('extra')) headerData = headerData.concat([{ title: 'Extra', field: 'extra' }]);\r\n    // console.log(\"headerData\", headerData.length, JSON.stringify(headerData));\r\n\r\n    // Make the actual table and return it\r\n    return <>\r\n        <b>Raw Results</b>:\r\n        <RenderObject thisObject={results} />\r\n        <MaterialTable\r\n            // icons={tableIcons}\r\n            title={`All ${results.noticeList.length.toLocaleString()} Raw Notices`}\r\n            columns={headerData}\r\n            data={results.noticeList}\r\n            options={{ sorting: true, exportButton: true, exportAllData: true }}\r\n        />\r\n    </>;\r\n}\r\n\r\n\r\nexport function RenderMessage({ color, message, details }) {\r\n    /**\r\n    * @description - Displays the message plus details if specified\r\n    * @param {String} color - color field for the message style\r\n    * @param {String} message - notice text\r\n    * @param {String} details - (optional) extra notice text\r\n    * @return {String} - rendered HTML for the given reference\r\n    */\r\n    let detailsString = '';\r\n    if (details && details.length)\r\n        detailsString = ' with ' + (details[0] === '(' ? details : `'${details}'`);\r\n    return <><b style={{ color: color }}>{message}</b>{detailsString}</>;\r\n}\r\n\r\n\r\nexport function RenderBCV({ bookID, C, V }) {\r\n    /**\r\n    * @description - Displays the bookcode and chapter/verse details if specified\r\n    * @param {String} bookID - (optional) 3-character UPPERCASE USFM bookcode or 'OBS'.\r\n    * @param {String} C - (optional) chapter info\r\n    * @param {String} V - (optional) verse info\r\n    * @return {String} - rendered HTML for the given reference\r\n    */\r\n    // These are all optional parameters - they may be undefined or blank if irrelevant\r\n    // console.log(`RenderBCV(${bookID}, ${C}, ${V})`);\r\n    if (!bookID && !C && !V) return null; // They're all undefined or blank!\r\n    // console.log(`RenderBCV2 ${bookID}, ${C}, ${V}`);\r\n    let result;\r\n    if (bookID && bookID.length) result = bookID;\r\n    if (C && C.length) result = `${result}${result.length ? ' ' : ''}${C}`;\r\n    if (V && V.length) result = `${result}${result.length ? ':' : ''}${V}`;\r\n    if (result.length)\r\n        return <> {V && V.length ? 'at' : 'in'} <b>{result}</b></>;\r\n    return null;\r\n}\r\n\r\nexport function RenderFileDetails({ repoName, filename, lineNumber, rowID, fieldName }) {\r\n    /**\r\n    * @description - Displays the repoName and filename/lineNumber details if specified\r\n    * @param {String} repoName - (optional) repo name string\r\n    * @param {String} filename - (optional) filename string\r\n    * @param {Number} lineNumber - (optional) line number integer (1-based)\r\n    * @param {String} rowID - (optional) 4-character ID field\r\n    * @param {String} fieldName - (optional) name of field\r\n    * @return {String} - rendered HTML for the given reference\r\n    */\r\n    // These are all optional parameters - they may be undefined or blank if irrelevant\r\n    // console.log(`RenderFileDetails(${repoName}, ${filename}, ${lineNumber}, ${rowID}, ${fieldName})`);\r\n    if (!repoName && !filename && !lineNumber && !rowID && !fieldName)\r\n        return null; // They're all undefined or blank!\r\n    // console.log(`RenderFileDetails2 ${repoName}, ${filename}, ${lineNumber}`);\r\n    let resultStart = '', lineResult = '', resultEnd = '';\r\n    if (repoName && repoName.length) resultStart += ` in ${repoName} repository`;\r\n    if (filename && filename.length) resultStart += ` in file ${filename}`;\r\n    if (lineNumber) {\r\n        resultStart += ' on ';\r\n        lineResult = `line ${lineNumber.toLocaleString()}`;\r\n    }\r\n    if (rowID && rowID.length) resultEnd += ` with ID ${rowID}`;\r\n    if (fieldName && fieldName.length) resultEnd += ` in ${fieldName} field`;\r\n    return <>{resultStart}<b>{lineResult}</b>{resultEnd}</>;\r\n}\r\n\r\nexport function RenderSuccessesColored({ results }) {\r\n    // Display our array of success message strings in a nicer format\r\n    //\r\n    // Expects results to contain:\r\n    //      1/ successList\r\n    // console.log(\"In RenderSuccessesColored with \", successList);\r\n    // consoleLogObject('RenderSuccessesColored results', results);\r\n\r\n    let haveWarnings;\r\n    try { haveWarnings = results.errorList.length || results.warningList.length; }\r\n    catch (e1) {\r\n        try { haveWarnings = results.severeList.length || results.mediumList.length || results.lowList.length; }\r\n        catch (e2) { haveWarnings = results.warningList.length; }\r\n    }\r\n\r\n    return <ul>\r\n        {results.successList.map(function (listEntry, index) {\r\n            return <li key={index}>\r\n                <b style={{ color: haveWarnings ? 'limegreen' : 'green' }}>{listEntry}</b>\r\n            </li>;\r\n        })}\r\n    </ul>;\r\n}\r\n\r\nexport function RenderProcessedArray({ arrayType, results }) {\r\n    // Display our array of objects in a nicer format\r\n    //  priority (integer), message (string)\r\n    //  plus optional fields:\r\n    //      bookID, C, V, repoName, filename, lineNumber\r\n    //      characterIindex (integer), extract (string), location (string)\r\n    //\r\n    // console.log(\"In RenderProcessedArray with \", arrayType);\r\n    // consoleLogObject('RenderProcessedArray results', results);\r\n\r\n    if (arrayType === 's')\r\n        return <>\r\n            <RenderSuccessesColored results={results} />\r\n        </>;\r\n    else { // not 's' (successList)\r\n        const myList = arrayType === 'e' ? results.errorList : results.warningList;\r\n        return <ul>\r\n            {myList.map(function (listEntry, index) {\r\n                return <li key={index}>\r\n                    <RenderMessage color={arrayType === 'e' ? 'red' : 'orange'} message={listEntry.message} details={listEntry.details} />\r\n                    <RenderBCV bookID={listEntry.bookID} C={listEntry.C} V={listEntry.V} />\r\n                    <RenderFileDetails repoName={listEntry.repoName} filename={listEntry.filename} lineNumber={listEntry.lineNumber} rowID={listEntry.rowID} fieldName={listEntry.fieldName} />\r\n                    {listEntry.characterIndex > 0 ? \" (at character \" + (listEntry.characterIndex + 1) + \")\" : \"\"}\r\n                    <span style={{ color: 'DimGray' }}>{listEntry.extract ? \" around '\" + listEntry.extract + \"'\" : \"\"}</span>\r\n                    {listEntry.location}\r\n                    <small style={{ color: 'Gray' }}>{listEntry.priority >= 0 ? \" (Priority \" + listEntry.priority + \")\" : \"\"}</small>\r\n                </li>;\r\n            })}\r\n        </ul>;\r\n    }\r\n}\r\n\r\n\r\nexport function RenderGivenArray({ array, color }) {\r\n    // Display our array of objects in a nicer format\r\n    //  priority (integer), message (string),\r\n    //  plus possible optional fields:\r\n    //      bookID, C, V,\r\n    //      repoName, filename, lineNumber,\r\n    //      characterIndex (integer), extract (string), location (descriptive string)\r\n    //\r\n    // console.log(\"In RenderGivenArray with \", arrayType);\r\n    // consoleLogObject('RenderGivenArray results', results);\r\n\r\n    return <ul>\r\n        {array.map(function (listEntry, index) {\r\n            return <li key={index}>\r\n                <RenderMessage color={color} message={listEntry.message} details={listEntry.details} />\r\n                <RenderBCV bookID={listEntry.bookID} C={listEntry.C} V={listEntry.V} />\r\n                <RenderFileDetails repoName={listEntry.repoName} filename={listEntry.filename} lineNumber={listEntry.lineNumber} rowID={listEntry.rowID} fieldName={listEntry.fieldName} />\r\n                {listEntry.characterIndex !== undefined && listEntry.characterIndex >= 0 ? \" (at character \" + (listEntry.characterIndex + 1) + \" of line)\" : \"\"}\r\n                <span style={{ color: 'DimGray' }}>{listEntry.extract ? \" around '\" + listEntry.extract + \"'\" : \"\"}</span>\r\n                {listEntry.location}\r\n                <small style={{ color: 'Gray' }}>{listEntry.priority >= 0 ? \" (Priority \" + listEntry.priority + \")\" : \"\"}</small>\r\n            </li>;\r\n        })}\r\n    </ul>;\r\n}\r\n\r\n\r\nexport function getGradientcolor(priorityValue) {\r\n    // priorityValue is in range 1..999\r\n    //\r\n    // Returns a color value from red (highest priority) to orange (lower)\r\n    const red = `0${Math.floor(priorityValue * 255 / 999).toString(16)}`.slice(-2);\r\n    // const green = `0${Math.floor((1000-priorityValue) * 55 / 999).toString(16)}`.slice(-2);\r\n    // console.log(`getGradientcolor(${priorityValue}) -> red='${red}' green='${green}'`)\r\n    return `#${red}0000`; // or `#${red}${green}00`\r\n}\r\n\r\n\r\nexport function RenderWarningsGradient({ results }) {\r\n    // Display our array of 8-part lists in a nicer format\r\n    //  1/ priority number, 2/ bookID, 3/ C, 4/ V, 5/ message,\r\n    //      6/ index (integer), 7/ extract (optional), 8/ location\r\n    //\r\n    // Expects results to contain:\r\n    //      1/ warningList\r\n    // console.log(\"In RenderWarningsGradient with \", results.warningList);\r\n    // consoleLogObject('RenderWarningsGradient results', results);\r\n\r\n    return <ul>\r\n        {results.warningList.map(function (listEntry, index) {\r\n            const thiscolor = getGradientcolor(listEntry.priority);\r\n            return <li key={index}>\r\n                <RenderMessage color={thiscolor} message={listEntry.message} details={listEntry.details} />\r\n                <RenderBCV bookID={listEntry.bookID} C={listEntry.C} V={listEntry.V} />\r\n                <RenderFileDetails repoName={listEntry.repoName} filename={listEntry.filename} lineNumber={listEntry.lineNumber} rowID={listEntry.rowID} fieldName={listEntry.fieldName} />\r\n                {listEntry.characterIndex !== undefined && listEntry.characterIndex >= 0 ? \" (at character \" + (listEntry.characterIndex + 1) + \" of line)\" : \"\"}\r\n                <span style={{ color: 'DimGray' }}>{listEntry.extract ? \" around '\" + listEntry.extract + \"'\" : \"\"}</span>\r\n                {listEntry.location}\r\n                <small style={{ color: 'Gray' }}>{listEntry.priority >= 0 ? \" (Priority \" + listEntry.priority + \")\" : \"\"}</small>\r\n            </li>;\r\n        })}\r\n    </ul>;\r\n}\r\n\r\n\r\nexport function RenderErrors({ results }) {\r\n    // console.log(\"In RenderErrors\");\r\n    // consoleLogObject('RenderErrors results', results);\r\n    return <>\r\n        <b style={{ color: results.errorList.length ? 'red' : 'green' }}>{results.errorList.length.toLocaleString()} error{results.errorList.length === 1 ? '' : 's'}</b>{results.errorList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numSuppressedErrors ? \" (\" + results.numSuppressedErrors.toLocaleString() + \" similar one\" + (results.numSuppressedErrors === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        <RenderProcessedArray results={results} arrayType='e' />\r\n    </>;\r\n}\r\nexport function RenderWarnings({ results }) {\r\n    // console.log(\"In RenderWarnings\");\r\n    // consoleLogObject('RenderWarnings results', results);\r\n    return <>\r\n        <b style={{ color: results.warningList.length ? 'orange' : 'green' }}>{results.warningList.length.toLocaleString()} warning{results.warningList.length === 1 ? '' : 's'}</b>{results.warningList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numSuppressedWarnings ? \" (\" + results.numSuppressedWarnings.toLocaleString() + \" similar one\" + (results.numSuppressedWarnings === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        <RenderProcessedArray results={results} arrayType='w' />\r\n    </>;\r\n}\r\nexport function RenderErrorsAndWarnings({ results }) {\r\n    // console.log(\"In RenderErrorsAndWarnings\");\r\n    // consoleLogObject('RenderErrorsAndWarnings results', results);\r\n    return <>\r\n        <RenderErrors results={results} />\r\n        <RenderWarnings results={results} />\r\n    </>;\r\n}\r\n\r\n\r\nexport function RenderSevere({ results }) {\r\n    // console.log(\"In RenderSevere\");\r\n    // consoleLogObject('RenderSevere results', results);\r\n    return <>\r\n        <b style={{ color: results.severeList.length ? 'red' : 'green' }}>{results.severeList.length.toLocaleString()} severe error{results.severeList.length === 1 ? '' : 's'}</b>{results.severeList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numSevereSuppressed ? \" (\" + results.numSevereSuppressed.toLocaleString() + \" similar one\" + (results.numSevereSuppressed === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        <RenderGivenArray array={results.severeList} color='red' />\r\n    </>;\r\n}\r\nexport function RenderMedium({ results }) {\r\n    // console.log(\"In RenderSevere\");\r\n    // consoleLogObject('RenderSevere results', results);\r\n    return <>\r\n        <b style={{ color: results.mediumList.length ? 'maroon' : 'green' }}>{results.mediumList.length.toLocaleString()} medium error{results.mediumList.length === 1 ? '' : 's'}</b>{results.mediumList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numMediumSuppressed ? \" (\" + results.numMediumSuppressed.toLocaleString() + \" similar one\" + (results.numMediumSuppressed === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        <RenderGivenArray array={results.mediumList} color='maroon' />\r\n    </>;\r\n}\r\nexport function RenderLow({ results }) {\r\n    // console.log(\"In RenderLow\");\r\n    // consoleLogObject('RenderLow results', results);\r\n    return <>\r\n        <b style={{ color: results.lowList.length ? 'orange' : 'green' }}>{results.lowList.length.toLocaleString()} other warning{results.lowList.length === 1 ? '' : 's'}</b>{results.lowList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numLowSuppressed ? \" (\" + results.numLowSuppressed.toLocaleString() + \" similar one\" + (results.numLowSuppressed === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        <RenderGivenArray array={results.lowList} color='orange' />\r\n    </>;\r\n}\r\nexport function RenderSevereMediumLow({ results }) {\r\n    // console.log(\"In RenderSevereMediumLow\");\r\n    // consoleLogObject('RenderSevereMediumLow results', results);\r\n    return <>\r\n        <RenderSevere results={results} />\r\n        <RenderMedium results={results} />\r\n        <RenderLow results={results} />\r\n    </>;\r\n}\r\n\r\n\r\nexport function RenderSuccessesErrorsWarnings({ results }) {\r\n    // console.log(\"In RenderSuccessesErrorsWarnings\");\r\n\r\n    // consoleLogObject('RenderSuccessesErrorsWarnings results', results);\r\n\r\n    const haveErrorsOrWarnings = results.errorList.length || results.warningList.length;\r\n\r\n    let successCount;\r\n    if (results.successList.length === 1) successCount = 'One';\r\n    else if (results.successList.length === 2) successCount = 'Two';\r\n    else if (results.successList.length === 3) successCount = 'Three';\r\n    else if (results.successList.length === 4) successCount = 'Four';\r\n    else if (results.successList.length === 5) successCount = 'Five';\r\n    else successCount = results.successList.length.toLocaleString();\r\n\r\n    return <>\r\n        <b style={{ color: haveErrorsOrWarnings ? 'limegreen' : 'green' }}>{successCount.toLocaleString()} check{results.successList.length === 1 ? '' : 's'} completed</b>{results.successList.length ? ':' : ''}\r\n        <RenderSuccessesColored results={results} />\r\n        {haveErrorsOrWarnings ? <RenderErrorsAndWarnings results={results} /> : \"\"}\r\n    </>;\r\n}\r\n\r\n\r\nexport function RenderSuccessesSevereMediumLow({ results }) {\r\n    // console.log(\"In RenderSuccessesSevereMediumLow\");\r\n\r\n    // consoleLogObject('RenderSuccessesSevereMediumLow results', results);\r\n\r\n    const haveErrorsOrWarnings = results.severeList.length || results.mediumList.length || results.lowList.length;\r\n\r\n    let successCount;\r\n    if (results.successList.length === 1) successCount = 'One';\r\n    else if (results.successList.length === 2) successCount = 'Two';\r\n    else if (results.successList.length === 3) successCount = 'Three';\r\n    else if (results.successList.length === 4) successCount = 'Four';\r\n    else if (results.successList.length === 5) successCount = 'Five';\r\n    else successCount = results.successList.length.toLocaleString();\r\n\r\n    return <>\r\n        <b style={{ color: haveErrorsOrWarnings ? 'limegreen' : 'green' }}>{successCount.toLocaleString()} check{results.successList.length === 1 ? '' : 's'} completed</b>{results.successList.length ? ':' : ''}\r\n        <RenderSuccessesColored results={results} />\r\n        {haveErrorsOrWarnings ? <RenderSevereMediumLow results={results} /> : \"\"}\r\n    </>;\r\n}\r\n\r\nexport function RenderSuccessesWarningsGradient({ results }) {\r\n    // console.log(\"In RenderSuccessesWarningsGradient\");\r\n\r\n    // consoleLogObject('RenderSuccessesWarningsGradient results', results);\r\n\r\n    let successCount;\r\n    if (results.successList.length === 1) successCount = 'One';\r\n    else if (results.successList.length === 2) successCount = 'Two';\r\n    else if (results.successList.length === 3) successCount = 'Three';\r\n    else if (results.successList.length === 4) successCount = 'Four';\r\n    else if (results.successList.length === 5) successCount = 'Five';\r\n    else successCount = results.successList.length.toLocaleString();\r\n\r\n    return <>\r\n        <b style={{ color: results.warningList.length ? 'limegreen' : 'green' }}>{successCount.toLocaleString()} check{results.successList.length === 1 ? '' : 's'} completed</b>{results.successList.length ? ':' : ''}\r\n        <RenderSuccessesColored results={results} />\r\n        <b style={{ color: results.warningList.length ? 'orange' : 'green' }}>{results.warningList.length.toLocaleString()} warning notice{results.warningList.length === 1 ? '' : 's'}</b>{results.warningList.length ? ':' : ''}\r\n        <small style={{ color: 'Gray' }}>{results.numSuppressedWarnings ? \" (\" + results.numSuppressedWarnings.toLocaleString() + \" similar one\" + (results.numSuppressedWarnings === 1 ? '' : 's') + \" suppressed)\" : ''}</small>\r\n        {results.warningList.length ? <RenderWarningsGradient results={results} /> : \"\"}\r\n    </>;\r\n}\r\n\r\n\r\nexport function RenderElapsedTime({ elapsedSeconds }) {\r\n    const seconds = Math.round(elapsedSeconds % 60);\r\n    let remainingTime = Math.floor(elapsedSeconds / 60);\r\n    const minutes = Math.round(remainingTime % 60);\r\n    remainingTime = Math.floor(remainingTime / 60);\r\n    const hours = Math.round(remainingTime % 24);\r\n    remainingTime = Math.floor(remainingTime / 24);\r\n    console.assert(remainingTime === 0, `Elapsed time also contains ${remainingTime} days`);\r\n    return <>{hours ? `${hours} hour` : ''}{hours && hours !== 1 ? 's' : ''}{hours ? ', ' : ''}{minutes ? `${minutes} minute` : ''}{minutes && minutes !== 1 ? 's' : ''}{minutes ? ', ' : ''}{seconds} second{seconds === 1 ? '' : 's'}</>;\r\n}\r\n","export * from './books';\r\n","export function isWhitespace(myString) {\r\n    if (/^\\s+$/.test(myString)) return true;\r\n    return false;\r\n}\r\n\r\n\r\nexport function countOccurrences(mainString, subString, allowOverlapping = false) {\r\n    // Adapted from https://stackoverflow.com/questions/4009756/how-to-count-string-occurrence-in-string\r\n\r\n    mainString += '';\r\n    subString += '';\r\n    if (subString.length <= 0) return (mainString.length + 1);\r\n\r\n    let n = 0,\r\n        pos = 0,\r\n        step = allowOverlapping ? 1 : subString.length;\r\n\r\n    while (true) {\r\n        pos = mainString.indexOf(subString, pos);\r\n        if (pos >= 0) {\r\n            ++n;\r\n            pos += step;\r\n        } else break;\r\n    }\r\n    return n;\r\n}\r\n// end of countOccurrences function\r\n","import {checkTextField} from './field-text-check';\r\n\r\n\r\nconst MARKDOWN_VALIDATOR_VERSION_STRING = '0.3.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport function checkMarkdownText(textName, markdownText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire markdown file, i.e., all lines.\r\n\r\n    Note: This function does not check that any link targets in the markdown are valid links.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`checkMarkdownText(${textName}, ${markdownText.length}, ${givenLocation})`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    // if (textName) ourLocation = ` in ${textName}${ourLocation}`;\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (mdtcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(\"Using default extractLength=\" + extractLength);\r\n    }\r\n    // else\r\n        // console.log(\"Using supplied extractLength=\" + extractLength, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    // const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    // const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(\"Using halfLength=\" + halfLength, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const result = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(\"checkMarkdownText success: \" + successString);\r\n        result.successList.push(successString);\r\n    }\r\n    function addNotice6(noticeObject) {\r\n        // console.log(`checkMarkdownText addNotice6: (priority=${noticeObject.priority}) ${noticeObject.message}${noticeObject.characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${noticeObject.extract ? \" \" + extract : \"\"}${noticeObject.location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"cMdT addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `cMdT addNotice6: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"cMdT addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `cMdT addNotice6: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(characterIndex !== undefined, \"cMdT addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cMdT addNotice6: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cMdT addNotice6: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cMdT addNotice6: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"cMdT addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `cMdT addNotice6: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        result.noticeList.push({ ...noticeObject, filename:textName });\r\n    }\r\n    // end of addNotice6 function\r\n\r\n    function ourCheckTextField(lineNumber, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} optionalFieldLocation - description of where the field is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        // console.log(`cMdT ourCheckTextField(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${optionalFieldLocation}, )`);\r\n        console.assert(lineNumber !== undefined, \"cMdT ourCheckTextField: 'lineNumber' parameter should be defined\");\r\n        console.assert(typeof lineNumber === 'number', `cMdT ourCheckTextField: 'lineNumber' parameter should be a number not a '${typeof lineNumber}'`);\r\n        console.assert(fieldText !== undefined, \"cMdT ourCheckTextField: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cMdT ourCheckTextField: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"cMdT ourCheckTextField: allowedLinks parameter must be either true or false\");\r\n\r\n        const dbtcResultObject = checkTextField('', fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(dbtcResultObject.noticeList);\r\n        // If we need to put everything through addNotice6, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of dbtcResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `MD ourCheckTextField notice length=${Object.keys(noticeEntry).length}`);\r\n            if (!noticeEntry.message.startsWith(\"Unexpected doubled * characters\") // 577 Markdown allows this\r\n                && !noticeEntry.message.startsWith(\"Unexpected * character after space\") // 191\r\n            )\r\n                addNotice6({ ...noticeEntry, lineNumber });\r\n        }\r\n    }\r\n    // end of ourCheckTextField function\r\n\r\n\r\n    function checkMarkdownLineContents(lineNumber, lineText, lineLocation) {\r\n\r\n        // console.log(`checkMarkdownLineContents for '${lineName} ${lineText}' at${lineLocation}`);\r\n        let thisText = lineText\r\n\r\n        // Remove leading and trailing hash signs\r\n        thisText = thisText.replace(/^#+|#$/g, '')\r\n        // console.log(`After removing hashes have '${thisText}'`);\r\n\r\n        // Remove leading spaces\r\n        thisText = thisText.replace(/^ +/g, '')\r\n        // console.log(`After removing leading spaces have '${thisText}'`);\r\n\r\n        // // Remove leading asterisks\r\n        // thisText = thisText.replace(/^\\*/g,'')\r\n        // console.log(`After removing asterisks have '${thisText}'`);\r\n\r\n        // // Remove leading spaces again now\r\n        // thisText = thisText.replace(/^ +/g,'')\r\n        // console.log(`After removing more leading spaces have '${thisText}'`);\r\n\r\n        if (thisText)\r\n            ourCheckTextField(lineNumber, thisText, true, lineLocation, optionalCheckingOptions);\r\n    }\r\n    // end of checkMarkdownLine function\r\n\r\n\r\n    // Main code for checkMarkdownText function\r\n    const lines = markdownText.split('\\n');\r\n    // console.log(`  '${location}' has ${lines.length.toLocaleString()} total lines`);\r\n\r\n    let headerLevel = 0;\r\n    let lastNumLeadingSpaces = 0;\r\n    // let lastLineContents;\r\n    for (let n = 1; n <= lines.length; n++) {\r\n\r\n        const line = lines[n - 1];\r\n        let numLeadingSpaces;\r\n        if (line) {\r\n\r\n            const thisHeaderLevel = line.match(/^#*/)[0].length;\r\n            // console.log(`Got thisHeaderLevel=${thisHeaderLevel} for ${line}${atString}`);\r\n            if (thisHeaderLevel > headerLevel + 1)\r\n                addNotice6({priority:172, message:\"Header levels should only increment by one\", lineNumber:n, characterIndex:0, location:ourLocation});\r\n            if (thisHeaderLevel > 0)\r\n                headerLevel = thisHeaderLevel;\r\n\r\n            numLeadingSpaces = line.match(/^ */)[0].length;\r\n            // console.log(`Got numLeadingSpaces=${numLeadingSpaces} for ${line}${atString}`);\r\n            if (numLeadingSpaces && lastNumLeadingSpaces && numLeadingSpaces !== lastNumLeadingSpaces)\r\n                addNotice6({priority:472, message:\"Nesting seems confused\", lineNumber:n, characterIndex:0, location:ourLocation});\r\n\r\n            checkMarkdownLineContents(n, line, ourLocation);\r\n        } else {\r\n            // This is a blank line\r\n            numLeadingSpaces = 0;\r\n        }\r\n\r\n        // lastLineContents = line;\r\n        lastNumLeadingSpaces = numLeadingSpaces;\r\n    }\r\n\r\n    addSuccessMessage(`Checked all ${lines.length.toLocaleString()} line${lines.length === 1 ? '' : 's'}${ourLocation}.`);\r\n    if (result.noticeList)\r\n        addSuccessMessage(`checkMarkdownText v${MARKDOWN_VALIDATOR_VERSION_STRING} finished with ${result.noticeList.length ? result.noticeList.length.toLocaleString() : \"zero\"} notice${result.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by checkMarkdownText v${MARKDOWN_VALIDATOR_VERSION_STRING}`)\r\n    // console.log(`  checkMarkdownText returning with ${result.successList.length.toLocaleString()} success(es), ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkMarkdownText result is\", JSON.stringify(result));\r\n    return result;\r\n}\r\n// end of checkMarkdownText function\r\n\r\n\r\n//export default checkMarkdownText;\r\n","import { isWhitespace, countOccurrences } from './text-handling-functions'\r\n\r\n//const VALIDATOR_VERSION_STRING = '0.1.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport function checkTextfileContents(languageCode, filename, fileText, optionalFileLocation, optionalCheckingOptions) {\r\n    // Does basic checks for small errors like mismatched punctuation pairs, etc.\r\n    //  (Used by usfm-text-check)\r\n\r\n    // filename (str): Used for identification\r\n    // fileText (str): The field being checked\r\n    // allowedLinks (bool): doesn't check links -- only checks lack of links\r\n    // optionalFileLocation (str): Used to inform where this field is located\r\n\r\n    // We assume that checking for compulsory fields is done elsewhere\r\n\r\n    // Returns a single notice list\r\n    //  The list contains objects with the following fields:\r\n    //      priority (compulsory): the priority number 0..999 (usually 800+ are errors, lower are warnings)\r\n    //      message (compulsory): the error description string\r\n    //      characterIndeX: the 0-based index for the position in the string\r\n    //      extract: a short extract of the string containing the error (or empty-string if irrelevant)\r\n    //      location: the detailed location string\r\n    //  (Returned in this way for more intelligent processing at a higher level)\r\n    // console.log(`checkTextfileContents(${filename}, ${fileText.length.toLocaleString()} chars, ${allowedLinks}, '${optionalFileLocation}')`);\r\n    console.assert(filename !== undefined, \"checkTextfileContents: 'filename' parameter should be defined\");\r\n    console.assert(typeof filename === 'string', `checkTextfileContents: 'filename' parameter should be a number not a '${typeof filename}': ${filename}`);\r\n    console.assert(fileText !== undefined, \"checkTextfileContents: 'fileText' parameter should be defined\");\r\n    console.assert(typeof fileText === 'string', `checkTextfileContents: 'fileText' parameter should be a number not a '${typeof fileText}': ${fileText}`);\r\n    // console.assert( allowedLinks===true || allowedLinks===false, \"checkTextfileContents: allowedLinks parameter must be either true or false\");\r\n\r\n    let result = { noticeList: [] };\r\n\r\n    function addNotice6(noticeObject) {\r\n        // console.log(`dBTC Notice: (priority=${noticeObject.priority}) ${noticeObject.message}${noticeObject.characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${noticeObject.extract ? ` ${noticeObject.extract}` : \"\"}${noticeObject.location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"dBTCs addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `dBTCs addNotice6: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"dBTCs addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `dBTCs addNotice6: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(characterIndex !== undefined, \"dBTCs addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `dBTCs addNotice6: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"dBTCs addNotice6: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `dBTCs addNotice6: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"dBTCs addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `dBTCs addNotice6: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        result.noticeList.push(noticeObject);\r\n    }\r\n\r\n\r\n    // Main code for checkTextfileContents()\r\n    if (!fileText) // Nothing to check\r\n        return result;\r\n\r\n    // Create our more detailed location string by prepending the filename\r\n    let ourLocation = optionalFileLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n\r\n    if (isWhitespace(fileText)) {\r\n        addNotice6({ priority: 638, message: \"Only found whitespace\", location: ourLocation });\r\n        return result;\r\n    }\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (bfcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    let characterIndex;\r\n    if ((characterIndex = fileText.indexOf('<<<<<<<')) >= 0) {\r\n        const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n        const extract = (iy > halfLength ? '' : '') + fileText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '') + (iy + halfLengthPlus < fileText.length ? '' : '')\r\n        addNotice6({ priority: 993, message: \"Unresolved GIT conflict\", characterIndex, extract, location: ourLocation });\r\n    } else if ((characterIndex = fileText.indexOf('=======')) >= 0) {\r\n        const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n        const extract = (iy > halfLength ? '' : '') + fileText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '') + (iy + halfLengthPlus < fileText.length ? '' : '')\r\n        addNotice6({ priority: 992, message: \"Unresolved GIT conflict\", characterIndex, extract, location: ourLocation });\r\n    } else if ((characterIndex = fileText.indexOf('>>>>>>>>')) >= 0) {\r\n        const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n        const extract = (iy > halfLength ? '' : '') + fileText.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '') + (iy + halfLengthPlus < fileText.length ? '' : '')\r\n        addNotice6({ priority: 991, message: \"Unresolved GIT conflict\", characterIndex, extract, location: ourLocation });\r\n    }\r\n\r\n    // Check matched pairs in the file\r\n    for (const punctSet of [['[', ']'], ['(', ')'], ['{', '}'],\r\n    ['<', '>'], ['', ''], ['', ''],\r\n    ['', ''], ['', ''], ['**_', '_**']]) {\r\n        // Can't check '' coz they might be used as apostrophe\r\n        const leftChar = punctSet[0], rightChar = punctSet[1];\r\n        const leftCount = countOccurrences(fileText, leftChar);\r\n        const rightCount = countOccurrences(fileText, rightChar);\r\n        if (leftCount !== rightCount)\r\n            // NOTE: These are lower priority than similar checks in a field\r\n            //          since they occur only within the entire file\r\n            addNotice6({ priority: leftChar === '' ? 162 : 462, message: `Mismatched ${leftChar}${rightChar} characters`, details: `(left=${leftCount.toLocaleString()}, right=${rightCount.toLocaleString()})`, location: ourLocation });\r\n    }\r\n\r\n    // if (!allowedLinks) {\r\n    //     // Simple check that there aren't any\r\n    //     ix = fileText.indexOf('://');\r\n    //     if (ix === -1) ix = fileText.indexOf('http');\r\n    //     if (ix === -1) ix = fileText.indexOf('ftp');\r\n    //     // The following might have to be removed if text fields can contain email addresses\r\n    //     if (ix === -1) ix = fileText.indexOf('.org');\r\n    //     if (ix === -1) ix = fileText.indexOf('.com');\r\n    //     if (ix === -1) ix = fileText.indexOf('.info');\r\n    //     if (ix === -1) ix = fileText.indexOf('.bible');\r\n    //     if (ix >= 0) {\r\n    //         let extract = (ix>halfLength ? '' : '') + fileText.substring(ix-halfLength, ix+halfLengthPlus) + (ix+halfLengthPlus < fileText.length ? '' : '')\r\n    //         addNotice6({765, \"Unexpected link\", ix,extract, ourAtString});\r\n    //     }\r\n    // }\r\n    return result;\r\n}\r\n// end of checkTextfileContents function\r\n\r\n//export default checkTextfileContents;\r\n","import {checkTextField} from './field-text-check';\r\n\r\n\r\nconst PLAIN_TEXT_VALIDATOR_VERSION_STRING = '0.1.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport function checkPlainText(textName, plainText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire text, i.e., all lines.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    console.log(`checkPlainText(${textName}, ${plainText.length}, ${givenLocation}, ${JSON.stringify(optionalCheckingOptions)})`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (textName) ourLocation = ` in ${textName}${ourLocation}`;\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (ptcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    // const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    // const halfLengthPlus = Math.floor((extractLength+1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const cptResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkPlainText success: ${successString}`);\r\n        cptResult.successList.push(successString);\r\n    }\r\n    function addNotice9(noticeObject) {\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // console.log(`checkPlainText notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"cPT addNotice9: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `cPT addNotice9: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"cPT addNotice9: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `cPT addNotice9: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        console.assert(noticeObject.bookID !== undefined, \"cPT addNotice9: 'bookID' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cPT addNotice9: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract!==undefined, \"cPT addNotice9: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cPT addNotice9: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"cPT addNotice9: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `cPT addNotice9: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        cptResult.noticeList.push(noticeObject);\r\n    }\r\n\r\n    function ourCheckTextField(lineNumber, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} optionalFieldLocation - description of where the field is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        // console.log(`cPT ourCheckTextField(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${fieldLocation}, )`);\r\n        console.assert(lineNumber !== undefined, \"cPT ourCheckTextField: 'lineNumber' parameter should be defined\");\r\n        console.assert(typeof lineNumber === 'number', `cPT ourCheckTextField: 'fieldName' parameter should be a string not a '${typeof lineNumber}'`);\r\n        console.assert(fieldText !== undefined, \"cPT ourCheckTextField: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cPT ourCheckTextField: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"cPT ourCheckTextField: allowedLinks parameter must be either true or false\");\r\n\r\n        const resultObject = checkTextField('', fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // cptResult.noticeList = cptResult.noticeList.concat(resultObject.noticeList);\r\n        // If we need to put everything through addNotice9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of resultObject.noticeList)\r\n            addNotice9({ ...noticeEntry, lineNumber });\r\n    }\r\n    // end of ourCheckTextField function\r\n\r\n    function checkPlainLineContents(lineNumber, lineText, lineLocation) {\r\n\r\n        // console.log(`checkPlainLineContents for '${lineName}', '${lineText}' at${lineLocation}`);\r\n        let thisText = lineText.trimStart(); // So we don't get \"leading space\" and \"doubled spaces\" errors\r\n\r\n        if (thisText)\r\n            ourCheckTextField(lineNumber, thisText, false, lineLocation, optionalCheckingOptions);\r\n    }\r\n    // end of checkPlainLine function\r\n\r\n\r\n    // Main code for checkPlainText function\r\n    const lines = plainText.split('\\n');\r\n    // console.log(`  '${location}' has ${lines.length.toLocaleString()} total lines`);\r\n\r\n    // let headerLevel = 0;\r\n    // let lastNumLeadingSpaces = 0;\r\n    // let lastLineContents;\r\n    for (let n = 1; n <= lines.length; n++) {\r\n\r\n        const line = lines[n - 1];\r\n        if (line) {\r\n            checkPlainLineContents(n, line, ourLocation);\r\n        } else {\r\n            // This is a blank line\r\n        }\r\n\r\n        // lastLineContents = line;\r\n    }\r\n\r\n    addSuccessMessage(`Checked all ${lines.length.toLocaleString()} line${lines.length === 1 ? '' : 's'}${ourLocation}.`);\r\n    if (cptResult.noticeList)\r\n        addSuccessMessage(`checkPlainText v${PLAIN_TEXT_VALIDATOR_VERSION_STRING} finished with ${cptResult.noticeList.length ? cptResult.noticeList.length.toLocaleString() : \"zero\"} notice${cptResult.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by checkPlainText v${PLAIN_TEXT_VALIDATOR_VERSION_STRING}`)\r\n    // console.log(`  checkPlainText returning with ${result.successList.length.toLocaleString()} success(es), ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkPlainText result is\", JSON.stringify(result));\r\n    return cptResult;\r\n}\r\n// end of checkPlainText function\r\n\r\n\r\n//export default checkPlainText;\r\n","import * as books from './books/books';\r\nimport {checkTextField} from './field-text-check';\r\nimport {checkMarkdownText} from './markdown-text-check';\r\nimport {checkTAReference} from './ta-reference-check';\r\nimport {checkTNLinks} from './tn-links-check';\r\nimport {checkOriginalLanguageQuote} from './quote-check';\r\n\r\n\r\n// const TN_TABLE_ROW_VALIDATOR_VERSION_STRING = '0.4.2';\r\n\r\nconst NUM_EXPECTED_TN_TSV_FIELDS = 9; // so expects 8 tabs per line\r\nconst EXPECTED_TN_HEADING_LINE = 'Book\\tChapter\\tVerse\\tID\\tSupportReference\\tOrigQuote\\tOccurrence\\tGLQuote\\tOccurrenceNote';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport async function checkTN_TSVDataRow(languageCode, line, bookID, C, V, givenRowLocation, optionalCheckingOptions) {\r\n    /**\r\n    * @description - Checks one TSV data row of translation notes (TN)\r\n    * @param {String} line - the TSV line to be checked\r\n    * @param {String} bookID - 3-character UPPERCASE USFM book identifier\r\n    * @param {String} C - chapter number string\r\n    * @param {String} V - verse number string\r\n    * @param {String} givenRowLocation - description of where the line is located\r\n    * @param {Object} optionalCheckingOptions - may contain extractLength parameter\r\n    * @return {Object} - containing noticeList\r\n    */\r\n    /* This function is only for checking one data row\r\n          and the function doesn't assume that it has any previous context.\r\n\r\n        It's designed to be able to quickly show errors for a single row being displayed/edited.\r\n\r\n        Returns an object containing the noticeList.\r\n    */\r\n    // console.log(`checkTN_TSVDataRow(${bookID}, ${line}, ${givenRowLocation}, ${JSON.stringify(optionalCheckingOptions)})`);\r\n    console.assert(line !== undefined, \"checkTN_TSVDataRow: 'line' parameter should be defined\");\r\n    console.assert(typeof line === 'string', `checkTN_TSVDataRow: 'line' parameter should be a string not a '${typeof line}'`);\r\n    console.assert(bookID !== undefined, \"checkTN_TSVDataRow: 'bookID' parameter should be defined\");\r\n    console.assert(typeof bookID === 'string', `checkTN_TSVDataRow: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n    console.assert(bookID.length === 3, `checkTN_TSVDataRow: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n    console.assert(books.isValidBookID(bookID), `checkTN_TSVDataRow: '${bookID}' is not a valid USFM book identifier`);\r\n    // console.assert(C !== undefined, \"checkTN_TSVDataRow: 'C' parameter should be defined\");\r\n    if (C) console.assert(typeof C === 'string', `checkTN_TSVDataRow: 'C' parameter should be a string not a '${typeof C}'`);\r\n    // console.assert(V !== undefined, \"checkTN_TSVDataRow: 'V' parameter should be defined\");\r\n    if (V) console.assert(typeof V === 'string', `checkTN_TSVDataRow: 'V' parameter should be a string not a '${typeof V}'`);\r\n    console.assert(givenRowLocation !== undefined, \"checkTN_TSVDataRow: 'givenRowLocation' parameter should be defined\");\r\n    console.assert(typeof givenRowLocation === 'string', `checkTN_TSVDataRow: 'givenRowLocation' parameter should be a string not a '${typeof givenRowLocation}'`);\r\n\r\n    let ourRowLocation = givenRowLocation;\r\n    if (ourRowLocation && ourRowLocation[0] !== ' ') ourRowLocation = ` ${ourRowLocation}`;\r\n\r\n    let drResult = { noticeList: [] };\r\n\r\n    function addNotice6to9(noticeObject) {\r\n        /**\r\n        * @description - adds a new notice entry, adding bookID,C,V to the given fields\r\n        * @param {Number} priority - notice priority from 1 (lowest) to 999 (highest)\r\n        * @param {String} message - the text of the notice message\r\n        * @param {String} rowID - 4-character row ID field\r\n        * @param {Number} lineNumber - one-based line number\r\n        * @param {Number} characterIndex - zero-based index of where the issue occurs in the line\r\n        * @param {String} extract - short extract from the line centred on the problem (if available)\r\n        * @param {String} location - description of where the issue is located\r\n        */\r\n        // console.log(`Annotation TSV Row Notice: (priority=${priority}) ${message}, ${characterIndex}, ${extract}, ${location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"checkTN_TSVDataRow addNotice6to9: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `checkTN_TSVDataRow addNotice6to9: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"checkTN_TSVDataRow addNotice6to9: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `checkTN_TSVDataRow addNotice6to9: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(lineNumber !== undefined, \"checkTN_TSVDataRow addNotice6to9: 'lineNumber' parameter should be defined\");\r\n        // console.assert(typeof lineNumber === 'number', `checkTN_TSVDataRow addNotice6to9: 'lineNumber' parameter should be a number not a '${typeof lineNumber}': ${lineNumber}`);\r\n        // console.assert(characterIndex !== undefined, \"checkTN_TSVDataRow addNotice6to9: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `checkTN_TSVDataRow addNotice6to9: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"checkTN_TSVDataRow addNotice6to9: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `checkTN_TSVDataRow addNotice6to9: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"checkTN_TSVDataRow addNotice6to9: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `checkTN_TSVDataRow addNotice6to9: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        // Also uses the given bookID,C,V, parameters from the main function call\r\n        drResult.noticeList.push({ ...noticeObject, bookID, C, V });\r\n    }\r\n\r\n    function ourMarkdownTextChecks(rowID, fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given markdown field and processes the returned results\r\n        * @param {String} rowID - 4-character row ID field\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} rowLocation - description of where the line is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does markdown checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n\r\n        // We don't currently use the allowedLinks parameter\r\n\r\n        // console.log(`checkTN_TSVDataRow ourCheckTextField(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${rowLocation}, )`);\r\n        console.assert(rowID !== undefined, \"checkTN_TSVDataRow ourMarkdownTextChecks: 'rowID' parameter should be defined\");\r\n        console.assert(typeof rowID === 'string', `checkTN_TSVDataRow ourMarkdownTextChecks: 'rowID' parameter should be a string not a '${typeof rowID}'`);\r\n        // console.assert(fieldName !== undefined, \"checkTN_TSVDataRow ourMarkdownTextChecks: 'fieldName' parameter should be defined\");\r\n        // console.assert(typeof fieldName === 'string', `checkTN_TSVDataRow ourMarkdownTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldName === 'OccurrenceNote', \"checkTN_TSVDataRow ourMarkdownTextChecks: Only run this check on OccurrenceNotes\")\r\n        console.assert(fieldText !== undefined, \"checkTN_TSVDataRow ourMarkdownTextChecks: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `checkTN_TSVDataRow ourMarkdownTextChecks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"checkTN_TSVDataRow ourMarkdownTextChecks: allowedLinks parameter must be either true or false\");\r\n        console.assert(rowLocation.indexOf(fieldName) < 0, `checkTN_TSVDataRow ourMarkdownTextChecks: 'rowLocation' parameter should be not contain fieldName=${fieldName}`);\r\n\r\n        const cmtResultObject = checkMarkdownText(fieldName, fieldText, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(cmtResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of cmtResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourMarkdownTextChecks notice length=${Object.keys(noticeEntry).length}`);\r\n            // NOTE: Ellipses in OccurrenceNote have the normal meaning\r\n            //          not like the specialised meaning in the snippet fields OrigQuote and GLQuote\r\n            if (noticeEntry.priority !== 178 && noticeEntry.priority !== 179 // unexpected space after ellipse, ellipse after space\r\n                && !noticeEntry.message.startsWith(\"Unexpected  character after space\") // 191\r\n            )\r\n                addNotice6to9({ ...noticeEntry, rowID, fieldName });\r\n        }\r\n    }\r\n    // end of ourMarkdownTextChecks function\r\n\r\n    function ourCheckTextField(rowID, fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} rowID - 4-character row ID field\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} rowLocation - description of where the line is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`checkTN_TSVDataRow ourCheckTextField(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${rowLocation}, )`);\r\n        console.assert(rowID !== undefined, \"checkTN_TSVDataRow ourCheckTextField: 'rowID' parameter should be defined\");\r\n        console.assert(typeof rowID === 'string', `checkTN_TSVDataRow ourCheckTextField: 'rowID' parameter should be a string not a '${typeof rowID}'`);\r\n        console.assert(fieldName !== undefined, \"checkTN_TSVDataRow ourCheckTextField: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `checkTN_TSVDataRow ourCheckTextField: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"checkTN_TSVDataRow ourCheckTextField: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `checkTN_TSVDataRow ourCheckTextField: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"checkTN_TSVDataRow ourCheckTextField: allowedLinks parameter must be either true or false\");\r\n        console.assert(rowLocation.indexOf(fieldName) < 0, `checkTN_TSVDataRow ourCheckTextField: 'rowLocation' parameter should be not contain fieldName=${fieldName}`);\r\n\r\n        const dbtcResultObject = checkTextField(fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(dbtcResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of dbtcResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTextField notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({ ...noticeEntry, rowID, fieldName });\r\n        }\r\n    }\r\n    // end of ourCheckTextField function\r\n\r\n    async function ourCheckTAReference(rowID, fieldName, taLinkText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the TA reference can be found\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`checkTN_TSVDataRow ourCheckTAReference(${fieldName}, (${taLinkText.length}) '${taLinkText}', ${rowLocation}, )`);\r\n        console.assert(rowID !== undefined, \"checkTN_TSVDataRow ourCheckTAReference: 'rowID' parameter should be defined\");\r\n        console.assert(typeof rowID === 'string', `checkTN_TSVDataRow ourCheckTAReference: 'rowID' parameter should be a string not a '${typeof rowID}'`);\r\n        console.assert(fieldName !== undefined, \"checkTN_TSVDataRow ourCheckTAReference: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `checkTN_TSVDataRow ourCheckTAReference: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(taLinkText !== undefined, \"checkTN_TSVDataRow ourCheckTAReference: 'taLinkText' parameter should be defined\");\r\n        console.assert(typeof taLinkText === 'string', `checkTN_TSVDataRow ourCheckTAReference: 'taLinkText' parameter should be a string not a '${typeof taLinkText}'`);\r\n        console.assert(rowLocation.indexOf(fieldName) < 0, `checkTN_TSVDataRow ourCheckTAReference: 'rowLocation' parameter should be not contain fieldName=${fieldName}`);\r\n\r\n        const coqResultObject = await checkTAReference(fieldName, taLinkText, rowLocation, { ...optionalCheckingOptions, taRepoLanguageCode: languageCode });\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTAReference notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({ ...noticeEntry, rowID, fieldName });\r\n        }\r\n    }\r\n    // end of ourCheckTAReference function\r\n\r\n    async function ourCheckTNOriginalLanguageQuote(rowID, fieldName, fieldText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the Hebrew/Greek quote can be found in the original texts\r\n\r\n        // Uses the bookID,C,V values from the main function call\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`checkTN_TSVDataRow ourCheckTNOriginalLanguageQuote(${fieldName}, (${fieldText.length}) '${fieldText}', ${rowLocation}, )`);\r\n        console.assert(rowID !== undefined, \"checkTN_TSVDataRow ourMarkdownTextChecks: 'rowID' parameter should be defined\");\r\n        console.assert(typeof rowID === 'string', `checkTN_TSVDataRow ourMarkdownTextChecks: 'rowID' parameter should be a string not a '${typeof rowID}'`);\r\n        console.assert(fieldName !== undefined, \"checkTN_TSVDataRow ourMarkdownTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `checkTN_TSVDataRow ourMarkdownTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"checkTN_TSVDataRow ourCheckTNOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `checkTN_TSVDataRow ourCheckTNOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(rowLocation.indexOf(fieldName) < 0, `checkTN_TSVDataRow ourCheckTNOriginalLanguageQuote: 'rowLocation' parameter should be not contain fieldName=${fieldName}`);\r\n\r\n        const coqResultObject = await checkOriginalLanguageQuote(fieldName, fieldText, bookID, C, V, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTNOriginalLanguageQuote notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({ ...noticeEntry, rowID, fieldName });\r\n        }\r\n    }\r\n    // end of ourCheckTNOriginalLanguageQuote function\r\n\r\n    async function ourCheckTNLinks(rowID, fieldName, taLinkText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the TA reference can be found\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`checkTN_TSVDataRow ourCheckTNLinks(${fieldName}, (${taLinkText.length}) '${taLinkText}', ${rowLocation}, )`);\r\n        console.assert(rowID !== undefined, \"checkTN_TSVDataRow ourCheckTNLinks: 'rowID' parameter should be defined\");\r\n        console.assert(typeof rowID === 'string', `checkTN_TSVDataRow ourCheckTNLinks: 'rowID' parameter should be a string not a '${typeof rowID}'`);\r\n        console.assert(fieldName !== undefined, \"checkTN_TSVDataRow ourCheckTNLinks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `checkTN_TSVDataRow ourCheckTNLinks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(taLinkText !== undefined, \"checkTN_TSVDataRow ourCheckTNLinks: 'taLinkText' parameter should be defined\");\r\n        console.assert(typeof taLinkText === 'string', `checkTN_TSVDataRow ourCheckTNLinks: 'taLinkText' parameter should be a string not a '${typeof taLinkText}'`);\r\n\r\n        const coqResultObject = await checkTNLinks(bookID, fieldName, taLinkText, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTNLinks notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({ ...noticeEntry, rowID, fieldName });\r\n        }\r\n    }\r\n    // end of ourCheckTNLinks function\r\n\r\n\r\n    // Main code for checkTN_TSVDataRow function\r\n    if (line === EXPECTED_TN_HEADING_LINE) // Assume it must be ok\r\n        return drResult; // We can't detect if it's in the wrong place\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (tlcELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    // const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    // const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const lowercaseBookID = bookID.toLowerCase();\r\n    let numChaptersThisBook;\r\n    try {\r\n        numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n    } catch (tlcNCerror) {\r\n        addNotice6to9({ priority: 979, message: \"Invalid book identifier passed to checkTN_TSVDataRow\", location: ` '${bookID}' in first parameter: ${tlcNCerror}` });\r\n    }\r\n    const haveGoodBookID = numChaptersThisBook !== undefined;\r\n\r\n    let fields = line.split('\\t');\r\n    if (fields.length === NUM_EXPECTED_TN_TSV_FIELDS) {\r\n        const [B, C, V, rowID, supportReference, origQuote, occurrence, GLQuote, occurrenceNote] = fields;\r\n        // let withString = ` with '${rowID}'${inString}`;\r\n        // let CV_withString = ` ${C}:${V}${withString}`;\r\n        // let atString = ` at ${B} ${C}:${V} (${rowID})${inString}`;\r\n\r\n        // Check the fields one-by-one\r\n        if (B.length) {\r\n            if (B !== bookID)\r\n                addNotice6to9({ priority: 978, message: `Wrong '${B}' book identifier`, rowID, location: ` (expected '${bookID}')${ourRowLocation}` });\r\n        }\r\n        else\r\n            addNotice6to9({ priority: 977, message: \"Missing book identifier\", characterIndex: 0, rowID, location: ourRowLocation });\r\n\r\n        let numVersesThisChapter, haveGoodChapterNumber;\r\n        if (C.length) {\r\n            if (C === 'front') { }\r\n            else if (/^\\d+$/.test(C)) {\r\n                let intC = Number(C);\r\n                if (intC === 0) {\r\n                    addNotice6to9({ priority: 824, message: `Invalid zero chapter number`, extract: C, rowID, location: ourRowLocation });\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n                // TODO: Does this next section need rewriting (see verse check below)???\r\n                else if (intC > numChaptersThisBook) {\r\n                    addNotice6to9({ priority: 823, message: `Invalid large chapter number`, extract: C, rowID, location: ourRowLocation });\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n                try {\r\n                    numVersesThisChapter = books.versesInChapter(lowercaseBookID, intC);\r\n                    haveGoodChapterNumber = true;\r\n                } catch (tlcNVerror) {\r\n                    if (!haveGoodBookID)\r\n                        // addNotice6to9({priority:500, \"Invalid chapter number\", rowLocation);\r\n                        // else\r\n                        addNotice6to9({ priority: 822, message: \"Unable to check chapter number\", rowID, location: ` '${C}'${ourRowLocation}` });\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n            }\r\n            else\r\n                addNotice6to9({ priority: 821, message: \"Bad chapter number\", rowID, location: ` '${C}' with${ourRowLocation}` });\r\n        }\r\n        else\r\n            addNotice6to9({ priority: 820, message: \"Missing chapter number\", rowID, location: ` ?:${V}${ourRowLocation}` });\r\n\r\n        if (V.length) {\r\n            if (V === 'intro') { }\r\n            else if (/^\\d+$/.test(V)) {\r\n                let intV = Number(V);\r\n                if (intV === 0)\r\n                    addNotice6to9({ priority: 814, message: `Invalid zero '${V}' verse number`, rowID, location: ourRowLocation });\r\n                else {\r\n                    if (haveGoodChapterNumber) {\r\n                        if (intV > numVersesThisChapter)\r\n                            addNotice6to9({ priority: 813, message: `Invalid large '${V}' verse number`, rowID, location: ` for chapter ${C}${ourRowLocation}` });\r\n                    } else\r\n                        addNotice6to9({ priority: 812, message: \"Unable to check verse number\", rowID, location: ` '${V}'${ourRowLocation}` });\r\n                }\r\n            }\r\n            else\r\n                addNotice6to9({ priority: 811, message: \"Bad verse number\", rowID, location: ` '${V}'${ourRowLocation}` });\r\n        }\r\n        else\r\n            addNotice6to9({ priority: 810, message: \"Missing verse number\", rowID, location: ` after ${C}:?${ourRowLocation}` });\r\n\r\n        if (!rowID.length)\r\n            addNotice6to9({ priority: 779, message: \"Missing ID field\", location: ourRowLocation });\r\n        else {\r\n            if (rowID.length !== 4)\r\n                addNotice6to9({ priority: 778, message: \"ID should be exactly 4 characters\", rowID, location: ` (not ${rowID.length})${ourRowLocation}` });\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(rowID[0]) < 0)\r\n                addNotice6to9({ priority: 176, message: \"ID should start with a lowercase letter or digit\", characterIndex: 0, rowID, location: ` (not '${rowID[0]}')${ourRowLocation}` });\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(rowID[3]) < 0)\r\n                addNotice6to9({ priority: 175, message: \"ID should end with a lowercase letter or digit\", characterIndeX: 3, rowID, location: ` (not '${rowID[3]}')${ourRowLocation}` });\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(rowID[1]) < 0)\r\n                addNotice6to9({ priority: 174, message: \"ID characters should only be lowercase letters, digits, or hypen\", characterIndex: 1, rowID, location: ` (not '${rowID[1]}')${ourRowLocation}` });\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(rowID[2]) < 0)\r\n                addNotice6to9({ priority: 173, message: \"ID characters should only be lowercase letters, digits, or hypen\", characterIndex: 2, rowID, location: ` (not '${rowID[2]}')${ourRowLocation}` });\r\n        }\r\n\r\n        if (supportReference.length) { // need to check TN against TA\r\n            ourCheckTextField(rowID, 'SupportReference', supportReference, true, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTAReference(rowID, 'SupportReference', supportReference, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        // // TODO: Check if this is really required????\r\n        // else if (/^\\d+$/.test(C) && /^\\d+$/.test(V)) // C:V are both digits\r\n        //     addNotice6to9({ priority: 877, message: \"Missing SupportReference field\", fieldName: 'SupportReference', rowID, location: ourRowLocation });\r\n\r\n        if (origQuote.length) { // need to check UTN against UHB and UGNT\r\n            ourCheckTextField(rowID, 'OrigQuote', origQuote, false, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTNOriginalLanguageQuote(rowID, 'OrigQuote', origQuote, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        else // TODO: Find more details about when these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n            if (V !== 'intro' && occurrence !== '0')\r\n                addNotice6to9({ priority: 919, message: \"Missing OrigQuote field\", rowID, location: ourRowLocation });\r\n\r\n        if (occurrence.length) { // This should usually be a digit\r\n            if (occurrence === '0') { // zero means that it doesn't occur\r\n                if (origQuote.length)\r\n                    addNotice6to9({ priority: 550, message: \"Invalid zero occurrence field when we have an original quote\", rowID, location: ourRowLocation });\r\n                // if (V !== 'intro')\r\n                //     addNotice6to9({priority:500, message:\"Invalid zero occurrence field\", rowID, location:rowLocation);\r\n            }\r\n            else if (occurrence === '-1') // TODO check the special conditions when this can occur???\r\n                ;\r\n            else if ('12345'.indexOf(occurrence) < 0) // it's not one of these integers\r\n                addNotice6to9({ priority: 792, message: `Invalid '${occurrence}' occurrence field`, rowID, location: ourRowLocation });\r\n        }\r\n\r\n        if (GLQuote.length) { // TODO: need to check UTN against ULT\r\n            if (V !== 'intro')\r\n                ourCheckTextField(rowID, 'GLQuote', GLQuote, false, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        // else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n        //     if (V !== 'intro')\r\n        //         addNotice6to9({ priority: 275, message: \"Missing GLQuote field\", rowID, location: ourRowLocation });\r\n\r\n        if (occurrenceNote.length) {\r\n            ourMarkdownTextChecks(rowID, 'OccurrenceNote', occurrenceNote, true, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTNLinks(rowID, 'OccurrenceNote', occurrenceNote, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n            addNotice6to9({ priority: 274, message: \"Missing OccurrenceNote field\", rowID, location: ourRowLocation });\r\n\r\n    } else\r\n        addNotice6to9({ priority: 861, message: `Found wrong number of TSV fields (expected ${NUM_EXPECTED_TN_TSV_FIELDS})`, extract: `Found ${fields.length} field${fields.length === 1 ? '' : 's'}`, location: ourRowLocation });\r\n\r\n    // console.log(`  checkTN_TSVDataRow returning with ${drResult.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkTN_TSVDataRow result is\", JSON.stringify(drResult));\r\n    return drResult; // object with noticeList only\r\n}\r\n// end of checkTN_TSVDataRow function\r\n\r\n//export default checkTN_TSVDataRow;\r\n","import { getFileCached } from '../core/getApi';\r\n// import { consoleLogObject } from '../core/utilities';\r\n\r\n\r\n// const TA_REFERENCE_VALIDATOR_VERSION_STRING = '0.2.2';\r\n\r\n// const DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport async function checkTAReference(fieldName, fieldText, givenLocation, optionalCheckingOptions) {\r\n    // This is for the case of the full SupportReference field being the article link\r\n    //  which is assumed to be in the translate part of the TA manual.\r\n\r\n    // We fetch the TA link from Door43 to test that it's really there\r\n    //  -- you can control this with:\r\n    //      optionalCheckingOptions.taRepoUsername\r\n    //      optionalCheckingOptions.taRepoBranch (or tag)\r\n    //      optionalCheckingOptions.taRepoLanguageCode\r\n    //      optionalCheckingOptions.taRepoSectionName\r\n\r\n    // console.log(`checkTAReference v${TA_REFERENCE_VALIDATOR_VERSION_STRING} (${fieldName}, (${fieldText.length}) '${fieldText}', ${givenLocation}, )`);\r\n    console.assert(fieldName !== undefined, \"checkTAReference: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldName === 'string', `checkTAReference: 'fieldText' parameter should be a string not a '${typeof fieldName}'`);\r\n    console.assert(fieldText !== undefined, \"checkTAReference: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldText === 'string', `checkTAReference: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n    console.assert(givenLocation !== undefined, \"checkTAReference: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof givenLocation === 'string', `checkTAReference: 'fieldText' parameter should be a string not a '${typeof givenLocation}'`);\r\n    console.assert(fieldName === 'SupportReference', `Unexpected checkTAReference fieldName='${fieldName}'`); // so far\r\n    console.assert(givenLocation.indexOf(fieldName) < 0, `checkTAReference: 'givenLocation' parameter should be not contain fieldName=${fieldName}`);\r\n\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    // if (fieldName) ourLocation = ` in ${fieldName}${ourLocation}`;\r\n\r\n    const ctarResult = { noticeList: [] };\r\n\r\n    function addNotice6(noticeObject) {\r\n        // console.log(`checkTAReference Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"cTAref addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `cTAref addNotice6: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"cTAref addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `cTAref addNotice6: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(characterIndex !== undefined, \"cTAref addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cTAref addNotice6: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cTAref addNotice6: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cTAref addNotice6: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"cTAref addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `cTAref addNotice6: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        ctarResult.noticeList.push(noticeObject);\r\n    }\r\n\r\n\r\n    // Main code for checkTAReference\r\n    /*\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (trcELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, \"cf. default=\"+DEFAULT_EXTRACT_LENGTH);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, \"halfLengthPlus=\"+halfLengthPlus);\r\n    */\r\n\r\n    let username;\r\n    try {\r\n        username = optionalCheckingOptions.taRepoUsername;\r\n    } catch (trcUNerror) { }\r\n    if (!username) username = 'unfoldingWord'; // or Door43-Catalog ???\r\n    let branch;\r\n    try {\r\n        branch = optionalCheckingOptions.taRepoBranch;\r\n    } catch (trcBRerror) { }\r\n    if (!branch) branch = 'master';\r\n    let languageCode;\r\n    try {\r\n        languageCode = optionalCheckingOptions.taRepoLanguageCode;\r\n    } catch (trcLCerror) { }\r\n    if (!languageCode) languageCode = 'en';\r\n    let sectionName;\r\n    try {\r\n        sectionName = optionalCheckingOptions.taRepoSectionName;\r\n    } catch (trcSNerror) { }\r\n    if (!sectionName) sectionName = 'translate';\r\n    const taRepoName = `${languageCode}_ta`;\r\n    const filepath = `${sectionName}/${fieldText}/01.md`; // Other files are title.md, sub-title.md\r\n\r\n    // console.log(`Need to check against ${taRepoName}`);\r\n    let taFileContent; // Not really used here -- just to show that we got something valid\r\n    try {\r\n        const getFile_ = (optionalCheckingOptions && optionalCheckingOptions.getFile) ? optionalCheckingOptions.getFile : getFileCached;\r\n        taFileContent = await getFile_({ username, repository: taRepoName, path: filepath, branch });\r\n        // console.log(\"Fetched fileContent for\", taRepoName, filepath, typeof fileContent, fileContent.length);\r\n    } catch (trcGCerror) {\r\n        console.log(\"ERROR: Failed to load\", username, taRepoName, filepath, branch, trcGCerror.message);\r\n        addNotice6({priority:888, message:`Error loading ${fieldName} TA link`, extract:fieldText, location:`${ourLocation} ${filepath}: ${trcGCerror}`});\r\n    }\r\n    if (!taFileContent)\r\n        addNotice6({priority:889, message:`Unable to find ${fieldName} TA link`, extract:fieldText, location:`${ourLocation} ${filepath}`});\r\n    else if ( taFileContent.length < 10)\r\n        addNotice6({priority:887, message:`Linked ${fieldName} TA article seems empty`, extract:fieldText, location:`${ourLocation} ${filepath}`});\r\n\r\n    // console.log(`checkTAReference is returning ${JSON.stringify(ctarResult)}`);\r\n    return ctarResult;\r\n}\r\n// end of checkTAReference function\r\n\r\n\r\n//export default checkTAReference;\r\n","import * as books from '../core/books/books';\r\nimport { getFileCached } from '../core/getApi';\r\nimport { ourParseInt } from './utilities';\r\n// import { consoleLogObject } from '../core/utilities';\r\n\r\n\r\n// const TN_LINKS_VALIDATOR_VERSION_STRING = '0.2.2';\r\n\r\n// const DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport async function checkTNLinks(bookID, fieldName, fieldText, givenLocation, optionalCheckingOptions) {\r\n    /* This is for the case of the OccurrenceNote field containing markdown links\r\n\r\n    bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n\r\n    These notes may contain links\r\n        to TA, e.g., (See: [[rc://en/ta/man/translate/figs-metaphor]] and \r\n        to TWs, e.g., (See: [[rc://en/tw/dict/bible/other/death]] and \r\n        To Bibles, e.g.,  how you translated this in [Revelation 3:11](../03/11.md).\r\n\r\n    // We fetch the TA link from Door43 to test that it's really there\r\n    //  -- you can control this with:\r\n    //      optionalCheckingOptions.taRepoUsername\r\n    //      optionalCheckingOptions.taRepoBranch (or tag)\r\n    //      optionalCheckingOptions.taRepoDefaultLanguageCode\r\n    */\r\n\r\n    // console.log(`checkTNLinks v${TN_LINKS_VALIDATOR_VERSION_STRING} ${bookID} (${fieldName}, (${fieldText.length}) '${fieldText}', ${givenLocation}, )`);\r\n    console.assert(bookID !== undefined, \"checkTNLinks: 'bookID' parameter should be defined\");\r\n    console.assert(typeof bookID === 'string', `checkTNLinks: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n    console.assert(bookID.length === 3, `checkTNLinks: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n    console.assert(books.isValidBookID(bookID), `checkTNLinks: '${bookID}' is not a valid USFM book identifier`);\r\n    console.assert(fieldName !== undefined, \"checkTNLinks: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldName === 'string', `checkTNLinks: 'fieldText' parameter should be a string not a '${typeof fieldName}'`);\r\n    console.assert(fieldText !== undefined, \"checkTNLinks: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldText === 'string', `checkTNLinks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n    console.assert(givenLocation !== undefined, \"checkTNLinks: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof givenLocation === 'string', `checkTNLinks: 'fieldText' parameter should be a string not a '${typeof givenLocation}'`);\r\n    console.assert(fieldName === 'OccurrenceNote' || fieldName === 'Annotation', `Unexpected checkTNLinks fieldName='${fieldName}'`);\r\n\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n\r\n    const ctarResult = { noticeList: [] };\r\n\r\n    function addNotice6(noticeObject) {\r\n        // console.log(`checkTNLinks Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"cTNlnk addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `cTNlnk addNotice6: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"cTNlnk addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `cTNlnk addNotice6: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(characterIndex !== undefined, \"cTNlnk addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cTNlnk addNotice6: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cTNlnk addNotice6: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cTNlnk addNotice6: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"cTNlnk addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `cTNlnk addNotice6: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        ctarResult.noticeList.push(noticeObject);\r\n    }\r\n\r\n\r\n    // Main code for checkTNLinks\r\n    /*\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (trcELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n    */\r\n\r\n  const getFile_ = (optionalCheckingOptions && optionalCheckingOptions.getFile) ? optionalCheckingOptions.getFile : getFileCached;\r\n  let username;\r\n    try {\r\n        username = optionalCheckingOptions.taRepoUsername;\r\n    } catch (trcUNerror) { }\r\n    if (!username) username = 'unfoldingWord'; // or Door43-Catalog ???\r\n    let branch;\r\n    try {\r\n        branch = optionalCheckingOptions.taRepoBranch;\r\n    } catch (trcBRerror) { }\r\n    if (!branch) branch = 'master';\r\n    let defaultLanguageCode;\r\n    try {\r\n        defaultLanguageCode = optionalCheckingOptions.taRepoLanguageCode;\r\n    } catch (trcLCerror) { }\r\n    if (!defaultLanguageCode) defaultLanguageCode = 'en';\r\n\r\n\r\n    // Check TA links like [[rc://en/ta/man/translate/figs-metaphor]]\r\n    let resultArray;\r\n    // console.log(\"checkTNLinks: Search for TA links\")\r\n    const taRegex = new RegExp('\\\\[\\\\[rc://([^ /]+?)/ta/man/([^ /]+?)/([^ \\\\]]+?)\\\\]\\\\]', 'g');\r\n    // eslint-disable-next-line no-cond-assign\r\n    while (resultArray = taRegex.exec(fieldText)) {\r\n        // console.log(`  resultArray=${JSON.stringify(resultArray)}`);\r\n        console.assert(resultArray.length === 4, `Expected 4 fields (not ${resultArray.length})`)\r\n        let languageCode = resultArray[1];\r\n        if (!languageCode || languageCode === '*') languageCode = defaultLanguageCode;\r\n        const taRepoName = `${languageCode}_ta`;\r\n        // console.log(`Got taRepoName=${taRepoName}`);\r\n        const filepath = `${resultArray[2]}/${resultArray[3]}/01.md`; // Other files are title.md, sub-title.md\r\n        // console.log(`Got tA filepath=${filepath}`);\r\n\r\n        // console.log(`Need to check against ${taRepoName}`);\r\n        let taFileContent; // Not really used here -- just to show that we got something valid\r\n        try {\r\n            taFileContent = await getFile_({ username, repository: taRepoName, path: filepath, branch });\r\n            // console.log(\"Fetched fileContent for\", taRepoName, filepath, typeof fileContent, fileContent.length);\r\n        } catch (trcGCerror) {\r\n            console.log(\"ERROR: Failed to load\", username, taRepoName, filepath, branch, trcGCerror.message);\r\n            addNotice6({priority:885, message:`Error loading ${fieldName} TA link`, extract:resultArray[0], location:`${ourLocation} ${filepath}: ${trcGCerror}`});\r\n        }\r\n        if (!taFileContent)\r\n            addNotice6({priority:886, message:`Unable to find ${fieldName} TA link`, extract:resultArray[0], location:`${ourLocation} ${filepath}`});\r\n        else if (taFileContent.length < 10)\r\n            addNotice6({priority:884, message:`Linked ${fieldName} TA article seems empty`, extract:resultArray[0], location:`${ourLocation} ${filepath}`});\r\n    }\r\n\r\n    // Check TW links like [[rc://en/tw/dict/bible/other/death]]\r\n    // console.log(\"checkTNLinks: Search for TW links\")\r\n    const twRegex = new RegExp('\\\\[\\\\[rc://([^ /]+?)/tw/dict/bible/([^ /]+?)/([^ \\\\]]+?)\\\\]\\\\]', 'g');\r\n    // eslint-disable-next-line no-cond-assign\r\n    while (resultArray = twRegex.exec(fieldText)) {\r\n        // console.log(`  resultArray=${JSON.stringify(resultArray)}`);\r\n        console.assert(resultArray.length === 4, `Expected 4 fields (not ${resultArray.length})`)\r\n        let languageCode = resultArray[1];\r\n        if (!languageCode || languageCode === '*') languageCode = defaultLanguageCode;\r\n        const twRepoName = `${languageCode}_tw`;\r\n        // console.log(`Got twRepoName=${twRepoName}`);\r\n        const filepath = `bible/${resultArray[2]}/${resultArray[3]}.md`; // Other files are title.md, sub-title.md\r\n        // console.log(`Got tW filepath=${filepath}`);\r\n\r\n        // console.log(`Need to check against ${twRepoName}`);\r\n        let taFileContent; // Not really used here -- just to show that we got something valid\r\n        try {\r\n            taFileContent = await getFile_({ username, repository: twRepoName, path: filepath, branch });\r\n            // console.log(\"Fetched fileContent for\", twRepoName, filepath, typeof fileContent, fileContent.length);\r\n        } catch (trcGCerror) {\r\n            console.log(\"ERROR: Failed to load\", username, twRepoName, filepath, branch, trcGCerror.message);\r\n            addNotice6({priority:882, message:`Error loading ${fieldName} TW link`, extract:resultArray[0], location:`${ourLocation} ${filepath}: ${trcGCerror}`});\r\n        }\r\n        if (!taFileContent)\r\n            addNotice6({priority:883, message:`Unable to find ${fieldName} TW link`, extract:resultArray[0], location:`${ourLocation} ${filepath}`});\r\n        else if (taFileContent.length < 10)\r\n            addNotice6({priority:881, message:`Linked ${fieldName} TW article seems empty`, extract:resultArray[0], location:`${ourLocation} ${filepath}`});\r\n    }\r\n\r\n    // Check Bible links like [Revelation 3:11](../03/11.md)\r\n    const lowercaseBookID = bookID.toLowerCase();\r\n    let numChaptersThisBook;\r\n    try {\r\n        numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n    } catch (tnlcError) {\r\n        addNotice6({priority:979, message:\"Invalid book identifier passed to checkTNLinks\", location:` '${bookID}' in first parameter: ${tnlcError}`});\r\n    }\r\n\r\n    // console.log(\"checkTNLinks: Search for Bible links\")\r\n    const bibleRegex = new RegExp('\\\\[(\\\\w+?) (\\\\d{1,3}):(\\\\d{1,3})\\\\]\\\\(\\\\.\\\\./(\\\\d{1,3})/(\\\\d{1,3})\\\\.md\\\\)', 'g');\r\n    // eslint-disable-next-line no-cond-assign\r\n    while (resultArray = bibleRegex.exec(fieldText)) {\r\n        // console.log(`  resultArray=${JSON.stringify(resultArray)}`);\r\n        console.assert(resultArray.length === 6, `Expected 6 fields (not ${resultArray.length})`)\r\n\r\n        let chapterInt, verseInt;\r\n        try {\r\n            chapterInt = ourParseInt(resultArray[4]);\r\n        } catch (tnCIerror) {\r\n            console.log(`TN Link Check couldn't convert chapter '${resultArray[4]}': ${tnCIerror}`);\r\n            chapterInt = 1;\r\n        }\r\n        // eslint-disable-next-line no-unused-vars\r\n        let numVersesThisChapter;\r\n        if (chapterInt < 1 || chapterInt > numChaptersThisBook)\r\n            addNotice6({priority:843, message:\"Invalid chapter number\", extract:resultArray[4], location:`${ourLocation}`});\r\n        else {\r\n            try {\r\n                numVersesThisChapter = books.versesInChapter(lowercaseBookID, chapterInt);\r\n            } catch (tnVIerror) {\r\n            console.log(`TN Link Check couldn't convert verse '${resultArray[5]}': ${tnVIerror}`);\r\n            verseInt = 1;\r\n            }\r\n        }\r\n        try {\r\n            if (ourParseInt(resultArray[2]) !== chapterInt)\r\n                addNotice6({priority:743, message:\"Chapter numbers of Bible link don't match\", extract:resultArray[0], location:`${ourLocation}`});\r\n        } catch (ccError) {\r\n            console.log(`TN Link Check couldn't compare chapter numbers: ${ccError}`);\r\n        }\r\n        try {\r\n            verseInt = ourParseInt(resultArray[5]);\r\n        } catch (tnVIerror) {\r\n            console.log(`TN Link Check couldn't convert verse '${resultArray[5]}': ${tnVIerror}`);\r\n        }\r\n        try {\r\n            if (ourParseInt(resultArray[3]) !== ourParseInt(verseInt))\r\n                addNotice6({priority:742, message:\"Verse numbers of Bible link don't match\", extract:resultArray[0], location:`${ourLocation}`});\r\n        } catch (vvError) {\r\n            console.log(`TN Link Check couldn't compare verse numbers: ${vvError}`);\r\n        }\r\n    }\r\n\r\n    // console.log(`checkTNLinks is returning ${JSON.stringify(ctarResult)}`);\r\n    return ctarResult;\r\n}\r\n// end of checkTNLinks function\r\n\r\n\r\n//export default checkTNLinks;\r\n","import * as books from '../core/books/books';\r\nimport { getFileCached } from '../core/getApi';\r\n// import { consoleLogObject } from '../core/utilities';\r\n\r\n\r\n// const QUOTE_VALIDATOR_VERSION_STRING = '0.4.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport async function checkOriginalLanguageQuote(fieldName, fieldText, bookID, C, V, givenLocation, optionalCheckingOptions) {\r\n    // Checks that the Hebrew/Greek quote can be found in the original texts\r\n\r\n    // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n\r\n    // Note that the original language verse text can be passed in as\r\n    //      optionalCheckingOptions.originalLanguageVerseText.\r\n    // Alternatively, we can fetch it from Door43 -- you can control this with:\r\n    //      optionalCheckingOptions.originalLanguageRepoUsername\r\n    //      (UHB or UGNT will be used for the repo name)\r\n    //      optionalCheckingOptions.originalLanguageRepoBranch (or tag)\r\n\r\n    // console.log(`checkOriginalLanguageQuote v${QUOTE_VALIDATOR_VERSION_STRING} (${fieldName}, (${fieldText.length}) '${fieldText}', ${bookID} ${C}:${V} ${givenLocation}, )`);\r\n    console.assert(fieldName !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldName === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof fieldName}'`);\r\n    console.assert(fieldText !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof fieldText === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n    console.assert(bookID !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof bookID === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof bookID}'`);\r\n    console.assert(bookID.length === 3, `checkOriginalLanguageQuote: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n    console.assert(books.isValidBookID(bookID), `checkOriginalLanguageQuote: '${bookID}' is not a valid USFM book identifier`);\r\n    console.assert(C !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof C === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof C}'`);\r\n    console.assert(V !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof V === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof V}'`);\r\n    console.assert(givenLocation !== undefined, \"checkOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n    console.assert(typeof givenLocation === 'string', `checkOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof givenLocation}'`);\r\n\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n\r\n    const colqResult = { noticeList: [] };\r\n\r\n    function addNotice6(noticeObject) {\r\n        // console.log(`checkOriginalLanguageQuote Notice: (priority=${noticeObject.priority}) ${noticeObject.message}${characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${noticeObject.extract ? ` ${noticeObject.extract}` : \"\"}${noticeObject.location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"cOLQ addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `cOLQ addNotice6: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"cOLQ addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `cOLQ addNotice6: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(characterIndex !== undefined, \"cOLQ addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cOLQ addNotice6: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cOLQ addNotice6: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cOLQ addNotice6: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"cOLQ addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `cOLQ addNotice6: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        colqResult.noticeList.push(noticeObject);\r\n    }\r\n\r\n    async function getPassage(bookID, C, V, optionalCheckingOptions) {\r\n        // console.log(`getPassage(${bookID}, ${C}, ${V})`);\r\n\r\n        const bookNumberAndName = books.usfmNumberName(bookID);\r\n        const whichTestament = books.testament(bookID); // returns 'old' or 'new'\r\n        const originalLanguageRepoLanguageCode = whichTestament === 'old' ? 'hbo' : 'el-x-koine';\r\n        const originalLanguageRepoCode = whichTestament === 'old' ? 'UHB' : 'UGNT';\r\n        const originalLanguageRepoName = `${originalLanguageRepoLanguageCode}_${originalLanguageRepoCode.toLowerCase()}`;\r\n        const filename = `${bookNumberAndName}.usfm`;\r\n\r\n        let username;\r\n        try {\r\n            username = optionalCheckingOptions.originalLanguageRepoUsername;\r\n        } catch (qcoError) { }\r\n        if (!username) username = 'unfoldingWord'; // or Door43-Catalog ???\r\n        let branch;\r\n        try {\r\n            branch = optionalCheckingOptions.originalLanguageRepoBranch;\r\n        } catch (qcunError) { }\r\n        if (!branch) branch = 'master';\r\n\r\n        let originalUSFM;\r\n        // console.log(`Need to check against ${originalLanguageRepoCode}`);\r\n        const getFile_ = (optionalCheckingOptions && optionalCheckingOptions.getFile) ? optionalCheckingOptions.getFile : getFileCached;\r\n        if (originalLanguageRepoCode === 'UHB') {\r\n            try {\r\n                originalUSFM = await getFile_({ username, repository: originalLanguageRepoName, path: filename, branch });\r\n                // console.log(\"Fetched file_content for\", repoName, filename, typeof originalUSFM, originalUSFM.length);\r\n            } catch (gcUHBerror) {\r\n                console.log(\"ERROR: Failed to load\", username, originalLanguageRepoCode, filename, branch, gcUHBerror.message);\r\n                addNotice6({ priority: 601, message: \"Failed to load\", filename, location: `${ourLocation}: ${gcUHBerror}`, extra: originalLanguageRepoName });\r\n            }\r\n        } else if (originalLanguageRepoCode === 'UGNT') {\r\n            try {\r\n                originalUSFM = await getFile_({ username, repository: originalLanguageRepoName, path: filename, branch });\r\n                // console.log(\"Fetched file_content for\", repoName, filename, typeof originalUSFM, originalUSFM.length);\r\n            } catch (gcUGNTerror) {\r\n                console.log(\"ERROR: Failed to load\", username, originalLanguageRepoCode, filename, branch, gcUGNTerror.message);\r\n                addNotice6({ priority: 601, message: \"Failed to load\", filename, location: `${ourLocation}: ${gcUGNTerror}`, extra: originalLanguageRepoName });\r\n            }\r\n        }\r\n\r\n        // Do global fixes\r\n        originalUSFM = originalUSFM.replace(/\\\\k-e\\\\\\*/g, ''); // Remove \\k-e self-closed milestones\r\n        originalUSFM = originalUSFM.replace(/\\\\k-s.+?\\\\\\*/g, ''); // Remove \\k-s self-closed milestones\r\n\r\n\r\n        // Now find the desired C:V\r\n        let foundChapter = false, foundVerse = false;\r\n        let verseText = '';\r\n        for (let bookLine of originalUSFM.split('\\n')) {\r\n            // console.log(\"bookLine\", bookLine);\r\n            if (!foundChapter && bookLine === `\\\\c ${C}`) {\r\n                foundChapter = true;\r\n                continue;\r\n            }\r\n            if (foundChapter && !foundVerse && bookLine.startsWith(`\\\\v ${V}`)) {\r\n                foundVerse = true;\r\n                bookLine = bookLine.substring(3 + V.length); // Delete verse number so below bit doesn't fail\r\n            }\r\n            if (foundVerse) {\r\n                if (bookLine.startsWith('\\\\v ') || bookLine.startsWith('\\\\c '))\r\n                    break; // Don't go into the next verse or chapter\r\n                verseText += (bookLine.startsWith('\\\\f ') ? '' : ' ') + bookLine;\r\n            }\r\n        }\r\n        verseText = verseText.replace(/\\\\p/g, '').trim().replace(/ {2}/g, ' ')\r\n        // console.log(`Got verse text1: '${verseText}'`);\r\n\r\n        // Remove \\w fields (just leaving the actual Bible text words)\r\n        let ixW = verseText.indexOf('\\\\w ')\r\n        while (ixW !== -1) {\r\n            const ixEnd = verseText.indexOf('\\\\w*', ixW)\r\n            if (ixEnd !== -1) {\r\n                const field = verseText.substring(ixW + 3, ixEnd);\r\n                const bits = field.split('|');\r\n                const adjusted_field = bits[0];\r\n                verseText = verseText.substring(0, ixW) + adjusted_field + verseText.substring(ixEnd + 3);\r\n            } else {\r\n                console.log(`Missing \\\\w* in ${bookID} ${C}:${V} verseText: '${verseText}'`);\r\n                verseText = verseText.replace(/\\\\w /g, '', 1); // Attempt to limp on\r\n            }\r\n            ixW = verseText.indexOf('\\\\w ', ixW + 1); // Might be another one\r\n        }\r\n        // console.log(`Got verse text2: '${verseText}'`);\r\n\r\n        // Remove footnotes\r\n        verseText = verseText.replace(/\\\\f (.+?)\\\\f\\*/g, '');\r\n        // Remove alternative versifications\r\n        verseText = verseText.replace(/\\\\va (.+?)\\\\va\\*/g, '');\r\n        // console.log(`Got verse text3: '${verseText}'`);\r\n\r\n        // Final clean-up (shouldn't be necessary, but just in case)\r\n        verseText = verseText.replace(/ {2}/g, ' ');\r\n        console.assert(verseText.indexOf('\\\\w') === -1, `getPassage: Should be no \\\\w in ${bookID} ${C}:${V} '${verseText}'`);\r\n        console.assert(verseText.indexOf('\\\\k') === -1, `getPassage: Should be no \\\\k in ${bookID} ${C}:${V} '${verseText}'`);\r\n        console.assert(verseText.indexOf('x-') === -1, `getPassage: Should be no x- in ${bookID} ${C}:${V} '${verseText}'`);\r\n        console.assert(verseText.indexOf('\\\\f') === -1, `getPassage: Should be no \\\\f in ${bookID} ${C}:${V} '${verseText}'`);\r\n        console.assert(verseText.indexOf('\\\\x') === -1, `getPassage: Should be no \\\\x in ${bookID} ${C}:${V} '${verseText}'`);\r\n        // console.log(`  getPassage(${bookID} ${C}:${V}) is returning '${verseText}'`);\r\n        return verseText;\r\n    }\r\n    // end of getPassage function\r\n\r\n\r\n    // Main code for checkOriginalLanguageQuote\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (gcELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n\r\n    // if fieldText.lstrip() !== fieldText:\r\n    //     addNotice6({priority:0, message:`Unexpected whitespace at start of {TNid} '{fieldText}'\")\r\n    // if fieldText.rstrip() !== fieldText:\r\n    //     addNotice6({priority:0, message:`Unexpected whitespace at end of {TNid} '{fieldText}'\")\r\n    // fieldText = fieldText.strip() # so we don't get consequential errors\r\n\r\n    let characterIndex;\r\n    if ((characterIndex = fieldText.indexOf('...')) >= 0) {\r\n        // console.log(`Bad ellipse characters in '${fieldText}'`);\r\n        const extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '' : '');\r\n        addNotice6({ priority: 159, message: \"Should use proper ellipse character (not periods)\", characterIndex, extract, location: ourLocation });\r\n    }\r\n\r\n    let quoteBits;\r\n    if (fieldText.indexOf('') >= 0) {\r\n        quoteBits = fieldText.split('');\r\n        if ((characterIndex = fieldText.indexOf(' ')) >= 0 || (characterIndex = fieldText.indexOf(' ')) >= 0) {\r\n            // console.log(`Unexpected space(s) beside ellipse in '${fieldText}'`);\r\n            const extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '' : '');\r\n            addNotice6({ priority: 158, message: \"Unexpected space(s) beside ellipse character\", characterIndex, extract, location: ourLocation });\r\n        }\r\n    } else if (fieldText.indexOf('...') >= 0) { // Yes, we still actually allow this\r\n        quoteBits = fieldText.split('...');\r\n        if ((characterIndex = fieldText.indexOf(' ...')) >= 0 || (characterIndex = fieldText.indexOf('... ')) >= 0) {\r\n            // console.log(`Unexpected space(s) beside ellipse characters in '${fieldText}'`);\r\n            const extract = (characterIndex > halfLength ? '' : '') + fieldText.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < fieldText.length ? '' : '');\r\n            addNotice6({ priority: 158, message: \"Unexpected space(s) beside ellipse characters\", characterIndex, extract, location: ourLocation });\r\n        }\r\n    }\r\n    // console.log(`Got quoteBits=${quoteBits}`);\r\n\r\n    // Find the verse text in the original language\r\n    let verseText;\r\n    try {\r\n        verseText = optionalCheckingOptions.originalLanguageVerseText;\r\n    } catch (gcVTerror) { }\r\n    if (!verseText) // not supplied, so then we need to get it ourselves\r\n        verseText = await getPassage(bookID, C, V, optionalCheckingOptions);\r\n    if (!verseText) {\r\n        addNotice6({ priority: 851, message: \"Unable to load original language verse text\", location: ourLocation });\r\n        return colqResult; // nothing else we can do here\r\n    }\r\n\r\n    // Now check if the quote can be found in the verse text\r\n    if (quoteBits) {\r\n        const numQuoteBits = quoteBits.length;\r\n        if (numQuoteBits >= 2) {\r\n            for (let bitIndex = 0; bitIndex < numQuoteBits; bitIndex++) {\r\n                if (verseText.indexOf(quoteBits[bitIndex]) < 0) { // this is what we really want to catch\r\n                    // If the quote has multiple parts, create a description of the current part\r\n                    let partDescription;\r\n                    if (numQuoteBits === 1) partDescription = '';\r\n                    else if (bitIndex === 0) partDescription = 'beginning';\r\n                    else if (bitIndex === numQuoteBits - 1) partDescription = 'end';\r\n                    else partDescription = `middle${numQuoteBits > 3 ? bitIndex : ''}`;\r\n                    // console.log(`721 Unable to find '${fieldText}' ${numQuoteBits === 1? '': `'${quoteBits[bitIndex]}' `}${partDescription? '('+partDescription+') ':''}in '${verseText}'`);\r\n                    const extract = `${quoteBits[bitIndex]}' ${partDescription ? '(' + partDescription + ')' : ''}`;\r\n                    addNotice6({ priority: 721, message: \"Unable to find original language quote in verse text\", extract, location: ourLocation });\r\n                }\r\n            }\r\n        } else // < 2\r\n            addNotice6({ priority: 375, message: \"Ellipsis without surrounding snippet\", location: ourLocation });\r\n    } else { // Only a single quote (no ellipsis)\r\n        if (verseText.indexOf(fieldText) >= 0) {\r\n            // Double check that it doesn't start/stop in the middle of a word\r\n            // console.log(`Here with fieldText=${fieldText} and verseText=${verseText}`);\r\n            let remainingBits = verseText.split(fieldText);\r\n            // console.log(`remaingBits=${JSON.stringify(remainingBits)}`);\r\n            if (remainingBits.length > 2) // Join the extra bits back up\r\n                remainingBits = [remainingBits[0], remainingBits.slice(1).join('')];\r\n            console.assert(remainingBits.length === 2, `remaining bits are ${remainingBits.length}`);\r\n            // Note: There's some Hebrew (RTL) characters at the beginning of the following regex\r\n            if (remainingBits[0] && remainingBits[0].slice(-1).search(/[^A-Za-z\\s*[(]/) !== -1) {\r\n                // const badChar = remainingBits[0].slice(-1);\r\n                // const badCharString = ` by '{badChar}' {unicodedata.name(badChar)}={hex(ord(badChar))}`;\r\n                // console.log(`Seems '${fieldText}' might not start at the beginning of a wordit's preceded ${badCharString} in '${verseText}'`);\r\n                const extract = `(${remainingBits[0].slice(-1)}=D${remainingBits[0].slice(-1).charCodeAt()}/H${remainingBits[0].slice(-1).charCodeAt().toString(16)})` + fieldText.substring(0, extractLength - 3) + (fieldText.length > extractLength - 3 ? '' : '');\r\n                addNotice6({ priority: 620, message: \"Seems original language quote might not start at the beginning of a word\", characterIndex: 0, extract, location: ourLocation });\r\n            }\r\n            // Note: There's some Hebrew (RTL) characters at the beginning of the following regex\r\n            if (remainingBits[1] && remainingBits[1][0].search(/[^A-Za-z\\s.,:;?!)]/) !== -1) {\r\n                // const badChar = remainingBits[1][0];\r\n                // const badCharString = ` by '${badChar}' {unicodedata.name(badChar)}={hex(ord(badChar))}`;\r\n                // console.log(`Seems '${fieldText}' might not finish at the end of a wordit's followed ${badCharString} in '${verseText}'`);\r\n                const extract = (fieldText.length > extractLength - 3 ? '' : '') + fieldText.substring(fieldText.length - extractLength + 3, fieldText.length) + `(${remainingBits[1][0]}=D${remainingBits[1].charCodeAt(0)}/H${remainingBits[1].charCodeAt(0).toString(16)})`;\r\n                addNotice6({ priority: 621, message: \"Seems original language quote might not finish at the end of a word\", characterIndex: fieldText.length, extract, location: ourLocation });\r\n            }\r\n        } else { // can't find the given text\r\n            // console.log(`Unable to find '${fieldText}' in '${verseText}'`);\r\n            const noBreakSpaceText = fieldText.indexOf('\\u00A0') >= 0 ? \"quote which contains No-Break Space shown as ''\" : \"\";\r\n            if (noBreakSpaceText) fieldText = fieldText.replace(/\\u00A0/g, '');\r\n            // console.log(`722 fieldText='${fieldText}'${extraText}`);\r\n            // console.log(`722 verseText='${verseText}'`);\r\n            if (fieldText[0] === '\\u2060') { // Word joiner\r\n                const extract = fieldText.substring(0, extractLength) + fieldText.length > extractLength ? '' : '';\r\n                addNotice6({ priority: 916, message: \"Unable to find original language quote in verse text\", details:\"quote which starts with 'word joiner'\" + (noBreakSpaceText? ' '+ noBreakSpaceText:''), extract, location: ourLocation });\r\n            } else if (fieldText.endsWith('\\u2060')) { // Word joiner\r\n                const extract = fieldText.length > extractLength ? '' : '' + fieldText.substring(fieldText.length-extractLength, fieldText.length);\r\n                addNotice6({ priority: 916, message: \"Unable to find original language quote in verse text\", details:\"quote which ends with 'word joiner'\" + (noBreakSpaceText? ' '+ noBreakSpaceText:''), extract, location: ourLocation });\r\n            } else if (fieldText[0] === '\\u200B') { // Zero-width space\r\n                const extract = fieldText.substring(0, extractLength) + fieldText.length > extractLength ? '' : '';\r\n                addNotice6({ priority: 916, message: \"Unable to find original language quote in verse text\", details:\"quote which starts with 'zero-width space'\" + (noBreakSpaceText? ' '+ noBreakSpaceText:''), extract, location: ourLocation });\r\n            } else if (fieldText.endsWith('\\u200B')) { // Zero-width space\r\n                const extract = fieldText.length > extractLength ? '' : '' + fieldText.substring(fieldText.length-extractLength, fieldText.length);\r\n                addNotice6({ priority: 916, message: \"Unable to find original language quote in verse text\", details:\"quote which ends with 'zero-width space'\" + (noBreakSpaceText? ' '+ noBreakSpaceText:''), extract, location: ourLocation });\r\n            } else if (fieldText[0] === '\\u200D') { // Zero-width joiner\r\n                const extract = fieldText.substring(0, extractLength) + fieldText.length > extractLength ? '' : '';\r\n                addNotice6({ priority: 916, message: \"Unable to find original language quote in verse text\", details:\"quote which starts with 'zero-width joiner'\" + (noBreakSpaceText? ' '+ noBreakSpaceText:''), extract, location: ourLocation });\r\n            } else if (fieldText.endsWith('\\u200D')) { // Zero-width joiner\r\n                const extract = fieldText.length > extractLength ? '' : '' + fieldText.substring(fieldText.length-extractLength, fieldText.length);\r\n                addNotice6({ priority: 916, message: \"Unable to find original language quote in verse text\", details:\"quote which ends with 'zero-width joiner'\" + (noBreakSpaceText? ' '+ noBreakSpaceText:''), extract, location: ourLocation });\r\n            } else {\r\n                const extract = fieldText.substring(0, halfLength) + (fieldText.length > 2 * halfLength ? '' : '') + fieldText.substring(fieldText.length - halfLength, fieldText.length);\r\n                addNotice6({ priority: 916, message: \"Unable to find original language quote in verse text\", details:noBreakSpaceText, extract, location: ourLocation });\r\n            }\r\n        }\r\n    }\r\n\r\n    // console.log(`checkOriginalLanguageQuote is returning ${JSON.stringify(colqResult)}`);\r\n    return colqResult;\r\n}\r\n// end of checkOriginalLanguageQuote function\r\n\r\n\r\n//export default checkOriginalLanguageQuote;\r\n","import * as books from './books/books';\r\nimport {checkTN_TSVDataRow} from './tn-table-row-check';\r\n\r\n\r\nconst TN_TABLE_TEXT_VALIDATOR_VERSION_STRING = '0.2.3';\r\n\r\nconst NUM_EXPECTED_TN_TSV_FIELDS = 9; // so expects 8 tabs per line\r\nconst EXPECTED_TN_HEADING_LINE = 'Book\\tChapter\\tVerse\\tID\\tSupportReference\\tOrigQuote\\tOccurrence\\tGLQuote\\tOccurrenceNote';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport async function checkTN_TSVText(languageCode, bookID, filename, tableText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all rows.\r\n\r\n      It also has the advantage of being able to compare one row with the previous one.\r\n\r\n     bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`checkTN_TSVText(${bookID}, ${tableText.length}, ${location},${JSON.stringify(optionalCheckingOptions)})`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    // if (bookID) ourLocation = ` in ${bookID}${ourLocation}`;\r\n\r\n    const result = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkTN_TSVText success: ${successString}`);\r\n        result.successList.push(successString);\r\n    }\r\n    function addNoticeCV8(noticeObject) {\r\n        // console.log(`checkTN_TSVText notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"TSV addNoticeCV8: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `TSV addNoticeCV8: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"TSV addNoticeCV8: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `TSV addNoticeCV8: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(C !== undefined, \"TSV addNoticeCV8: 'C' parameter should be defined\");\r\n        if (noticeObject.C) console.assert(typeof noticeObject.C === 'string', `TSV addNoticeCV8: 'C' parameter should be a string not a '${typeof noticeObject.C}': ${noticeObject.C}`);\r\n        // console.assert(V !== undefined, \"TSV addNoticeCV8: 'V' parameter should be defined\");\r\n        if (noticeObject.V) console.assert(typeof noticeObject.V === 'string', `TSV addNoticeCV8: 'V' parameter should be a string not a '${typeof noticeObject.V}': ${noticeObject.V}`);\r\n        // console.assert(characterIndex !== undefined, \"TSV addNoticeCV8: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `TSV addNoticeCV8: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"TSV addNoticeCV8: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `TSV addNoticeCV8: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"TSV addNoticeCV8: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `TSV addNoticeCV8: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        result.noticeList.push({ ...noticeObject, bookID, filename });\r\n    }\r\n\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (ttcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    // const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    // const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    let lowercaseBookID = bookID.toLowerCase();\r\n    let numChaptersThisBook = 0;\r\n    try {\r\n        numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n    }\r\n    catch {\r\n        if (!books.isValidBookID(bookID)) // must not be in FRT, BAK, etc.\r\n            addNoticeCV8({ priority: 747, message: \"Bad function call: should be given a valid book abbreviation\", extract: bookID, location: ` (not '${bookID}')${ourLocation}` });\r\n    }\r\n\r\n    let lines = tableText.split('\\n');\r\n    // console.log(`  '${location}' has ${lines.length.toLocaleString()} total lines (expecting ${NUM_EXPECTED_TN_FIELDS} fields in each line)`);\r\n\r\n    let lastB = '', lastC = '', lastV = '';\r\n    let rowIDList = [], uniqueRowList = [];\r\n    let numVersesThisChapter = 0;\r\n    for (let n = 0; n < lines.length; n++) {\r\n        // console.log(`checkTN_TSVText checking line ${n}: ${JSON.stringify(lines[n])}`);\r\n        if (n === 0) {\r\n            if (lines[0] === EXPECTED_TN_HEADING_LINE)\r\n                addSuccessMessage(`Checked TSV header ${ourLocation}`);\r\n            else\r\n                addNoticeCV8({ priority: 746, message: \"Bad TSV header\", lineNumber: n + 1, location: `${ourLocation}: '${lines[0]}'` });\r\n        }\r\n        else // not the header\r\n        {\r\n            let fields = lines[n].split('\\t');\r\n            if (fields.length === NUM_EXPECTED_TN_TSV_FIELDS) {\r\n                // eslint-disable-next-line no-unused-vars\r\n                const [B, C, V, rowID, supportReference, origQuote, occurrence, _GLQuote, _occurrenceNote] = fields;\r\n\r\n                // Use the row check to do most basic checks\r\n                const firstResult = await checkTN_TSVDataRow(languageCode, lines[n], bookID, C, V, ourLocation, optionalCheckingOptions);\r\n                // Choose only ONE of the following\r\n                // This is the fast way of append the results from this field\r\n                // result.noticeList = result.noticeList.concat(firstResult.noticeList);\r\n                // If we need to put everything through addNoticeCV8, e.g., for debugging or filtering\r\n                //  process results line by line\r\n                for (const noticeEntry of firstResult.noticeList)\r\n                    addNoticeCV8({ ...noticeEntry, lineNumber: n + 1 });\r\n\r\n                // So here we only have to check against the previous and next fields for out-of-order problems and duplicate problems\r\n                if (B !== lastB || C !== lastC || V !== lastV) {\r\n                    rowIDList = []; // ID's only need to be unique within each verse\r\n                    uniqueRowList = []; // Same for these\r\n                }\r\n\r\n                // TODO: Check if we need this at all (even though tC 3.0 can't display these \"duplicate\" notes)\r\n                // Check for duplicate notes\r\n                const uniqueID = C + V + supportReference + origQuote + occurrence; // This combination should not be repeated\r\n                // if (uniqueRowList.indexOf(uniqueID) >= 0)\r\n                //     addNoticeCV8({ priority: 880, C, V, message: `Duplicate note`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                // if (uniqueRowList.indexOf(uniqueID) >= 0)\r\n                //     addNoticeCV8({ priority: 80, C, V, message: `Note: tC 3.0 won't display duplicate note`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                uniqueRowList.push(uniqueID);\r\n\r\n                if (B) {\r\n                    if (B !== bookID)\r\n                        addNoticeCV8({ priority: 745, C, V, message: `Wrong '${B}' book identifier (expected '${bookID}')`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                }\r\n                else\r\n                    addNoticeCV8({ priority: 744, C, V, message: \"Missing book identifier\", rowID, lineNumber: n + 1, location: ourLocation });\r\n\r\n                if (C) {\r\n                    if (C === 'front') { }\r\n                    else if (/^\\d+$/.test(C)) {\r\n                        let intC = Number(C);\r\n                        if (C !== lastC)\r\n                            numVersesThisChapter = books.versesInChapter(lowercaseBookID, intC);\r\n                        if (intC === 0)\r\n                            addNoticeCV8({ priority: 551, C, V, message: `Invalid zero '${C}' chapter number`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                        if (intC > numChaptersThisBook)\r\n                            addNoticeCV8({ priority: 737, C, V, message: `Invalid large '${C}' chapter number`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                        if (/^\\d+$/.test(lastC)) {\r\n                            let lastintC = Number(lastC);\r\n                            if (intC < lastintC)\r\n                                addNoticeCV8({ priority: 736, C, V, message: `Receding '${C}' chapter number after '${lastC}'`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                            else if (intC > lastintC + 1)\r\n                                addNoticeCV8({ priority: 735, C, V, message: `Advancing '${C}' chapter number after '${lastC}'`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                        }\r\n                    }\r\n                    else\r\n                        addNoticeCV8({ priority: 734, C, V, message: \"Bad chapter number\", rowID, lineNumber: n + 1, location: ourLocation });\r\n                }\r\n                else\r\n                    addNoticeCV8({ priority: 739, C, V, message: \"Missing chapter number\", rowID, lineNumber: n + 1, location: ` after ${lastC}:${V}${ourLocation}` });\r\n\r\n                if (V) {\r\n                    if (V === 'intro') { }\r\n                    else if (/^\\d+$/.test(V)) {\r\n                        let intV = Number(V);\r\n                        if (intV === 0)\r\n                            addNoticeCV8({ priority: 552, C, V, message: `Invalid zero '${V}' verse number`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                        if (intV > numVersesThisChapter)\r\n                            addNoticeCV8({ priority: 734, C, V, message: `Invalid large '${V}' verse number for chapter ${C}`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                        if (/^\\d+$/.test(lastV)) {\r\n                            let lastintV = Number(lastV);\r\n                            if (intV < lastintV)\r\n                                addNoticeCV8({ priority: 733, C, V, message: `Receding '${V}' verse number after '${lastV}'`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                            // else if (intV > lastintV + 1)\r\n                            //   addNoticeCV8({priority:556, `Skipped verses with '${V}' verse number after '${lastV}'${withString}`);\r\n                        }\r\n                    }\r\n                    else\r\n                        addNoticeCV8({ priority: 738, C, V, message: \"Bad verse number\", rowID, lineNumber: n + 1, location: ourLocation });\r\n\r\n                }\r\n                else\r\n                    addNoticeCV8({ priority: 790, C, V, message: \"Missing verse number\", rowID, lineNumber: n + 1, location: ` after ${C}:${lastV}${ourLocation}` });\r\n\r\n                if (rowID) {\r\n                    if (rowIDList.indexOf(rowID) >= 0)\r\n                        addNoticeCV8({ priority: 729, C, V, message: `Duplicate '${rowID}' ID`, fieldName:'ID', rowID, lineNumber: n + 1, location: ourLocation });\r\n                } else\r\n                    addNoticeCV8({ priority: 730, C, V, message: \"Missing ID\", fieldName:'ID', lineNumber: n + 1, location: ourLocation });\r\n\r\n\r\n                lastB = B; lastC = C; lastV = V;\r\n\r\n            } else\r\n                // if (n === lines.length - 1) // it's the last line\r\n                //     console.log(`  Line ${n}: Has ${fields.length} field(s) instead of ${NUM_EXPECTED_TN_FIELDS}: ${EXPECTED_TN_HEADING_LINE.replace(/\\t/g, ', ')}`);\r\n                // else\r\n                if (n !== lines.length - 1) // it's not the last line\r\n                    addNoticeCV8({ priority: 988, message: `Wrong number of tabbed fields (expected ${NUM_EXPECTED_TN_TSV_FIELDS})`, extract: `Found ${fields.length} field${fields.length === 1 ? '' : 's'}`, lineNumber: n + 1, location: ourLocation });\r\n        }\r\n    }\r\n    addSuccessMessage(`Checked all ${(lines.length - 1).toLocaleString()} data line${lines.length - 1 === 1 ? '' : 's'}${ourLocation}.`);\r\n    if (result.noticeList)\r\n        addSuccessMessage(`checkTN_TSVText v${TN_TABLE_TEXT_VALIDATOR_VERSION_STRING} finished with ${result.noticeList.length ? result.noticeList.length.toLocaleString() : \"zero\"} notice${result.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by checkTN_TSVText v${TN_TABLE_TEXT_VALIDATOR_VERSION_STRING}`)\r\n    // console.log(`  checkTN_TSVText returning with ${result.successList.length.toLocaleString()} success(es), ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkTN_TSVText result is\", JSON.stringify(result));\r\n    return result;\r\n}\r\n// end of checkTN_TSVText function\r\n\r\n\r\n//export default checkTN_TSVText;\r\n","import * as books from './books/books';\r\nimport {checkTextField} from './field-text-check';\r\nimport {checkMarkdownText} from './markdown-text-check';\r\nimport {checkTAReference} from './ta-reference-check';\r\nimport {checkTNLinks} from './tn-links-check';\r\nimport {checkOriginalLanguageQuote} from './quote-check';\r\n\r\n\r\n// const ANNOTATION_TABLE_ROW_VALIDATOR_VERSION_STRING = '0.4.1';\r\n\r\nconst NUM_EXPECTED_ANNOTATION_TSV_FIELDS = 7; // so expects 6 tabs per line\r\nconst EXPECTED_TN_HEADING_LINE = 'Reference\\tID\\tTags\\tSupportReference\\tQuote\\tOccurrence\\tAnnotation';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport async function checkAnnotationTSVDataRow(languageCode, annotationType, line, bookID, C, V, givenRowLocation, optionalCheckingOptions) {\r\n    /**\r\n    * @description - Checks one TSV data row of translation notes (TN)\r\n    * @param {String} annotationType - TN, TQ, TWL, SN, or SQ -- allows more specific checks\r\n    * @param {String} line - the TSV line to be checked\r\n    * @param {String} bookID - 3-character UPPERCASE USFM book identifier or 'OBS'\r\n    * @param {String} C - chapter number or (for OBS) story number string\r\n    * @param {String} V - verse number or (for OBS) frame number string\r\n    * @param {String} givenRowLocation - description of where the line is located\r\n    * @param {Object} optionalCheckingOptions - may contain extractLength parameter\r\n    * @return {Object} - containing noticeList\r\n    */\r\n    /* This function is only for checking one data row\r\n          and the function doesn't assume that it has any previous context.\r\n\r\n        annotationType is a 2-3 character string, being\r\n            TN, TQ, TWL, SN, or SQ\r\n                being translation or study notes, questions, or word-links.\r\n\r\n        bookID is a three-character UPPERCASE USFM book identifier or 'OBS'\r\n            so C and V are usually chapter number and verse number\r\n                but can be story number and frame number for OBS.\r\n\r\n        It's designed to be able to quickly show errors for a single row being displayed/edited.\r\n\r\n        Returns an object containing the noticeList.\r\n    */\r\n    // console.log(`checkAnnotationTSVDataRow(${annotationType}, ${line}, ${bookID} ${C}:${V} ${givenRowLocation}, ${JSON.stringify(optionalCheckingOptions)})`);\r\n    console.assert(annotationType !== undefined, \"checkAnnotationTSVDataRow: 'annotationType' parameter should be defined\");\r\n    console.assert(typeof annotationType === 'string', `checkAnnotationTSVDataRow: 'annotationType' parameter should be a string not a '${typeof annotationType}'`);\r\n    console.assert(annotationType.length === 2 || annotationType.length === 3, `checkAnnotationTSVDataRow: 'annotationType' parameter should be 2-3 characters long not ${annotationType.length}`);\r\n    console.assert(line !== undefined, \"checkAnnotationTSVDataRow: 'line' parameter should be defined\");\r\n    console.assert(typeof line === 'string', `checkAnnotationTSVDataRow: 'line' parameter should be a string not a '${typeof line}'`);\r\n    console.assert(bookID !== undefined, \"checkAnnotationTSVDataRow: 'bookID' parameter should be defined\");\r\n    console.assert(typeof bookID === 'string', `checkAnnotationTSVDataRow: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n    console.assert(bookID.length === 3, `checkAnnotationTSVDataRow: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n    console.assert(books.isValidBookID(bookID), `checkAnnotationTSVDataRow: '${bookID}' is not a valid USFM book identifier`);\r\n    // console.assert(C !== undefined, \"checkAnnotationTSVDataRow: 'C' parameter should be defined\");\r\n    if (C) console.assert(typeof C === 'string', `checkAnnotationTSVDataRow: 'C' parameter should be a string not a '${typeof C}'`);\r\n    // console.assert(V !== undefined, \"checkAnnotationTSVDataRow: 'V' parameter should be defined\");\r\n    if (V) console.assert(typeof V === 'string', `checkAnnotationTSVDataRow: 'V' parameter should be a string not a '${typeof V}'`);\r\n    console.assert(givenRowLocation !== undefined, \"checkAnnotationTSVDataRow: 'givenRowLocation' parameter should be defined\");\r\n    console.assert(typeof givenRowLocation === 'string', `checkAnnotationTSVDataRow: 'givenRowLocation' parameter should be a string not a '${typeof givenRowLocation}'`);\r\n\r\n    let ourRowLocation = givenRowLocation;\r\n    if (ourRowLocation && ourRowLocation[0] !== ' ') ourRowLocation = ` ${ourRowLocation}`;\r\n\r\n    let adrResult = { noticeList: [] };\r\n\r\n    function addNotice6to9(noticeObject) {\r\n        /**\r\n        * @description - adds a new notice entry, adding bookID,C,V to the given fields\r\n        * @param {Number} priority - notice priority from 1 (lowest) to 999 (highest)\r\n        * @param {String} message - the text of the notice message\r\n        * @param {String} rowID - 4-character row ID field\r\n        * @param {Number} lineNumber - one-based line number\r\n        * @param {Number} characterIndex - zero-based index of where the issue occurs in the line\r\n        * @param {String} extract - short extract from the line centred on the problem (if available)\r\n        * @param {String} location - description of where the issue is located\r\n        */\r\n        // console.log(`Annotation TSV Row Notice: ${noticeObject.priority}:${noticeObject.message} ${JSON.stringify(noticeObject)}`);\r\n        console.assert(noticeObject.priority !== undefined, \"checkAnnotationTSVDataRow addNotice6to9: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `checkAnnotationTSVDataRow addNotice6to9: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"checkAnnotationTSVDataRow addNotice6to9: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `checkAnnotationTSVDataRow addNotice6to9: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(lineNumber !== undefined, \"checkAnnotationTSVDataRow addNotice6to9: 'lineNumber' parameter should be defined\");\r\n        // console.assert(typeof lineNumber === 'number', `checkAnnotationTSVDataRow addNotice6to9: 'lineNumber' parameter should be a number not a '${typeof lineNumber}': ${lineNumber}`);\r\n        // console.assert(characterIndex !== undefined, \"checkAnnotationTSVDataRow addNotice6to9: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `checkAnnotationTSVDataRow addNotice6to9: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"checkAnnotationTSVDataRow addNotice6to9: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `checkAnnotationTSVDataRow addNotice6to9: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"checkAnnotationTSVDataRow addNotice6to9: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `checkAnnotationTSVDataRow addNotice6to9: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        // Also uses the given bookID,C,V, parameters from the main function call\r\n        adrResult.noticeList.push({ ...noticeObject, bookID, C, V });\r\n    }\r\n\r\n    function ourMarkdownTextChecks(rowID, fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given markdown field and processes the returned results\r\n        * @param {String} rowID - 4-character row ID field\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} rowLocation - description of where the line is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does markdown checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n\r\n        // We don't currently use the allowedLinks parameter\r\n\r\n        // console.log(`checkAnnotationTSVDataRow ourCheckTextField(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${rowLocation}, )`);\r\n        console.assert(rowID !== undefined, \"checkAnnotationTSVDataRow ourMarkdownTextChecks: 'rowID' parameter should be defined\");\r\n        console.assert(typeof rowID === 'string', `checkAnnotationTSVDataRow ourMarkdownTextChecks: 'rowID' parameter should be a string not a '${typeof rowID}'`);\r\n        // console.assert(fieldName !== undefined, \"checkAnnotationTSVDataRow ourMarkdownTextChecks: 'fieldName' parameter should be defined\");\r\n        // console.assert(typeof fieldName === 'string', `checkAnnotationTSVDataRow ourMarkdownTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldName === 'Annotation', \"checkAnnotationTSVDataRow ourMarkdownTextChecks: Only run this check on OccurrenceNotes\")\r\n        console.assert(fieldText !== undefined, \"checkAnnotationTSVDataRow ourMarkdownTextChecks: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `checkAnnotationTSVDataRow ourMarkdownTextChecks: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"checkAnnotationTSVDataRow ourMarkdownTextChecks: allowedLinks parameter must be either true or false\");\r\n        console.assert(rowLocation.indexOf(fieldName) < 0, `checkAnnotationTSVDataRow ourMarkdownTextChecks: 'rowLocation' parameter should be not contain fieldName=${fieldName}`);\r\n\r\n        const cmtResultObject = checkMarkdownText(fieldName, fieldText, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(cmtResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of cmtResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourMarkdownTextChecks notice length=${Object.keys(noticeEntry).length}`);\r\n            // NOTE: Ellipses in OccurrenceNote have the normal meaning\r\n            //          not like the specialised meaning in the snippet fields OrigQuote and GLQuote\r\n            if (noticeEntry.priority !== 178 && noticeEntry.priority !== 179 // unexpected space after ellipse, ellipse after space\r\n            && !noticeEntry.message.startsWith(\"Unexpected  character after space\") // 191\r\n            )\r\n                addNotice6to9({ ...noticeEntry, rowID, fieldName });\r\n        }\r\n    }\r\n    // end of ourMarkdownTextChecks function\r\n\r\n    function ourCheckTextField(rowID, fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} rowID - 4-character row ID field\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} rowLocation - description of where the line is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`checkAnnotationTSVDataRow ourCheckTextField(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${rowLocation}, )`);\r\n        console.assert(rowID !== undefined, \"checkAnnotationTSVDataRow ourCheckTextField: 'rowID' parameter should be defined\");\r\n        console.assert(typeof rowID === 'string', `checkAnnotationTSVDataRow ourCheckTextField: 'rowID' parameter should be a string not a '${typeof rowID}'`);\r\n        console.assert(fieldName !== undefined, \"checkAnnotationTSVDataRow ourCheckTextField: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `checkAnnotationTSVDataRow ourCheckTextField: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"checkAnnotationTSVDataRow ourCheckTextField: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `checkAnnotationTSVDataRow ourCheckTextField: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"checkAnnotationTSVDataRow ourCheckTextField: allowedLinks parameter must be either true or false\");\r\n        console.assert(rowLocation.indexOf(fieldName) < 0, `checkAnnotationTSVDataRow ourCheckTextField: 'rowLocation' parameter should be not contain fieldName=${fieldName}`);\r\n\r\n        const dbtcResultObject = checkTextField(fieldName, fieldText, allowedLinks, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(dbtcResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of dbtcResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTextField notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({ ...noticeEntry, rowID, fieldName });\r\n        }\r\n    }\r\n    // end of ourCheckTextField function\r\n\r\n\r\n    async function ourCheckTAReference(rowID, fieldName, taLinkText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the TA reference can be found\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`checkAnnotationTSVDataRow ourCheckTAReference(${fieldName}, (${taLinkText.length}) '${taLinkText}', ${rowLocation}, )`);\r\n        console.assert(rowID !== undefined, \"checkAnnotationTSVDataRow ourCheckTAReference: 'rowID' parameter should be defined\");\r\n        console.assert(typeof rowID === 'string', `checkAnnotationTSVDataRow ourCheckTAReference: 'rowID' parameter should be a string not a '${typeof rowID}'`);\r\n        console.assert(fieldName !== undefined, \"checkAnnotationTSVDataRow ourCheckTAReference: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `checkAnnotationTSVDataRow ourCheckTAReference: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(taLinkText !== undefined, \"checkAnnotationTSVDataRow ourCheckTAReference: 'taLinkText' parameter should be defined\");\r\n        console.assert(typeof taLinkText === 'string', `checkAnnotationTSVDataRow ourCheckTAReference: 'taLinkText' parameter should be a string not a '${typeof taLinkText}'`);\r\n        console.assert(rowLocation.indexOf(fieldName) < 0, `checkAnnotationTSVDataRow ourCheckTAReference: 'rowLocation' parameter should be not contain fieldName=${fieldName}`);\r\n\r\n        const coqResultObject = await checkTAReference(fieldName, taLinkText, rowLocation, { ...optionalCheckingOptions, taRepoLanguageCode: languageCode });\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTAReference notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({ ...noticeEntry, rowID, fieldName });\r\n        }\r\n    }\r\n    // end of ourCheckTAReference function\r\n\r\n    async function ourCheckTNOriginalLanguageQuote(rowID, fieldName, fieldText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the Hebrew/Greek quote can be found in the original texts\r\n\r\n        // Uses the bookID,C,V values from the main function call\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`checkAnnotationTSVDataRow ourCheckTNOriginalLanguageQuote(${fieldName}, (${fieldText.length}) '${fieldText}', ${rowLocation}, )`);\r\n        console.assert(rowID !== undefined, \"checkAnnotationTSVDataRow ourMarkdownTextChecks: 'rowID' parameter should be defined\");\r\n        console.assert(typeof rowID === 'string', `checkAnnotationTSVDataRow ourMarkdownTextChecks: 'rowID' parameter should be a string not a '${typeof rowID}'`);\r\n        console.assert(fieldName !== undefined, \"checkAnnotationTSVDataRow ourMarkdownTextChecks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `checkAnnotationTSVDataRow ourMarkdownTextChecks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"checkAnnotationTSVDataRow ourCheckTNOriginalLanguageQuote: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `checkAnnotationTSVDataRow ourCheckTNOriginalLanguageQuote: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n\r\n        const coqResultObject = await checkOriginalLanguageQuote(fieldName,fieldText, bookID,C,V, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTNOriginalLanguageQuote notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({ ...noticeEntry, rowID, fieldName });\r\n        }\r\n    }\r\n    // end of ourCheckTNOriginalLanguageQuote function\r\n\r\n    async function ourCheckTNLinks(rowID, fieldName, taLinkText, rowLocation, optionalCheckingOptions) {\r\n        // Checks that the TA reference can be found\r\n\r\n        // Updates the global list of notices\r\n\r\n        // console.log(`checkAnnotationTSVDataRow ourCheckTNLinks(${fieldName}, (${taLinkText.length}) '${taLinkText}', ${rowLocation}, )`);\r\n        console.assert(rowID !== undefined, \"checkAnnotationTSVDataRow ourCheckTNLinks: 'rowID' parameter should be defined\");\r\n        console.assert(typeof rowID === 'string', `checkAnnotationTSVDataRow ourCheckTNLinks: 'rowID' parameter should be a string not a '${typeof rowID}'`);\r\n        console.assert(fieldName !== undefined, \"checkAnnotationTSVDataRow ourCheckTNLinks: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `checkAnnotationTSVDataRow ourCheckTNLinks: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(taLinkText !== undefined, \"checkAnnotationTSVDataRow ourCheckTNLinks: 'taLinkText' parameter should be defined\");\r\n        console.assert(typeof taLinkText === 'string', `checkAnnotationTSVDataRow ourCheckTNLinks: 'taLinkText' parameter should be a string not a '${typeof taLinkText}'`);\r\n\r\n        const coqResultObject = await checkTNLinks(bookID, fieldName, taLinkText, rowLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        // result.noticeList = result.noticeList.concat(coqResultObject.noticeList);\r\n        // If we need to put everything through addNotice6to9, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        for (const noticeEntry of coqResultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `TL ourCheckTNLinks notice length=${Object.keys(noticeEntry).length}`);\r\n            addNotice6to9({ ...noticeEntry, rowID, fieldName });\r\n        }\r\n    }\r\n    // end of ourCheckTNLinks function\r\n\r\n\r\n    // Main code for checkAnnotationTSVDataRow function\r\n    if (line === EXPECTED_TN_HEADING_LINE) // Assume it must be ok\r\n        return adrResult; // We can't detect if it's in the wrong place\r\n\r\n    addNotice6to9({priority:998, message:\"checkAnnotationTSVDataRow() is still a placeholder -- not completed yet\", location:ourRowLocation});\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (tlcELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    // const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    // const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    let numChaptersThisBook;\r\n    if (bookID !== 'OBS') {\r\n        const lowercaseBookID = bookID.toLowerCase();\r\n        try {\r\n            numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n        } catch (tlcNCerror) {\r\n            addNotice6to9({priority:979, message:\"Invalid book identifier passed to checkAnnotationTSVDataRow\", location:` '${bookID}' in first parameter: ${tlcNCerror}`});\r\n        }\r\n    }\r\n    const haveBibleBookID = numChaptersThisBook !== undefined;\r\n\r\n    let fields = line.split('\\t');\r\n    if (fields.length === NUM_EXPECTED_ANNOTATION_TSV_FIELDS) {\r\n        const [reference, rowID, tags, supportReference, quote, occurrence, annotation] = fields;\r\n        // let withString = ` with '${rowID}'${inString}`;\r\n        // let CV_withString = ` ${C}:${V}${withString}`;\r\n        // let atString = ` at ${B} ${C}:${V} (${rowID})${inString}`;\r\n\r\n        // Check the fields one-by-one\r\n        const [C, V] = reference.split(':')\r\n        let numVersesThisChapter, haveGoodChapterNumber;\r\n        if (C.length) {\r\n            if (C === 'front') { }\r\n            else if (/^\\d+$/.test(C)) {\r\n                let intC = Number(C);\r\n                if (intC === 0) {\r\n                    addNotice6to9({priority:824, message:`Invalid zero chapter number`, extract:C, rowID, location:ourRowLocation});\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n                // TODO: Does this next section need rewriting (see verse check below)???\r\n                else if (intC > numChaptersThisBook) {\r\n                    addNotice6to9({priority:823, message:`Invalid large chapter number`, extract:C, rowID, location:ourRowLocation});\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n                try {\r\n                    numVersesThisChapter = books.versesInChapter(bookID.toLowerCase(), intC);\r\n                    haveGoodChapterNumber = true;\r\n                } catch (tlcNVerror) {\r\n                    if (!haveBibleBookID)\r\n                        // addNotice6to9({priority:500, message:\"Invalid chapter number\", rowLocation);\r\n                        // else\r\n                        addNotice6to9({priority:822, message:\"Unable to check chapter number\", rowID, location:` '${C}'${ourRowLocation}`});\r\n                    haveGoodChapterNumber = false;\r\n                }\r\n            }\r\n            else\r\n                addNotice6to9({priority:821, message:\"Bad chapter number\", rowID, location:` '${C}' with${ourRowLocation}`});\r\n        }\r\n        else\r\n            addNotice6to9({priority:820, message:\"Missing chapter number\", rowID, location:` ?:${V}${ourRowLocation}`});\r\n\r\n        if (V.length) {\r\n            if (V === 'intro') { }\r\n            else if (/^\\d+$/.test(V)) {\r\n                let intV = Number(V);\r\n                if (intV === 0)\r\n                    addNotice6to9({priority:814, message:`Invalid zero '${V}' verse number`, rowID, location:ourRowLocation});\r\n                else {\r\n                    if (haveGoodChapterNumber) {\r\n                        if (intV > numVersesThisChapter)\r\n                            addNotice6to9({priority:813, message:`Invalid large '${V}' verse number`, rowID, location:` for chapter ${C}${ourRowLocation}`});\r\n                    } else\r\n                        addNotice6to9({priority:812, message:\"Unable to check verse number\", rowID, location:` '${V}'${ourRowLocation}`});\r\n                }\r\n            }\r\n            else\r\n                addNotice6to9({priority:811, message:\"Bad verse number\", rowID, location:` '${V}'${ourRowLocation}`});\r\n        }\r\n        else\r\n            addNotice6to9({priority:810, message:\"Missing verse number\", rowID, location:` after ${C}:?${ourRowLocation}`});\r\n\r\n        if (!rowID.length)\r\n            addNotice6to9({priority:779, message:\"Missing ID field\", location:ourRowLocation});\r\n        else {\r\n            if (rowID.length !== 4)\r\n                addNotice6to9({priority:778, message:\"ID should be exactly 4 characters\", rowID, location:` (not ${rowID.length})${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(rowID[0]) < 0)\r\n                addNotice6to9({priority:176, message:\"ID should start with a lowercase letter or digit\", characterIndex:0, rowID, location:` (not '${rowID[0]}')${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(rowID[3]) < 0)\r\n                addNotice6to9({priority:175, message:\"ID should end with a lowercase letter or digit\", characterIndex:3, rowID, location:` (not '${rowID[3]}')${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(rowID[1]) < 0)\r\n                addNotice6to9({priority:174, message:\"ID characters should only be lowercase letters, digits, or hypen\", characterIndex:1, rowID, location:` (not '${rowID[1]}')${ourRowLocation}`});\r\n            else if ('abcdefghijklmnopqrstuvwxyz0123456789'.indexOf(rowID[2]) < 0)\r\n                addNotice6to9({priority:173, message:\"ID characters should only be lowercase letters, digits, or hypen\", characterIndex:2, rowID, location:` (not '${rowID[2]}')${ourRowLocation}`});\r\n        }\r\n\r\n        if (tags.length)\r\n            ;\r\n\r\n        if (supportReference.length) { // need to check UTN against UTA\r\n            ourCheckTextField(rowID, 'SupportReference', supportReference, true, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTAReference(rowID, 'SupportReference', supportReference, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        // else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n        //     addNotice6to9({priority:277, message:\"Missing SupportReference field\", location:ourRowLocation});\r\n\r\n        if (quote.length) { // need to check UTN against UHB and UGNT\r\n            ourCheckTextField(rowID, 'Quote', quote, false, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTNOriginalLanguageQuote(rowID, 'Quote', quote, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n            if (V !== 'intro')\r\n                addNotice6to9({priority:276, message:\"Missing Quote field\", rowID, location:ourRowLocation});\r\n\r\n        if (occurrence.length) { // This should usually be a digit\r\n            if (occurrence === '0') { // zero means that it doesn't occur\r\n                if (quote.length)\r\n                    addNotice6to9({priority:550, message:\"Invalid zero occurrence field when we have an original quote\", rowID, location:ourRowLocation});\r\n                // if (V !== 'intro')\r\n                //     addNotice6to9({priority:500, message:\"Invalid zero occurrence field\", rowID, location:rowLocation);\r\n            }\r\n            else if (occurrence === '-1') // TODO check the special conditions when this can occur???\r\n                ;\r\n            else if ('12345'.indexOf(occurrence) < 0) // it's not one of these integers\r\n                addNotice6to9({priority:792, message:`Invalid '${occurrence}' occurrence field`, rowID, location:ourRowLocation});\r\n        }\r\n\r\n        if (annotation.length) {\r\n            ourMarkdownTextChecks(rowID, 'Annotation', annotation, true, ourRowLocation, optionalCheckingOptions);\r\n            await ourCheckTNLinks(rowID, 'Annotation', annotation, ourRowLocation, optionalCheckingOptions);\r\n        }\r\n        else // TODO: Find out if these fields are really compulsory (and when they're not, e.g., for 'intro') ???\r\n            addNotice6to9({priority:274, message:`Missing ${annotationType} Annotation field`, rowID, location:ourRowLocation});\r\n\r\n    } else\r\n        addNotice6to9({priority:861, message:`Found wrong number of TSV fields (expected ${NUM_EXPECTED_ANNOTATION_TSV_FIELDS})`, extract:`Found ${fields.length} field${fields.length === 1 ? '' : 's'}`, location:ourRowLocation});\r\n\r\n    // console.log(`  checkAnnotationTSVDataRow returning with ${drResult.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkAnnotationTSVDataRow result is\", JSON.stringify(drResult));\r\n    return adrResult; // object with noticeList only\r\n}\r\n// end of checkAnnotationTSVDataRow function\r\n\r\n//export default checkAnnotationTSVDataRow;\r\n","import * as books from '../core/books/books';\r\nimport { isWhitespace, countOccurrences } from './text-handling-functions'\r\nimport {checkTextField} from './field-text-check';\r\nimport {checkTextfileContents} from './file-text-check';\r\nimport { runUsfmJsCheck } from './usfm-js-check';\r\nimport { runBCSGrammarCheck } from './BCS-usfm-grammar-check';\r\nimport { ourParseInt } from './utilities';\r\n\r\n\r\n// const USFM_VALIDATOR_VERSION_STRING = '0.6.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\n// See http://ubsicap.github.io/usfm/master/index.html\r\nconst INTRO_LINE_START_MARKERS = ['id', 'usfm', 'ide', 'h',\r\n    'toc1', 'toc2', 'toc3',\r\n    'mt', 'mt1', 'mt2',\r\n    'mte', 'mte1', 'mte2',\r\n    'imt', 'imt1', 'imt2',\r\n    'is', 'is1', 'is2',\r\n    'ip', 'ipi', 'im', 'imi', 'ipq', 'imq', 'ipr',\r\n    'iq', 'iq1', 'iq2',\r\n    'ili', 'ili1', 'ili2',\r\n    'iot', 'io', 'io1', 'io2',\r\n    'iex', 'imte', 'imte1', 'imte2'];\r\nconst CV_MARKERS = ['c', 'v', 'ca', 'va'];\r\nconst HEADING_TYPE_MARKERS = [ // expected to contain text on the same line\r\n    's', 's1', 's2', 's3', 's4', 'sr',\r\n    'ms', 'ms1', 'mr',\r\n    'r', 'd', 'rem', 'sp', 'qs', 'cl',\r\n    'sd', 'sd1', 'sd2',\r\n    'pr', 'cls', 'pmo', 'pmc', 'pmr', 'pc',\r\n    'periph'];\r\nconst PARAGRAPH_MARKERS = ['p', 'q', 'q1', 'q2', 'q3', 'q4',\r\n    'm', 'mi',\r\n    'pi', 'pi1', 'pi2', 'pi3', 'pi4',\r\n    'li', 'li1', 'li2', 'li3', 'li4',\r\n    'lim', 'lim1', 'lim2', 'lim3', 'lim4',\r\n    'lh', 'lf',\r\n    'po', 'pm',\r\n    'ph', 'ph1', 'ph2', 'ph3', 'ph4',\r\n    'tr'];\r\nconst NOTE_MARKERS = ['f', 'x'];\r\nconst SPECIAL_MARKERS = ['w', 'zaln-s', 'k-s',\r\n    'qt-s', 'qt1-s', 'qt2-s',\r\n    'lit'];\r\nconst MILESTONE_MARKERS = ['ts\\\\*', 'ts-s', 'ts-e', 'k-e\\\\*']; // Is this a good way to handle it???\r\nconst MARKERS_WITHOUT_CONTENT = ['b', 'nb', 'ib', 'ie'].concat(MILESTONE_MARKERS);\r\nconst ALLOWED_LINE_START_MARKERS = [].concat(INTRO_LINE_START_MARKERS).concat(HEADING_TYPE_MARKERS)\r\n    .concat(CV_MARKERS).concat(PARAGRAPH_MARKERS)\r\n    .concat(NOTE_MARKERS).concat(SPECIAL_MARKERS).concat(MARKERS_WITHOUT_CONTENT)\r\n    .concat(MILESTONE_MARKERS);\r\nconst DEPRECATED_MARKERS = [\r\n    'h1', 'h2', 'h3', 'h4',\r\n    'pr',\r\n    'ph', 'ph1', 'ph2', 'ph3', 'ph4',\r\n    'addpn', 'pro', 'fdc', 'xdc'];\r\nconst MARKERS_WITH_COMPULSORY_CONTENT = [].concat(INTRO_LINE_START_MARKERS).concat(HEADING_TYPE_MARKERS)\r\n    .concat(CV_MARKERS).concat(NOTE_MARKERS).concat(SPECIAL_MARKERS);\r\n// eslint-disable-next-line no-unused-vars\r\nconst CHARACTER_MARKERS = ['add', 'bk', 'dc', 'k', 'nd', 'ord', 'pn', 'png', 'addpn',\r\n    'qt', 'sig', 'sls', 'tl', 'wj',\r\n    'rq', 'ior', 'iqt',\r\n    'em', 'bd', 'it', 'bdit', 'no', 'sc', 'sup',\r\n    'fig', 'ndx', 'rb', 'pro', 'w', 'wg', 'wh', 'wa', // NOTE that we have \\w in TWO places\r\n    'litl', 'lik',\r\n    'liv', 'liv1', 'liv2', 'liv3', 'liv4'];\r\n// eslint-disable-next-line no-unused-vars\r\nconst FOOTNOTE_INTERNAL_MARKERS = ['fr', 'fq', 'fqa', 'fk', 'fl', 'fw', 'fp', 'fv', 'ft', 'fdc', 'fm', 'xt'];\r\n// eslint-disable-next-line no-unused-vars\r\nconst XREF_INTERNAL_MARKERS = ['xo', 'xk', 'xq', 'xt', 'xta', 'xop', 'xot', 'xnt', 'xdc', 'rq'];\r\nconst COMPULSORY_MARKERS = ['id', 'ide'];\r\nconst EXPECTED_MARKERS = ['usfm', 'mt1'];\r\nconst EXPECTED_BIBLE_BOOK_MARKERS = ['h', 'toc1', 'toc2', 'toc3'];\r\nconst EXPECTED_PERIPHERAL_BOOK_MARKERS = ['periph'];\r\n\r\n\r\nexport function checkUSFMText(languageCode, bookID, filename, givenText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all lines.\r\n\r\n    bookID is a three-character UPPERCASE USFM book identifier.\r\n\r\n    filename parameter can be an empty string if we don't have one.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`checkUSFMText(${languageCode}, ${bookID}, ${givenText.length.toLocaleString()} chars, '${givenLocation}', ${JSON.stringify(optionalCheckingOptions)})`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (usfmELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength} cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const result = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkUSFMText success: ${successString}`);\r\n        result.successList.push(successString);\r\n    }\r\n    function addNoticeCV8(noticeObject) {\r\n        // console.log(\"checkUSFMText addNoticeCV8:\", JSON.stringify(noticeObject));\r\n        // console.log(`checkUSFMText addNoticeCV8: (priority=${noticeObject.priority}) ${noticeObject.C}:${noticeObject.V} ${noticeObject.message}${noticeObject.characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${noticeObject.extract ? ` ${noticeObject.extract}` : \"\"}${noticeObject.location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"cUSFM addNoticeCV8: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `cUSFM addNoticeCV8: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"cUSFM addNoticeCV8: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `cUSFM addNoticeCV8: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(C !== undefined, \"cUSFM addNoticeCV8: 'C' parameter should be defined\");\r\n        if (noticeObject.C) console.assert(typeof noticeObject.C === 'string', `cUSFM addNoticeCV8: 'C' parameter should be a string not a '${typeof noticeObject.C}': ${noticeObject.C}`);\r\n        // console.assert(V !== undefined, \"cUSFM addNoticeCV8: 'V' parameter should be defined\");\r\n        if (noticeObject.V) console.assert(typeof noticeObject.V === 'string', `cUSFM addNoticeCV8: 'V' parameter should be a string not a '${typeof noticeObject.V}': ${noticeObject.V}`);\r\n        // console.assert(characterIndex !== undefined, \"cUSFM addNoticeCV8: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex !== undefined) console.assert(typeof noticeObject.characterIndex === 'number', `cUSFM addNoticeCV8: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cUSFM addNoticeCV8: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cUSFM addNoticeCV8: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"cUSFM addNoticeCV8: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `cUSFM addNoticeCV8: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        result.noticeList.push({ ...noticeObject, bookID, filename });\r\n    }\r\n\r\n\r\n    function ourRunBCSGrammarCheck(filename, fileText, fileLocation) {\r\n        // Runs the BCS USFM Grammar checker\r\n        //  which can be quite time-consuming on large, complex USFM files\r\n        // console.log(\"Running our BCS USFM grammar check (can take quite a while for a large book)\");\r\n\r\n        const grammarCheckResult = runBCSGrammarCheck('strict', fileText, filename, fileLocation, optionalCheckingOptions);\r\n        // NOTE: We haven't figured out how to get ERRORS out of this parser yet\r\n        // console.log(`  Finished our BCS USFM grammar check with ${grammarCheckResult.isValidUSFM} and ${grammarCheckResult.warnings.length} warnings.`);\r\n        addSuccessMessage(`Checked USFM Grammar (strict mode) ${grammarCheckResult.isValidUSFM ? \"without errors\" : \" (but the USFM DIDN'T validate)\"}`);\r\n\r\n        // if (!grammarCheckResult.isValidUSFM) // TEMP DEGRADE TO WARNING 994 -> 544 ................XXXXXXXXXXXXXXXXXXXXXX\r\n        // Don't do this since we add the actual error message elsewhere now\r\n        // addNoticeCV8({priority:994, '', '', `USFM3 Grammar Check (strict mode) doesn't pass`, location:fileLocation});\r\n\r\n        // We only get one error if it fails\r\n        if (grammarCheckResult.error && grammarCheckResult.error.priority)\r\n            // Prevent these false alarms (from Ohm schema issues, esp. empty lemma fields)\r\n            if (!grammarCheckResult.error.extract\r\n                || (grammarCheckResult.error.extract.indexOf('emma=\"\"') < 0 && grammarCheckResult.error.message.indexOf('Expected \"c\", \"v\", ') < 0))\r\n                addNoticeCV8(grammarCheckResult.error);\r\n\r\n        // console.log(\"  Warnings:\", JSON.stringify(grammarCheckResult.warnings));\r\n        // Display these warnings but with a lower priority\r\n        for (const warningString of grammarCheckResult.warnings)\r\n            if (!warningString.startsWith(\"Empty lines present\") // we allow empty lines in our USFM\r\n                && !warningString.startsWith(\"Trailing spaces present at line end\") // we find these ourselves\r\n            )\r\n                addNoticeCV8({ priority: 102, message: `USFMGrammar: ${warningString}`, location: fileLocation });\r\n\r\n        if (!grammarCheckResult.isValidUSFM) {\r\n            const relaxedGrammarCheckResult = runBCSGrammarCheck('relaxed', fileText, filename, fileLocation);\r\n            addSuccessMessage(`Checked USFM Grammar (relaxed mode) ${relaxedGrammarCheckResult.isValidUSFM ? \"without errors\" : \" (but the USFM DIDN'T validate)\"}`);\r\n            if (!relaxedGrammarCheckResult.isValidUSFM)\r\n                addNoticeCV8({ priority: 644, message: \"USFM3 Grammar Check (relaxed mode) doesn't pass either\", location: fileLocation });\r\n        }\r\n    }\r\n    // end of ourRunBCSGrammarCheck function\r\n\r\n\r\n    function CVCheck(bookID, givenText, CVlocation) {\r\n        /*\r\n        This check uses the USFM-JS package to parse the USFM\r\n            and then it checks the results to make sure all expected verses are there.\r\n\r\n        This has the side advantage that it's using exactly the same code/package that's\r\n            used by tCore and tC Create.\r\n\r\n        Note that for verse bridges, USFM-JS returns the bridge, e.g., 24-25\r\n            AS WELL AS an entry for the bridged verses, e.g., 24 and 25.\r\n\r\n        Sadly this package doesn't return any errors or warnings from its parsing\r\n            so that's handle other ways in other places.\r\n\r\n        Note that this code below does NOT check for chapters and verses\r\n            being in the correct order. That's done elsewhere.\r\n        */\r\n        // console.log(\"Running CVCheck() using USFM-JS (can take quite a while for a large book)\");\r\n        let chapterNumberString, verseNumberString;\r\n\r\n\r\n        function hasText(verseObjects) {\r\n            let gotDeep = false;\r\n            for (const someObject of verseObjects) {\r\n                // console.log(\"someObject\", JSON.stringify(someObject));\r\n                if (someObject['type'] === 'text' && someObject['text'].length > 5)\r\n                    return true;\r\n                if (someObject['type'] === 'word' && someObject['text'].length > 2)\r\n                    return true;\r\n                if (someObject['type'] === 'milestone')\r\n                    for (const someSubobject of someObject['children']) {\r\n                        // console.log(\"someSubobject\", JSON.stringify(someSubobject));\r\n                        if (someSubobject['type'] === 'text' && someSubobject['text'].length > 5)\r\n                            return true;\r\n                        if (someSubobject['type'] === 'word' && someSubobject['text'].length > 2)\r\n                            return true;\r\n                        if (someSubobject['type'] === 'milestone')\r\n                            for (const someSubSubobject of someSubobject['children']) {\r\n                                // console.log(\"someSubSubobject\", JSON.stringify(someSubSubobject));\r\n                                if (someSubSubobject['type'] === 'text' && someSubSubobject['text'].length > 5)\r\n                                    return true;\r\n                                if (someSubSubobject['type'] === 'word' && someSubSubobject['text'].length > 2)\r\n                                    return true;\r\n                                if (someSubSubobject['type'] === 'milestone')\r\n                                    for (const someSubSubSubobject of someSubSubobject['children']) {\r\n                                        // console.log(\"someSubSubSubobject\", JSON.stringify(someSubSubSubobject));\r\n                                        if (someSubSubSubobject['type'] === 'text' && someSubSubSubobject['text'].length > 5)\r\n                                            return true;\r\n                                        if (someSubSubSubobject['type'] === 'word' && someSubSubSubobject['text'].length > 2)\r\n                                            return true;\r\n                                        if (someSubSubSubobject['type'] === 'milestone')\r\n                                            for (const someSubSubSubSubobject of someSubSubSubobject['children']) {\r\n                                                // console.log(\"someSubSubSubSubobject\", JSON.stringify(someSubSubSubSubobject));\r\n                                                if (someSubSubSubSubobject['type'] === 'text' && someSubSubSubSubobject['text'].length > 5)\r\n                                                    return true;\r\n                                                if (someSubSubSubSubobject['type'] === 'word' && someSubSubSubSubobject['text'].length > 2)\r\n                                                    return true;\r\n                                                if (someSubSubSubSubobject['type'] === 'milestone') gotDeep = true;\r\n                                                // console.assert(someSubSubSubobject['type'] !== 'milestone', `We need to add more depth levels to hasText() for ${chapterNumberString}:${verseNumberString}`);\r\n                                            }\r\n                                    }\r\n                            }\r\n                    }\r\n            }\r\n            if (gotDeep) console.assert(false, `We need to add more depth levels to hasText() for ${bookID} ${chapterNumberString}:${verseNumberString}`);\r\n            // console.log(`hasText() for ${chapterNumberString}:${verseNumberString} returning false with ${typeof verseObjects} (${verseObjects.length}): ${JSON.stringify(verseObjects)}`);\r\n            return false;\r\n        }\r\n        // end of hasText function\r\n\r\n\r\n        // Main code for CVCheck function\r\n        let lowercaseBookID = bookID.toLowerCase();\r\n        let expectedVersesPerChapterList = [];\r\n        try {\r\n            expectedVersesPerChapterList = books.chaptersInBook(lowercaseBookID); // A list of integers -- numVerses for each chapter\r\n            // console.log(\"Got chapterList\", JSON.stringify(expectedVersesPerChapterList));\r\n        }\r\n        catch { }\r\n\r\n        // Try doing this using USFM-JS via runUsfmJsCheck()\r\n        const result1 = runUsfmJsCheck(givenText);\r\n        // console.log(\"Got a JSON result\", JSON.stringify(result1));\r\n        // console.log(\"Got a JSON headers result\", JSON.stringify(result1.returnedJSON.headers));\r\n        // console.log(\"Got a JSON chapters result\", JSON.stringify(result1.returnedJSON.chapters));\r\n        for (chapterNumberString in result1.returnedJSON.chapters) {\r\n            // console.log(`chapterNumberString=${chapterNumberString}`);\r\n            // if (chapterNumberString === '3')\r\n            //     console.log(`chapter ${chapterNumberString} ${JSON.stringify(result1.returnedJSON.chapters[chapterNumberString])}`);\r\n            let chapterInt;\r\n            try {\r\n                chapterInt = ourParseInt(chapterNumberString);\r\n            } catch (usfmCIerror) {\r\n                console.log(`CVCheck couldn't convert ${bookID} chapter '${chapterNumberString}': ${usfmCIerror}`);\r\n            }\r\n            if (chapterInt < 1 || chapterInt > expectedVersesPerChapterList.length)\r\n                addNoticeCV8({ priority: 869, message: \"Chapter number out of range\", C: chapterNumberString, extract: `${bookID} ${chapterNumberString}`, location: CVlocation });\r\n            else {\r\n                let discoveredVerseList = [], discoveredVerseWithTextList = [];\r\n                // console.log(`Chapter ${chapterNumberString} verses ${Object.keys(result1.returnedJSON.chapters[chapterNumberString])}`);\r\n                for (verseNumberString in result1.returnedJSON.chapters[chapterNumberString]) {\r\n                    if (verseNumberString === 'front') continue; // skip the rest here\r\n                    // if (chapterNumberString === '3')\r\n                    //     console.log(`verseNumberString=${verseNumberString}`);\r\n                    // if (chapterNumberString === '3' && verseNumberString === '14')\r\n                    //     console.log(`verse ${verseNumberString} ${JSON.stringify(result1.returnedJSON.chapters[chapterNumberString][verseNumberString])}`);\r\n                    const verseObjects = result1.returnedJSON.chapters[chapterNumberString][verseNumberString]['verseObjects'];\r\n                    // if (chapterNumberString === '3' && verseNumberString === '14')\r\n                    //     console.log(`verseObjects=${verseObjects}`);\r\n                    const verseHasText = hasText(verseObjects);\r\n                    if (verseNumberString.indexOf('-') >= 0) { // It's a verse bridge\r\n                        const bits = verseNumberString.split('-');\r\n                        const firstVString = bits[0], secondVString = bits[1];\r\n                        let intFirstV, intSecondV;\r\n                        try {\r\n                            intFirstV = ourParseInt(firstVString);\r\n                            intSecondV = ourParseInt(secondVString);\r\n                            for (let v = intFirstV; v <= intSecondV; v++) {\r\n                                discoveredVerseList.push(v);\r\n                                if (verseHasText)\r\n                                    discoveredVerseWithTextList.push(v);\r\n                            }\r\n                        } catch (usfmVIerror) {\r\n                            addNoticeCV8({ priority: 762, message: \"Unable to convert verse bridge numbers to integers\", C: chapterNumberString, V: verseNumberString, characterIndex: 3, extract: verseNumberString, location: `${CVlocation} with ${usfmVIerror}` });\r\n                        }\r\n                    } else { // It's NOT a verse bridge\r\n                        let verseInt;\r\n                        try {\r\n                            verseInt = ourParseInt(verseNumberString);\r\n                            discoveredVerseList.push(verseInt);\r\n                        } catch (usfmPIerror) {\r\n                            console.log(`We couldn't convert ${bookID} ${chapterNumberString} verse '${verseNumberString}': ${usfmPIerror}`);\r\n                        }\r\n\r\n                        if (verseInt < 1 || verseInt > expectedVersesPerChapterList[chapterInt - 1])\r\n                            addNoticeCV8({ priority: 868, message: \"Verse number out of range\", C: chapterNumberString, V: verseNumberString, extract: `${bookID} ${chapterNumberString}:${verseNumberString}`, location: CVlocation });\r\n\r\n                        if (verseHasText)\r\n                            discoveredVerseWithTextList.push(verseInt);\r\n                    }\r\n                }\r\n\r\n                // Check that expected verses numbers were actually all there\r\n                // console.log(\"Doing missing verse check\");\r\n                for (let v = 1; v <= expectedVersesPerChapterList[chapterInt - 1]; v++) {\r\n                    if (discoveredVerseList.indexOf(v) < 0)\r\n                        if (books.isOftenMissing(bookID, chapterInt, v))\r\n                            addNoticeCV8({ priority: 67, C: chapterNumberString, V: `${v}`, message: \"Verse appears to be left out\", location: CVlocation });\r\n                        else\r\n                            addNoticeCV8({ priority: 867, C: chapterNumberString, V: `${v}`, message: \"Verse appears to be missing\", location: CVlocation });\r\n                    // Check for existing verses but missing text\r\n                    if (discoveredVerseWithTextList.indexOf(v) < 0) {\r\n                        // const firstVerseObject = result1.returnedJSON.chapters[chapterNumberString][v]['verseObjects'][0];\r\n                        // console.log(\"firstVerseObject\", JSON.stringify(firstVerseObject));\r\n                        addNoticeCV8({ priority: 866, C: chapterNumberString, V: `${v}`, message: \"Verse seems to have no text\", location: CVlocation });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        addSuccessMessage(`Checked CV patterns for ${bookID}${CVlocation}`);\r\n    }\r\n    // end of CVCheck function\r\n\r\n\r\n    function ourCheckTextField(lineNumber, C, V, fieldName, fieldText, allowedLinks, fieldLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} C - chapter number of the text being checked\r\n        * @param {String} V - verse number of the text being checked\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} fieldLocation - description of where the field is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        // console.log(`cUSFM ourCheckTextField(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${fieldLocation}, )`);\r\n        console.assert(fieldName !== undefined, \"cUSFM ourCheckTextField: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName === 'string', `cUSFM ourCheckTextField: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText !== undefined, \"cUSFM ourCheckTextField: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText === 'string', `cUSFM ourCheckTextField: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert(allowedLinks === true || allowedLinks === false, \"cUSFM ourCheckTextField: allowedLinks parameter must be either true or false\");\r\n\r\n        const dbtcResultObject = checkTextField(fieldName, fieldText, allowedLinks, fieldLocation, optionalCheckingOptions);\r\n\r\n        // Process results line by line to filter out potential false positives\r\n        //  for this particular kind of text field\r\n        for (const noticeEntry of dbtcResultObject.noticeList) {\r\n            console.log(\"Notice keys\", JSON.stringify(Object.keys(noticeEntry)));\r\n            console.assert(Object.keys(noticeEntry).length === 5, `USFM ourCheckTextField notice length=${Object.keys(noticeEntry).length}`);\r\n            if (!noticeEntry.message.startsWith(\"Mismatched () characters\") // 663 Mismatched left/right chars -- suppress these misleading warnings coz open quote can occur in one verse and close in another\r\n                && !noticeEntry.message.startsWith(\"Mismatched [] characters\")\r\n                && !noticeEntry.message.startsWith(\"Mismatched  characters\")\r\n                && !noticeEntry.message.startsWith(\"Mismatched  characters\")\r\n                && (!noticeEntry.message.startsWith(\"Unexpected | character after space\") || fieldText.indexOf('x-lemma') < 0) // inside \\zaln-s fields\r\n                && (!noticeEntry.message.startsWith(\"Unexpected doubled , characters\") || fieldText.indexOf('x-morph') < 0) // inside \\w fields\r\n                && (!noticeEntry.message.startsWith('Unexpected doubled \" characters') || fieldText.indexOf('x-morph') < 0) // inside \\w fields\r\n            ) {\r\n                // const newNoticeObject = { priority:noticeEntry.priority, message:noticeEntry.message }\r\n                // if (C !== undefined && C.length) newNoticeObject.C = C;\r\n                // if (V !== undefined && V.length) newNoticeObject.V = V;\r\n                // // if (filename !== undefined && filename.length) newNoticeObject.filename = filename;\r\n                // if (noticeEntry.characterIndex !== undefined) newNoticeObject.characterIndex = noticeEntry.characterIndex;\r\n                // if (noticeEntry.extract !== undefined && noticeEntry.extract.length) newNoticeObject.extract = noticeEntry.extract;\r\n                // if (noticeEntry.location !== undefined && noticeEntry.location.length) newNoticeObject.location = noticeEntry.location;\r\n                addNoticeCV8({ ...noticeEntry, lineNumber, C, V });\r\n            }\r\n        }\r\n    }\r\n    // end of ourCheckTextField function\r\n\r\n\r\n    function ourBasicFileChecks(filename, fileText, fileLocation, optionalCheckingOptions) {\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        console.assert(filename !== undefined, \"cUSFM ourBasicFileChecks: 'filename' parameter should be defined\");\r\n        console.assert(typeof filename === 'string', `cUSFM ourBasicFileChecks: 'filename' parameter should be a string not a '${typeof filename}'`);\r\n        console.assert(fileText !== undefined, \"cUSFM ourBasicFileChecks: 'fileText' parameter should be defined\");\r\n        console.assert(typeof fileText === 'string', `cUSFM ourBasicFileChecks: 'fileText' parameter should be a string not a '${typeof fileText}'`);\r\n\r\n        const resultObject = checkTextfileContents(languageCode, filename, fileText, fileLocation, optionalCheckingOptions);\r\n\r\n        // Choose only ONE of the following\r\n        // This is the fast way of append the results from this field\r\n        result.noticeList = result.noticeList.concat(resultObject.noticeList);\r\n        // If we need to put everything through addNoticeCV8, e.g., for debugging or filtering\r\n        //  process results line by line\r\n        // for (const noticeEntry of resultObject.noticeList)\r\n        //     addNoticeCV8({priority:noticeEntry.priority, noticeEntry.message, noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7]);\r\n    }\r\n    // end of ourBasicFileChecks function\r\n\r\n\r\n    function checkUSFMCharacterFields(filename, fileText, fileLocation) {\r\n        // Check matched pairs\r\n        for (const punctSet of [\r\n            // Character formatting\r\n            ['\\\\add ', '\\\\add*'], ['\\\\addpn ', '\\\\addpn*'],\r\n            ['\\\\bd ', '\\\\bd*'], ['\\\\bdit ', '\\\\bdit*'],\r\n            ['\\\\bk ', '\\\\bk*'],\r\n            ['\\\\dc ', '\\\\dc*'],\r\n            ['\\\\em ', '\\\\em*'],\r\n            ['\\\\fig ', '\\\\fig*'],\r\n            ['\\\\it ', '\\\\it*'],\r\n            ['\\\\k ', '\\\\k*'],\r\n            ['\\\\nd ', '\\\\nd*'], ['\\\\ndx ', '\\\\ndx*'],\r\n            ['\\\\no ', '\\\\no*'],\r\n            ['\\\\ord ', '\\\\ord*'],\r\n            ['\\\\pn ', '\\\\pn*'],\r\n            ['\\\\pro ', '\\\\pro*'],\r\n            ['\\\\qt ', '\\\\qt*'],\r\n            ['\\\\sc ', '\\\\sc*'],\r\n            ['\\\\sig ', '\\\\sig*'],\r\n            ['\\\\sls ', '\\\\sls*'],\r\n            ['\\\\tl ', '\\\\tl*'],\r\n            ['\\\\w ', '\\\\w*'],\r\n            ['\\\\wg ', '\\\\wg*'], ['\\\\wh ', '\\\\wh*'],\r\n            ['\\\\wj ', '\\\\wj*'],\r\n\r\n            ['\\\\ca ', '\\\\ca*'], ['\\\\va ', '\\\\va*'],\r\n\r\n            ['\\\\f ', '\\\\f*'], ['\\\\x ', '\\\\x*'],\r\n        ]) {\r\n            const opener = punctSet[0], closer = punctSet[1];\r\n            const lCount = countOccurrences(fileText, opener);\r\n            const rCount = countOccurrences(fileText, closer);\r\n            if (lCount !== rCount)\r\n                addNoticeCV8({ priority: 873, message: `Mismatched ${opener}${closer} fields`, extract: `(left=${lCount.toLocaleString()}, right=${rCount.toLocaleString()})`, location: fileLocation });\r\n        }\r\n    }\r\n    // end of checkUSFMCharacterFields function\r\n\r\n\r\n    function checkUSFMFileContents(filename, fileText, markerSet, fileLocation) {\r\n        // Does global checks on the file\r\n        // Note: These run the risk of duplicating messages that are found within individual lines.\r\n        //          However, it's common in USFM for parentheses to open '(' in one verse\r\n        //                      and close ')' in another. So the USFM line check can't check that.\r\n        //          Also, the USFM v3.0 spec seems to allow/require whitespace reduction,\r\n        //              i.e., newLines can conceivably appear WITHIN a footnote for example.\r\n\r\n        // Check markers like \\add ... \\add*, \\f .. \\f*\r\n        checkUSFMCharacterFields(filename, fileText, fileLocation)\r\n\r\n        // Now do the general global checks (e.g., for general punctuation)\r\n        ourBasicFileChecks(filename, fileText, fileLocation);\r\n\r\n        for (const compulsoryMarker of COMPULSORY_MARKERS)\r\n            if (!markerSet.has(compulsoryMarker))\r\n                addNoticeCV8({ priority: 819, message: \"Missing compulsory USFM line\", extract: `missing \\\\${compulsoryMarker}`, location: fileLocation });\r\n        for (const expectedMarker of EXPECTED_MARKERS)\r\n            if (!markerSet.has(expectedMarker)\r\n                && (!expectedMarker.endsWith('1') || !markerSet.has(expectedMarker.substring(0, expectedMarker.length - 1))))\r\n                addNoticeCV8({ priority: 519, message: \"Missing expected USFM line\", extract: `missing \\\\${expectedMarker}`, location: fileLocation });\r\n        if (books.isExtraBookID(bookID))\r\n            for (const expectedMarker of EXPECTED_PERIPHERAL_BOOK_MARKERS)\r\n                if (!markerSet.has(expectedMarker))\r\n                    addNoticeCV8({ priority: 517, message: \"Missing expected USFM line\", extract: `missing \\\\${expectedMarker}`, location: fileLocation });\r\n                else\r\n                    for (const expectedMarker of EXPECTED_BIBLE_BOOK_MARKERS)\r\n                        if (!markerSet.has(expectedMarker))\r\n                            addNoticeCV8({ priority: 518, message: \"Missing expected USFM line\", extract: `missing \\\\${expectedMarker}`, location: fileLocation });\r\n        for (const deprecatedMarker of DEPRECATED_MARKERS)\r\n            if (markerSet.has(deprecatedMarker))\r\n                addNoticeCV8({ priority: 218, message: \"Using deprecated USFM marker\", extract: `\\\\${deprecatedMarker}`, location: fileLocation });\r\n    }\r\n    // end of checkUSFMFileContents function\r\n\r\n\r\n    function checkUSFMLineInternals(lineNumber, C, V, marker, rest, lineLocation, optionalCheckingOptions) {\r\n        // Handles character formatting within the line contents\r\n        // let adjustedRest = rest;\r\n\r\n        if (marker === 'c' && isNaN(rest))\r\n            addNoticeCV8({ priority: 822, message: \"Expected \\\\c field to contain an integer\", lineNumber, C, V, characterIndex: 3, extract: '\\\\c ' + rest, location: lineLocation });\r\n        if (marker === 'v') {\r\n            let Vstr = (rest) ? rest.split(' ', 1)[0] : '?';\r\n            if (isNaN(Vstr) && Vstr.indexOf('-') < 0)\r\n                addNoticeCV8({ priority: 822, C, V, message: \"Expected \\\\v field to contain an integer\", characterIndex: 3, extract: '\\\\v ' + rest, location: lineLocation });\r\n        }\r\n        const allowedLinks = (marker === 'w' || marker === 'k-s' || marker === 'SPECIAL1')\r\n            // (because we don't know what marker SPECIAL1 is, so default to \"no false alarms\")\r\n            && rest.indexOf('x-tw') >= 0;\r\n        if (rest) ourCheckTextField(lineNumber, C, V, '\\\\' + marker, rest, allowedLinks, ' field ' + lineLocation, optionalCheckingOptions);\r\n    }\r\n    // end of checkUSFMLineInternals function\r\n\r\n\r\n    function checkUSFMLineContents(lineNumber, C, V, marker, rest, lineLocation) {\r\n        // Looks at the marker and determines what content is allowed/expected on the rest of the line\r\n        // 'SPECIAL1' is used internally here when a character other than a backslash starts a line\r\n        if (ALLOWED_LINE_START_MARKERS.indexOf(marker) >= 0 || marker === 'SPECIAL1') {\r\n            if (rest && MARKERS_WITHOUT_CONTENT.indexOf(marker) >= 0)\r\n                if (isWhitespace(rest))\r\n                    addNoticeCV8({ priority: 301, message: `Unexpected whitespace after \\\\${marker} marker`, C, V, lineNumber, characterIndex: marker.length, extract: rest, location: lineLocation });\r\n                else if (rest !== '') // in UHB NEH 3:20\r\n                    addNoticeCV8({ priority: 401, message: `Unexpected content after \\\\${marker} marker`, C, V, lineNumber, characterIndex: marker.length, extract: rest, location: lineLocation });\r\n                else if (MARKERS_WITH_COMPULSORY_CONTENT.indexOf(marker) >= 0 && !rest)\r\n                    addNoticeCV8({ priority: 711, message: \"Expected compulsory content\", C, V, lineNumber, characterIndex: marker.length, location: ` after \\\\${marker} marker${lineLocation}` });\r\n        } else // it's not a recognised line marker\r\n            // Lower priority of deprecated \\s5 markers (compared to all other unknown markers)\r\n            addNoticeCV8({ priority: marker === 's5' ? 111 : 809, message: `${marker === 's5' ? 'Deprecated' : 'Unexpected'} '\\\\${marker}' marker at start of line`, C, V, lineNumber, characterIndex: 1, location: lineLocation });\r\n        if (rest) checkUSFMLineInternals(lineNumber, marker, rest, lineLocation);\r\n    }\r\n    // end of checkUSFMLineContents function\r\n\r\n\r\n    function mainUSFMCheck(bookID, filename, givenText, location) {\r\n        // console.log(\"Running mainUSFMCheck() (can take quite a while for a large book)\");\r\n\r\n        let ourLocation = location;\r\n        if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n\r\n        let lowercaseBookID = bookID.toLowerCase();\r\n        // eslint-disable-next-line no-unused-vars\r\n        let numChaptersThisBook = 0;\r\n        try {\r\n            numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n        }\r\n        catch {\r\n            if (!books.isValidBookID(bookID)) // must not be in FRT, BAK, etc.\r\n                addNoticeCV8({ priority: 903, message: \"Bad function call: should be given a valid book abbreviation\", extract: bookID, location: ` (not '${bookID}')${ourLocation}` });\r\n        }\r\n\r\n        function findStartMarker(C, V, lineNumber, USFMline) {\r\n            // Returns the USFM marker at the start of the line\r\n            //  (without the leading backslash but including full self-closing milestones)\r\n            console.assert(USFMline && USFMline[0] === '\\\\', `Programming error in findStartMarker(${C}:${V}, ${lineNumber}, ${USFMline})`);\r\n            let foundMarker = '';\r\n            for (let characterIndex = 1; characterIndex < USFMline.length; characterIndex++) {\r\n                const char = USFMline[characterIndex];\r\n                if (char === ' ') break;\r\n                // Cope with self-closing milestones like \\k-s\\*\r\n                if (char === '\\\\' && (characterIndex === USFMline.length - 1 || USFMline[characterIndex + 1] !== '*')) {\r\n                    const extract = USFMline.substring(0, extractLength) + (USFMline.length > extractLength ? '' : '');\r\n                    addNoticeCV8({ priority: 603, message: \"USFM marker doesn't end with space\", C, V, lineNumber, characterIndex, extract, location: ourLocation });\r\n                    break;\r\n                }\r\n                foundMarker += char;\r\n                if (char === '*') break;\r\n            }\r\n            return foundMarker;\r\n        }\r\n\r\n        let lines = givenText.split('\\n');\r\n        // console.log(`  '${ourLocation}' has ${lines.length.toLocaleString()} total lines`);\r\n\r\n        // let lastB = '';\r\n        let lastC = '', lastV = '', C = '0', V = '0';\r\n        let lastIntC = 0, lastIntV = 0;\r\n        // let numVersesThisChapter = 0;\r\n        let lastMarker = '', lastRest = '';\r\n        const markerSet = new Set();\r\n        for (let n = 1; n <= lines.length; n++) {\r\n            let line = lines[n - 1];\r\n            if (C === '0') V = n.toString();\r\n            // console.log(`line '${line}'${atString}`);\r\n            if (!line) {\r\n                // addNoticeCV8({priority:103, \"Unexpected blank line\", 0, '', location:ourLocation});\r\n                continue;\r\n            }\r\n            let characterIndex;\r\n            if ((characterIndex = line.indexOf('\\r')) >= 0) {\r\n                const iy = characterIndex + halfLength; // Want extract to focus more on what follows\r\n                const extract = (iy > halfLength ? '' : '') + line.substring(iy - halfLength, iy + halfLengthPlus).replace(/ /g, '') + (iy + halfLengthPlus < line.length ? '' : '')\r\n                addNoticeCV8({ priority: 703, C, V, message: \"Unexpected CarriageReturn character\", lineNumber: n, characterIndex, extract, location: ourLocation });\r\n            }\r\n\r\n            let marker, rest;\r\n            if (line[0] === '\\\\') {\r\n                marker = findStartMarker(C, V, n, line);\r\n                rest = line.substring(marker.length + 2); // Skip backslash, marker, and space after marker\r\n                // console.log(`Line ${n}: marker='${marker}' rest='${rest}'`);\r\n            } else { // Line didn't start with a backslash\r\n                // NOTE: Some unfoldingWord USFM Bibles commonly have this\r\n                //          so it's not necessarily either an error or a warning\r\n                rest = line;\r\n                if (`([`.indexOf(line[0]) < 0) { // These are the often expected characters\r\n                    // Drop the priority if it's a \"half-likely\" character\r\n                    addNoticeCV8({ priority: `\"`.indexOf(line[0]) < 0 ? 980 : 280, C, V, message: \"Expected line to start with backslash\", lineNumber: n, characterIndex: 0, extract: line[0], location: ourLocation });\r\n                    if (line[1] === '\\\\') { // Let's drop the leading punctuation and try to check the rest of the line\r\n                        marker = line.substring(2).split(' ', 1)[0];\r\n                        rest = line.substring(marker.length + 2 + 1); // Skip leading character, backslash, marker, and space after marker\r\n                        // console.log(`USFM after ${line[0]} got '${marker}': '${rest}'`);\r\n                    }\r\n                    else\r\n                        marker = 'rem'; // to try to avoid consequential errors, but the rest of the line won't be checked\r\n                } else { // How do we handle an allowed line that doesn't start with a backslash?\r\n                    // Can't use 'rem' because we want the rest of the line checked\r\n                    marker = 'SPECIAL1'; // Handle as a special case\r\n                }\r\n            }\r\n            markerSet.add(marker); // Keep track of all line markers\r\n\r\n            // Handle C/V numbers including verse bridges\r\n            let intC, intV, vIndex;\r\n            if (marker === 'c') {\r\n                C = rest; V = '0';\r\n                try {\r\n                    intC = ourParseInt(C);\r\n                } catch (usfmICerror) {\r\n                    addNoticeCV8({ priority: 724, C, V, message: \"Unable to convert chapter number to integer\", lineNumber: n, characterIndex: 3, extract: `${rest.substring(0, halfLength)}${rest.length > halfLength ? '' : ''}`, location: ourLocation });\r\n                    intC = -999; // Used to prevent consequential errors\r\n                }\r\n                if (C === lastC || (intC > 0 && intC !== lastIntC + 1))\r\n                    addNoticeCV8({ priority: 764, C, V, message: \"Chapter number didn't increment correctly\", lineNumber: n, characterIndex: 3, extract: `${rest.substring(0, halfLength)}${rest.length > halfLength ? '' : ''} (${lastC ? lastC : '0'}  ${C})`, location: ourLocation });\r\n                lastC = C; lastV = '0';\r\n                lastIntC = intC; lastIntV = 0;\r\n            } else if (marker === 'v') {\r\n                V = (rest) ? rest.split(' ', 1)[0] : '?';\r\n                if (V.indexOf('-') < 0) { // no hyphen -> no verse bridge\r\n                    try {\r\n                        intV = ourParseInt(V);\r\n                    } catch (usfmIVerror) {\r\n                        addNoticeCV8({ priority: 723, C, V, message: \"Unable to convert verse number to integer\", lineNumber: n, characterIndex: 3, extract: `${rest.substring(0, halfLength)}${rest.length > halfLength ? '' : ''}`, location: ourLocation });\r\n                        intV = -999; // Used to prevent consequential errors\r\n                    }\r\n                    if (V === lastV || (intV > 0 && intV !== lastIntV + 1))\r\n                        addNoticeCV8({ priority: 763, C, V, message: \"Verse number didn't increment correctly\", lineNumber: n, characterIndex: 3, extract: `${rest.substring(0, halfLength)}${rest.length > halfLength ? '' : ''} (${lastV ? lastV : '0'}  ${V})`, location: ourLocation });\r\n                    lastV = V; lastIntV = intV;\r\n                } else { // handle verse bridge\r\n                    const bits = V.split('-');\r\n                    const firstV = bits[0], secondV = bits[1];\r\n                    let intFirstV, intSecondV;\r\n                    try {\r\n                        intFirstV = ourParseInt(firstV);\r\n                        intSecondV = ourParseInt(secondV);\r\n                    } catch (usfmV12error) {\r\n                        addNoticeCV8({ priority: 762, C, V, message: \"Unable to convert verse bridge numbers to integers\", lineNumber: n, characterIndex: 3, extract: `${rest.substring(0, Math.max(9, extractLength))}${rest.length > extractLength ? '' : ''}`, location: ourLocation });\r\n                        intFirstV = -999; intSecondV = -998; // Used to prevent consequential errors\r\n                    }\r\n                    if (intSecondV <= intFirstV)\r\n                        addNoticeCV8({ priority: 769, C, V, message: \"Verse bridge numbers not in ascending order\", lineNumber: n, characterIndex: 3, extract: `${rest.substring(0, Math.max(9, extractLength))}${rest.length > extractLength ? '' : ''} (${firstV}  ${secondV})`, location: ourLocation });\r\n                    else if (firstV === lastV || (intFirstV > 0 && intFirstV !== lastIntV + 1))\r\n                        addNoticeCV8({ priority: 765, C, V, message: \"Bridged verse numbers didn't increment correctly\", lineNumber: n, characterIndex: 3, extract: `${rest.substring(0, Math.max(9, extractLength))}${rest.length > extractLength ? '' : ''} (${lastV}  ${firstV})`, location: ourLocation });\r\n                    lastV = secondV; lastIntV = intSecondV;\r\n                }\r\n            } else if ((vIndex = rest.indexOf('\\\\v ')) >= 0) {\r\n                // verse number marker follows another marker on the same line, so it's inside `rest`\r\n                const restRest = rest.substring(vIndex + 3);\r\n                // console.log(`Got restRest=${restRest}`);\r\n                try {\r\n                    intV = parseInt(restRest);\r\n                    // console.log(\"Got\", intV);\r\n                } catch (usfmIIVerror) {\r\n                    addNoticeCV8({ priority: 720, C, V, message: \"Unable to convert internal verse number to integer\", lineNumber: n, characterIndex: 3, extract: `${restRest.substring(0, halfLength)}${restRest.length > halfLength ? '' : ''}`, location: ourLocation });\r\n                    intV = -999; // Used to prevent consequential errors\r\n                }\r\n                if (intV > 0 && intV !== lastIntV + 1)\r\n                    addNoticeCV8({ priority: 761, C, V, message: \"Verse number didn't increment correctly\", lineNumber: n, characterIndex: 3, extract: `${restRest.substring(0, halfLength)}${restRest.length > halfLength ? '' : ''} (${lastV ? lastV : '0'}  ${V})`, location: ourLocation });\r\n                lastV = intV.toString(); lastIntV = intV;\r\n            }\r\n\r\n            if (marker === 'id' && !rest.startsWith(bookID)) {\r\n                const thisLength = Math.max(4, extractLength);\r\n                const extract = `${rest.substring(0, thisLength)}${rest.length > thisLength ? '' : ''}`;\r\n                addNoticeCV8({ priority: 987, C, V, message: \"Expected \\\\id line to start with book identifier\", lineNumber: n, characterIndex: 4, extract, location: ourLocation });\r\n            }\r\n            // Check the order of markers\r\n            // In headers\r\n            if (marker === 'toc2' && lastMarker !== 'toc1')\r\n                addNoticeCV8({ priority: 87, C, V, message: \"Expected \\\\toc2 line to follow \\\\toc1\", lineNumber: n, characterIndex: 1, extract: `(not '${lastMarker}')`, location: ourLocation });\r\n            else if (marker === 'toc3' && lastMarker !== 'toc2')\r\n                addNoticeCV8({ priority: 87, C, V, message: \"Expected \\\\toc3 line to follow \\\\toc2\", lineNumber: n, characterIndex: 1, extract: `(not '${lastMarker}')`, location: ourLocation });\r\n            // In chapters\r\n            else if ((PARAGRAPH_MARKERS.indexOf(marker) >= 0 || marker === 's5' || marker === 'ts\\\\*')\r\n                && PARAGRAPH_MARKERS.indexOf(lastMarker) >= 0\r\n                && !lastRest)\r\n                addNoticeCV8({ priority: 399, C, V, message: \"Useless paragraph marker\", lineNumber: n, characterIndex: 1, extract: `('${lastMarker}' before '${marker}')`, location: ourLocation });\r\n\r\n            // Do general checks\r\n            checkUSFMLineContents(n, C, V, marker, rest, ourLocation);\r\n\r\n            lastMarker = marker; lastRest = rest;\r\n        }\r\n\r\n        // Do overall global checks of the entire text\r\n        checkUSFMFileContents(filename, givenText, markerSet, ourLocation) // Do this last so the results are lower in the lists\r\n\r\n        addSuccessMessage(`Checked all ${lines.length.toLocaleString()} line${lines.length === 1 ? '' : 's'} for ${bookID}${ourLocation}`)\r\n    }\r\n\r\n    /* function runSlowTask(which) {\r\n        // Ideally these should be run in parallel using multiprocessing\r\n        //  See https://hackernoon.com/multithreading-multiprocessing-and-the-nodejs-event-loop-5b2929bd450b\r\n        console.log(`runSlowTask(${which})`)\r\n        return (which === 1)\r\n            ? mainUSFMCheck(bookID, filename, givenText, location)\r\n            : runBCSGrammarCheck(filename, givenText, location);\r\n    }\r\n    // Main code for checkUSFMText()\r\n    console.log(\"Starting USFM checking tasks\");\r\n    const tasks = [1,2].map(runSlowTask);\r\n    const allResults = await Promise.all(tasks);\r\n    console.log(`  Finished all tasks with ${JSON.stringify(allResults)}.`);\r\n    console.log(\"  Finished all tasks.\");\r\n    if (!allResults[1].isValidUSFM)\r\n        addNoticeCV8({priority:942, \"USFM Grammar check fails\", location});\r\n    console.log(\"  Warnings:\", JSON.stringify(allResults[1].warnings));\r\n    // Display these warnings but with a lower priority\r\n    for (const warningString of allResults[1].warnings)\r\n        addNoticeCV8({priority:103, `USFMGrammar: ${warningString.trim()}`, location});\r\n    */\r\n\r\n    // NOTE: If we're careful about how/when we add their notices to our global list,\r\n    //  we should be able to run these three slowish checks in parallel on different threads/processes\r\n    let allResults = [];\r\n    allResults.push(mainUSFMCheck(bookID, filename, givenText, ourLocation));\r\n    allResults.push(CVCheck(bookID, givenText, ourLocation));\r\n    if (!books.isExtraBookID(bookID))\r\n        allResults.push(ourRunBCSGrammarCheck(filename, givenText, ourLocation));\r\n    // console.assert(allResults.length === 2);\r\n    // console.log(\"allResults\", JSON.stringify(allResults));\r\n    // if (!allResults[1].isValidUSFM)\r\n    //     addNoticeCV8({priority:941, \"USFM Grammar check fails\", location});\r\n    // console.log(\"  Warnings:\", JSON.stringify(allResults[1].warnings));\r\n    // // Display these warnings but with a lower priority\r\n    // for (const warningString of allResults[1].warnings)\r\n    // addNoticeCV8({priority:103, `USFMGrammar: ${warningString.trim()}`, location});\r\n\r\n    // console.log(`  checkUSFMText returning with ${result.successList.length.toLocaleString()} success(es) and ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(`checkUSFMText result is ${JSON.stringify(result)}`);\r\n    return result;\r\n}\r\n// end of checkUSFMText function\r\n\r\n\r\n//export default checkUSFMText;\r\n","// import { isWhitespace, countOccurrences } from './text-handling-functions'\r\nimport yaml from 'yaml';\r\nimport {checkTextField} from './field-text-check';\r\n\r\n\r\nconst YAML_VALIDATOR_VERSION_STRING = '0.1.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport function checkYAMLText(textName, YAMLText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all lines.\r\n\r\n     Returns a result object containing a successList and a noticeList,\r\n        as well as the parsed YAML for further checking.\r\n\r\n     */\r\n    // console.log(`checkYAMLText(${textName}, ${YAMLText.length}, ${givenLocation})`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (textName) ourLocation = ` in ${textName}${ourLocation}`;\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (ytcError) {}\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    // const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    // const halfLengthPlus = Math.floor((extractLength+1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const cytResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkYAMLText success: ${successString}`);\r\n        cytResult.successList.push(successString);\r\n    }\r\n    function addNotice6(noticeObject) {\r\n        // console.log(`checkYAMLText Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(noticeObject.priority!==undefined, \"cYt addNotice6: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority==='number', `cManT addNotice6: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message!==undefined, \"cYt addNotice6: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message==='string', `cManT addNotice6: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(characterIndex!==undefined, \"cYt addNotice6: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex==='number', `cManT addNotice6: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract!==undefined, \"cYt addNotice6: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract==='string', `cManT addNotice6: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location!==undefined, \"cYt addNotice6: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location==='string', `cYt addNotice6: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        cytResult.noticeList.push(noticeObject);\r\n    }\r\n\r\n    function ourCheckTextField(fieldName, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions) {\r\n        /**\r\n        * @description - checks the given text field and processes the returned results\r\n        * @param {String} fieldName - name of the field being checked\r\n        * @param {String} fieldText - the actual text of the field being checked\r\n        * @param {boolean} allowedLinks - true if links are allowed in the field, otherwise false\r\n        * @param {String} optionalFieldLocation - description of where the field is located\r\n        * @param {Object} optionalCheckingOptions - parameters that might affect the check\r\n        */\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        // console.log(`cYt ourCheckTextField(${fieldName}, (${fieldText.length}), ${allowedLinks}, ${fieldLocation}, )`);\r\n        console.assert(fieldName!==undefined, \"cYt ourCheckTextField: 'fieldName' parameter should be defined\");\r\n        console.assert(typeof fieldName==='string', `cYt ourCheckTextField: 'fieldName' parameter should be a string not a '${typeof fieldName}'`);\r\n        console.assert(fieldText!==undefined, \"cYt ourCheckTextField: 'fieldText' parameter should be defined\");\r\n        console.assert(typeof fieldText==='string', `cYt ourCheckTextField: 'fieldText' parameter should be a string not a '${typeof fieldText}'`);\r\n        console.assert( allowedLinks===true || allowedLinks===false, \"cYt ourCheckTextField: allowedLinks parameter must be either true or false\");\r\n\r\n        const resultObject = checkTextField(fieldName, fieldText, allowedLinks, optionalFieldLocation, optionalCheckingOptions);\r\n\r\n        // Process results line by line\r\n        //  suppressing undesired errors\r\n        for (const noticeEntry of resultObject.noticeList) {\r\n            // console.assert(Object.keys(noticeEntry).length === 5, `YAML ourCheckTextField notice length=${Object.keys(noticeEntry).length}`);\r\n            if (noticeEntry.priority !== 191 // \"Unexpected XXX character after space\"\r\n              && noticeEntry.message !== \"Unexpected ' character after space\"\r\n            //   && noticeEntry.message !== \"Unexpected space after ' character\"\r\n              && noticeEntry.message !== \"Unexpected space after [ character\"\r\n              && (noticeEntry.message !== \"Unexpected doubled - characters\" || fieldText === '---')\r\n              )\r\n                addNotice6(noticeEntry);\r\n    }\r\n}\r\n    // end of ourCheckTextField function\r\n\r\n    function checkYAMLLineContents(lineName, lineText, lineLocation) {\r\n\r\n        // console.log(`checkYAMLLineContents for '${lineName} ${lineText}' at${lineLocation}`);\r\n        let thisText = lineText\r\n\r\n        // Remove leading spaces\r\n        thisText = thisText.replace(/^ +/g,'')\r\n        // console.log(`After removing leading spaces have '${thisText}'`);\r\n\r\n        // Remove leading hyphens\r\n        thisText = thisText.replace(/^-/g,'')\r\n        // console.log(`After removing hyphens have '${thisText}'`);\r\n\r\n        // Remove leading spaces again now\r\n        thisText = thisText.replace(/^ +/g,'')\r\n        // console.log(`After removing more leading spaces have '${thisText}'`);\r\n\r\n        const allowedLinksInLine = thisText.startsWith('url:') || thisText.startsWith('chapter_url:');\r\n        if (thisText)\r\n            ourCheckTextField(lineName, thisText, allowedLinksInLine, lineLocation, optionalCheckingOptions);\r\n    }\r\n    // end of checkYAMLLine function\r\n\r\n\r\n    // Main code for checkYAMLText function\r\n    const lines = YAMLText.split('\\n');\r\n    // console.log(`  '${location}' has ${lines.length.toLocaleString()} total lines`);\r\n    let formData;\r\n    try {\r\n        formData = yaml.parse(YAMLText);\r\n        // console.log(\"yaml.parse(YAMLText) got formData\", JSON.stringify(formData));\r\n    }\r\n    catch(yamlError) {\r\n        // console.log(`ERROR: yaml parse error: ${yamlError.message}`);\r\n        addNotice6({priority:920, message:yamlError.message, location:ourLocation})\r\n    }\r\n    // Add the parsed YAML to our result\r\n    cytResult.formData = formData;\r\n\r\n    // let lastNumLeadingSpaces = 0;\r\n    // let lastLineContents;\r\n    for (let n= 1; n <= lines.length; n++) {\r\n\r\n        const line = lines[n - 1];\r\n        // let numLeadingSpaces;\r\n        // if (line) {\r\n        //     numLeadingSpaces = line.match(/^ */)[0].length;\r\n            // console.log(`Got numLeadingSpaces=${numLeadingSpaces} for ${line}${atString}`);\r\n        //     if (numLeadingSpaces && lastNumLeadingSpaces && numLeadingSpaces!=lastNumLeadingSpaces)\r\n        //         addNotice6({472, \"Nesting seems confused\", 0, '', atString);\r\n\r\n            checkYAMLLineContents(`line ${n.toLocaleString()}`, line, ourLocation);\r\n        // } else {\r\n        //     // This is a blank line\r\n        //     numLeadingSpaces = 0;\r\n        // }\r\n\r\n        // lastLineContents = line;\r\n        // lastNumLeadingSpaces = numLeadingSpaces;\r\n    }\r\n\r\n    addSuccessMessage(`Checked all ${lines.length.toLocaleString()} line${lines.length===1?'':'s'}${ourLocation}.`);\r\n    if (cytResult.noticeList)\r\n        addSuccessMessage(`checkYAMLText v${YAML_VALIDATOR_VERSION_STRING} finished with ${cytResult.noticeList.length?cytResult.noticeList.length.toLocaleString():\"zero\"} notice${cytResult.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by checkYAMLText v${YAML_VALIDATOR_VERSION_STRING}`)\r\n    // console.log(`  checkYAMLText returning with ${cytResult.successList.length.toLocaleString()} success(es), ${cytResult.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkYAMLText result is\", JSON.stringify(result));\r\n    return cytResult;\r\n}\r\n// end of checkYAMLText function\r\n\r\n\r\n//export default checkYAMLText;\r\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 404;","export * from './file-check';\r\nexport * from './book-package-check';\r\nexport * from './book-packages-check';\r\nexport * from './repo-check';\r\nexport * from './notice-processing-functions';\r\nexport * from './RenderProcessedResults';","export {default as FileCheck} from './FileCheck';\r\n\r\n","import React, { useEffect, useState } from 'react';\r\n// import PropTypes from 'prop-types';\r\n// import ReactJson from 'react-json-view';\r\n// import { Paper, Button } from '@material-ui/core';\r\n// import { RepositoryContext, FileContext } from 'gitea-react-toolkit';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport { getFileCached, checkFileContents } from '../../core';\r\nimport { processNoticesToErrorsWarnings, processNoticesToSevereMediumLow, processNoticesToSingleList } from '../notice-processing-functions';\r\nimport { RenderSuccessesErrorsWarnings, RenderSuccessesSevereMediumLow, RenderSuccessesWarningsGradient, RenderElapsedTime } from '../RenderProcessedResults';\r\nimport { ourParseInt } from '../../core/utilities';\r\n// import { consoleLogObject } from '../../core/utilities';\r\n\r\n\r\n// const FILE_CHECK_VERSION_STRING = '0.1.3';\r\n\r\n\r\nfunction FileCheck(props) {\r\n    // console.log(`I'm here in FileCheck v${FILE_CHECK_VERSION_STRING}`);\r\n    // consoleLogObject(\"props\", props);\r\n\r\n    const [result, setResultValue] = useState(\"Waiting-FileCheck\");\r\n    useEffect(() => {\r\n      // console.log(\"FileCheck.useEffect() called with \", JSON.stringify(props));\r\n\r\n      // Use an IIFE (Immediately Invoked Function Expression)\r\n      //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174\r\n      (async () => {\r\n        // console.log(\"Started FileCheck.unnamedFunction()\");\r\n\r\n        // Display our \"waiting\" message\r\n        setResultValue(<p style={{ color: 'magenta' }}>Checking <b>{filename}</b></p>);\r\n        // console.log(`About to call getFileCached(${username}, ${repoName}, ${filename}, ${branch})`);\r\n        const fileContent = await getFileCached({ username: username, repository: repoName, path: filename, branch: branch });\r\n        let rawCFResults = { noticeList:[{priority:990, message:\"Unable to load file\", filename}], elapsedSeconds:0 };\r\n        if (fileContent) {\r\n          const languageCode = repoName.split('_')[0];\r\n          rawCFResults = await checkFileContents(languageCode, filename, fileContent, givenLocation, checkingOptions);\r\n        }\r\n        // console.log(`FileCheck got initial results with ${rawCFResults.successList.length} success message(s) and ${rawCFResults.noticeList.length} notice(s)`);\r\n\r\n        // Since we know the repoName here, add it to our notices\r\n        for (const thisNotice of rawCFResults.noticeList)\r\n          thisNotice.repoName = repoName; // Add in this info that we know\r\n\r\n        // Add some extra fields to our rawCFResults object in case we need this information again later\r\n        rawCFResults.checkType = 'File';\r\n        rawCFResults.username = username;\r\n        rawCFResults.repoName = repoName;\r\n        rawCFResults.branch = props.branch;\r\n        rawCFResults.filename = filename;\r\n        rawCFResults.checkingOptions = checkingOptions;\r\n\r\n        // Now do our final handling of the result\r\n        let processOptions = { // Uncomment any of these to test them\r\n          // 'maximumSimilarMessages': 4, // default is 3  -- 0 means don't suppress\r\n          // 'errorPriorityLevel': 800, // default is 700\r\n          // 'cutoffPriorityLevel': 100, // default is 0\r\n          // 'sortBy': 'ByPriority', // default is 'AsFound'\r\n          // 'ignorePriorityNumberList': [123, 202], // default is []\r\n        };\r\n        // Or this allows the parameters to be specified as a FileCheck property\r\n        if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = ourParseInt(props.maximumSimilarMessages);\r\n        if (props.errorPriorityLevel) processOptions.errorPriorityLevel = ourParseInt(props.errorPriorityLevel);\r\n        if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);\r\n        if (props.sortBy) processOptions.sortBy = props.sortBy;\r\n        // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;\r\n\r\n        let displayType = 'ErrorsWarnings'; // default\r\n        if (props.displayType) displayType = props.displayType;\r\n\r\n        function renderSummary(processedResults) {\r\n          return (<div>\r\n            <p>Checked <b>{filename}</b> (from {username} {repoName} <i>{branch === undefined ? 'DEFAULT' : branch}</i> branch)</p>\r\n            <p>&nbsp;&nbsp;&nbsp;&nbsp;Finished in <RenderElapsedTime elapsedSeconds={processedResults.elapsedSeconds} /> with {rawCFResults.noticeList.length===0?'no':rawCFResults.noticeList.length} notice{rawCFResults.noticeList.length===1?'':'s'}.</p>\r\n            {/* <RenderRawResults results={rawCFResults} /> */}\r\n          </div>);\r\n        }\r\n\r\n        if (displayType === 'ErrorsWarnings') {\r\n          const processedResults = processNoticesToErrorsWarnings(rawCFResults, processOptions);\r\n  //                 console.log(`${`FileCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)`}\r\n  //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n          if (processedResults.errorList.length || processedResults.warningList.length)\r\n            setResultValue(<>\r\n              <div>{renderSummary(processedResults)}\r\n                {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n              <RenderSuccessesErrorsWarnings results={processedResults} />\r\n            </>);\r\n          else // no errors or warnings\r\n            setResultValue(<>\r\n              <div>{renderSummary(processedResults)}\r\n                {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n              <RenderSuccessesErrorsWarnings results={processedResults} />\r\n            </>);\r\n        } else if (displayType === 'SevereMediumLow') {\r\n          const processedResults = processNoticesToSevereMediumLow(rawCFResults, processOptions);\r\n  //                 console.log(`FileCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n  //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n          if (processedResults.severeList.length || processedResults.mediumList.length || processedResults.lowList.length)\r\n            setResultValue(<>\r\n              <div>{renderSummary(processedResults)}\r\n                {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n              <RenderSuccessesSevereMediumLow results={processedResults} />\r\n            </>);\r\n          else // no severe, medium, or low notices\r\n            setResultValue(<>\r\n              <div>{renderSummary(processedResults)}\r\n                {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n              <RenderSuccessesSevereMediumLow results={processedResults} />\r\n            </>);\r\n        } else if (displayType === 'SingleList') {\r\n          const processedResults = processNoticesToSingleList(rawCFResults, processOptions);\r\n  //                 console.log(`FileCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n  //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n          if (processedResults.warningList.length)\r\n            setResultValue(<>\r\n              <div>{renderSummary(processedResults)}\r\n                {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n              <RenderSuccessesWarningsGradient results={processedResults} />\r\n            </>);\r\n          else // no warnings\r\n            setResultValue(<>\r\n              <div>{renderSummary(processedResults)}\r\n                {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n              <RenderSuccessesWarningsGradient results={processedResults} />\r\n            </>);\r\n        } else setResultValue(<b style={{ color: 'red' }}>Invalid displayType='{displayType}'</b>)\r\n      })(); // end of async part in unnamedFunction\r\n      // Doesn't work if we add this to next line: username,repoName,branch,checkingOptions,filename,givenLocation,props\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []); // end of useEffect part\r\n\r\n    const username = props.username;\r\n    // console.log(`FileCheck username='${username}'`);\r\n    if (!username) return <><b>ERROR</b>: The Door43 username must be specified</>;\r\n    const repoName = props.repoName;\r\n    // console.log(`FileCheck repoName='${repoName}'`);\r\n    if (!repoName) return <><b>ERROR</b>: The Door43 repository name must be specified</>;\r\n    let branch = props.branch;\r\n    // console.log(`FileCheck branch='${branch}'`);\r\n    if (branch === undefined) branch = 'master';\r\n    const filename = props.filename;\r\n    // console.log(`filename='${filename}'`);\r\n    if (!filename) return <><b>ERROR</b>: The Door43 filename must be specified</>;\r\n\r\n    let givenLocation = props['location'] ? props['location'] : \"\";\r\n    if (givenLocation && givenLocation[0] !== ' ') givenLocation = ` ${givenLocation}`;\r\n\r\n    const checkingOptions = { // Uncomment any of these to test them\r\n        // 'extractLength': 25,\r\n    };\r\n    // Or this allows the parameters to be specified as a FileCheck property\r\n    if (props.extractLength) checkingOptions.extractLength = ourParseInt(props.extractLength);\r\n\r\n    // {/* <div className={classes.root}> */}\r\n    return (\r\n        <div className=\"Fred\">\r\n            {result}\r\n        </div>\r\n    );\r\n};\r\n// end of FileCheck()\r\n\r\nconst styles = theme => ({\r\n    root: {\r\n    },\r\n});\r\n\r\nexport default withStyles(styles)(FileCheck);\r\n","import * as books from './books/books';\r\nimport {checkAnnotationTSVDataRow} from './annotation-row-check';\r\n\r\n\r\nconst ANNOTATION_TABLE_VALIDATOR_VERSION_STRING = '0.2.3';\r\n\r\nconst NUM_EXPECTED_ANNOTATION_TSV_FIELDS = 7; // so expects 6 tabs per line\r\nconst EXPECTED_TN_HEADING_LINE = 'Reference\\tID\\tTags\\tSupportReference\\tQuote\\tOccurrence\\tAnnotation';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport async function CheckAnnotationRows(languageCode, annotationType, bookID, filename, tableText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all rows.\r\n\r\n      It also has the advantage of being able to compare one row with the previous one.\r\n\r\n     bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`CheckAnnotationRows(${languageCode}, ${annotationType}, ${bookID}, ${tableText.length}, ${givenLocation},${JSON.stringify(optionalCheckingOptions)})`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    // if (bookID) ourLocation = ` in ${bookID}${ourLocation}`;\r\n\r\n    const result = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`CheckAnnotationRows success: ${successString}`);\r\n        result.successList.push(successString);\r\n    }\r\n    function addNoticeCV8(noticeObject) {\r\n        // console.log(`CheckAnnotationRows notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"ATSV addNoticeCV8: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `ATSV addNoticeCV8: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"ATSV addNoticeCV8: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `ATSV addNoticeCV8: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(C !== undefined, \"ATSV addNoticeCV8: 'C' parameter should be defined\");\r\n        if (noticeObject.C) console.assert(typeof noticeObject.C === 'string', `ATSV addNoticeCV8: 'C' parameter should be a string not a '${typeof noticeObject.C}': ${noticeObject.C}`);\r\n        // console.assert(V !== undefined, \"ATSV addNoticeCV8: 'V' parameter should be defined\");\r\n        if (noticeObject.V) console.assert(typeof noticeObject.V === 'string', `ATSV addNoticeCV8: 'V' parameter should be a string not a '${typeof noticeObject.V}': ${noticeObject.V}`);\r\n        // console.assert(characterIndex !== undefined, \"ATSV addNoticeCV8: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `ATSV addNoticeCV8: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"ATSV addNoticeCV8: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `ATSV addNoticeCV8: 'extract' parameter should be a string not a '${typeof noticeObject.extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"ATSV addNoticeCV8: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `ATSV addNoticeCV8: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        result.noticeList.push({ ...noticeObject, bookID, filename });\r\n    }\r\n\r\n\r\n    addNoticeCV8({ priority: 997, message: \"CheckAnnotationRows() is still a placeholder -- not completed yet\", location: ourLocation });\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (ttcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    // const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    // const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    let lowercaseBookID = bookID.toLowerCase();\r\n    let numChaptersThisBook = 0;\r\n    try {\r\n        numChaptersThisBook = books.chaptersInBook(lowercaseBookID).length;\r\n    }\r\n    catch {\r\n        if (!books.isValidBookID(bookID)) // must not be in FRT, BAK, etc.\r\n            addNoticeCV8({ priority: 747, message: \"Bad function call: should be given a valid book abbreviation\", extract: bookID, location: ` (not '${bookID}')${ourLocation}` });\r\n    }\r\n\r\n    let lines = tableText.split('\\n');\r\n    // console.log(`  '${location}' has ${lines.length.toLocaleString()} total lines (expecting ${NUM_EXPECTED_TN_FIELDS} fields in each line)`);\r\n\r\n    let lastC = '', lastV = '';\r\n    let rowID_list = [];\r\n    let numVersesThisChapter = 0;\r\n    for (let n = 0; n < lines.length; n++) {\r\n        // console.log(`CheckAnnotationRows checking line ${n}: ${JSON.stringify(lines[n])}`);\r\n        if (n === 0) {\r\n            if (lines[0] === EXPECTED_TN_HEADING_LINE)\r\n                addSuccessMessage(`Checked TSV header ${ourLocation}`);\r\n            else\r\n                addNoticeCV8({ priority: 746, message: \"Bad TSV header\", lineNumber: n + 1, location: `${ourLocation}: '${lines[0]}'` });\r\n        }\r\n        else // not the header\r\n        {\r\n            let fields = lines[n].split('\\t');\r\n            if (fields.length === NUM_EXPECTED_ANNOTATION_TSV_FIELDS) {\r\n                // eslint-disable-next-line no-unused-vars\r\n                const [reference, rowID, tags, _support_reference, _quote, _occurrence, _annotation] = fields;\r\n                const [C, V] = reference.split(':')\r\n\r\n                // Use the row check to do most basic checks\r\n                const firstResult = await checkAnnotationTSVDataRow(languageCode, annotationType, lines[n], bookID, C, V, ourLocation, optionalCheckingOptions);\r\n                // Choose only ONE of the following\r\n                // This is the fast way of append the results from this field\r\n                // result.noticeList = result.noticeList.concat(firstResult.noticeList);\r\n                // If we need to put everything through addNoticeCV8, e.g., for debugging or filtering\r\n                //  process results line by line\r\n                for (const noticeEntry of firstResult.noticeList)\r\n                    addNoticeCV8({ ...noticeEntry, lineNumber: n + 1 });\r\n\r\n                // So here we only have to check against the previous and next fields for out-of-order problems\r\n                if (C) {\r\n                    if (C === 'front') { }\r\n                    else if (/^\\d+$/.test(C)) {\r\n                        let intC = Number(C);\r\n                        if (C !== lastC)\r\n                            numVersesThisChapter = books.versesInChapter(lowercaseBookID, intC);\r\n                        if (intC === 0)\r\n                            addNoticeCV8({ priority: 551, C, V, message: `Invalid zero '${C}' chapter number`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                        if (intC > numChaptersThisBook)\r\n                            addNoticeCV8({ priority: 737, C, V, message: `Invalid large '${C}' chapter number`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                        if (/^\\d+$/.test(lastC)) {\r\n                            let lastintC = Number(lastC);\r\n                            if (intC < lastintC)\r\n                                addNoticeCV8({ priority: 736, C, V, message: `Receding '${C}' chapter number after '${lastC}'`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                            else if (intC > lastintC + 1)\r\n                                addNoticeCV8({ priority: 735, C, V, message: `Advancing '${C}' chapter number after '${lastC}'`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                        }\r\n                    }\r\n                    else\r\n                        addNoticeCV8({ priority: 734, C, V, message: \"Bad chapter number\", rowID, lineNumber: n + 1, location: ourLocation });\r\n                }\r\n                else\r\n                    addNoticeCV8({ priority: 739, C, V, message: \"Missing chapter number\", rowID, lineNumber: n + 1, location: ` after ${lastC}:${V}${ourLocation}` });\r\n\r\n                if (V) {\r\n                    if (V === 'intro') { }\r\n                    else if (/^\\d+$/.test(V)) {\r\n                        let intV = Number(V);\r\n                        if (intV === 0)\r\n                            addNoticeCV8({ priority: 552, C, V, message: `Invalid zero '${V}' verse number`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                        if (intV > numVersesThisChapter)\r\n                            addNoticeCV8({ priority: 734, C, V, message: `Invalid large '${V}' verse number for chapter ${C}`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                        if (/^\\d+$/.test(lastV)) {\r\n                            let lastintV = Number(lastV);\r\n                            if (intV < lastintV)\r\n                                addNoticeCV8({ priority: 733, C, V, message: `Receding '${V}' verse number after '${lastV}'`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                            // else if (intV > lastintV + 1)\r\n                            //   addNoticeCV8({priority:556, `Skipped verses with '${V}' verse number after '${lastV}'${withString}`);\r\n                        }\r\n                    }\r\n                    else\r\n                        addNoticeCV8({ priority: 738, C, V, message: \"Bad verse number\", rowID, lineNumber: n + 1, location: ourLocation });\r\n\r\n                }\r\n                else\r\n                    addNoticeCV8({ priority: 790, C, V, message: \"Missing verse number\", rowID, lineNumber: n + 1, location: ` after ${C}:${lastV}${ourLocation}` });\r\n\r\n                if (rowID) {\r\n                    if (rowID_list.indexOf(rowID) >= 0)\r\n                        addNoticeCV8({ priority: 729, C, V, message: `Duplicate '${rowID}' ID`, rowID, lineNumber: n + 1, location: ourLocation });\r\n                } else\r\n                    addNoticeCV8({ priority: 730, C, V, message: \"Missing ID\", lineNumber: n + 1, location: ourLocation });\r\n\r\n\r\n                if (C !== lastC || V !== lastV) {\r\n                    rowID_list = []; // ID's only need to be unique within each verse\r\n                    lastC = C; lastV = V;\r\n                }\r\n\r\n            } else\r\n                // if (n === lines.length - 1) // it's the last line\r\n                //     console.log(`  Line ${n}: Has ${fields.length} field(s) instead of ${NUM_EXPECTED_TN_FIELDS}: ${EXPECTED_TN_HEADING_LINE.replace(/\\t/g, ', ')}`);\r\n                // else\r\n                if (n !== lines.length - 1) // it's not the last line\r\n                    addNoticeCV8({ priority: 988, message: `Wrong number of tabbed fields (expected ${NUM_EXPECTED_ANNOTATION_TSV_FIELDS})`, extract: `Found ${fields.length} field${fields.length === 1 ? '' : 's'}`, lineNumber: n + 1, location: ourLocation });\r\n        }\r\n    }\r\n    addSuccessMessage(`Checked all ${(lines.length - 1).toLocaleString()} data line${lines.length - 1 === 1 ? '' : 's'}${ourLocation}.`);\r\n    if (result.noticeList)\r\n        addSuccessMessage(`CheckAnnotationRows v${ANNOTATION_TABLE_VALIDATOR_VERSION_STRING} finished with ${result.noticeList.length ? result.noticeList.length.toLocaleString() : \"zero\"} notice${result.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by CheckAnnotationRows v${ANNOTATION_TABLE_VALIDATOR_VERSION_STRING}`)\r\n    // console.log(`  CheckAnnotationRows returning with ${result.successList.length.toLocaleString()} success(es), ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"CheckAnnotationRows result is\", JSON.stringify(result));\r\n    return result;\r\n}\r\n// end of CheckAnnotationRows function\r\n\r\n\r\n//export default CheckAnnotationRows;\r\n","import { toJSON } from 'usfm-js';\r\n\r\n\r\nexport function runUsfmJsCheck(fileText, convertOptions) {\r\n    // Runs the USFM-JS converter as a check\r\n    //  which can be quite time-consuming on large, complex USFM files\r\n    // console.log(\"Running USFM-JS converter check (can take quite a while for a large book)\");\r\n\r\n    const jsonResult = toJSON(fileText, convertOptions);\r\n    const jsonKeys = Object.keys(jsonResult); // Expect 'headers', 'chapters'\r\n    const numJSONkeys = jsonKeys.length;\r\n    // console.log(`  Finished USFM-JS converter check with ${numJSONkeys} json key(s)`);\r\n    // console.log(`  jsonResult: ${JSON.stringify(jsonResult)}`)\r\n    // NOTE: We don't know how to get the errors out yet\r\n\r\n    return { isValidUSFM: numJSONkeys >= 2, returnedJSON:jsonResult }; // Expect 'headers', 'chapters'\r\n}\r\n// end of runUsfmJsCheck function\r\n\r\n\r\nexport function checkUSFMToJSON(bookID, filename, givenText, givenLocation, optionalCheckingOptions) {\r\n    /*\r\n    This function is only used for the demonstration pages -- not for the core!\r\n\r\n    bookID is a three-character UPPERCASE USFM book identifier.\r\n\r\n        filename parameter can be an empty string if we don't have one.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    // console.log(`checkUSFMToJSON(${givenText.length.toLocaleString()} chars, '${givenLocation}')`);\r\n\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (filename) ourLocation = ` in ${filename}${ourLocation}`;\r\n\r\n\r\n    const result = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkUSFMToJSON success: ${successString}`);\r\n        result.successList.push(successString);\r\n    }\r\n    function addNotice6to7({priority, message, lineNumber, characterIndex, extract, location}) {\r\n        /**\r\n        * @description - adds a new notice entry, adding bookID,C,V to the given fields\r\n        * @param {Number} priority - notice priority from 1 (lowest) to 999 (highest)\r\n        * @param {String} message - the text of the notice message\r\n        * @param {Number} characterIndex - where the issue occurs in the line\r\n        * @param {String} extract - short extract from the line centred on the problem (if available)\r\n        * @param {String} location - description of where the issue is located\r\n        */\r\n        // console.log(`checkUSFMToJSON notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cUSFMjs addNotice6to7: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cUSFMjs addNotice6to7: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cUSFMjs addNotice6to7: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cUSFMjs addNotice6to7: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        // console.assert(characterIndex !== undefined, \"cUSFMjs addNotice6to7: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cUSFMjs addNotice6to7: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cUSFMjs addNotice6to7: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cUSFMjs addNotice6to7: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cUSFMjs addNotice6to7: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cUSFMjs addNotice6to7: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        result.noticeList.push({priority,message, bookID, lineNumber, characterIndex, extract, location});\r\n    }\r\n\r\n\r\n    // Set your options here -- change values or comment out lines\r\n    const convertOptions = {\r\n        'chunk': true,\r\n        'content-source': ourLocation,\r\n        'convertToInt': []\r\n        };\r\n    const convertCheckResult = runUsfmJsCheck(givenText, ourLocation, convertOptions);\r\n    // NOTE: We haven't figured out how to get ERRORS out of this parser yet\r\n\r\n    if (!convertCheckResult.isValidUSFM)\r\n        addNotice6to7({priority:943, message:`USFM3 toJSON Check doesn't pass`, location:ourLocation});\r\n\r\n    addSuccessMessage(`Checked USFM-JS`);\r\n    // console.log(`  checkUSFMToJSON returning with ${result.successList.length.toLocaleString()} success(es) and ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(`checkUSFMToJSON result is ${JSON.stringify(result)}`);\r\n    return result;\r\n}\r\n// end of checkUSFMToJSON function\r\n\r\n\r\n//export default checkUSFMToJSON;\r\n","import grammar from 'usfm-grammar';\r\nimport * as books from '../core/books/books';\r\n\r\n\r\n// const USFM_GRAMMAR_VALIDATOR_VERSION_STRING = '0.3.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport function runBCSGrammarCheck(strictnessString, fileText, filename, givenLocation, optionalCheckingOptions) {\r\n    // Runs the BCS USFM Grammar checker\r\n    //  which can be quite time-consuming on large, complex USFM files\r\n    // console.log(`Running ${strictnessString} BCS USFM grammar check${givenLocation} (can take quite a while for a large book)`);\r\n    console.assert(strictnessString === 'strict' || strictnessString === 'relaxed', `Unexpected strictnessString='${strictnessString}'`);\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (usfmELerror) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n    // console.log(`Using supplied extractLength=${extractLength} cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    // Now create the parser and run the check\r\n    const ourUsfmParser = new grammar.USFMParser(fileText,\r\n        strictnessString === 'relaxed' ? grammar.LEVEL.RELAXED : null);\r\n    // Returns a Boolean indicating whether the input USFM text satisfies the grammar or not.\r\n    // This method is available in both default and relaxed modes.\r\n    // const parserResult = ourUsfmParser.validate();\r\n    const parserResult = ourUsfmParser.toJSON()\r\n    let parserMessages;\r\n    parserMessages = parserResult._messages; // Throw away the JSON (if any)\r\n    // console.log(`  Finished BCS USFM grammar check with messages: ${JSON.stringify(parserResult)}\\n and warnings: ${JSON.stringify(ourUsfmParser.warnings)}.`);\r\n    let parseError;\r\n    parseError = parserMessages._error;\r\n    // console.log(`  parseError: ${parseError}`);\r\n    let ourErrorMessage, lineNumberString, characterIndex, extract;\r\n    // NOTE: The following code is quite fragile\r\n    //  as it depends on the precise format of the error message return from USFMParser\r\n    let ourErrorObject = {};\r\n    if (parseError) {\r\n        const contextRE = /(\\d+?)\\s\\|\\s(.+)/g;\r\n        for (const errorLine of parseError.split('\\n')) {\r\n            // console.log(`BCS errorLine=${errorLine}`);\r\n            if (errorLine.startsWith('>')) {\r\n                const regexResult = contextRE.exec(errorLine.substring(1).trim());\r\n                // console.log(`  regexResult: ${JSON.stringify(regexResult)}`);\r\n                if (regexResult) {\r\n                    lineNumberString = regexResult[1];\r\n                    extract = regexResult[2];\r\n                }\r\n            }\r\n            else if (errorLine.endsWith('^')) {\r\n                characterIndex = errorLine.indexOf('^') - 8;\r\n                if (characterIndex < 0) characterIndex = 0; // Just in case\r\n                if (extract.length)\r\n                    extract = (characterIndex > halfLength ? '' : '') + extract.substring(characterIndex - halfLength, characterIndex + halfLengthPlus) + (characterIndex + halfLengthPlus < extract.length ? '' : '')\r\n            }\r\n            else ourErrorMessage = errorLine; // We only want the last one\r\n        }\r\n        // console.log(`  ourErrorMessage: '${ourErrorMessage}' lineNumberString=${lineNumberString} characterIndex=${characterIndex} extract='${extract}'`);\r\n\r\n        // Some of these \"errors\" need to be degraded in priority\r\n\r\n        let adjustedPriority = 994;\r\n        if (extract==='\\\\s5' // Temporarily, even though \\s5 fields are not valid USFM\r\n        || ourErrorMessage.startsWith('Expected \"f*\", \"+\"') // Might neeed a OHM schema fix?\r\n        )\r\n            adjustedPriority = 294;\r\n\r\n        ourErrorObject = {priority:adjustedPriority, message:`USFMGrammar: ${ourErrorMessage}`,\r\n                            filename,\r\n                            characterIndex, extract,\r\n                            location:givenLocation};\r\n\r\n        // Save our line number\r\n        if (lineNumberString && lineNumberString.length) {\r\n            //  but we need a temporary fix for the BCS bug which doesn't include blank lines in the count\r\n            let lineNumber = Number(lineNumberString)\r\n            let notified = false;\r\n            const lines = fileText.split('\\n');\r\n            for (let n = 1; n <= lines.length; n++) {\r\n                if (n >= lineNumber) break; // Gone far enough\r\n                if (!lines[n-1]) {\r\n                    lineNumber += 1; // Increment error line number for each blank line\r\n                    if (!notified) {\r\n                        console.log(\"Temporarily adjusting BCS grammar error line number to account for blank lines\");\r\n                        notified = true;\r\n                    }\r\n                }\r\n            }\r\n            ourErrorObject.lineNumber = lineNumber;\r\n        }\r\n    }\r\n\r\n    const parseWarnings = parserResult._warnings ? parserResult._warnings : ourUsfmParser.warnings;\r\n    // console.log(`  Warnings: ${JSON.stringify(parseWarnings)}`);\r\n    let ourWarnings = [];\r\n    for (const warningString of parseWarnings) {\r\n        // console.log(`warningString: '${warningString}'`);\r\n        // Clean up their warnings a little: Remove trailing spaces and periods\r\n        let adjustedString = warningString.trim(); // Removes the trailing space\r\n        if (adjustedString.endsWith('.')) adjustedString = adjustedString.substring(0, adjustedString.length - 1);\r\n        ourWarnings.push(adjustedString);\r\n    }\r\n\r\n    return { isValidUSFM: !parseError, error: ourErrorObject, warnings: ourWarnings };\r\n}\r\n// end of runBCSGrammarCheck function\r\n\r\n\r\nexport function checkUSFMGrammar(bookID, strictnessString, filename, givenText, givenLocation, optionalCheckingOptions) {\r\n    /*\r\n    This function is only used for the demonstration pages -- not for the core!\r\n\r\n    bookID is a three-character UPPERCASE USFM book identifier.\r\n\r\n    filename parameter can be an empty string if we don't have one.\r\n\r\n     Returns a result object containing a successList and a noticeList\r\n     */\r\n    console.log(`checkUSFMGrammar(${givenText.length.toLocaleString()} chars, '${givenLocation}')`);\r\n    console.assert(strictnessString === 'strict' || strictnessString === 'relaxed', `Unexpected strictnessString='${strictnessString}'`);\r\n\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n\r\n\r\n    const cugResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkUSFMGrammar success: ${successString}`);\r\n        cugResult.successList.push(successString);\r\n    }\r\n    function addNotice6to7(noticeObject) {\r\n        /**\r\n        * @description - adds a new notice entry, adding bookID,C,V to the given fields\r\n        * @param {Number} priority - notice priority from 1 (lowest) to 999 (highest)\r\n        * @param {String} message - the text of the notice message\r\n        * @param {Number} characterIndex - where the issue occurs in the line\r\n        * @param {String} extract - short extract from the line centred on the problem (if available)\r\n        * @param {String} location - description of where the issue is located\r\n        */\r\n        // console.log(`checkUSFMGrammar notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"cUSFMgr addNotice6to7: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `cUSFMgr addNotice6to7: 'priority' parameter should be a number not a '${typeof noticeObject.priority}': ${noticeObject.priority}`);\r\n        console.assert(noticeObject.message !== undefined, \"cUSFMgr addNotice6to7: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `cUSFMgr addNotice6to7: 'message' parameter should be a string not a '${typeof noticeObject.message}': ${noticeObject.message}`);\r\n        // console.assert(characterIndex !== undefined, \"cUSFMgr addNotice6to7: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cUSFMgr addNotice6to7: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}': ${noticeObject.characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cUSFMgr addNotice6to7: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cUSFMgr addNotice6to7: 'extract' parameter should be a string not a '${typeof extract}': ${noticeObject.extract}`);\r\n        console.assert(noticeObject.location !== undefined, \"cUSFMgr addNotice6to7: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `cUSFMgr addNotice6to7: 'location' parameter should be a string not a '${typeof noticeObject.location}': ${noticeObject.location}`);\r\n        cugResult.noticeList.push({ ...noticeObject, bookID,filename });\r\n    }\r\n\r\n\r\n    // Main code for checkUSFMGrammar function\r\n    if (books.isExtraBookID(bookID)) // doesn't work for these\r\n        return cugResult;\r\n\r\n    const grammarCheckResult = runBCSGrammarCheck(strictnessString, givenText, filename, ourLocation, optionalCheckingOptions);\r\n    // console.log(`grammarCheckResult=${JSON.stringify(grammarCheckResult)}`);\r\n\r\n    if (!grammarCheckResult.isValidUSFM)\r\n        addNotice6to7({priority:944, message:`USFM3 Grammar Check (${strictnessString} mode) doesn't pass`, filename, location:ourLocation});\r\n\r\n    // We only get one error if it fails\r\n    if (grammarCheckResult.error && grammarCheckResult.priority)\r\n        addNotice6to7(grammarCheckResult.error);\r\n\r\n    // Display these warnings but with a lowish priority\r\n    for (const warningString of grammarCheckResult.warnings)\r\n        addNotice6to7({priority:101, message:`USFMGrammar: ${warningString}`, filename, location:ourLocation});\r\n\r\n    addSuccessMessage(`Checked USFM Grammar (${strictnessString} mode) ${grammarCheckResult.isValidUSFM ? \"without errors\" : \" (but the USFM DIDN'T validate)\"}`);\r\n    // console.log(`  checkUSFMGrammar returning with ${result.successList.length.toLocaleString()} success(es) and ${result.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(`checkUSFMGrammar result is ${JSON.stringify(result)}`);\r\n    return cugResult;\r\n}\r\n// end of checkUSFMGrammar function\r\n\r\n\r\n//export default checkUSFMGrammar;\r\n","import React from 'react';\r\nimport * as books from './books';\r\nimport { getRepoName, getFilelistFromZip, getFileCached, fetchRepositoryZipFile } from './getApi';\r\nimport checkUSFMText from './usfm-text-check';\r\nimport checkMarkdownText from './markdown-text-check';\r\nimport checkPlainText from './plain-text-check';\r\nimport checkYAMLText from './yaml-text-check';\r\nimport checkManifestText from './manifest-text-check';\r\nimport checkTN_TSVText from './tn-table-text-check';\r\n\r\n\r\n/*\r\n    checkRepo\r\n*/\r\nexport async function checkRepo(username, repoName, branch, givenLocation, setResultValue, checkingOptions) {\r\n  /*\r\n  checkRepo DOES NOT USE the Gitea React Toolkit to fetch the repo\r\n\r\n  It returns an object containing:\r\n      successList: an array of strings to tell the use exactly what has been checked\r\n      noticeList: an array of 9 (i.e., with extra bookOrFileCode parameter at end) notice components\r\n  */\r\n  // console.log(`I'm here in checkRepo\r\n  //   with ${username}, ${repoName}, ${branch}, ${givenLocation}, ${JSON.stringify(checkingOptions)}`);\r\n  const startTime = new Date();\r\n\r\n  const languageCode = repoName.split('_')[0];\r\n  // console.log(\"checkRepo languageCode\", languageCode);\r\n\r\n  if (branch === undefined) branch = 'master'; // Ideally we should ask what the default branch is\r\n\r\n  let checkRepoResult = {\r\n    successList: [], noticeList: [],\r\n    checkedFileCount: 0, checkedFilenames: [], checkedFilenameExtensions: []\r\n  };\r\n\r\n  function addSuccessMessage(successString) {\r\n    // Adds the message to the result that we will later return\r\n    // console.log(`checkRepo success: ${successString}`);\r\n    checkRepoResult.successList.push(successString);\r\n  }\r\n  function addNotice10(noticeObject) {\r\n    // Adds the notices to the result that we will later return\r\n    // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n    // Note that bookID,C,V might all be empty strings (as some repos don't have BCV)\r\n    // console.log(`checkRepo addNotice10: ${noticeObject.priority}:${noticeObject.message} ${noticeObject.bookID} ${noticeObject.C}:${noticeObject.V} ${noticeObject.filename}:${noticeObject.lineNumber} ${noticeObject.characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${noticeObject.extract ? ` ${noticeObject.extract}` : \"\"}${noticeObject.location}`);\r\n    console.assert(noticeObject.priority !== undefined, \"cR addNotice10: 'priority' parameter should be defined\");\r\n    console.assert(typeof noticeObject.priority === 'number', `cR addNotice10: 'priority' parameter should be a number not a '${typeof noticeObject.priority}'`);\r\n    console.assert(noticeObject.message !== undefined, \"cR addNotice10: 'message' parameter should be defined\");\r\n    console.assert(typeof noticeObject.message === 'string', `cR addNotice10: 'message' parameter should be a string not a '${typeof noticeObject.message}'`);\r\n    // console.assert(bookID !== undefined, \"cR addNotice10: 'bookID' parameter should be defined\");\r\n    if (noticeObject.bookID) {\r\n      console.assert(typeof noticeObject.bookID === 'string', `cR addNotice10: 'bookID' parameter should be a string not a '${typeof noticeObject.bookID}'`);\r\n      console.assert(noticeObject.bookID.length === 3, `cR addNotice10: 'bookID' parameter should be three characters long not ${noticeObject.bookID.length}`);\r\n      console.assert(books.isOptionalValidBookID(noticeObject.bookID), `cR addNotice10: '${noticeObject.bookID}' is not a valid USFM book identifier`);\r\n    }\r\n    // console.assert(C !== undefined, \"cR addNotice10: 'C' parameter should be defined\");\r\n    if (noticeObject.C) console.assert(typeof noticeObject.C === 'string', `cR addNotice10: 'C' parameter should be a string not a '${typeof noticeObject.C}'`);\r\n    // console.assert(V !== undefined, \"cR addNotice10: 'V' parameter should be defined\");\r\n    if (noticeObject.V) console.assert(typeof noticeObject.V === 'string', `cR addNotice10: 'V' parameter should be a string not a '${typeof noticeObject.V}'`);\r\n    // console.assert(characterIndex !== undefined, \"cR addNotice10: 'characterIndex' parameter should be defined\");\r\n    if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cR addNotice10: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}'`);\r\n    // console.assert(extract !== undefined, \"cR addNotice10: 'extract' parameter should be defined\");\r\n    if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cR addNotice10: 'extract' parameter should be a string not a '${typeof noticeObject.extract}'`);\r\n    console.assert(noticeObject.location !== undefined, \"cR addNotice10: 'location' parameter should be defined\");\r\n    console.assert(typeof noticeObject.location === 'string', `cR addNotice10: 'location' parameter should be a string not a '${typeof noticeObject.location}'`);\r\n    console.assert(noticeObject.extra !== undefined, \"cR addNotice10: 'extra' parameter should be defined\");\r\n    console.assert(typeof noticeObject.extra === 'string', `cR addNotice10: 'extra' parameter should be a string not a '${typeof noticeObject.extra}'`);\r\n    // Add in the repoName from the outer scope\r\n    checkRepoResult.noticeList.push({ ...noticeObject, repoName });\r\n  }\r\n\r\n\r\n  async function ourCheckFileContents(bookOrFileCode, cfBookID, filename, file_content, fileLocation, optionalCheckingOptions) {\r\n    // We assume that checking for compulsory fields is done elsewhere\r\n    // console.log(`checkRepo ourCheckFileContents(${filename})`);\r\n\r\n    // Updates the global list of notices\r\n    console.assert(bookOrFileCode !== undefined, \"ourCheckFileContents: 'bookOrFileCode' parameter should be defined\");\r\n    console.assert(typeof bookOrFileCode === 'string', `ourCheckFileContents: 'bookOrFileCode' parameter should be a string not a '${typeof bookOrFileCode}'`);\r\n    console.assert(cfBookID !== undefined, \"ourCheckFileContents: 'cfBookID' parameter should be defined\");\r\n    console.assert(typeof cfBookID === 'string', `ourCheckFileContents: 'cfBookID' parameter should be a string not a '${typeof cfBookID}'`);\r\n    console.assert(filename !== undefined, \"ourCheckFileContents: 'filename' parameter should be defined\");\r\n    console.assert(typeof filename === 'string', `ourCheckFileContents: 'filename' parameter should be a string not a '${typeof filename}'`);\r\n    console.assert(file_content !== undefined, \"ourCheckFileContents: 'file_content' parameter should be defined\");\r\n    console.assert(typeof file_content === 'string', `ourCheckFileContents: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n    console.assert(fileLocation !== undefined, \"ourCheckFileContents: 'fileLocation' parameter should be defined\");\r\n    console.assert(typeof fileLocation === 'string', `ourCheckFileContents: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n    const cfcResultObject = await checkFileContents(languageCode, filename, file_content, fileLocation, optionalCheckingOptions);\r\n    // console.log(\"checkFileContents() returned\", resultObject.successList.length, \"success message(s) and\", resultObject.noticeList.length, \"notice(s)\");\r\n    // for (const successEntry of resultObject.successList)\r\n    //     console.log(\"  \", successEntry);\r\n\r\n    // Process results line by line,  appending the bookOrFileCode as an extra field as we go\r\n    for (const cfcNoticeEntry of cfcResultObject.noticeList)\r\n      // We add the bookOrFileCode as an extra value\r\n      addNotice10({ ...cfcNoticeEntry, bookID: cfBookID, extra: bookOrFileCode });\r\n  }\r\n  // end of ourCheckFileContents function\r\n\r\n\r\n  // Main code for checkRepo()\r\n  // Put all this in a try/catch block coz otherwise it's difficult to debug/view errors\r\n  try {\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    // if (ourLocation.indexOf(username) < 0)\r\n    // ourLocation = ` in ${username} ${repoName} ${givenLocation}`\r\n\r\n    // Update our \"waiting\" message\r\n    setResultValue(<p style={{ color: 'magenta' }}>Fetching zipped files from <b>{username}/{repoName}</b> repository</p>);\r\n\r\n    // Let's fetch the zipped repo since it should be much more efficient than individual fetches\r\n    // console.log(`checkRepo: fetch zip file for ${repoName}`);\r\n    const zipFetchSucceeded = await fetchRepositoryZipFile({ username, repository: repoName, branch });\r\n    if (!zipFetchSucceeded)\r\n      console.log(`checkRepo: misfetched zip file for repo with ${zipFetchSucceeded}`);\r\n    if (!zipFetchSucceeded) return checkRepoResult;\r\n    // Note: We don't stop for failure coz the code below will still work (fetching each file individually)\r\n\r\n    // Now we need to fetch the list of files from the repo\r\n    setResultValue(<p style={{ color: 'magenta' }}>Preprocessing file list from <b>{username}/{repoName}</b> repository</p>);\r\n    // const pathList = await getFilelistFromFetchedTreemaps(username, repoName, branch);\r\n    const pathList = await getFilelistFromZip({ username, repository: repoName, branch });\r\n    // console.log(`Got pathlist (${pathList.length}) = ${pathList}`);\r\n\r\n    // So now we want to work through checking all the files in this repo\r\n    const countString = `${pathList.length.toLocaleString()} file${pathList.length === 1 ? '' : 's'}`;\r\n    let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0;\r\n    for (const thisFilepath of pathList) {\r\n      // console.log(`At top of loop: thisFilepath='${thisFilepath}'`);\r\n\r\n      // Update our \"waiting\" message\r\n      setResultValue(<p style={{ color: 'magenta' }}>Checking <b>{username}/{repoName}</b> repo: checked {checkedFileCount.toLocaleString()}/{countString}</p>);\r\n\r\n      const thisFilename = thisFilepath.split('/').pop();\r\n      // console.log(`thisFilename=${thisFilename}`);\r\n      const thisFilenameExtension = thisFilename.split('.').pop();\r\n      // console.log(`thisFilenameExtension=${thisFilenameExtension}`);\r\n\r\n      // Default to the main filename without the extensions\r\n      let bookOrFileCode = thisFilename.substring(0, thisFilename.length - thisFilenameExtension.length - 1);\r\n      let ourBookID = \"\";\r\n      if (thisFilenameExtension === 'usfm') {\r\n        // const filenameMain = thisFilename.substring(0, thisFilename.length - 5); // drop .usfm\r\n        // console.log(`Have USFM filenameMain=${bookOrFileCode}`);\r\n        const bookID = bookOrFileCode.substring(bookOrFileCode.length - 3);\r\n        // console.log(`Have USFM bookcode=${bookID}`);\r\n        console.assert(books.isValidBookID(bookID), `checkRepo: '${bookID}' is not a valid USFM book identifier`);\r\n        bookOrFileCode = bookID;\r\n        ourBookID = bookID;\r\n      }\r\n      else if (thisFilenameExtension === 'tsv') {\r\n        // const filenameMain = thisFilename.substring(0, thisFilename.length - 4); // drop .tsv\r\n        // console.log(`Have TSV filenameMain=${bookOrFileCode}`);\r\n        const bookID = bookOrFileCode.substring(bookOrFileCode.length - 3);\r\n        // console.log(`Have TSV bookcode=${bookID}`);\r\n        console.assert(books.isValidBookID(bookID), `checkRepo: '${bookID}' is not a valid USFM book identifier`);\r\n        bookOrFileCode = bookID;\r\n        ourBookID = bookID;\r\n      }\r\n\r\n      // console.log(\"checkRepo: Try to load\", username, repoName, thisFilepath, branch);\r\n      const getFile_ = (checkingOptions && checkingOptions.getFile) ? checkingOptions.getFile : getFileCached;\r\n      let repoFileContent;\r\n      try {\r\n        repoFileContent = await getFile_({ username, repository: repoName, path: thisFilepath, branch });\r\n        // console.log(\"Fetched file_content for\", repoName, thisPath, typeof repoFileContent, repoFileContent.length);\r\n      } catch (cRgfError) {\r\n        console.log(\"Failed to load\", username, repoName, thisFilepath, branch, `${cRgfError}`);\r\n        addNotice10({ priority: 996, message: \"Failed to load\", bookID: ourBookID, filename: thisFilename, location: `${givenLocation} ${thisFilepath}: ${cRgfError}`, extra: repoName });\r\n        return;\r\n      }\r\n      if (repoFileContent) {\r\n        // console.log(`checkRepo for ${repoName} checking ${thisFilename}`);\r\n        await ourCheckFileContents(bookOrFileCode, ourBookID,\r\n          // OBS has many files with the same name, so we have to give some of the path as well\r\n          repoName.endsWith('_obs') ? thisFilepath.replace('content/', '') : thisFilename,\r\n          repoFileContent, ourLocation, checkingOptions);\r\n        checkedFileCount += 1;\r\n        checkedFilenames.push(thisFilename);\r\n        checkedFilenameExtensions.add(thisFilenameExtension);\r\n        totalCheckedSize += repoFileContent.length;\r\n        // console.log(`checkRepo checked ${thisFilename}`);\r\n        if (thisFilenameExtension !== 'md') // There's often far, far too many of these\r\n          addSuccessMessage(`Checked ${bookOrFileCode.toUpperCase()} file: ${thisFilename}`);\r\n      }\r\n    }\r\n\r\n    // Check that we processed a license and a manifest\r\n    if (checkedFilenames.indexOf('LICENSE.md') < 0)\r\n      addNotice10({ priority: 946, message: \"Missing LICENSE.md\", location: ourLocation, extra: 'LICENSE' });\r\n    if (checkedFilenames.indexOf('manifest.yaml') < 0)\r\n      addNotice10({ priority: 947, message: \"Missing manifest.yaml\", location: ourLocation, extra: 'MANIFEST' });\r\n\r\n    // Add some extra fields to our checkRepoResult object\r\n    //  in case we need this information again later\r\n    checkRepoResult.checkedFileCount = checkedFileCount;\r\n    checkRepoResult.checkedFilenames = checkedFilenames;\r\n    checkRepoResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n    checkRepoResult.checkedFilesizes = totalCheckedSize;\r\n    checkRepoResult.checkedRepoNames = [`${username}/${repoName}`];\r\n    // checkRepoResult.checkedOptions = checkingOptions; // This is done at the caller level\r\n\r\n    addSuccessMessage(`Checked ${username} repo: ${repoName}`);\r\n    // console.log(`checkRepo() is returning ${checkRepoResult.successList.length.toLocaleString()} success message(s) and ${checkRepoResult.noticeList.length.toLocaleString()} notice(s)`);\r\n  } catch (cRerror) {\r\n    console.log(`checkRepo main code block got error: ${cRerror.message}`);\r\n    setResultValue(<>\r\n      <p style={{ color: 'Red' }}>checkRepo main code block got error: <b>{cRerror.message}</b></p>\r\n    </>);\r\n\r\n  }\r\n  checkRepoResult.elapsedSeconds = (new Date() - startTime) / 1000; // seconds\r\n  return checkRepoResult;\r\n};\r\n// end of checkRepo()\r\n\r\n\r\n/*\r\n    checkFileContents\r\n*/\r\nexport async function checkFileContents(languageCode, filename, fileContent, givenLocation, checkingOptions) {\r\n  // Determine the file type from the filename extension\r\n  //  and return the results of checking that kind of file text\r\n  // console.log(`I'm here in checkFileContents\r\n  //   with ${filename}, ${fileContent.length} chars, ${givenLocation}, ${JSON.stringify(checkingOptions)}`);\r\n  const startTime = new Date();\r\n\r\n  let ourCFLocation = givenLocation;\r\n  if (ourCFLocation[0] !== ' ') ourCFLocation = ' ' + ourCFLocation;\r\n\r\n  let checkFileResult;\r\n  if (filename.toLowerCase().endsWith('.tsv')) {\r\n    const filenameMain = filename.substring(0, filename.length - 4); // drop .tsv\r\n    // console.log(`Have TSV filenameMain=${filenameMain}`);\r\n    const bookID = filenameMain.substring(filenameMain.length - 3);\r\n    // console.log(`Have TSV bookcode=${bookID}`);\r\n    console.assert(books.isValidBookID(bookID), `checkFileContents: '${bookID}' is not a valid USFM book identifier`);\r\n    checkFileResult = await checkTN_TSVText(languageCode, bookID, filename, fileContent, ourCFLocation, checkingOptions);\r\n  }\r\n  else if (filename.toLowerCase().endsWith('.usfm')) {\r\n    const filenameMain = filename.substring(0, filename.length - 5); // drop .usfm\r\n    // console.log(`Have USFM filenameMain=${filenameMain}`);\r\n    const bookID = filenameMain.substring(filenameMain.length - 3);\r\n    // console.log(`Have USFM bookcode=${bookID}`);\r\n    console.assert(books.isValidBookID(bookID), `checkFileContents: '${bookID}' is not a valid USFM book identifier`);\r\n    checkFileResult = checkUSFMText(languageCode, bookID, filename, fileContent, ourCFLocation, checkingOptions);\r\n  } else if (filename.toLowerCase().endsWith('.sfm')) {\r\n    const filenameMain = filename.substring(0, filename.length - 4); // drop .sfm\r\n    console.log(`Have SFM filenameMain=${filenameMain}`);\r\n    const bookID = filenameMain.substring(2, 5);\r\n    console.log(`Have SFM bookcode=${bookID}`);\r\n    console.assert(books.isValidBookID(bookID), `checkFileContents: '${bookID}' is not a valid USFM book identifier`);\r\n    checkFileResult = checkUSFMText(languageCode, bookID, filename, fileContent, ourCFLocation, checkingOptions);\r\n  } else if (filename.toLowerCase().endsWith('.md'))\r\n    checkFileResult = checkMarkdownText(filename, fileContent, ourCFLocation, checkingOptions);\r\n  else if (filename.toLowerCase().endsWith('.txt'))\r\n    checkFileResult = checkPlainText(filename, fileContent, ourCFLocation, checkingOptions);\r\n  else if (filename.toLowerCase() === 'manifest.yaml')\r\n    checkFileResult = checkManifestText(filename, fileContent, ourCFLocation, checkingOptions);\r\n  else if (filename.toLowerCase().endsWith('.yaml'))\r\n    checkFileResult = checkYAMLText(filename, fileContent, ourCFLocation, checkingOptions);\r\n  else {\r\n    checkFileResult = checkPlainText(filename, fileContent, ourCFLocation, checkingOptions);\r\n    checkFileResult.noticeList.unshift({ priority: 995, message: \"File extension is not recognized, so treated as plain text.\", filename, location: filename });\r\n  }\r\n  // console.log(`checkFileContents got initial results with ${checkFileResult.successList.length} success message(s) and ${checkFileResult.noticeList.length} notice(s)`);\r\n\r\n  // Add some extra fields to our checkFileResult object\r\n  //  in case we need this information again later\r\n  checkFileResult.checkedFileCount = 1;\r\n  checkFileResult.checkedFilename = filename;\r\n  checkFileResult.checkedFilesize = fileContent.length;\r\n  checkFileResult.checkedOptions = checkingOptions;\r\n\r\n  checkFileResult.elapsedSeconds = (new Date() - startTime) / 1000; // seconds\r\n  // console.log(`checkFileResult: ${JSON.stringify(checkFileResult)}`);\r\n  return checkFileResult;\r\n};\r\n// end of checkFileContents()\r\n\r\n\r\n/*\r\n    checkTQbook\r\n*/\r\nexport async function checkTQbook(username, languageCode, repoName, branch, bookID, checkingOptions) {\r\n  // console.log(`checkTQbook(${username}, ${repoName}, ${branch}, ${bookID}, ${JSON.stringify(checkingOptions)})`)\r\n  const repoCode = 'TQ';\r\n  const generalLocation = `in ${username} ${repoName} (${branch})`;\r\n\r\n  const ctqResult = { successList: [], noticeList: [] };\r\n\r\n  function addSuccessMessage(successString) {\r\n    // console.log(`checkBookPackage success: ${successString}`);\r\n    ctqResult.successList.push(successString);\r\n  }\r\n\r\n  function addNotice10(noticeObject) {\r\n    // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n    // console.log(`checkTQbook addNotice10: ${noticeObject.priority}:${noticeObject.message} ${noticeObject.bookID} ${noticeObject.C}:${noticeObject.V} ${noticeObject.filename}:${noticeObject.lineNumber} ${noticeObject.characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${noticeObject.extract ? ` ${noticeObject.extract}` : \"\"}${noticeObject.location}`);\r\n    console.assert(noticeObject.priority !== undefined, \"cTQ addNotice10: 'priority' parameter should be defined\");\r\n    console.assert(typeof noticeObject.priority === 'number', `cTQ addNotice10: 'priority' parameter should be a number not a '${typeof noticeObject.priority}'`);\r\n    console.assert(noticeObject.message !== undefined, \"cTQ addNotice10: 'message' parameter should be defined\");\r\n    console.assert(typeof noticeObject.message === 'string', `cTQ addNotice10: 'message' parameter should be a string not a '${typeof noticeObject.message}'`);\r\n    console.assert(noticeObject.bookID !== undefined, \"cTQ addNotice10: 'bookID' parameter should be defined\");\r\n    console.assert(typeof noticeObject.bookID === 'string', `cTQ addNotice10: 'bookID' parameter should be a string not a '${typeof noticeObject.bookID}'`);\r\n    console.assert(noticeObject.bookID.length === 3, `cTQ addNotice10: 'bookID' parameter should be three characters long not ${noticeObject.bookID.length}`);\r\n    console.assert(books.isValidBookID(noticeObject.bookID), `cTQ addNotice10: '${noticeObject.bookID}' is not a valid USFM book identifier`);\r\n    // console.assert(C !== undefined, \"cTQ addNotice10: 'C' parameter should be defined\");\r\n    if (noticeObject.C) console.assert(typeof noticeObject.C === 'string', `cTQ addNotice10: 'C' parameter should be a string not a '${typeof noticeObject.C}'`);\r\n    // console.assert(V !== undefined, \"cTQ addNotice10: 'V' parameter should be defined\");\r\n    if (noticeObject.V) console.assert(typeof noticeObject.V === 'string', `cTQ addNotice10: 'V' parameter should be a string not a '${typeof noticeObject.V}'`);\r\n    // console.assert(characterIndex !== undefined, \"cTQ addNotice10: 'characterIndex' parameter should be defined\");\r\n    if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cTQ addNotice10: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}'`);\r\n    // console.assert(extract !== undefined, \"cTQ addNotice10: 'extract' parameter should be defined\");\r\n    if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cTQ addNotice10: 'extract' parameter should be a string not a '${typeof noticeObject.extract}'`);\r\n    console.assert(noticeObject.location !== undefined, \"cTQ addNotice10: 'location' parameter should be defined\");\r\n    console.assert(typeof noticeObject.location === 'string', `cTQ addNotice10: 'location' parameter should be a string not a '${typeof noticeObject.location}'`);\r\n    console.assert(noticeObject.extra !== undefined, \"cTQ addNotice10: 'extra' parameter should be defined\");\r\n    console.assert(typeof noticeObject.extra === 'string', `cTQ addNotice10: 'extra' parameter should be a string not a '${typeof noticeObject.extra}'`);\r\n    ctqResult.noticeList.push({ ...noticeObject, bookID });\r\n  }\r\n\r\n\r\n  async function ourCheckFileContents(repoCode, bookID, C, V, cfFilename, file_content, fileLocation, optionalCheckingOptions) {\r\n    // console.log(`checkBookPackage ourCheckFileContents(${cfFilename})`);\r\n\r\n    // Updates the global list of notices\r\n    console.assert(repoCode !== undefined, \"cTQ ourCheckFileContents: 'repoCode' parameter should be defined\");\r\n    console.assert(typeof repoCode === 'string', `cTQ ourCheckFileContents: 'repoCode' parameter should be a string not a '${typeof repoCode}'`);\r\n    console.assert(cfFilename !== undefined, \"cTQ ourCheckFileContents: 'cfFilename' parameter should be defined\");\r\n    console.assert(typeof cfFilename === 'string', `cTQ ourCheckFileContents: 'cfFilename' parameter should be a string not a '${typeof cfFilename}'`);\r\n    console.assert(file_content !== undefined, \"cTQ ourCheckFileContents: 'file_content' parameter should be defined\");\r\n    console.assert(typeof file_content === 'string', `cTQ ourCheckFileContents: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n    console.assert(fileLocation !== undefined, \"cTQ ourCheckFileContents: 'fileLocation' parameter should be defined\");\r\n    console.assert(typeof fileLocation === 'string', `cTQ ourCheckFileContents: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n    const cfResultObject = await checkFileContents(languageCode, cfFilename, file_content, fileLocation, optionalCheckingOptions);\r\n    // console.log(\"checkFileContents() returned\", cfResultObject.successList.length, \"success message(s) and\", cfResultObject.noticeList.length, \"notice(s)\");\r\n    // for (const successEntry of cfResultObject.successList) console.log(\"  ourCheckFileContents:\", successEntry);\r\n\r\n    // Process results line by line,  appending the repoCode as an extra field as we go\r\n    for (const noticeEntry of cfResultObject.noticeList) {\r\n      // noticeEntry is an array of eight fields: 1=priority, 2=bookID, 3=C, 4=V, 5=msg, 6=characterIndex, 7=extract, 8=location\r\n      // console.assert(Object.keys(noticeEntry).length === 5, `cTQ ourCheckFileContents notice length=${Object.keys(noticeEntry).length}`);\r\n      // We add the repoCode as an extra value\r\n      addNotice10({ ...noticeEntry, bookID, C, V, extra: repoCode });\r\n    }\r\n  }\r\n  // end of ourCheckFileContents function\r\n\r\n\r\n  // Main code for checkTQbook\r\n  // We need to find an check all the markdown folders/files for this book\r\n  let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(['md']), totalCheckedSize = 0;\r\n  let filelistFromZip_ = checkingOptions && checkingOptions.getFilelistFromZip ? checkingOptions.getFilelistFromZip : getFilelistFromZip;\r\n  let bookIdLc = bookID.toLowerCase();\r\n  let pathList = await filelistFromZip_({ username, repository: repoName, branch, optionalPrefix: `${bookIdLc}/` });\r\n  if (!Array.isArray(pathList) || !pathList.length) {\r\n    console.log(\"checkTQrepo failed to load\", username, repoName, branch);\r\n    addNotice10({ priority: 996, message: \"Failed to load\", bookID, C: '', V: '', location: `${generalLocation}`, extra: repoCode });\r\n  } else {\r\n\r\n    // console.log(`  Got ${pathList.length} pathList entries`)\r\n    for (const thisPath of pathList) {\r\n      // console.log(\"checkTQbook: Try to load\", username, repoName, thisPath, branch);\r\n\r\n      console.assert(thisPath.endsWith('.md'), `Expected ${thisPath} to end with .md`);\r\n      const filename = thisPath.split('/').pop();\r\n      const pathParts = thisPath.slice(0, -3).split('/');\r\n      const C = pathParts[pathParts.length - 2].replace(/^0+(?=\\d)/, ''); // Remove leading zeroes\r\n      const V = pathParts[pathParts.length - 1].replace(/^0+(?=\\d)/, ''); // Remove leading zeroes\r\n\r\n      const getFile_ = (checkingOptions && checkingOptions.getFile) ? checkingOptions.getFile : getFileCached;\r\n      let tqFileContent;\r\n      try {\r\n        tqFileContent = await getFile_({username, repository: repoName, path: thisPath, branch});\r\n        // console.log(\"Fetched file_content for\", repoName, thisPath, typeof tqFileContent, tqFileContent.length);\r\n        checkedFilenames.push(thisPath);\r\n        totalCheckedSize += tqFileContent.length;\r\n      } catch (tQerror) {\r\n        console.log(\"checkTQbook failed to load\", username, repoName, thisPath, branch, tQerror + '');\r\n        addNotice10({ priority: 996, message: \"Failed to load\", bookID, C, V, location: `${generalLocation} ${thisPath}: ${tQerror}`, extra: repoCode });\r\n        continue;\r\n      }\r\n\r\n      // We use the generalLocation here (does not include repo name)\r\n      //  so that we can adjust the returned strings ourselves\r\n      await ourCheckFileContents(repoCode, bookID, C, V, filename, tqFileContent, generalLocation, checkingOptions); // Adds the notices to checkBookPackageResult\r\n      checkedFileCount += 1;\r\n      // addSuccessMessage(`Checked ${repoCode.toUpperCase()} file: ${thisPath}`);\r\n    }\r\n    addSuccessMessage(`Checked ${checkedFileCount.toLocaleString()} ${repoCode.toUpperCase()} file${checkedFileCount === 1 ? '' : 's'}`);\r\n  }\r\n\r\n  ctqResult.checkedFileCount = checkedFileCount;\r\n  ctqResult.checkedFilenames = checkedFilenames;\r\n  ctqResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n  ctqResult.checkedFilesizes = totalCheckedSize;\r\n  // console.log(`  checkTQbook returning ${JSON.stringify(ctqResult)}`);\r\n  return ctqResult;\r\n}\r\n// end of checkTQbook function\r\n\r\n\r\n/*\r\n    checkBookPackage\r\n*/\r\nexport async function checkBookPackage(username, languageCode, bookID, setResultValue, checkingOptions) {\r\n  /*\r\n  Note: You may want to run clearCaches() before running this function???\r\n\r\n  Note that bookID here can also be the 'OBS' pseudo bookID.\r\n  */\r\n  // console.log(`checkBookPackage(${username}, ${languageCode}, ${bookID}, )`)\r\n  const startTime = new Date();\r\n\r\n  let checkBookPackageResult = { successList: [], noticeList: [] };\r\n\r\n  const newCheckingOptions = checkingOptions ? { ...checkingOptions } : {}; // clone before modify\r\n  const getFile_ = newCheckingOptions.getFile ? newCheckingOptions.getFile : getFileCached; // default to using caching of files\r\n  newCheckingOptions.getFile = getFile_; // use same getFile_ when we call core functions\r\n\r\n  function addSuccessMessage(successString) {\r\n    // console.log(`checkBookPackage success: ${successString}`);\r\n    checkBookPackageResult.successList.push(successString);\r\n  }\r\n\r\n  function addNotice10(noticeObject) {\r\n    // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n    // console.log(`checkBookPackage addNotice10: (priority=${noticeObject.priority}) ${noticeObject.bookID} ${noticeObject.C}:${noticeObject.V} ${noticeObject.message}${noticeObject.characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n    console.assert(noticeObject.priority !== undefined, \"cBP addNotice10: 'priority' parameter should be defined\");\r\n    console.assert(typeof noticeObject.priority === 'number', `cBP addNotice10: 'priority' parameter should be a number not a '${typeof noticeObject.priority}'`);\r\n    console.assert(noticeObject.message !== undefined, \"cBP addNotice10: 'message' parameter should be defined\");\r\n    console.assert(typeof noticeObject.message === 'string', `cBP addNotice10: 'message' parameter should be a string not a '${typeof noticeObject.message}'`);\r\n    // console.assert(bookID !== undefined, \"cBP addNotice10: 'bookID' parameter should be defined\");\r\n    if (noticeObject.bookID) {\r\n      console.assert(typeof noticeObject.bookID === 'string', `cBP addNotice10: 'bookID' parameter should be a string not a '${typeof noticeObject.bookID}'`);\r\n      console.assert(noticeObject.bookID.length === 3, `cBP addNotice10: 'bookID' parameter should be three characters long not ${noticeObject.bookID.length}`);\r\n      console.assert(books.isValidBookID(noticeObject.bookID), `cBP addNotice10: '${noticeObject.bookID}' is not a valid USFM book identifier`);\r\n    }\r\n    // console.assert(C !== undefined, \"cBP addNotice10: 'C' parameter should be defined\");\r\n    if (noticeObject.C) console.assert(typeof noticeObject.C === 'string', `cBP addNotice10: 'C' parameter should be a string not a '${typeof noticeObject.C}'`);\r\n    // console.assert(V !== undefined, \"cBP addNotice10: 'V' parameter should be defined\");\r\n    if (noticeObject.V) console.assert(typeof noticeObject.V === 'string', `cBP addNotice10: 'V' parameter should be a string not a '${typeof noticeObject.V}'`);\r\n    // console.assert(characterIndex !== undefined, \"cBP addNotice10: 'characterIndex' parameter should be defined\");\r\n    if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cBP addNotice10: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}'`);\r\n    // console.assert(extract !== undefined, \"cBP addNotice10: 'extract' parameter should be defined\");\r\n    if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cBP addNotice10: 'extract' parameter should be a string not a '${typeof noticeObject.extract}'`);\r\n    console.assert(noticeObject.location !== undefined, \"cBP addNotice10: 'location' parameter should be defined\");\r\n    console.assert(typeof noticeObject.location === 'string', `cBP addNotice10: 'location' parameter should be a string not a '${typeof noticeObject.location}'`);\r\n    console.assert(noticeObject.extra !== undefined, \"cBP addNotice10: 'extra' parameter should be defined\");\r\n    console.assert(typeof noticeObject.extra === 'string', `cBP addNotice10: 'extra' parameter should be a string not a '${typeof noticeObject.extra}'`);\r\n    checkBookPackageResult.noticeList.push({ ...noticeObject, bookID });\r\n  }\r\n\r\n\r\n  async function ourCheckFileContents(repoCode, cfFilename, file_content, fileLocation, optionalCheckingOptions) {\r\n    // console.log(`checkBookPackage ourCheckFileContents(${cfFilename})`);\r\n\r\n    // Updates the global list of notices\r\n    console.assert(repoCode !== undefined, \"cBP ourCheckFileContents: 'repoCode' parameter should be defined\");\r\n    console.assert(typeof repoCode === 'string', `cBP ourCheckFileContents: 'repoCode' parameter should be a string not a '${typeof repoCode}'`);\r\n    console.assert(cfFilename !== undefined, \"cBP ourCheckFileContents: 'cfFilename' parameter should be defined\");\r\n    console.assert(typeof cfFilename === 'string', `cBP ourCheckFileContents: 'cfFilename' parameter should be a string not a '${typeof cfFilename}'`);\r\n    console.assert(file_content !== undefined, \"cBP ourCheckFileContents: 'file_content' parameter should be defined\");\r\n    console.assert(typeof file_content === 'string', `cBP ourCheckFileContents: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n    console.assert(fileLocation !== undefined, \"cBP ourCheckFileContents: 'fileLocation' parameter should be defined\");\r\n    console.assert(typeof fileLocation === 'string', `cBP ourCheckFileContents: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n    const cfcResultObject = await checkFileContents(languageCode, cfFilename, file_content, fileLocation, optionalCheckingOptions);\r\n    // console.log(\"checkFileContents() returned\", cfResultObject.successList.length, \"success message(s) and\", cfResultObject.noticeList.length, \"notice(s)\");\r\n    // for (const successEntry of cfResultObject.successList) console.log(\"  ourCheckFileContents:\", successEntry);\r\n    // console.log(\"cfcResultObject\", JSON.stringify(cfcResultObject));\r\n\r\n    // Process results line by line,  appending the repoCode as an extra field as we go\r\n    for (const cfcNoticeEntry of cfcResultObject.noticeList)\r\n      // noticeEntry is an object\r\n      // We add the repoCode as an extra value\r\n      addNotice10({ ...cfcNoticeEntry, extra: repoCode });\r\n  }\r\n  // end of ourCheckFileContents function\r\n\r\n  // Main code for checkBookPackage()\r\n  // No point in passing the branch through as a parameter\r\n  //  coz if it's not 'master', it's unlikely to be common for all the repos\r\n  const branch = 'master';\r\n\r\n  const generalLocation = ` in ${languageCode} ${bookID} book package from ${username} ${branch} branch`;\r\n\r\n  if (bookID === 'OBS') {\r\n    // We use the generalLocation here (does not include repo name)\r\n    //  so that we can adjust the returned strings ourselves\r\n    // console.log(\"Calling OBS checkRepo()\");\r\n    checkBookPackageResult = await checkRepo(username, `${languageCode}_obs`, branch, generalLocation, setResultValue, newCheckingOptions); // Adds the notices to checkBookPackageResult\r\n    // console.log(`checkRepo() returned ${checkBookPackageResult.successList.length} success message(s) and ${checkBookPackageResult.noticeList.length} notice(s)`);\r\n    // console.log(\"crResultObject keys\", JSON.stringify(Object.keys(checkBookPackageResult)));\r\n\r\n    // Concat is faster if we don't need to process each notice individually\r\n    // checkBookPackageResult.successList = checkBookPackageResult.successList.concat(crResultObject.successList);\r\n    // checkBookPackageResult.noticeList = checkBookPackageResult.noticeList.concat(crResultObject.noticeList);\r\n    // checkedFileCount += crResultObject.fileCount;\r\n    addSuccessMessage(`Checked ${languageCode} OBS repo from ${username}`);\r\n  } else { // not OBS\r\n    // We also need to know the number for USFM books\r\n    let bookNumberAndName, whichTestament;\r\n    try {\r\n      bookNumberAndName = books.usfmNumberName(bookID);\r\n      whichTestament = books.testament(bookID); // returns 'old' or 'new'\r\n    } catch (bNNerror) {\r\n      if (books.isValidBookID(bookID)) // must be in FRT, BAK, etc.\r\n        whichTestament = 'other'\r\n      else {\r\n        addNotice10({ priority: 902, message: \"Bad function call: should be given a valid book abbreviation\", bookID, extract: bookID, location: ` (not '${bookID}')${generalLocation}` }); return checkBookPackageResult;\r\n      }\r\n    }\r\n    // console.log(`bookNumberAndName='${bookNumberAndName}' (${whichTestament} testament)`);\r\n\r\n    // So now we want to work through checking this one specified Bible book in various repos:\r\n    //  UHB/UGNT, ULT/GLT, UST/GST, TN, TQ\r\n    const getFile_ = (newCheckingOptions && newCheckingOptions.getFile) ? newCheckingOptions.getFile : getFileCached;\r\n    let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0, checkedRepoNames = [];\r\n    const origLang = whichTestament === 'old' ? 'UHB' : 'UGNT';\r\n    const ULT = languageCode === 'en' ? 'ULT' : 'GLT';\r\n    const UST = languageCode === 'en' ? 'UST' : 'GST';\r\n\r\n    const repoCodeList = [origLang, ULT, UST, 'TN', 'TQ'];\r\n    for (const repoCode of repoCodeList) {\r\n      console.log(`Check ${bookID} in ${repoCode} (${languageCode} ${bookID} from ${username})`);\r\n      const repoLocation = ` in ${repoCode.toUpperCase()}${generalLocation}`;\r\n      const repoName = getRepoName(languageCode, repoCode);\r\n\r\n      // Update our \"waiting\" message\r\n      setResultValue(<p style={{ color: 'magenta' }}>Checking {username} {languageCode} <b>{bookID}</b> book package in <b>{repoCode}</b> (checked <b>{checkedRepoNames.length.toLocaleString()}</b>/{repoCodeList.length} repos)</p>);\r\n\r\n      let filename;\r\n      if (repoCode === 'UHB' || repoCode === 'UGNT' || repoCode === ULT || repoCode === UST) {\r\n        filename = `${bookNumberAndName}.usfm`;\r\n        checkedFilenameExtensions.add('usfm');\r\n      }\r\n      else if (repoCode === 'TN') {\r\n        filename = `${languageCode}_tn_${bookNumberAndName}.tsv`;\r\n        checkedFilenameExtensions.add('tsv');\r\n      }\r\n\r\n      if (repoCode === 'TQ') {\r\n        // This resource might eventually be converted to TSV tables\r\n        const tqResultObject = await checkTQbook(username, languageCode, repoName, branch, bookID, newCheckingOptions);\r\n        checkBookPackageResult.successList = checkBookPackageResult.successList.concat(tqResultObject.successList);\r\n        checkBookPackageResult.noticeList = checkBookPackageResult.noticeList.concat(tqResultObject.noticeList);\r\n        checkedFilenames = checkedFilenames.concat(tqResultObject.checkedFilenames);\r\n        checkedFilenameExtensions = new Set([...checkedFilenameExtensions, ...tqResultObject.checkedFilenameExtensions]);\r\n        checkedFileCount += tqResultObject.checkedFileCount;\r\n        totalCheckedSize += tqResultObject.totalCheckedSize;\r\n        checkedRepoNames.push(repoCode);\r\n      } else { // For repos other than TQ, we only have one file to check\r\n        // console.log(\"Try to load\", username, repoName, filename, branch);\r\n        let repoFileContent;\r\n        try {\r\n          repoFileContent = await getFile_({ username, repository: repoName, path: filename, branch });\r\n          // console.log(\"Fetched file_content for\", repoName, filename, typeof repoFileContent, repoFileContent.length);\r\n          checkedFilenames.push(filename);\r\n          totalCheckedSize += repoFileContent.length;\r\n          checkedRepoNames.push(repoCode);\r\n        } catch (cBPgfError) {\r\n          console.log(\"ERROR: Failed to load\", username, repoName, filename, branch, cBPgfError + '');\r\n          addNotice10({ priority: 996, message: \"Failed to load\", bookID, repoName, filename, location: `${repoLocation}: ${cBPgfError}`, extra: repoCode });\r\n          continue;\r\n        }\r\n\r\n        // We use the generalLocation here (does not include repo name)\r\n        //  so that we can adjust the returned strings ourselves\r\n        await ourCheckFileContents(repoCode, filename, repoFileContent, generalLocation, newCheckingOptions); // Adds the notices to checkBookPackageResult\r\n        checkedFileCount += 1;\r\n        addSuccessMessage(`Checked ${repoCode.toUpperCase()} file: ${filename}`);\r\n      }\r\n    }\r\n\r\n    // Add some extra fields to our checkFileResult object\r\n    //  in case we need this information again later\r\n    checkBookPackageResult.checkedFileCount = checkedFileCount;\r\n    checkBookPackageResult.checkedFilenames = checkedFilenames;\r\n    checkBookPackageResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n    checkBookPackageResult.checkedFilesizes = totalCheckedSize;\r\n    checkBookPackageResult.checkedRepoNames = checkedRepoNames;\r\n    // checkBookPackageResult.checkedOptions = newCheckingOptions; // This is done at the caller level\r\n  }\r\n\r\n  checkBookPackageResult.elapsedSeconds = (new Date() - startTime) / 1000; // seconds\r\n  // console.log(\"checkBookPackageResult:\", JSON.stringify(checkBookPackageResult));\r\n  return checkBookPackageResult;\r\n};\r\n// end of checkBookPackage()\r\n","import {checkYAMLText} from './yaml-text-check';\r\nimport * as books from './books';\r\n\r\n\r\nconst MANIFEST_VALIDATOR_VERSION_STRING = '0.2.1';\r\n\r\nconst DEFAULT_EXTRACT_LENGTH = 10;\r\n\r\n\r\nexport function checkManifestText(textName, manifestText, givenLocation, optionalCheckingOptions) {\r\n    /* This function is optimised for checking the entire file, i.e., all lines.\r\n\r\n    See the specification at https://resource-container.readthedocs.io/en/latest/manifest.html.\r\n\r\n    Returns a result object containing a successList and a noticeList\r\n    */\r\n    // console.log(`checkManifestText(${textName}, ${manifestText.length}, ${givenLocation})`);\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    if (textName) ourLocation = ` in ${textName}${ourLocation}`;\r\n\r\n    let extractLength;\r\n    try {\r\n        extractLength = optionalCheckingOptions.extractLength;\r\n    } catch (mfcError) { }\r\n    if (typeof extractLength !== 'number' || isNaN(extractLength)) {\r\n        extractLength = DEFAULT_EXTRACT_LENGTH;\r\n        // console.log(`Using default extractLength=${extractLength}`);\r\n    }\r\n    // else\r\n        // console.log(`Using supplied extractLength=${extractLength}`, `cf. default=${DEFAULT_EXTRACT_LENGTH}`);\r\n    // const halfLength = Math.floor(extractLength / 2); // rounded down\r\n    // const halfLengthPlus = Math.floor((extractLength + 1) / 2); // rounded up\r\n    // console.log(`Using halfLength=${halfLength}`, `halfLengthPlus=${halfLengthPlus}`);\r\n\r\n    const cmtResult = { successList: [], noticeList: [] };\r\n\r\n    function addSuccessMessage(successString) {\r\n        // console.log(`checkManifestText success: ${successString}`);\r\n        cmtResult.successList.push(successString);\r\n    }\r\n    function addNotice9({priority,message, bookID,C,V, lineNumber, characterIndex, extract, location}) {\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        // console.log(`checkManifestText Notice: (priority=${priority}) ${message}${characterIndex > 0 ? ` (at character ${characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n        console.assert(priority !== undefined, \"cManT addNotice9: 'priority' parameter should be defined\");\r\n        console.assert(typeof priority === 'number', `cManT addNotice9: 'priority' parameter should be a number not a '${typeof priority}': ${priority}`);\r\n        console.assert(message !== undefined, \"cManT addNotice9: 'message' parameter should be defined\");\r\n        console.assert(typeof message === 'string', `cManT addNotice9: 'message' parameter should be a string not a '${typeof message}': ${message}`);\r\n        console.assert(bookID !== undefined, \"cManT addNotice9: 'bookID' parameter should be defined\");\r\n        console.assert(typeof bookID === 'string', `cManT addNotice9: 'bookID' parameter should be a string not a '${typeof bookID}'`);\r\n        console.assert(bookID.length === 3, `cManT addNotice9: 'bookID' parameter should be three characters long not ${bookID.length}`);\r\n        console.assert(books.isValidBookID(bookID), `cManT addNotice9: '${bookID}' is not a valid USFM book identifier`);\r\n        // console.assert(C !== undefined, \"cManT addNotice9: 'C' parameter should be defined\");\r\n        if (C) console.assert(typeof C === 'string', `cManT addNotice9: 'C' parameter should be a string not a '${typeof C}'`);\r\n        // console.assert(V !== undefined, \"cManT addNotice9: 'V' parameter should be defined\");\r\n        if (V) console.assert(typeof V === 'string', `cManT addNotice9: 'V' parameter should be a string not a '${typeof V}'`);\r\n        // console.assert(characterIndex !== undefined, \"cManT addNotice9: 'characterIndex' parameter should be defined\");\r\n        if (characterIndex) console.assert(typeof characterIndex === 'number', `cManT addNotice9: 'characterIndex' parameter should be a number not a '${typeof characterIndex}': ${characterIndex}`);\r\n        // console.assert(extract !== undefined, \"cManT addNotice9: 'extract' parameter should be defined\");\r\n        if (extract) console.assert(typeof extract === 'string', `cManT addNotice9: 'extract' parameter should be a string not a '${typeof extract}': ${extract}`);\r\n        console.assert(location !== undefined, \"cManT addNotice9: 'location' parameter should be defined\");\r\n        console.assert(typeof location === 'string', `cManT addNotice9: 'location' parameter should be a string not a '${typeof location}': ${location}`);\r\n        cmtResult.noticeList.push({priority,message, bookID,C,V, lineNumber, characterIndex,extract, location});\r\n    }\r\n\r\n\r\n    function ourYAMLTextChecks(textName, manifestText, givenLocation, optionalCheckingOptions) {\r\n        // Does basic checks for small errors like leading/trailing spaces, etc.\r\n\r\n        // We assume that checking for compulsory fields is done elsewhere\r\n\r\n        // Updates the global list of notices\r\n        // console.log(`cManT ourYAMLTextChecks(${textName}, (${fieldText.length}), ${allowedLinks}, ${fieldLocation}, )`);\r\n        console.assert(textName !== undefined, \"cManT ourYAMLTextChecks: 'textName' parameter should be defined\");\r\n        console.assert(typeof textName === 'string', `cManT ourYAMLTextChecks: 'textName' parameter should be a string not a '${typeof textName}'`);\r\n        console.assert(manifestText !== undefined, \"cManT ourYAMLTextChecks: 'manifestText' parameter should be defined\");\r\n        console.assert(typeof manifestText === 'string', `cManT ourYAMLTextChecks: 'manifestText' parameter should be a string not a '${typeof manifestText}'`);\r\n        // console.assert( allowedLinks===true || allowedLinks===false, \"cManT ourYAMLTextChecks: allowedLinks parameter must be either true or false\");\r\n\r\n        const cYtResultObject = checkYAMLText(textName, manifestText, givenLocation, optionalCheckingOptions);\r\n\r\n        // Concat is faster if we don't need to process each notice individually\r\n        cmtResult.successList = cmtResult.successList.concat(cYtResultObject.successList);\r\n        cmtResult.noticeList = cmtResult.noticeList.concat(cYtResultObject.noticeList);\r\n        /* // Process results line by line\r\n        //  suppressing undesired errors\r\n        for (const noticeEntry of cYtResultObject.noticeList)\r\n            if (noticeEntry.priority !== 191 // \"Unexpected XXX character after space\"\r\n              && noticeEntry.message !== \"Unexpected ' character after space\"\r\n              && noticeEntry.message !== \"Unexpected space after ' character\"\r\n              && noticeEntry.message !== \"Unexpected space after [ character\"\r\n              )\r\n                addNotice9(noticeEntry.priority, noticeEntry.message, noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7]);\r\n        */\r\n        return cYtResultObject.formData;\r\n    }\r\n    // end of ourYAMLTextChecks function\r\n\r\n\r\n    // Main code for checkManifestText function\r\n    const formData = ourYAMLTextChecks(textName, manifestText, ourLocation, optionalCheckingOptions);\r\n    if (formData) {\r\n        // console.log(\"formData\", JSON.stringify(formData));\r\n        const formDataKeys = Object.keys(formData);\r\n        // console.log(\"formData keys\", JSON.stringify(formDataKeys));\r\n\r\n        if (formDataKeys.indexOf('dublin_core') < 0)\r\n            addNotice9({priority:928, message:\"'dublin_core' key is missing\", location:ourLocation});\r\n        if (formDataKeys.indexOf('projects') < 0)\r\n            addNotice9({priority:929, message:\"'projects' key is missing\", location:ourLocation});\r\n        if (formDataKeys.indexOf('checking') < 0)\r\n            addNotice9({priority:148, message:\"'checking' key is missing\", location:ourLocation});\r\n    }\r\n\r\n    // addSuccessMessage(`Checked all ${lines.length.toLocaleString()} line${lines.length==1?'':'s'}${ourLocation}.`);\r\n    if (cmtResult.noticeList)\r\n        addSuccessMessage(`checkManifestText v${MANIFEST_VALIDATOR_VERSION_STRING} finished with ${cmtResult.noticeList.length ? cmtResult.noticeList.length.toLocaleString() : \"zero\"} notice${cmtResult.noticeList.length === 1 ? '' : 's'}`);\r\n    else\r\n        addSuccessMessage(`No errors or warnings found by checkManifestText v${MANIFEST_VALIDATOR_VERSION_STRING}`)\r\n    // console.log(`  checkManifestText returning with ${cmtResult.successList.length.toLocaleString()} success(es), ${cmtResult.noticeList.length.toLocaleString()} notice(s).`);\r\n    // console.log(\"checkManifestText result is\", JSON.stringify(result));\r\n    return cmtResult;\r\n}\r\n// end of checkManifestText function\r\n\r\n\r\n//export default checkManifestText;\r\n","//export * from './checkBookPackage';\r\nexport {default} from './BookPackageCheck';\r\n","import React, { useState, useEffect } from 'react';\r\n// import { withStyles } from '@material-ui/core/styles';\r\nimport * as books from '../../core/books/books';\r\nimport { ourParseInt, checkBookPackage, clearCacheAndPreloadRepos } from '../../core';\r\nimport { processNoticesToErrorsWarnings, processNoticesToSevereMediumLow, processNoticesToSingleList } from '../notice-processing-functions';\r\nimport { RenderSuccessesErrorsWarnings, RenderSuccessesSevereMediumLow, RenderSuccessesWarningsGradient, RenderElapsedTime } from '../RenderProcessedResults';\r\n// import { consoleLogObject } from '../../core/utilities';\r\n\r\n\r\n// const BP_VALIDATOR_VERSION_STRING = '0.2.1';\r\n\r\n\r\nfunction BookPackageCheck(/*username, languageCode, bookID,*/ props) {\r\n    // Check a single Bible book across many repositories\r\n    const [result, setResultValue] = useState(\"Waiting-CheckBookPackage\");\r\n\r\n    // console.log(`I'm here in BookPackageCheck v${BP_VALIDATOR_VERSION_STRING}`);\r\n    // consoleLogObject(\"props\", props);\r\n    // consoleLogObject(\"props.classes\", props.classes);\r\n\r\n    let username = props.username;\r\n    // console.log(`username='${username}'`);\r\n    let languageCode = props.languageCode;\r\n    // console.log(`languageCode='${languageCode}'`);\r\n    let bookID = props.bookID;\r\n    // console.log(`bookID='${bookID}'`);\r\n    let branch = props.branch;\r\n    // console.log(`branch='${branch}'`);\r\n\r\n    // Clear cached files if we've changed repo\r\n    //  autoClearCache(bookID); // This technique avoids the complications of needing a button\r\n\r\n    let checkingOptions = { // Uncomment any of these to test them\r\n        // 'extractLength': 25,\r\n    };\r\n    // Or this allows the parameters to be specified as a BookPackageCheck property\r\n    if (props.extractLength) checkingOptions.extractLength = ourParseInt(props.extractLength);\r\n\r\n    useEffect(() => {\r\n        // const newProps = { bookID, branch, checkingOptions, languageCode, cutoffPriorityLevel: props.cutoffPriorityLevel, displayType: props.displayType, errorPriorityLevel: props.errorPriorityLevel, maximumSimilarMessages: props.maximumSimilarMessages, sortBy: props.sortBy, username};\r\n        // console.log(\"BookPackageCheck.useEffect() called with \", JSON.stringify(newProps));\r\n\r\n        // Use an IIFE (Immediately Invoked Function Expression)\r\n        //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174\r\n        (async () => {\r\n            // console.log(\"Started BookPackageCheck.unnamedFunction()\");\r\n\r\n            // NOTE from RJH: I can't find the correct React place for this / way to do this\r\n            //                  so it shows a warning for the user, and doesn't continue to try to process\r\n            if (bookID !== 'OBS' && !books.isValidBookID(bookID)) {\r\n                console.log(`Invalid '${bookID}' bookID given!`)\r\n                setResultValue(<p style={{ color: 'red' }}>Please enter a valid USFM book identifier or 'OBS'. ('<b>{bookID}</b>' is not valid.)</p>);\r\n                return;\r\n            }\r\n\r\n            if (bookID !== 'OBS') {\r\n                // Preload the reference repos\r\n                // RJH TODO: Doesn't the end user need control of this somehow???\r\n                // TEMP: Removed TQ\r\n                setResultValue(<p style={{ color: 'magenta' }}>Preloading repos for {username} {languageCode} ready for <b>{bookID}</b> book package check</p>);\r\n                // This call is not needed, but makes sure you don't have stale data that has been cached\r\n                const successFlag = await clearCacheAndPreloadRepos(username, languageCode, [bookID], branch);\r\n                if (!successFlag)\r\n                    console.log(`BookPackageCheck error: Failed to pre-load all repos`)\r\n            }\r\n\r\n            // Display our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Checking {username} {languageCode} <b>{bookID}</b> book package</p>);\r\n\r\n            const rawCBPResults = await checkBookPackage(username, languageCode, bookID, setResultValue, checkingOptions);\r\n            // console.log(\"checkBookPackage() returned\", typeof rawCBPResults); //, JSON.stringify(rawCBPResults));\r\n\r\n            // Add some extra fields to our rawCBPResults object in case we need this information again later\r\n            rawCBPResults.checkType = 'BookPackage';\r\n            rawCBPResults.username = username;\r\n            rawCBPResults.languageCode = languageCode;\r\n            rawCBPResults.bookID = bookID;\r\n            rawCBPResults.checkedOptions = checkingOptions;\r\n\r\n            // console.log(\"Here with CBP rawCBPResults\", typeof rawCBPResults);\r\n            // Now do our final handling of the result -- we have some options available\r\n            let processOptions = { // Uncomment any of these to test them\r\n                // 'maximumSimilarMessages': 4, // default is 3 -- 0 means don't suppress\r\n                // 'errorPriorityLevel': 800, // default is 700\r\n                // 'cutoffPriorityLevel': 100, // default is 0\r\n                // 'sortBy': 'ByPriority', // default is 'AsFound'\r\n                // 'ignorePriorityNumberList': [123, 202], // default is []\r\n            };\r\n            // Or this allows the parameters to be specified as a BookPackageCheck property\r\n            if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = ourParseInt(props.maximumSimilarMessages);\r\n            if (props.errorPriorityLevel) processOptions.errorPriorityLevel = ourParseInt(props.errorPriorityLevel);\r\n            if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);\r\n            if (props.sortBy) processOptions.sortBy = props.sortBy;\r\n            // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;\r\n\r\n            let displayType = 'ErrorsWarnings'; // default\r\n            if (props.displayType) displayType = props.displayType;\r\n\r\n            function renderSummary(processedResults) {\r\n                return (<div>\r\n                    <p>Checked <b>{username} {languageCode} {bookID}</b> (from <i>{branch === undefined ? 'DEFAULT' : branch}</i> branches)</p>\r\n                    <p>&nbsp;&nbsp;&nbsp;&nbsp;Successfully checked {processedResults.checkedFileCount.toLocaleString()} file{processedResults.checkedFileCount === 1 ? '' : 's'} from {processedResults.checkedRepoNames.length} repo{processedResults.checkedRepoNames.length === 1 ? '' : 's'}: <b>{processedResults.checkedRepoNames.join(', ')}</b>\r\n                        <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;including {processedResults.checkedFilenameExtensions.length} file type{processedResults.checkedFilenameExtensions.size === 1 ? '' : 's'}: {processedResults.checkedFilenameExtensions.join(', ')}.</p>\r\n                    <p>&nbsp;&nbsp;&nbsp;&nbsp;Finished in <RenderElapsedTime elapsedSeconds={processedResults.elapsedSeconds} /> with {rawCBPResults.noticeList.length===0?'no':rawCBPResults.noticeList.length} notice{rawCBPResults.noticeList.length===1?'':'s'}.</p>\r\n                    {/* <RenderRawResults results={rawCBPResults} /> */}\r\n                </div>);\r\n            }\r\n\r\n            if (displayType === 'ErrorsWarnings') {\r\n                const processedResults = processNoticesToErrorsWarnings(rawCBPResults, processOptions);\r\n                //             console.log(`BookPackageCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n                //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n                // console.log(\"Here now in rendering bit!\");\r\n\r\n                if (processedResults.errorList.length || processedResults.warningList.length)\r\n                    setResultValue(<>\r\n                        {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}\r\n                        <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                    </>);\r\n                else // no errors or warnings\r\n                    setResultValue(<>\r\n                        {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}\r\n                        <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                    </>);\r\n            } else if (displayType === 'SevereMediumLow') {\r\n                const processedResults = processNoticesToSevereMediumLow(rawCBPResults, processOptions);\r\n                //             console.log(`BookPackageCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n                //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n                if (processedResults.severeList.length || processedResults.mediumList.length || processedResults.lowList.length)\r\n                    setResultValue(<>\r\n                        {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}\r\n                        <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                    </>);\r\n                else // no severe, medium, or low notices\r\n                    setResultValue(<>\r\n                        {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}\r\n                        <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                    </>);\r\n            } else if (displayType === 'SingleList') {\r\n                const processedResults = processNoticesToSingleList(rawCBPResults, processOptions);\r\n                //             console.log(`BookPackageCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n                //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n                if (processedResults.warningList.length)\r\n                    setResultValue(<>\r\n                        {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}\r\n                        <RenderSuccessesWarningsGradient results={processedResults} />\r\n                    </>);\r\n                else // no warnings\r\n                    setResultValue(<>\r\n                        {renderSummary(processedResults)}\r\n                        {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}\r\n                        <RenderSuccessesWarningsGradient results={processedResults} />\r\n                    </>);\r\n            } else setResultValue(<b style={{ color: 'red' }}>Invalid displayType='{displayType}'</b>)\r\n\r\n            // console.log(\"Finished rendering bit.\");\r\n        })(); // end of async part in unnamedFunction\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [bookID, branch, JSON.stringify(checkingOptions), languageCode, JSON.stringify(props), username]); // end of useEffect part\r\n\r\n    // {/* <div className={classes.root}> */}\r\n    return (\r\n        <div className=\"Fred\">\r\n            {result}\r\n        </div>\r\n    );\r\n}\r\n\r\n// BookPackageCheck.propTypes = {\r\n//   /** @ignore */\r\n//   username: PropTypes.object.isRequired,\r\n//   /** @ignore */\r\n//   languageCode: PropTypes.object.isRequired,\r\n//   bookID: PropTypes.object.isRequired,\r\n//   props: PropTypes.object,\r\n// };\r\n\r\n// const styles = theme => ({\r\n//   root: {\r\n//   },\r\n// });\r\n\r\n//export default withStyles(styles)(BookPackageCheck);\r\nexport default BookPackageCheck;\r\n","//export {checkBookPackages} from './checkBookPackages';\r\nexport {default} from './BookPackagesCheck';\r\n","import React, { useState, useEffect } from 'react';\r\n// import { withStyles } from '@material-ui/core/styles';\r\nimport * as books from '../../core/books/books';\r\nimport { ourParseInt, clearCacheAndPreloadRepos } from '../../core';\r\nimport checkBookPackages from './checkBookPackages';\r\nimport { processNoticesToErrorsWarnings, processNoticesToSevereMediumLow, processNoticesToSingleList } from '../notice-processing-functions';\r\nimport { RenderSuccessesErrorsWarnings, RenderSuccessesSevereMediumLow, RenderSuccessesWarningsGradient, RenderElapsedTime } from '../RenderProcessedResults';\r\n// import { consoleLogObject } from '../../core/utilities';\r\n\r\n\r\n// const BPS_VALIDATOR_VERSION_STRING = '0.1.2';\r\n\r\n\r\nfunction BookPackagesCheck(/*username, languageCode, bookIDs,*/ props) {\r\n    // Check a single Bible book across many repositories\r\n    const [result, setResultValue] = useState(\"Waiting-CheckBookPackages\");\r\n\r\n    // console.log(`I'm here in BookPackagesCheck v${BPS_VALIDATOR_VERSION_STRING}`);\r\n    // consoleLogObject(\"props\", props);\r\n    // consoleLogObject(\"props.classes\", props.classes);\r\n\r\n    let username = props.username;\r\n    // console.log(`username='${username}'`);\r\n    let languageCode = props.languageCode;\r\n    // console.log(`languageCode='${languageCode}'`);\r\n    let bookIDs = props.bookIDs;\r\n    // console.log(`bookIDs='${bookIDs}'`);\r\n    let branch = props.branch;\r\n    // console.log(`branch='${branch}'`);\r\n\r\n    // Clear cached files if we've changed repo\r\n    //  autoClearCache(bookIDs); // This technique avoids the complications of needing a button\r\n\r\n    let bookIDList = [];\r\n    let bookIDInvalid;\r\n    for (let bookID of bookIDs.split(',')) {\r\n        bookID = bookID.trim();\r\n        if (!books.isValidBookID(bookID) && bookID!=='OBS') {\r\n            bookIDInvalid = bookID;\r\n        }\r\n        bookIDList.push(bookID);\r\n    }\r\n    // console.log(`bookIDList (${bookIDList.length}) = ${bookIDList.join(', ')}`);\r\n\r\n    let checkingOptions = { // Uncomment any of these to test them\r\n        // 'extractLength': 25,\r\n    };\r\n    // Or this allows the parameters to be specified as a BookPackagesCheck property\r\n    if (props.extractLength) checkingOptions.extractLength = ourParseInt(props.extractLength);\r\n\r\n    useEffect(() => {\r\n        // console.log(\"BookPackagesCheck.useEffect() called with \", JSON.stringify(props));\r\n\r\n        // Use an IIFE (Immediately Invoked Function Expression)\r\n        //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174\r\n        (async () => {\r\n        // console.log(\"Started BookPackagesCheck.unnamedFunction()\");\r\n\r\n        // // TODO: We need to implement BM's new function here\r\n        // // Preload the reference repos\r\n        // let preloadCount = 1;\r\n        // // TEMP: Removed TQ\r\n        // const repoCodeList = ['UHB','UGNT', 'TA','TW'];\r\n        // for (const repoCode of repoCodeList) {\r\n        // setResultValue(<p style={{ color: 'magenta' }}>Preloading <b>{repoCode}</b> repo ({preloadCount}/{repoCodeList.length}) ready for {username} {languageCode} book packages check</p>);\r\n        //     const repoName = getRepoName(languageCode, repoCode);\r\n        //     console.log(`BookPackagesCheck: preloading zip file for ${repoName}`);\r\n        //     const zipFetchSucceeded = await fetchRepositoryZipFile({ username, repository: repoName, branch });\r\n        //     if (!zipFetchSucceeded)\r\n        //         console.log(`BookPackagesCheck: misfetched ${repoCode} zip file for repo with ${zipFetchSucceeded}`);\r\n        //     preloadCount += 1;\r\n        //     }\r\n\r\n        // This call is not needed, but makes sure you don't have stale data that has been cached\r\n        setResultValue(<p style={{ color: 'magenta' }}>Preloading repos for {username} {languageCode} ready for book packages check</p>);\r\n        const successFlag = await clearCacheAndPreloadRepos(username, languageCode, bookIDList, branch);\r\n        if (!successFlag)\r\n            console.log(`BookPackagesCheck error: Failed to pre-load all repos`)\r\n\r\n      // Display our \"waiting\" message\r\n      setResultValue(<p style={{ color: 'magenta' }}>Checking {username} {languageCode} <b>{bookIDList.join(', ')}</b> book packages</p>);\r\n\r\n      const rawCBPsResults = await checkBookPackages(username, languageCode, bookIDList, setResultValue, checkingOptions);\r\n      // console.log(\"checkBookPackage() returned\", typeof rawCBPsResults); //, JSON.stringify(rawCBPsResults));\r\n\r\n      // Add some extra fields to our rawCBPsResults object in case we need this information again later\r\n      rawCBPsResults.checkType = 'BookPackages';\r\n      rawCBPsResults.username = username;\r\n      rawCBPsResults.languageCode = languageCode;\r\n      rawCBPsResults.bookIDs = bookIDs;\r\n      rawCBPsResults.bookIDList = bookIDList;\r\n      rawCBPsResults.checkedOptions = checkingOptions;\r\n\r\n      // console.log(\"Here with CBPs rawCBPsResults\", typeof rawCBPsResults);\r\n      // Now do our final handling of the result -- we have some options available\r\n      let processOptions = { // Uncomment any of these to test them\r\n        // 'maximumSimilarMessages': 4, // default is 3 -- 0 means don't suppress\r\n        // 'errorPriorityLevel': 800, // default is 700\r\n        // 'cutoffPriorityLevel': 100, // default is 0\r\n        // 'sortBy': 'ByPriority', // default is 'AsFound'\r\n        // 'ignorePriorityNumberList': [123, 202], // default is []\r\n      };\r\n      // Or this allows the parameters to be specified as a BookPackagesCheck property\r\n      if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = ourParseInt(props.maximumSimilarMessages);\r\n      if (props.errorPriorityLevel) processOptions.errorPriorityLevel = ourParseInt(props.errorPriorityLevel);\r\n      if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);\r\n      if (props.sortBy) processOptions.sortBy = props.sortBy;\r\n      // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;\r\n\r\n      let displayType = 'ErrorsWarnings'; // default\r\n      if (props.displayType) displayType = props.displayType;\r\n\r\n      function renderSummary(processedResults) {\r\n        return (<div>\r\n          <p>Checked <b>{username} {languageCode} {bookIDList.join(', ')}</b> (from <i>{branch === undefined ? 'DEFAULT' : branch}</i> branches)</p>\r\n          <p>&nbsp;&nbsp;&nbsp;&nbsp;Successfully checked {processedResults.checkedFileCount.toLocaleString()} file{processedResults.checkedFileCount===1?'':'s'} from {username} {processedResults.checkedRepoNames.join(', ')}\r\n            <br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;including {processedResults.checkedFilenameExtensions.length} file type{processedResults.checkedFilenameExtensions.size === 1 ? '' : 's'}: {processedResults.checkedFilenameExtensions.join(', ')}.</p>\r\n          <p>&nbsp;&nbsp;&nbsp;&nbsp;Finished in <RenderElapsedTime elapsedSeconds={processedResults.elapsedSeconds} /> with {rawCBPsResults.noticeList.length===0?'no':rawCBPsResults.noticeList.length} notice{rawCBPsResults.noticeList.length===1?'':'s'}.</p>\r\n          {/* <RenderRawResults results={rawCBPsResults} /> */}\r\n        </div>);\r\n      }\r\n\r\n    if (displayType === 'ErrorsWarnings') {\r\n        const processedResults = processNoticesToErrorsWarnings(rawCBPsResults, processOptions);\r\n        console.log(`BookPackagesCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n  numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()} numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()} numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n        // console.log(\"Here now in rendering bit!\");\r\n\r\n        if (processedResults.errorList.length || processedResults.warningList.length)\r\n          setResultValue(<>\r\n            <div>{renderSummary(processedResults)}\r\n              {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n            <RenderSuccessesErrorsWarnings results={processedResults} />\r\n          </>);\r\n        else // no errors or warnings\r\n          setResultValue(<>\r\n            <div>{renderSummary(processedResults)}\r\n              {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n            <RenderSuccessesErrorsWarnings results={processedResults} />\r\n          </>);\r\n\r\n      } else if (displayType === 'SevereMediumLow') {\r\n        const processedResults = processNoticesToSevereMediumLow(rawCBPsResults, processOptions);\r\n//                 console.log(`FileCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n//   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, `numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()}`, `numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n        if (processedResults.severeList.length || processedResults.mediumList.length || processedResults.lowList.length)\r\n          setResultValue(<>\r\n            <div>{renderSummary(processedResults)}\r\n              {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n            <RenderSuccessesSevereMediumLow results={processedResults} />\r\n          </>);\r\n        else // no severe, medium, or low notices\r\n          setResultValue(<>\r\n            <div>{renderSummary(processedResults)}\r\n              {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n            <RenderSuccessesSevereMediumLow results={processedResults} />\r\n          </>);\r\n\r\n      } else if (displayType === 'SingleList') {\r\n        const processedResults = processNoticesToSingleList(rawCBPsResults, processOptions);\r\n        console.log(`FileCheck got processed results with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n  numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, `numSuppressedErrors=${processedResults.numSuppressedErrors.toLocaleString()}`, `numSuppressedWarnings=${processedResults.numSuppressedWarnings.toLocaleString()}`);\r\n\r\n        if (processedResults.warningList.length)\r\n          setResultValue(<>\r\n            <div>{renderSummary(processedResults)}\r\n              {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n            <RenderSuccessesWarningsGradient results={processedResults} />\r\n          </>);\r\n        else // no warnings\r\n          setResultValue(<>\r\n            <div>{renderSummary(processedResults)}\r\n              {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n            <RenderSuccessesWarningsGradient results={processedResults} />\r\n          </>);\r\n      } else setResultValue(<b style={{ color: 'red' }}>Invalid displayType='{displayType}'</b>)\r\n\r\n      // console.log(\"Finished rendering bit.\");\r\n    })(); // end of async part in unnamedFunction\r\n    // Doesn't work if we add this to next line: bookIDList,bookIDs,username,branch,checkingOptions,languageCode,props\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [JSON.stringify(bookIDList), bookIDs, branch, JSON.stringify(checkingOptions), languageCode, JSON.stringify(props), username]); // end of useEffect part\r\n\r\n  if (bookIDInvalid) {\r\n    return (<p>Please enter only valid USFM book identifiers separated by commas. ('{bookIDInvalid}' is not valid.)</p>);\r\n  }\r\n\r\n  // {/* <div className={classes.root}> */}\r\n  return (\r\n    <div className=\"Fred\">\r\n      {result}\r\n    </div>\r\n  );\r\n}\r\n\r\n// BookPackagesCheck.propTypes = {\r\n//   /** @ignore */\r\n//   username: PropTypes.object.isRequired,\r\n//   /** @ignore */\r\n//   languageCode: PropTypes.object.isRequired,\r\n//   bookIDs: PropTypes.object.isRequired,\r\n//   props: PropTypes.object,\r\n// };\r\n\r\n// const styles = theme => ({\r\n//   root: {\r\n//   },\r\n// });\r\n\r\n//export default withStyles(styles)(BookPackagesCheck);\r\nexport default BookPackagesCheck;\r\n","import * as books  from '../../core/books/books';\r\nimport { checkBookPackage } from '../../core';\r\n// import { consoleLogObject } from '../../core/utilities';\r\n\r\n//const VALIDATOR_VERSION_STRING = '0.2.1';\r\n\r\n\r\nasync function checkBookPackages(username, languageCode, bookIDList, setResultValue, checkingOptions) {\r\n    //     console.log(`I'm here in checkBookPackages v${VALIDATOR_VERSION_STRING}\r\n    //   with ${username}, ${languageCode}, ${bookIDList}, ${JSON.stringify(checkingOptions)}`);\r\n    const startTime = new Date();\r\n\r\n    const checkBookPackagesResult = { successList: [], noticeList: [] };\r\n\r\n    // function addSuccessMessage(successString) {\r\n    //     // console.log(`checkBookPackages success: ${successString}`);\r\n    //     checkBookPackagesResult.successList.push(successString);\r\n    // }\r\n\r\n    function addNotice10(noticeObject) {\r\n        // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n        console.log(`cBPs addNotice10: (priority=${noticeObject.priority}) ${noticeObject.extra} ${noticeObject.message}${noticeObject.characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${noticeObject.extract ? ` ${noticeObject.extract}` : \"\"}${noticeObject.location}`);\r\n        console.assert(noticeObject.priority !== undefined, \"cBPs addNotice10: 'priority' parameter should be defined\");\r\n        console.assert(typeof noticeObject.priority === 'number', `cBPs addNotice10: 'priority' parameter should be a number not a '${typeof noticeObject.priority}'`);\r\n        console.assert(noticeObject.message !== undefined, \"cBPs addNotice10: 'message' parameter should be defined\");\r\n        console.assert(typeof noticeObject.message === 'string', `cBPs addNotice10: 'message' parameter should be a string not a '${typeof noticeObject.message}'`);\r\n        // console.assert(bookID !== undefined, \"cBPs addNotice10: 'bookID' parameter should be defined\");\r\n        if (noticeObject.bookID) {\r\n            console.assert(typeof noticeObject.bookID === 'string', `cBPs addNotice10: 'bookID' parameter should be a string not a '${typeof noticeObject.bookID}'`);\r\n            console.assert(noticeObject.bookID.length === 3, `cBPs addNotice10: 'bookID' parameter should be three characters long not ${noticeObject.bookID.length}`);\r\n            console.assert(books.isValidBookID(noticeObject.bookID), `cBPs addNotice10: '${noticeObject.bookID}' is not a valid USFM book identifier`);\r\n        }\r\n        // console.assert(C !== undefined, \"cBPs addNotice10: 'C' parameter should be defined\");\r\n        if (noticeObject.C) console.assert(typeof noticeObject.C === 'string', `cBPs addNotice10: 'C' parameter should be a string not a '${typeof noticeObject.C}'`);\r\n        // console.assert(V !== undefined, \"cBPs addNotice10: 'V' parameter should be defined\");\r\n        if (noticeObject.V) console.assert(typeof noticeObject.V === 'string', `cBPs addNotice10: 'V' parameter should be a string not a '${typeof noticeObject.V}'`);\r\n        // console.assert(characterIndex !== undefined, \"cBPs addNotice10: 'characterIndex' parameter should be defined\");\r\n        if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cBPs addNotice10: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}'`);\r\n        // console.assert(extract !== undefined, \"cBPs addNotice10: 'extract' parameter should be defined\");\r\n        if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cBPs addNotice10: 'extract' parameter should be a string not a '${typeof noticeObject.extract}'`);\r\n        console.assert(noticeObject.location !== undefined, \"cBPs addNotice10: 'location' parameter should be defined\");\r\n        console.assert(typeof noticeObject.location === 'string', `cBPs addNotice10: 'location' parameter should be a string not a '${typeof noticeObject.location}'`);\r\n        console.assert(noticeObject.extra !== undefined, \"cBPs addNotice10: 'extra' parameter should be defined\");\r\n        console.assert(typeof noticeObject.extra === 'string', `cBPs addNotice10: 'extra' parameter should be a string not a '${typeof extra}'`);\r\n        checkBookPackagesResult.noticeList.push(noticeObject);\r\n    }\r\n\r\n\r\n    // Main code for checkBookPackages()\r\n    let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0, checkedRepoNames = new Set();\r\n    for (const bookID of bookIDList) {\r\n        // console.log(`checkBookPackages bookID: ${bookID}`);\r\n\r\n        // const generalLocation = ` ${languageCode} ${bookID} book packages from ${username}`;\r\n        if (bookID !== 'OBS') {\r\n          // eslint-disable-next-line no-unused-vars\r\n            let bookNumberAndName; //, whichTestament;\r\n            try {\r\n                bookNumberAndName = books.usfmNumberName(bookID);\r\n                // whichTestament = books.testament(bookID); // returns 'old' or 'new'\r\n            } catch (CBPsError) {\r\n                addNotice10({priority:900, message:\"Bad parameter: should be given a valid book abbreviation\",\r\n                                extract:bookIDList, location:` (not '${bookIDList}')`});\r\n                return checkBookPackagesResult;\r\n            }\r\n            // console.log(`bookNumberAndName='${bookNumberAndName}' (${whichTestament} testament)`);\r\n        }\r\n\r\n        // We use the generalLocation here (does not include repo name)\r\n        //  so that we can adjust the returned strings ourselves\r\n        const cbpResultObject = await checkBookPackage(username, languageCode, bookID, setResultValue, checkingOptions);\r\n        // console.log(`checkBookPackage() returned ${cbpResultObject.successList.length} success message(s) and ${cbpResultObject.noticeList.length} notice(s)`);\r\n\r\n        // Concat is faster if we don't need to process each success message individually\r\n        checkBookPackagesResult.successList = checkBookPackagesResult.successList.concat(cbpResultObject.successList);\r\n        // Process results line by line,  appending the repoCode/bookID as an extra field as we go\r\n        // for (const successEntry of cbpResultObject.successList) {\r\n        //     // console.log(\"  ourCheckBookPackage:\", successEntry);\r\n        //     addSuccessMessage(successEntry);\r\n        // }\r\n\r\n        // Concat is faster if we don't need to process each notice individually\r\n        checkBookPackagesResult.noticeList = checkBookPackagesResult.noticeList.concat(cbpResultObject.noticeList);\r\n        // for (const noticeEntry of cbpResultObject.noticeList)\r\n        //     // noticeEntry is an array of eight fields: 1=priority, 2=bookID, 3=C, 4=V, 5=msg, 6=characterIndex, 7=extract, 8=location\r\n        //     // The extra value from checkBookPackage is the repo name\r\n        //     addNotice10({noticeEntry.priority, noticeEntry[1], noticeEntry[2], noticeEntry[3], noticeEntry[4], noticeEntry[5], noticeEntry[6], noticeEntry[7], noticeEntry[5]);\r\n\r\n        checkedFileCount += cbpResultObject.checkedFileCount;\r\n        checkedFilenames = [...checkedFilenames, ...cbpResultObject.checkedFilenames];\r\n        checkedFilenameExtensions = new Set([...checkedFilenameExtensions, ...cbpResultObject.checkedFilenameExtensions]);\r\n        totalCheckedSize += cbpResultObject.checkedFilesizes;\r\n        checkedRepoNames = new Set([...checkedRepoNames, ...cbpResultObject.checkedRepoNames]);\r\n\r\n        // addSuccessMessage(`${checkedFileCount.toLocaleString()}/ Checked ${bookID} book package`);\r\n    }\r\n\r\n    // Add some extra fields to our checkFileResult object\r\n    //  in case we need this information again later\r\n    checkBookPackagesResult.checkedFileCount = checkedFileCount;\r\n    checkBookPackagesResult.checkedFilenames = checkedFilenames;\r\n    checkBookPackagesResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n    checkBookPackagesResult.checkedFilesizes = totalCheckedSize;\r\n    checkedRepoNames = [...checkedRepoNames]; // Convert set to Array\r\n    const index = checkedRepoNames.indexOf(`${username}/${languageCode}_obs`);\r\n    if (index !== -1) checkedRepoNames[index] = 'OBS'; // Looks tidier here\r\n    checkBookPackagesResult.checkedRepoNames = checkedRepoNames;\r\n    // checkBookPackagesResult.checkedOptions = checkingOptions; // This is done at the caller level\r\n\r\n    // console.log(\"checkBookPackages() is returning\", checkBookPackagesResult.successList.length.toLocaleString(), \"success message(s) and\", checkBookPackagesResult.noticeList.length.toLocaleString(), \"notice(s)\");\r\n    checkBookPackagesResult.elapsedSeconds = (new Date() - startTime) / 1000; // seconds\r\n    return checkBookPackagesResult;\r\n};\r\n// end of checkBookPackages()\r\n\r\nexport default checkBookPackages;\r\n","export * from './RepoCheck';\r\n","import React, { useState, useEffect } from 'react';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport { checkRepo } from '../../core';\r\nimport { processNoticesToErrorsWarnings, processNoticesToSevereMediumLow, processNoticesToSingleList } from '../notice-processing-functions';\r\nimport { RenderSuccessesErrorsWarnings, RenderSuccessesSevereMediumLow, RenderSuccessesWarningsGradient, RenderElapsedTime } from '../RenderProcessedResults';\r\nimport { ourParseInt } from '../../core/utilities';\r\n// import { consoleLogObject, displayPropertyNames } from '../../core/utilities';\r\n\r\n\r\n//const VALIDATOR_VERSION_STRING = '0.1.2';\r\n\r\n\r\nfunction RepoCheck(/*username, languageCode,*/ props) {\r\n    /*\r\n    Check an entire repository\r\n\r\n    Loads the zip file and the repo tree\r\n        and then checks all the individual files\r\n    */\r\n\r\n    // console.log(`I'm here in RepoCheck v${VALIDATOR_VERSION_STRING}`);\r\n    // consoleLogObject(\"props\", props);\r\n    // consoleLogObject(\"props.classes\", props.classes);\r\n\r\n    const username = props.username;\r\n    // console.log(`username='${username}'`);\r\n    const repoName = props.repoName;\r\n    // console.log(`repoName='${repoName}'`);\r\n    let branch = props.branch;\r\n    // console.log(`branch='${branch}'`);\r\n    if (branch === undefined) branch = 'master';\r\n\r\n    const languageCode = repoName.split('_', 1)[0];\r\n    // console.log(`languageCode='${languageCode}'`);\r\n\r\n    const checkingOptions = { // Uncomment any of these to test them\r\n        // 'extractLength': 25,\r\n    };\r\n    // Or this allows the parameters to be specified as a RepoCheck property\r\n    if (props.extractLength) checkingOptions.extractLength = ourParseInt(props.extractLength);\r\n\r\n    const [result, setResultValue] = useState(\"Waiting-checkRepo\");\r\n    useEffect(() => {\r\n        // console.log(\"RepoCheck.useEffect() called with \", JSON.stringify(props));\r\n\r\n        // Use an IIFE (Immediately Invoked Function Expression)\r\n        //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174\r\n        (async () => {\r\n            // console.log(\"Started RepoCheck.unnamedFunction()\");\r\n\r\n            // Display our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'magenta' }}>Checking <b>{repoName}</b> repo</p>);\r\n\r\n            // Put all this in a try/catch block coz otherwise it's difficult to debug/view errors\r\n            try {\r\n                let rawCRResults = {};\r\n                try {\r\n                    rawCRResults = await checkRepo(username, repoName, branch, \"\", setResultValue, checkingOptions);\r\n                } catch (checkRepoError) {\r\n                    rawCRResults = { successList: [], noticeList: [] };\r\n                    rawCRResults.noticeList.push({priority:999, message:\"checkRepo function FAILED\", repoName, extract:checkRepoError, location:repoName});\r\n                }\r\n                // console.log(\"checkRepo() returned\", typeof rawCRResults); //, JSON.stringify(rawCRResults));\r\n\r\n                // Add some extra fields to our rawCRResults object in case we need this information again later\r\n                rawCRResults.checkType = 'Repo';\r\n                rawCRResults.username = username;\r\n                rawCRResults.languageCode = languageCode;\r\n                rawCRResults.checkedOptions = checkingOptions;\r\n\r\n                // console.log(\"Here with RC rawCRResults\", typeof rawCRResults);\r\n                // Now do our final handling of the result -- we have some options available\r\n                let processOptions = { // Uncomment any of these to test them\r\n                    // 'maximumSimilarMessages': 4, // default is 3 -- 0 means don't suppress\r\n                    // 'errorPriorityLevel': 800, // default is 700\r\n                    // 'cutoffPriorityLevel': 100, // default is 0\r\n                    // 'sortBy': 'ByPriority', // default is 'AsFound'\r\n                    // 'ignorePriorityNumberList': [123, 202], // default is []\r\n                };\r\n                // Or this allows the parameters to be specified as a RepoCheck property\r\n                if (props.maximumSimilarMessages) processOptions.maximumSimilarMessages = ourParseInt(props.maximumSimilarMessages);\r\n                if (props.errorPriorityLevel) processOptions.errorPriorityLevel = ourParseInt(props.errorPriorityLevel);\r\n                if (props.cutoffPriorityLevel) processOptions.cutoffPriorityLevel = ourParseInt(props.cutoffPriorityLevel);\r\n                if (props.sortBy) processOptions.sortBy = props.sortBy;\r\n                // if (props.ignorePriorityNumberList) processOptions.ignorePriorityNumberList = props.ignorePriorityNumberList;\r\n\r\n                let displayType = 'ErrorsWarnings'; // default\r\n                if (props.displayType) displayType = props.displayType;\r\n\r\n                function renderSummary(processedResults) {\r\n                    return (<div>\r\n                        <p>Checked <b>{username} {repoName}</b> (from <i>{branch === undefined ? 'DEFAULT' : branch}</i> branch)</p>\r\n                        <p>&nbsp;&nbsp;&nbsp;&nbsp;Successfully checked {processedResults.checkedFileCount.toLocaleString()} file{processedResults.checkedFileCount === 1 ? '' : 's'} from {repoName}: {processedResults.checkedFilenames.join(', ')}\r\n                            <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;including {processedResults.checkedFilenameExtensions.length} file type{processedResults.checkedFilenameExtensions.size === 1 ? '' : 's'}: {processedResults.checkedFilenameExtensions.join(', ')}.</p>\r\n                        <p>&nbsp;&nbsp;&nbsp;&nbsp;Finished in <RenderElapsedTime elapsedSeconds={processedResults.elapsedSeconds} /> with {rawCRResults.noticeList.length===0?'no':rawCRResults.noticeList.length} notice{rawCRResults.noticeList.length===1?'':'s'}.</p>\r\n                        {/* <RenderRawResults results={rawCRResults} /> */}\r\n                    </div>);\r\n                }\r\n\r\n                if (displayType === 'ErrorsWarnings') {\r\n                    const processedResults = processNoticesToErrorsWarnings(rawCRResults, processOptions);\r\n                    // displayPropertyNames(\"RC processedResults\", processedResults);\r\n                    //             console.log(`RepoCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n                    //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, \"numSuppressedErrors=\" + processedResults.numSuppressedErrors.toLocaleString(), \"numSuppressedWarnings=\" + processedResults.numSuppressedWarnings.toLocaleString());\r\n\r\n                    // console.log(\"Here now in rendering bit!\");\r\n\r\n                    if (processedResults.errorList.length || processedResults.warningList.length)\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n                            <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                        </>);\r\n                    else // no errors or warnings\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n                            <RenderSuccessesErrorsWarnings results={processedResults} />\r\n                        </>);\r\n                } else if (displayType === 'SevereMediumLow') {\r\n                    const processedResults = processNoticesToSevereMediumLow(rawCRResults, processOptions);\r\n                    //             console.log(`RepoCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n                    //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, \"numSuppressedErrors=\" + processedResults.numSuppressedErrors.toLocaleString(), \"numSuppressedWarnings=\" + processedResults.numSuppressedWarnings.toLocaleString());\r\n\r\n                    if (processedResults.severeList.length || processedResults.mediumList.length || processedResults.lowList.length)\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n                            <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                        </>);\r\n                    else // no severe, medium, or low notices\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n                            <RenderSuccessesSevereMediumLow results={processedResults} />\r\n                        </>);\r\n                } else if (displayType === 'SingleList') {\r\n                    const processedResults = processNoticesToSingleList(rawCRResults, processOptions);\r\n                    //             console.log(`RepoCheck got back processedResults with ${processedResults.successList.length.toLocaleString()} success message(s), ${processedResults.errorList.length.toLocaleString()} error(s) and ${processedResults.warningList.length.toLocaleString()} warning(s)\r\n                    //   numIgnoredNotices=${processedResults.numIgnoredNotices.toLocaleString()}`, \"numSuppressedErrors=\" + processedResults.numSuppressedErrors.toLocaleString(), \"numSuppressedWarnings=\" + processedResults.numSuppressedWarnings.toLocaleString());\r\n\r\n                    if (processedResults.warningList.length)\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (but ${processedResults.numIgnoredNotices.toLocaleString()} ignored errors/warnings)` : \"\"}</div>\r\n                            <RenderSuccessesWarningsGradient results={processedResults} />\r\n                        </>);\r\n                    else // no warnings\r\n                        setResultValue(<>\r\n                            <div>{renderSummary(processedResults)}\r\n                                {processedResults.numIgnoredNotices ? ` (with a total of ${processedResults.numIgnoredNotices.toLocaleString()} notices ignored)` : \"\"}</div>\r\n                            <RenderSuccessesWarningsGradient results={processedResults} />\r\n                        </>);\r\n                } else setResultValue(<b style={{ color: 'red' }}>Invalid displayType='{displayType}'</b>)\r\n\r\n                // console.log(\"Finished rendering bit.\");\r\n            } catch (rcError) {\r\n                console.log(`RepoCheck main code block got error: ${rcError.message}`);\r\n                setResultValue(<>\r\n                    <p style={{ color: 'Red' }}>RepoCheck main code block got error: <b>{rcError.message}</b></p>\r\n                </>);\r\n            }\r\n        })(); // end of async part in unnamedFunction\r\n    // Doesn't work if we add this to next line: languageCode,username,repoName,branch,checkingOptions,props\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []); // end of useEffect part\r\n\r\n    // {/* <div className={classes.root}> */}\r\n    return (\r\n        <div className=\"Fred\">\r\n            {result}\r\n        </div>\r\n    );\r\n}\r\n\r\n// RepoCheck.propTypes = {\r\n//   /** @ignore */\r\n//   username: PropTypes.object.isRequired,\r\n//   /** @ignore */\r\n//   languageCode: PropTypes.object.isRequired,\r\n//   props: PropTypes.object,\r\n// };\r\n\r\nconst styles = theme => ({\r\n    root: {\r\n    },\r\n});\r\n\r\nexport default withStyles(styles)(RepoCheck);\r\n","module.exports = __webpack_public_path__ + \"static/media/SILEOTSR.a5284649.ttf\";","import data from './books.json';\r\n\r\nexport interface bookDataIF {\r\n  \"id\": string;\r\n  \"title\": string;\r\n  \"usfm\": string;\r\n  \"testament\": string;\r\n  \"verseCount\": number;\r\n  \"chapters\": number[];\r\n}\r\n\r\ninterface bpStateIF { [x: string]: boolean[]; };\r\n\r\nexport const chaptersInBook = (bookId: string) => {\r\n    let chapters: number[];\r\n    chapters = bookData(bookId).chapters;\r\n    if ( chapters === undefined ) {\r\n      throw new Error(\"Error: chaptersInBook(): Invalid bookId\");\r\n    }\r\n    return chapters;\r\n};\r\n\r\nexport const versesInChapter = (bookId: string, chapter: number) => {\r\n  const verses = chaptersInBook(bookId)[chapter - 1];\r\n  return verses;\r\n};\r\n\r\nexport const bookData = (bookId: string) => {\r\n  const _bookData: bookDataIF = data.filter(row => row.id === bookId)[0];\r\n  return _bookData;\r\n};\r\n\r\nexport const testament = (bookId: string) => {\r\n  const _testament = bookData(bookId).testament;\r\n  return _testament;\r\n};\r\n\r\nexport const newTestament = () => {\r\n  let list: string[] = [];\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].testament === \"new\" ) {\r\n      list.push( data[i].title )\r\n    }\r\n  }\r\n  return list;\r\n}\r\n\r\nexport const oldTestament = () => {\r\n  let list: string[] = [];\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].testament === \"old\" ) {\r\n      list.push( data[i].title )\r\n    }\r\n  }\r\n  return list;\r\n}\r\n\r\nexport const bookDataTitles = () => {\r\n  let list: string[] = [];\r\n  for (let i=0; i < data.length; i++) {\r\n      list.push( data[i].title )\r\n  }\r\n  return list;\r\n}\r\n\r\nexport const titlesToBoolean = () => {\r\n  let ob: bpStateIF = {};\r\n  let list = bookDataTitles();\r\n  list.forEach((v,k) => {ob[v]= [false,false]});\r\n  return ob;\r\n}\r\n\r\nexport const bookIdByTitle = (title: string) => {\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].title === title ) {\r\n      return data[i].id;\r\n    }\r\n  }\r\n  return \"\";\r\n}\r\n\r\nexport const bookTitleById = (id: string) => {\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].id === id ) {\r\n      return data[i].title;\r\n    }\r\n  }\r\n  return \"\";\r\n}\r\n\r\nconst extraBookList = ['FRT','BAK'];\r\n\r\nexport const isOptionalValidBookID = (bookId: string) => {\r\n  return !bookId || bookId.toLowerCase() in data || extraBookList.indexOf(bookId) >= 0;\r\n}\r\nexport const isValidBookID = (id: string) => {\r\n  const _id = id.toLowerCase();\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].id === _id ) {\r\n      return true;\r\n    }\r\n  }\r\n  const __id = id.toUpperCase();\r\n  for (let i=0; i < extraBookList.length; i++) {\r\n    if ( extraBookList[i] === __id ) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\nexport const usfmNumberNameById = (id: string) => {\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].id === id ) {\r\n      return data[i].usfm;\r\n    }\r\n  }\r\n  throw new Error(`usfmNumberName() given invalid bookId: '${id}'`);\r\n}\r\n\r\n","import Path from 'path';\r\n// import YAML from 'js-yaml-parser';\r\nimport localforage from 'localforage';\r\nimport { setup } from 'axios-cache-adapter';\r\nimport JSZip from 'jszip';\r\nimport * as books from './books';\r\n// import { consoleLogObject } from '../core/utilities';\r\n\r\n\r\nconst baseURL = 'https://git.door43.org/';\r\nconst apiPath = 'api/v1';\r\n\r\n\r\nconst failedStore = localforage.createInstance({\r\n  driver: [localforage.INDEXEDDB],\r\n  name: 'failed-store',\r\n});\r\n\r\nconst zipStore = localforage.createInstance({\r\n  driver: [localforage.INDEXEDDB],\r\n  name: 'zip-store',\r\n});\r\n\r\nconst cacheStore = localforage.createInstance({\r\n  driver: [localforage.INDEXEDDB],\r\n  name: 'web-cache',\r\n});\r\n\r\nconst Door43Api = setup({\r\n  baseURL: baseURL,\r\n  cache: {\r\n    store: cacheStore,\r\n    maxAge: 5 * 60 * 1000, // 5-minutes\r\n    exclude: { query: false },\r\n    key: req => {\r\n      // if (req.params) debugger\r\n      let serialized = req.params instanceof URLSearchParams ?\r\n        req.params.toString() : JSON.stringify(req.params) || '';\r\n      return req.url + serialized;\r\n    },\r\n  },\r\n});\r\n\r\n\r\nlet cachedUnzippedFiles = {};\r\n\r\n/**\r\n * adds caching of uncompressed files, calls getFile() if file is not cached\r\n * @param {String} username\r\n * @param {String} repository\r\n * @param {String} path\r\n * @param {String} branch\r\n * @return {Promise<*>}\r\n */\r\n// This is the function that we call the most from the outside\r\nexport async function getFileCached({ username, repository, path, branch }) {\r\n  const filePath = Path.join(username, repository, path, branch);\r\n  // console.log(`getFileCached(${username}, ${repository}, ${path}, ${branch})`);\r\n  if (cachedUnzippedFiles[filePath]) {\r\n    // console.log(`in cache - ${filePath}`);\r\n    return cachedUnzippedFiles[filePath];\r\n  }\r\n\r\n  let file = await getFile({ username, repository, path, branch });\r\n\r\n  if (file) {\r\n    cachedUnzippedFiles[filePath] = file;\r\n    // console.log(`saving to cache - ${filePath}`);\r\n  }\r\n\r\n  return file;\r\n}\r\n\r\n\r\nexport async function clearCaches() {\r\n  console.log(\"Clearing localforage.INDEXEDDB zipStore and cacheStore caches\");\r\n  // const tasks = [zipStore, cacheStore].map(localforage.clear);\r\n  // const results = await Promise.all(tasks);\r\n  // results.forEach(x => console.log(\"Done it\", x));\r\n  await failedStore.clear();\r\n  await zipStore.clear();\r\n  await cacheStore.clear();\r\n  cachedUnzippedFiles = {};\r\n}\r\n\r\n\r\nexport function getRepoName(languageCode, repoCode) {\r\n  /**\r\n  * @description - Creates and returns a Door43 repoName string\r\n  * @param {String} languageCode - the language code, e.g., 'en'\r\n  * @param {String} repoCode - the repo code, e.g., 'TQ'\r\n  * @return {String} - the Door43 repoName string\r\n  */\r\n//    console.log(`getRepoName('${languageCode}', '${repoCode}')`);\r\n let repo_languageCode = languageCode;\r\n  if (repoCode === 'UHB') repo_languageCode = 'hbo';\r\n  else if (repoCode === 'UGNT') repo_languageCode = 'el-x-koine';\r\n  const repoName = `${repo_languageCode}_${repoCode.toLowerCase()}`;\r\n  return repoName;\r\n}\r\n\r\n\r\n/**\r\n * clears the caches of stale data and preloads repo zips, before running book package checks\r\n *   this allows the calling app to clear cache and start loading repos in the backgound as soon as it starts up.  In this case it would not need to use await to wait for results.\r\n *   TRICKY: note that even if the user is super fast in selecting books and clicking next, it will not hurt anything.  getFile() would just be fetching files directly from repo until the zips are loaded.  After that the files would be pulled out of zipStore.\r\n * @param {string} username\r\n * @param {string} languageCode\r\n * @param {Array} bookIDList - one or more books that will be checked\r\n * @param {string} branch - optional, defaults to master\r\n * @param {Array} repos - optional, list of repos to pre-load\r\n * @return {Promise<Boolean>} resolves to true if file loads are successful\r\n */\r\n// TEMP: Removed TQ from default repos\r\nexport async function clearCacheAndPreloadRepos(username, languageCode, bookIDList, branch = 'master', repos = ['TA', 'TW']) {\r\n  console.log(`clearCacheAndPreloadRepos(${username}, ${languageCode}, ${bookIDList}, ${branch}, ${repos})`);\r\n  clearCaches(); // clear existing cached files so we know we have the latest\r\n  let success = true;\r\n  const repos_ = [...repos];\r\n\r\n  if (bookIDList && Array.isArray(bookIDList)) {\r\n    // make sure we have the original languages needed\r\n    for (const bookID of bookIDList) {\r\n      if (bookID !== 'OBS') {\r\n        const whichTestament = books.testament(bookID); // returns 'old' or 'new'\r\n        const origLang = whichTestament === 'old' ? 'UHB' : 'UGNT';\r\n        if (!repos_.includes(origLang))\r\n          repos_.unshift(origLang);\r\n      }\r\n    }\r\n  }\r\n\r\n  // load all the repos need\r\n  for (const repoCode of repos_) {\r\n    const repoName = getRepoName(languageCode, repoCode);\r\n    console.log(`clearCacheAndPreloadRepos: preloading zip file for ${repoName}`);\r\n    const zipFetchSucceeded = await fetchRepositoryZipFile({ username, repository: repoName, branch });\r\n    if (!zipFetchSucceeded) {\r\n      console.log(`clearCacheAndPreloadRepos: misfetched zip file for ${repoCode} repo with ${zipFetchSucceeded}`);\r\n      success = false;\r\n    }\r\n  }\r\n\r\n  return success;\r\n}\r\n\r\n\r\nasync function fetchFileFromServer({ username, repository, path, branch = 'master' }) {\r\n  // console.log(`fetchFileFromServer(${username}, ${repository}, ${path}, ${branch})`);\r\n  const repoExists = await repositoryExists({ username, repository });\r\n  let uri;\r\n  if (repoExists) {\r\n    uri = Path.join(username, repository, 'raw/branch', branch, path);\r\n    const failMessage = await failedStore.getItem(uri);\r\n    if (failMessage) {\r\n      // console.log(`fetchFileFromServer failed previously for ${uri}: ${failMessage}`);\r\n      return null;\r\n    }\r\n    try {\r\n      // console.log(\"URI=\",uri);\r\n      const data = await cachedGet({ uri });\r\n      // console.log(\"Got data\", data);\r\n      return data;\r\n    }\r\n    catch (fffsError) {\r\n      console.log(`ERROR: fetchFileFromServer could not fetch ${path}: ${fffsError}`)\r\n      /* await */ failedStore.setItem(uri, fffsError.message);\r\n      return null;\r\n    }\r\n  } else {\r\n    console.log(`ERROR: fetchFileFromServer repo '${repository}' does not exist!`);\r\n    /* await */ failedStore.setItem(uri, `Repo '${repository}' does not exist!`);\r\n    return null;\r\n  }\r\n};\r\n\r\n\r\nasync function getFile({ username, repository, path, branch }) {\r\n  console.log(`getFile(${username}, ${repository}, ${path}, ${branch})`);\r\n  let file;\r\n  file = await getFileFromZip({ username, repository, path, branch });\r\n  if (!file) {\r\n    file = await fetchFileFromServer({ username, repository, path, branch });\r\n  }\r\n  return file;\r\n}\r\n\r\n\r\nasync function getUID({ username }) {\r\n  // console.log(`getUID(${username})`);\r\n  const uri = Path.join(apiPath, 'users', username);\r\n  // console.log(`getUID uri=${uri}`);\r\n  const user = await cachedGet({ uri });\r\n  // console.log(`getUID user=${user}`);\r\n  const { id: uid } = user;\r\n  // console.log(`  getUID returning: ${uid}`);\r\n  return uid;\r\n}\r\nasync function repositoryExists({ username, repository }) {\r\n  // console.log(`repositoryExists(${username}, ${repository})`);\r\n  const uid = await getUID({ username });\r\n  // console.log(`repositoryExists uid=${uid}`);\r\n  // Default limit is 10 -- way too small\r\n  const params = { q: repository, limit: 500, uid }; // Documentation says limit is 50, but larger numbers seem to work ok\r\n  // console.log(`repositoryExists params=${JSON.stringify(params)}`);\r\n  const uri = Path.join(apiPath, 'repos', `search`);\r\n  // console.log(`repositoryExists uri=${uri}`);\r\n  const { data: repos } = await cachedGet({ uri, params });\r\n  // console.log(`repositoryExists repos (${repos.length})=${repos}`);\r\n  // for (const thisRepo of repos) console.log(`  thisRepo (${JSON.stringify(Object.keys(thisRepo))}) =${JSON.stringify(thisRepo.name)}`);\r\n  const repo = repos.filter(repo => repo.name === repository)[0];\r\n  // console.log(`repositoryExists repo=${repo}`);\r\n  // console.log(`  repositoryExists returning: ${!!repo}`);\r\n  return !!repo;\r\n};\r\n\r\n\r\nasync function cachedGet({ uri, params }) {\r\n  // console.log(`cachedGet(${uri}, ${JSON.stringify(params)})`);\r\n  // console.log(`  get querying: ${baseURL+uri}`);\r\n  const { data } = await Door43Api.get(baseURL + uri, { params });\r\n  // console.log(`  cachedGet returning: ${JSON.stringify(data)}`);\r\n  return data;\r\n};\r\n\r\nexport async function cachedGetURL({ uri, params }) {\r\n  // console.log(`cachedGetURL(${uri}, ${params})`);\r\n  const { data } = await Door43Api.get(uri, { params });\r\n  // console.log(`  cachedGetURL returning: ${data}`);\r\n  return data;\r\n};\r\n\r\n\r\n/*\r\nfunction fetchRepositoriesZipFiles({username, languageId, branch}) {\r\n  const repositories = resourceRepositories({languageId});\r\n  const promises = Object.values(repositories).map(repository => {\r\n    return fetchRepositoryZipFile({username, repository, branch});\r\n  });\r\n  const zipArray = await Promise.all(promises);\r\n  return zipArray;\r\n};\r\n*/\r\n\r\n\r\n// https://git.door43.org/{username}/{repository}/archive/{branch}.zip\r\nexport async function fetchRepositoryZipFile({ username, repository, branch }) {\r\n  console.log(`fetchRepositoryZipFile(${username}, ${repository}, ${branch})`);\r\n  const repoExists = await repositoryExists({ username, repository });\r\n  if (!repoExists) {\r\n    return null;\r\n  }\r\n  const uri = zipUri({ username, repository, branch });\r\n  const response = await fetch(uri);\r\n  if (response.status === 200 || response.status === 0) {\r\n    const zipArrayBuffer = await response.arrayBuffer(); // blob storage not supported on mobile\r\n    await zipStore.setItem(uri, zipArrayBuffer);\r\n    return true;\r\n  } else {\r\n    console.log(`ERROR: fetchRepositoryZipFile got response status: ${response.status}`);\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\nexport async function getFilelistFromZip({ username, repository, branch, optionalPrefix }) {\r\n  // console.log(`getFilelistFromZip(${username}, ${repository}, ${branch}, ${optionalPrefix})`);\r\n\r\n  const uri = zipUri({ username, repository, branch });\r\n  let zipBlob = await zipStore.getItem(uri);\r\n\r\n  if (!zipBlob) { // Seems that we need to load the zip file first\r\n    const response = await fetch(uri);\r\n    if (response.status === 200 || response.status === 0) {\r\n      const zipArrayBuffer = await response.arrayBuffer(); // blob storage not supported on mobile\r\n      zipBlob = await zipStore.setItem(uri, zipArrayBuffer);\r\n    } else {\r\n      console.log(`ERROR: getFilelistFromZip got response status: ${response.status}`);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  const pathList = [];\r\n  try {\r\n    if (zipBlob) {\r\n      // console.log(`  Got zipBlob for uri=${uri}`);\r\n      const zip = await JSZip.loadAsync(zipBlob);\r\n      // console.log(`  Got zip`);\r\n      // Now we need to fetch the list of files from the repo\r\n      // zip.forEach(function (relativePath, fileObject) {\r\n      zip.forEach(function (relativePath) {\r\n        // console.log(`relPath=${relativePath}`)\r\n        // consoleLogObject('fileObject', fileObject);\r\n        if (!relativePath.endsWith('/')) // it's not a folder\r\n        {\r\n          if (relativePath.startsWith(`${repository}/`)) // remove repo name prefix\r\n            relativePath = relativePath.substring(repository.length + 1);\r\n          if (relativePath.length\r\n            && !relativePath.startsWith('.git') // skips files in these folders\r\n            && !relativePath.startsWith('.apps') // skips files in this folder\r\n            && (!optionalPrefix || relativePath.startsWith(optionalPrefix))) // it's the correct prefix\r\n            pathList.push(relativePath);\r\n        }\r\n      })\r\n    }\r\n    // else console.log(\"  getFilelistFromZip: No zipBlob\");\r\n  } catch (error) {\r\n    console.log(`ERROR: getFilelistFromZip got: ${error.message}`);\r\n  }\r\n\r\n  // console.log(`getFilelistFromZip is returning (${pathList.length}) entries: ${pathList}`);\r\n  return pathList;\r\n}\r\n\r\n\r\nasync function getFileFromZip({ username, repository, path, branch }) {\r\n  // console.log(`getFileFromZip(${username}, ${repository}, ${path}, ${branch})`);\r\n  let file;\r\n  const uri = zipUri({ username, repository, branch });\r\n  const zipBlob = await zipStore.getItem(uri);\r\n  try {\r\n    if (zipBlob) {\r\n      // console.log(`  Got zipBlob for uri=${uri}`);\r\n      const zip = await JSZip.loadAsync(zipBlob);\r\n      const zipPath = Path.join(repository.toLowerCase(), path);\r\n      // console.log(`  zipPath=${zipPath}`);\r\n      file = await zip.file(zipPath).async('string');\r\n      // console.log(`    Got zipBlob ${file.length} bytes`);\r\n    }\r\n    // else console.log(\"  No zipBlob\");\r\n  } catch (error) {\r\n    console.log(`ERROR: getFileFromZip for ${username} ${repository} ${path} ${branch} got: ${error.message}`);\r\n    file = null;\r\n  }\r\n  return file;\r\n};\r\n\r\n\r\nexport function zipUri({ username, repository, branch = 'master' }) {\r\n  // console.log(`zipUri(${username}, ${repository}, ${branch})`);\r\n  const zipPath = Path.join(username, repository, 'archive', `${branch}.zip`);\r\n  const zipUri = baseURL + zipPath;\r\n  return zipUri;\r\n};\r\n\r\n\r\nexport async function fetchTree({ username, repository, sha = 'master' }) {\r\n  // console.log(`fetchTree(${username}, ${repository}, ${sha})`);\r\n  let data;\r\n  try {\r\n    const uri = Path.join('api/v1/repos', username, repository, 'git/trees', sha);\r\n    // console.log(`  uri='${uri}'`);\r\n    data = await cachedGet({ uri });\r\n    // console.log(`  data (${typeof data})`);\r\n    return data;\r\n    // const tree = JSON.parse(data); // RJH: Why was this here???\r\n    // console.log(`  tree (${typeof tree})`);\r\n    // return tree;\r\n  } catch (error) {\r\n    console.log(`ERROR: fetchTree got: ${error.message}`);\r\n    console.log(`  Data was: ${JSON.stringify(data)}`);\r\n    return null;\r\n  }\r\n};\r\n\r\n\r\n/*\r\nasync function recursiveTree({username, repository, path, sha}) {\r\n  console.log(\"recurse tree args:\",username,repository,path,sha)\r\n  let tree = {};\r\n  const pathArray = path.split();\r\n  const results = fetchTree({username, repository, sha});\r\n  const result = results.tree.filter(item => item.path === pathArray[0])[0];\r\n  if (result) {\r\n    if (result.type === 'tree') {\r\n      const childPath = pathArray.slice(1).join('/');\r\n      const children = recursiveTree({username, repository, path: childPath, sha: result.sha});\r\n      tree[result.path] = children;\r\n    } else if (result.type === 'blob') {\r\n      tree[result.path] = true;\r\n    }\r\n  }\r\n};\r\n\r\nasync function fileExists({username, repository, path, branch}) {\r\n  // get root listing\r\n  recursiveTree()\r\n  // get recursive path listing\r\n}\r\n*/\r\n","import React from 'react';\r\nimport * as books from './books';\r\nimport { getRepoName, getFilelistFromZip, getFileCached, fetchRepositoryZipFile } from './getApi'; \r\n/*\r\nimport * as cv from 'uw-content-validation';\r\nimport checkUSFMText from 'uw-content-validation';\r\nimport checkMarkdownText from 'uw-content-validation';\r\nimport checkPlainText from 'uw-content-validation';\r\nimport checkYAMLText from 'uw-content-validation';\r\nimport checkManifestText from 'uw-content-validation';\r\nimport checkTN_TSVText from 'uw-content-validation';\r\n*/\r\nimport {checkManifestText, checkMarkdownText, checkPlainText, checkTN_TSVText, checkUSFMText, checkYAMLText} from 'uw-content-validation';\r\n\r\n/*\r\n    checkRepo\r\n*/\r\nexport async function checkRepo(username, repoName, branch, givenLocation, setResultValue, checkingOptions) {\r\n  /*\r\n  checkRepo DOES NOT USE the Gitea React Toolkit to fetch the repo\r\n\r\n  It returns an object containing:\r\n      successList: an array of strings to tell the use exactly what has been checked\r\n      noticeList: an array of 9 (i.e., with extra bookOrFileCode parameter at end) notice components\r\n  */\r\n  // console.log(`I'm here in checkRepo\r\n  //   with ${username}, ${repoName}, ${branch}, ${givenLocation}, ${JSON.stringify(checkingOptions)}`);\r\n  const startTime = new Date();\r\n\r\n  const languageCode = repoName.split('_')[0];\r\n  // console.log(\"checkRepo languageCode\", languageCode);\r\n\r\n  if (branch === undefined) branch = 'master'; // Ideally we should ask what the default branch is\r\n\r\n  let checkRepoResult = {\r\n    successList: [], noticeList: [],\r\n    checkedFileCount: 0, checkedFilenames: [], checkedFilenameExtensions: []\r\n  };\r\n\r\n  function addSuccessMessage(successString) {\r\n    // Adds the message to the result that we will later return\r\n    // console.log(`checkRepo success: ${successString}`);\r\n    checkRepoResult.successList.push(successString);\r\n  }\r\n  function addNotice10(noticeObject) {\r\n    // Adds the notices to the result that we will later return\r\n    // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n    // Note that bookID,C,V might all be empty strings (as some repos don't have BCV)\r\n    // console.log(`checkRepo addNotice10: ${noticeObject.priority}:${noticeObject.message} ${noticeObject.bookID} ${noticeObject.C}:${noticeObject.V} ${noticeObject.filename}:${noticeObject.lineNumber} ${noticeObject.characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${noticeObject.extract ? ` ${noticeObject.extract}` : \"\"}${noticeObject.location}`);\r\n    console.assert(noticeObject.priority !== undefined, \"cR addNotice10: 'priority' parameter should be defined\");\r\n    console.assert(typeof noticeObject.priority === 'number', `cR addNotice10: 'priority' parameter should be a number not a '${typeof noticeObject.priority}'`);\r\n    console.assert(noticeObject.message !== undefined, \"cR addNotice10: 'message' parameter should be defined\");\r\n    console.assert(typeof noticeObject.message === 'string', `cR addNotice10: 'message' parameter should be a string not a '${typeof noticeObject.message}'`);\r\n    // console.assert(bookID !== undefined, \"cR addNotice10: 'bookID' parameter should be defined\");\r\n    if (noticeObject.bookID) {\r\n      console.assert(typeof noticeObject.bookID === 'string', `cR addNotice10: 'bookID' parameter should be a string not a '${typeof noticeObject.bookID}'`);\r\n      console.assert(noticeObject.bookID.length === 3, `cR addNotice10: 'bookID' parameter should be three characters long not ${noticeObject.bookID.length}`);\r\n      console.assert(books.isOptionalValidBookID(noticeObject.bookID), `cR addNotice10: '${noticeObject.bookID}' is not a valid USFM book identifier`);\r\n    }\r\n    // console.assert(C !== undefined, \"cR addNotice10: 'C' parameter should be defined\");\r\n    if (noticeObject.C) console.assert(typeof noticeObject.C === 'string', `cR addNotice10: 'C' parameter should be a string not a '${typeof noticeObject.C}'`);\r\n    // console.assert(V !== undefined, \"cR addNotice10: 'V' parameter should be defined\");\r\n    if (noticeObject.V) console.assert(typeof noticeObject.V === 'string', `cR addNotice10: 'V' parameter should be a string not a '${typeof noticeObject.V}'`);\r\n    // console.assert(characterIndex !== undefined, \"cR addNotice10: 'characterIndex' parameter should be defined\");\r\n    if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cR addNotice10: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}'`);\r\n    // console.assert(extract !== undefined, \"cR addNotice10: 'extract' parameter should be defined\");\r\n    if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cR addNotice10: 'extract' parameter should be a string not a '${typeof noticeObject.extract}'`);\r\n    console.assert(noticeObject.location !== undefined, \"cR addNotice10: 'location' parameter should be defined\");\r\n    console.assert(typeof noticeObject.location === 'string', `cR addNotice10: 'location' parameter should be a string not a '${typeof noticeObject.location}'`);\r\n    console.assert(noticeObject.extra !== undefined, \"cR addNotice10: 'extra' parameter should be defined\");\r\n    console.assert(typeof noticeObject.extra === 'string', `cR addNotice10: 'extra' parameter should be a string not a '${typeof noticeObject.extra}'`);\r\n    // Add in the repoName from the outer scope\r\n    checkRepoResult.noticeList.push({ ...noticeObject, repoName });\r\n  }\r\n\r\n\r\n  async function ourCheckFileContents(bookOrFileCode, cfBookID, filename, file_content, fileLocation, optionalCheckingOptions) {\r\n    // We assume that checking for compulsory fields is done elsewhere\r\n    // console.log(`checkRepo ourCheckFileContents(${filename})`);\r\n\r\n    // Updates the global list of notices\r\n    console.assert(bookOrFileCode !== undefined, \"ourCheckFileContents: 'bookOrFileCode' parameter should be defined\");\r\n    console.assert(typeof bookOrFileCode === 'string', `ourCheckFileContents: 'bookOrFileCode' parameter should be a string not a '${typeof bookOrFileCode}'`);\r\n    console.assert(cfBookID !== undefined, \"ourCheckFileContents: 'cfBookID' parameter should be defined\");\r\n    console.assert(typeof cfBookID === 'string', `ourCheckFileContents: 'cfBookID' parameter should be a string not a '${typeof cfBookID}'`);\r\n    console.assert(filename !== undefined, \"ourCheckFileContents: 'filename' parameter should be defined\");\r\n    console.assert(typeof filename === 'string', `ourCheckFileContents: 'filename' parameter should be a string not a '${typeof filename}'`);\r\n    console.assert(file_content !== undefined, \"ourCheckFileContents: 'file_content' parameter should be defined\");\r\n    console.assert(typeof file_content === 'string', `ourCheckFileContents: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n    console.assert(fileLocation !== undefined, \"ourCheckFileContents: 'fileLocation' parameter should be defined\");\r\n    console.assert(typeof fileLocation === 'string', `ourCheckFileContents: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n    const cfcResultObject = await checkFileContents(languageCode, filename, file_content, fileLocation, optionalCheckingOptions);\r\n    // console.log(\"checkFileContents() returned\", resultObject.successList.length, \"success message(s) and\", resultObject.noticeList.length, \"notice(s)\");\r\n    // for (const successEntry of resultObject.successList)\r\n    //     console.log(\"  \", successEntry);\r\n\r\n    // Process results line by line,  appending the bookOrFileCode as an extra field as we go\r\n    for (const cfcNoticeEntry of cfcResultObject.noticeList)\r\n      // We add the bookOrFileCode as an extra value\r\n      addNotice10({ ...cfcNoticeEntry, bookID: cfBookID, extra: bookOrFileCode });\r\n  }\r\n  // end of ourCheckFileContents function\r\n\r\n\r\n  // Main code for checkRepo()\r\n  // Put all this in a try/catch block coz otherwise it's difficult to debug/view errors\r\n  try {\r\n    let ourLocation = givenLocation;\r\n    if (ourLocation && ourLocation[0] !== ' ') ourLocation = ` ${ourLocation}`;\r\n    // if (ourLocation.indexOf(username) < 0)\r\n    // ourLocation = ` in ${username} ${repoName} ${givenLocation}`\r\n\r\n    // Update our \"waiting\" message\r\n    setResultValue(<p style={{ color: 'magenta' }}>Fetching zipped files from <b>{username}/{repoName}</b> repository</p>);\r\n\r\n    // Let's fetch the zipped repo since it should be much more efficient than individual fetches\r\n    // console.log(`checkRepo: fetch zip file for ${repoName}`);\r\n    const zipFetchSucceeded = await fetchRepositoryZipFile({ username, repository: repoName, branch });\r\n    if (!zipFetchSucceeded)\r\n      console.log(`checkRepo: misfetched zip file for repo with ${zipFetchSucceeded}`);\r\n    if (!zipFetchSucceeded) return checkRepoResult;\r\n    // Note: We don't stop for failure coz the code below will still work (fetching each file individually)\r\n\r\n    // Now we need to fetch the list of files from the repo\r\n    setResultValue(<p style={{ color: 'magenta' }}>Preprocessing file list from <b>{username}/{repoName}</b> repository</p>);\r\n    // const pathList = await getFilelistFromFetchedTreemaps(username, repoName, branch);\r\n    const pathList = await getFilelistFromZip({ username, repository: repoName, branch });\r\n    // console.log(`Got pathlist (${pathList.length}) = ${pathList}`);\r\n\r\n    // So now we want to work through checking all the files in this repo\r\n    const countString = `${pathList.length.toLocaleString()} file${pathList.length === 1 ? '' : 's'}`;\r\n    let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0;\r\n    for (const thisFilepath of pathList) {\r\n      // console.log(`At top of loop: thisFilepath='${thisFilepath}'`);\r\n\r\n      // Update our \"waiting\" message\r\n      setResultValue(<p style={{ color: 'magenta' }}>Checking <b>{username}/{repoName}</b> repo: checked {checkedFileCount.toLocaleString()}/{countString}</p>);\r\n\r\n      const thisFilename = thisFilepath.split('/').pop();\r\n      // console.log(`thisFilename=${thisFilename}`);\r\n      const thisFilenameExtension = thisFilename.split('.').pop();\r\n      // console.log(`thisFilenameExtension=${thisFilenameExtension}`);\r\n\r\n      // Default to the main filename without the extensions\r\n      let bookOrFileCode = thisFilename.substring(0, thisFilename.length - thisFilenameExtension.length - 1);\r\n      let ourBookID = \"\";\r\n      if (thisFilenameExtension === 'usfm') {\r\n        // const filenameMain = thisFilename.substring(0, thisFilename.length - 5); // drop .usfm\r\n        // console.log(`Have USFM filenameMain=${bookOrFileCode}`);\r\n        const bookID = bookOrFileCode.substring(bookOrFileCode.length - 3);\r\n        // console.log(`Have USFM bookcode=${bookID}`);\r\n        console.assert(books.isValidBookID(bookID), `checkRepo: '${bookID}' is not a valid USFM book identifier`);\r\n        bookOrFileCode = bookID;\r\n        ourBookID = bookID;\r\n      }\r\n      else if (thisFilenameExtension === 'tsv') {\r\n        // const filenameMain = thisFilename.substring(0, thisFilename.length - 4); // drop .tsv\r\n        // console.log(`Have TSV filenameMain=${bookOrFileCode}`);\r\n        const bookID = bookOrFileCode.substring(bookOrFileCode.length - 3);\r\n        // console.log(`Have TSV bookcode=${bookID}`);\r\n        console.assert(books.isValidBookID(bookID), `checkRepo: '${bookID}' is not a valid USFM book identifier`);\r\n        bookOrFileCode = bookID;\r\n        ourBookID = bookID;\r\n      }\r\n\r\n      // console.log(\"checkRepo: Try to load\", username, repoName, thisFilepath, branch);\r\n      const getFile_ = (checkingOptions && checkingOptions.getFile) ? checkingOptions.getFile : getFileCached;\r\n      let repoFileContent;\r\n      try {\r\n        repoFileContent = await getFile_({ username, repository: repoName, path: thisFilepath, branch });\r\n        // console.log(\"Fetched file_content for\", repoName, thisPath, typeof repoFileContent, repoFileContent.length);\r\n      } catch (cRgfError) {\r\n        console.log(\"Failed to load\", username, repoName, thisFilepath, branch, `${cRgfError}`);\r\n        addNotice10({ priority: 996, message: \"Failed to load\", bookID: ourBookID, filename: thisFilename, location: `${givenLocation} ${thisFilepath}: ${cRgfError}`, extra: repoName });\r\n        return;\r\n      }\r\n      if (repoFileContent) {\r\n        // console.log(`checkRepo for ${repoName} checking ${thisFilename}`);\r\n        await ourCheckFileContents(bookOrFileCode, ourBookID,\r\n          // OBS has many files with the same name, so we have to give some of the path as well\r\n          repoName.endsWith('_obs') ? thisFilepath.replace('content/', '') : thisFilename,\r\n          repoFileContent, ourLocation, checkingOptions);\r\n        checkedFileCount += 1;\r\n        checkedFilenames.push(thisFilename);\r\n        checkedFilenameExtensions.add(thisFilenameExtension);\r\n        totalCheckedSize += repoFileContent.length;\r\n        // console.log(`checkRepo checked ${thisFilename}`);\r\n        if (thisFilenameExtension !== 'md') // There's often far, far too many of these\r\n          addSuccessMessage(`Checked ${bookOrFileCode.toUpperCase()} file: ${thisFilename}`);\r\n      }\r\n    }\r\n\r\n    // Check that we processed a license and a manifest\r\n    if (checkedFilenames.indexOf('LICENSE.md') < 0)\r\n      addNotice10({ priority: 946, message: \"Missing LICENSE.md\", location: ourLocation, extra: 'LICENSE' });\r\n    if (checkedFilenames.indexOf('manifest.yaml') < 0)\r\n      addNotice10({ priority: 947, message: \"Missing manifest.yaml\", location: ourLocation, extra: 'MANIFEST' });\r\n\r\n    // Add some extra fields to our checkRepoResult object\r\n    //  in case we need this information again later\r\n    checkRepoResult.checkedFileCount = checkedFileCount;\r\n    checkRepoResult.checkedFilenames = checkedFilenames;\r\n    checkRepoResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n    checkRepoResult.checkedFilesizes = totalCheckedSize;\r\n    checkRepoResult.checkedRepoNames = [`${username}/${repoName}`];\r\n    // checkRepoResult.checkedOptions = checkingOptions; // This is done at the caller level\r\n\r\n    addSuccessMessage(`Checked ${username} repo: ${repoName}`);\r\n    // console.log(`checkRepo() is returning ${checkRepoResult.successList.length.toLocaleString()} success message(s) and ${checkRepoResult.noticeList.length.toLocaleString()} notice(s)`);\r\n  } catch (cRerror) {\r\n    console.log(`checkRepo main code block got error: ${cRerror.message}`);\r\n    setResultValue(<>\r\n      <p style={{ color: 'Red' }}>checkRepo main code block got error: <b>{cRerror.message}</b></p>\r\n    </>);\r\n\r\n  }\r\n  checkRepoResult.elapsedSeconds = (new Date() - startTime) / 1000; // seconds\r\n  return checkRepoResult;\r\n};\r\n// end of checkRepo()\r\n\r\n\r\n/*\r\n    checkFileContents\r\n*/\r\nexport async function checkFileContents(languageCode, filename, fileContent, givenLocation, checkingOptions) {\r\n  // Determine the file type from the filename extension\r\n  //  and return the results of checking that kind of file text\r\n  // console.log(`I'm here in checkFileContents\r\n  //   with ${filename}, ${fileContent.length} chars, ${givenLocation}, ${JSON.stringify(checkingOptions)}`);\r\n  const startTime = new Date();\r\n\r\n  let ourCFLocation = givenLocation;\r\n  if (ourCFLocation[0] !== ' ') ourCFLocation = ' ' + ourCFLocation;\r\n\r\n  let checkFileResult;\r\n  if (filename.toLowerCase().endsWith('.tsv')) {\r\n    const filenameMain = filename.substring(0, filename.length - 4); // drop .tsv\r\n    // console.log(`Have TSV filenameMain=${filenameMain}`);\r\n    const bookID = filenameMain.substring(filenameMain.length - 3);\r\n    // console.log(`Have TSV bookcode=${bookID}`);\r\n    console.assert(books.isValidBookID(bookID), `checkFileContents: '${bookID}' is not a valid USFM book identifier`);\r\n    checkFileResult = await checkTN_TSVText(languageCode, bookID, filename, fileContent, ourCFLocation, checkingOptions);\r\n  }\r\n  else if (filename.toLowerCase().endsWith('.usfm')) {\r\n    const filenameMain = filename.substring(0, filename.length - 5); // drop .usfm\r\n    console.log(`Have USFM filenameMain=${filenameMain}`);\r\n    const bookID = filenameMain.substring(filenameMain.length - 3);\r\n    console.log(`Have USFM bookcode=${bookID}`);\r\n    //console.assert(books.isValidBookID(bookID), `checkFileContents: '${bookID}' is not a valid USFM book identifier`);\r\n    console.log(\"type of checkUSFMText is:\", typeof(checkUSFMText))\r\n    checkFileResult = checkUSFMText(languageCode, bookID, filename, fileContent, ourCFLocation, checkingOptions);\r\n  } else if (filename.toLowerCase().endsWith('.sfm')) {\r\n    const filenameMain = filename.substring(0, filename.length - 4); // drop .sfm\r\n    console.log(`Have SFM filenameMain=${filenameMain}`);\r\n    const bookID = filenameMain.substring(2, 5);\r\n    console.log(`Have SFM bookcode=${bookID}`);\r\n    console.assert(books.isValidBookID(bookID), `checkFileContents: '${bookID}' is not a valid USFM book identifier`);\r\n    checkFileResult = checkUSFMText(languageCode, bookID, filename, fileContent, ourCFLocation, checkingOptions);\r\n  } else if (filename.toLowerCase().endsWith('.md'))\r\n    checkFileResult = checkMarkdownText(filename, fileContent, ourCFLocation, checkingOptions);\r\n  else if (filename.toLowerCase().endsWith('.txt'))\r\n    checkFileResult = checkPlainText(filename, fileContent, ourCFLocation, checkingOptions);\r\n  else if (filename.toLowerCase() === 'manifest.yaml')\r\n    checkFileResult = checkManifestText(filename, fileContent, ourCFLocation, checkingOptions);\r\n  else if (filename.toLowerCase().endsWith('.yaml'))\r\n    checkFileResult = checkYAMLText(filename, fileContent, ourCFLocation, checkingOptions);\r\n  else {\r\n    checkFileResult = checkPlainText(filename, fileContent, ourCFLocation, checkingOptions);\r\n    checkFileResult.noticeList.unshift({ priority: 995, message: \"File extension is not recognized, so treated as plain text.\", filename, location: filename });\r\n  }\r\n  // console.log(`checkFileContents got initial results with ${checkFileResult.successList.length} success message(s) and ${checkFileResult.noticeList.length} notice(s)`);\r\n\r\n  // Add some extra fields to our checkFileResult object\r\n  //  in case we need this information again later\r\n  checkFileResult.checkedFileCount = 1;\r\n  checkFileResult.checkedFilename = filename;\r\n  checkFileResult.checkedFilesize = fileContent.length;\r\n  checkFileResult.checkedOptions = checkingOptions;\r\n\r\n  checkFileResult.elapsedSeconds = (new Date() - startTime) / 1000; // seconds\r\n  // console.log(`checkFileResult: ${JSON.stringify(checkFileResult)}`);\r\n  return checkFileResult;\r\n};\r\n// end of checkFileContents()\r\n\r\n\r\n/*\r\n    checkTQbook\r\n*/\r\nexport async function checkTQbook(username, languageCode, repoName, branch, bookID, checkingOptions) {\r\n  // console.log(`checkTQbook(${username}, ${repoName}, ${branch}, ${bookID}, ${JSON.stringify(checkingOptions)})`)\r\n  const repoCode = 'TQ';\r\n  const generalLocation = `in ${username} ${repoName} (${branch})`;\r\n\r\n  const ctqResult = { successList: [], noticeList: [] };\r\n\r\n  function addSuccessMessage(successString) {\r\n    // console.log(`checkBookPackage success: ${successString}`);\r\n    ctqResult.successList.push(successString);\r\n  }\r\n\r\n  function addNotice10(noticeObject) {\r\n    // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n    // console.log(`checkTQbook addNotice10: ${noticeObject.priority}:${noticeObject.message} ${noticeObject.bookID} ${noticeObject.C}:${noticeObject.V} ${noticeObject.filename}:${noticeObject.lineNumber} ${noticeObject.characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${noticeObject.extract ? ` ${noticeObject.extract}` : \"\"}${noticeObject.location}`);\r\n    console.assert(noticeObject.priority !== undefined, \"cTQ addNotice10: 'priority' parameter should be defined\");\r\n    console.assert(typeof noticeObject.priority === 'number', `cTQ addNotice10: 'priority' parameter should be a number not a '${typeof noticeObject.priority}'`);\r\n    console.assert(noticeObject.message !== undefined, \"cTQ addNotice10: 'message' parameter should be defined\");\r\n    console.assert(typeof noticeObject.message === 'string', `cTQ addNotice10: 'message' parameter should be a string not a '${typeof noticeObject.message}'`);\r\n    console.assert(noticeObject.bookID !== undefined, \"cTQ addNotice10: 'bookID' parameter should be defined\");\r\n    console.assert(typeof noticeObject.bookID === 'string', `cTQ addNotice10: 'bookID' parameter should be a string not a '${typeof noticeObject.bookID}'`);\r\n    console.assert(noticeObject.bookID.length === 3, `cTQ addNotice10: 'bookID' parameter should be three characters long not ${noticeObject.bookID.length}`);\r\n    console.assert(books.isValidBookID(noticeObject.bookID), `cTQ addNotice10: '${noticeObject.bookID}' is not a valid USFM book identifier`);\r\n    // console.assert(C !== undefined, \"cTQ addNotice10: 'C' parameter should be defined\");\r\n    if (noticeObject.C) console.assert(typeof noticeObject.C === 'string', `cTQ addNotice10: 'C' parameter should be a string not a '${typeof noticeObject.C}'`);\r\n    // console.assert(V !== undefined, \"cTQ addNotice10: 'V' parameter should be defined\");\r\n    if (noticeObject.V) console.assert(typeof noticeObject.V === 'string', `cTQ addNotice10: 'V' parameter should be a string not a '${typeof noticeObject.V}'`);\r\n    // console.assert(characterIndex !== undefined, \"cTQ addNotice10: 'characterIndex' parameter should be defined\");\r\n    if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cTQ addNotice10: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}'`);\r\n    // console.assert(extract !== undefined, \"cTQ addNotice10: 'extract' parameter should be defined\");\r\n    if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cTQ addNotice10: 'extract' parameter should be a string not a '${typeof noticeObject.extract}'`);\r\n    console.assert(noticeObject.location !== undefined, \"cTQ addNotice10: 'location' parameter should be defined\");\r\n    console.assert(typeof noticeObject.location === 'string', `cTQ addNotice10: 'location' parameter should be a string not a '${typeof noticeObject.location}'`);\r\n    console.assert(noticeObject.extra !== undefined, \"cTQ addNotice10: 'extra' parameter should be defined\");\r\n    console.assert(typeof noticeObject.extra === 'string', `cTQ addNotice10: 'extra' parameter should be a string not a '${typeof noticeObject.extra}'`);\r\n    ctqResult.noticeList.push({ ...noticeObject, bookID });\r\n  }\r\n\r\n\r\n  async function ourCheckFileContents(repoCode, bookID, C, V, cfFilename, file_content, fileLocation, optionalCheckingOptions) {\r\n    // console.log(`checkBookPackage ourCheckFileContents(${cfFilename})`);\r\n\r\n    // Updates the global list of notices\r\n    console.assert(repoCode !== undefined, \"cTQ ourCheckFileContents: 'repoCode' parameter should be defined\");\r\n    console.assert(typeof repoCode === 'string', `cTQ ourCheckFileContents: 'repoCode' parameter should be a string not a '${typeof repoCode}'`);\r\n    console.assert(cfFilename !== undefined, \"cTQ ourCheckFileContents: 'cfFilename' parameter should be defined\");\r\n    console.assert(typeof cfFilename === 'string', `cTQ ourCheckFileContents: 'cfFilename' parameter should be a string not a '${typeof cfFilename}'`);\r\n    console.assert(file_content !== undefined, \"cTQ ourCheckFileContents: 'file_content' parameter should be defined\");\r\n    console.assert(typeof file_content === 'string', `cTQ ourCheckFileContents: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n    console.assert(fileLocation !== undefined, \"cTQ ourCheckFileContents: 'fileLocation' parameter should be defined\");\r\n    console.assert(typeof fileLocation === 'string', `cTQ ourCheckFileContents: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n    const cfResultObject = await checkFileContents(languageCode, cfFilename, file_content, fileLocation, optionalCheckingOptions);\r\n    // console.log(\"checkFileContents() returned\", cfResultObject.successList.length, \"success message(s) and\", cfResultObject.noticeList.length, \"notice(s)\");\r\n    // for (const successEntry of cfResultObject.successList) console.log(\"  ourCheckFileContents:\", successEntry);\r\n\r\n    // Process results line by line,  appending the repoCode as an extra field as we go\r\n    for (const noticeEntry of cfResultObject.noticeList) {\r\n      // noticeEntry is an array of eight fields: 1=priority, 2=bookID, 3=C, 4=V, 5=msg, 6=characterIndex, 7=extract, 8=location\r\n      // console.assert(Object.keys(noticeEntry).length === 5, `cTQ ourCheckFileContents notice length=${Object.keys(noticeEntry).length}`);\r\n      // We add the repoCode as an extra value\r\n      addNotice10({ ...noticeEntry, bookID, C, V, extra: repoCode });\r\n    }\r\n  }\r\n  // end of ourCheckFileContents function\r\n\r\n\r\n  // Main code for checkTQbook\r\n  // We need to find an check all the markdown folders/files for this book\r\n  let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(['md']), totalCheckedSize = 0;\r\n  let filelistFromZip_ = checkingOptions && checkingOptions.getFilelistFromZip ? checkingOptions.getFilelistFromZip : getFilelistFromZip;\r\n  let bookIdLc = bookID.toLowerCase();\r\n  let pathList = await filelistFromZip_({ username, repository: repoName, branch, optionalPrefix: `${bookIdLc}/` });\r\n  if (!Array.isArray(pathList) || !pathList.length) {\r\n    console.log(\"checkTQrepo failed to load\", username, repoName, branch);\r\n    addNotice10({ priority: 996, message: \"Failed to load\", bookID, C: '', V: '', location: `${generalLocation}`, extra: repoCode });\r\n  } else {\r\n\r\n    // console.log(`  Got ${pathList.length} pathList entries`)\r\n    for (const thisPath of pathList) {\r\n      // console.log(\"checkTQbook: Try to load\", username, repoName, thisPath, branch);\r\n\r\n      console.assert(thisPath.endsWith('.md'), `Expected ${thisPath} to end with .md`);\r\n      const filename = thisPath.split('/').pop();\r\n      const pathParts = thisPath.slice(0, -3).split('/');\r\n      const C = pathParts[pathParts.length - 2].replace(/^0+(?=\\d)/, ''); // Remove leading zeroes\r\n      const V = pathParts[pathParts.length - 1].replace(/^0+(?=\\d)/, ''); // Remove leading zeroes\r\n\r\n      const getFile_ = (checkingOptions && checkingOptions.getFile) ? checkingOptions.getFile : getFileCached;\r\n      let tqFileContent;\r\n      try {\r\n        tqFileContent = await getFile_({username, repository: repoName, path: thisPath, branch});\r\n        // console.log(\"Fetched file_content for\", repoName, thisPath, typeof tqFileContent, tqFileContent.length);\r\n        checkedFilenames.push(thisPath);\r\n        totalCheckedSize += tqFileContent.length;\r\n      } catch (tQerror) {\r\n        console.log(\"checkTQbook failed to load\", username, repoName, thisPath, branch, tQerror + '');\r\n        addNotice10({ priority: 996, message: \"Failed to load\", bookID, C, V, location: `${generalLocation} ${thisPath}: ${tQerror}`, extra: repoCode });\r\n        continue;\r\n      }\r\n\r\n      // We use the generalLocation here (does not include repo name)\r\n      //  so that we can adjust the returned strings ourselves\r\n      await ourCheckFileContents(repoCode, bookID, C, V, filename, tqFileContent, generalLocation, checkingOptions); // Adds the notices to checkBookPackageResult\r\n      checkedFileCount += 1;\r\n      // addSuccessMessage(`Checked ${repoCode.toUpperCase()} file: ${thisPath}`);\r\n    }\r\n    addSuccessMessage(`Checked ${checkedFileCount.toLocaleString()} ${repoCode.toUpperCase()} file${checkedFileCount === 1 ? '' : 's'}`);\r\n  }\r\n\r\n  ctqResult.checkedFileCount = checkedFileCount;\r\n  ctqResult.checkedFilenames = checkedFilenames;\r\n  ctqResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n  ctqResult.checkedFilesizes = totalCheckedSize;\r\n  // console.log(`  checkTQbook returning ${JSON.stringify(ctqResult)}`);\r\n  return ctqResult;\r\n}\r\n// end of checkTQbook function\r\n\r\n\r\n/*\r\n    checkBookPackage\r\n*/\r\nexport async function checkBookPackage(username, languageCode, bookID, setResultValue, checkingOptions) {\r\n  /*\r\n  Note: You may want to run clearCaches() before running this function???\r\n\r\n  Note that bookID here can also be the 'OBS' pseudo bookID.\r\n  */\r\n  // console.log(`checkBookPackage(${username}, ${languageCode}, ${bookID}, )`)\r\n  const startTime = new Date();\r\n\r\n  let checkBookPackageResult = { successList: [], noticeList: [] };\r\n\r\n  const newCheckingOptions = checkingOptions ? { ...checkingOptions } : {}; // clone before modify\r\n  const getFile_ = newCheckingOptions.getFile ? newCheckingOptions.getFile : getFileCached; // default to using caching of files\r\n  newCheckingOptions.getFile = getFile_; // use same getFile_ when we call core functions\r\n\r\n  function addSuccessMessage(successString) {\r\n    // console.log(`checkBookPackage success: ${successString}`);\r\n    checkBookPackageResult.successList.push(successString);\r\n  }\r\n\r\n  function addNotice10(noticeObject) {\r\n    // bookID is a three-character UPPERCASE USFM book identifier or 'OBS'.\r\n    // console.log(`checkBookPackage addNotice10: (priority=${noticeObject.priority}) ${noticeObject.bookID} ${noticeObject.C}:${noticeObject.V} ${noticeObject.message}${noticeObject.characterIndex > 0 ? ` (at character ${noticeObject.characterIndex})` : \"\"}${extract ? ` ${extract}` : \"\"}${location}`);\r\n    console.assert(noticeObject.priority !== undefined, \"cBP addNotice10: 'priority' parameter should be defined\");\r\n    console.assert(typeof noticeObject.priority === 'number', `cBP addNotice10: 'priority' parameter should be a number not a '${typeof noticeObject.priority}'`);\r\n    console.assert(noticeObject.message !== undefined, \"cBP addNotice10: 'message' parameter should be defined\");\r\n    console.assert(typeof noticeObject.message === 'string', `cBP addNotice10: 'message' parameter should be a string not a '${typeof noticeObject.message}'`);\r\n    // console.assert(bookID !== undefined, \"cBP addNotice10: 'bookID' parameter should be defined\");\r\n    if (noticeObject.bookID) {\r\n      console.assert(typeof noticeObject.bookID === 'string', `cBP addNotice10: 'bookID' parameter should be a string not a '${typeof noticeObject.bookID}'`);\r\n      console.assert(noticeObject.bookID.length === 3, `cBP addNotice10: 'bookID' parameter should be three characters long not ${noticeObject.bookID.length}`);\r\n      console.assert(books.isValidBookID(noticeObject.bookID), `cBP addNotice10: '${noticeObject.bookID}' is not a valid USFM book identifier`);\r\n    }\r\n    // console.assert(C !== undefined, \"cBP addNotice10: 'C' parameter should be defined\");\r\n    if (noticeObject.C) console.assert(typeof noticeObject.C === 'string', `cBP addNotice10: 'C' parameter should be a string not a '${typeof noticeObject.C}'`);\r\n    // console.assert(V !== undefined, \"cBP addNotice10: 'V' parameter should be defined\");\r\n    if (noticeObject.V) console.assert(typeof noticeObject.V === 'string', `cBP addNotice10: 'V' parameter should be a string not a '${typeof noticeObject.V}'`);\r\n    // console.assert(characterIndex !== undefined, \"cBP addNotice10: 'characterIndex' parameter should be defined\");\r\n    if (noticeObject.characterIndex) console.assert(typeof noticeObject.characterIndex === 'number', `cBP addNotice10: 'characterIndex' parameter should be a number not a '${typeof noticeObject.characterIndex}'`);\r\n    // console.assert(extract !== undefined, \"cBP addNotice10: 'extract' parameter should be defined\");\r\n    if (noticeObject.extract) console.assert(typeof noticeObject.extract === 'string', `cBP addNotice10: 'extract' parameter should be a string not a '${typeof noticeObject.extract}'`);\r\n    console.assert(noticeObject.location !== undefined, \"cBP addNotice10: 'location' parameter should be defined\");\r\n    console.assert(typeof noticeObject.location === 'string', `cBP addNotice10: 'location' parameter should be a string not a '${typeof noticeObject.location}'`);\r\n    console.assert(noticeObject.extra !== undefined, \"cBP addNotice10: 'extra' parameter should be defined\");\r\n    console.assert(typeof noticeObject.extra === 'string', `cBP addNotice10: 'extra' parameter should be a string not a '${typeof noticeObject.extra}'`);\r\n    checkBookPackageResult.noticeList.push({ ...noticeObject, bookID });\r\n  }\r\n\r\n\r\n  async function ourCheckFileContents(repoCode, cfFilename, file_content, fileLocation, optionalCheckingOptions) {\r\n    // console.log(`checkBookPackage ourCheckFileContents(${cfFilename})`);\r\n\r\n    // Updates the global list of notices\r\n    console.assert(repoCode !== undefined, \"cBP ourCheckFileContents: 'repoCode' parameter should be defined\");\r\n    console.assert(typeof repoCode === 'string', `cBP ourCheckFileContents: 'repoCode' parameter should be a string not a '${typeof repoCode}'`);\r\n    console.assert(cfFilename !== undefined, \"cBP ourCheckFileContents: 'cfFilename' parameter should be defined\");\r\n    console.assert(typeof cfFilename === 'string', `cBP ourCheckFileContents: 'cfFilename' parameter should be a string not a '${typeof cfFilename}'`);\r\n    console.assert(file_content !== undefined, \"cBP ourCheckFileContents: 'file_content' parameter should be defined\");\r\n    console.assert(typeof file_content === 'string', `cBP ourCheckFileContents: 'file_content' parameter should be a string not a '${typeof file_content}'`);\r\n    console.assert(fileLocation !== undefined, \"cBP ourCheckFileContents: 'fileLocation' parameter should be defined\");\r\n    console.assert(typeof fileLocation === 'string', `cBP ourCheckFileContents: 'fileLocation' parameter should be a string not a '${typeof fileLocation}'`);\r\n\r\n    const cfcResultObject = await checkFileContents(languageCode, cfFilename, file_content, fileLocation, optionalCheckingOptions);\r\n    // console.log(\"checkFileContents() returned\", cfResultObject.successList.length, \"success message(s) and\", cfResultObject.noticeList.length, \"notice(s)\");\r\n    // for (const successEntry of cfResultObject.successList) console.log(\"  ourCheckFileContents:\", successEntry);\r\n    // console.log(\"cfcResultObject\", JSON.stringify(cfcResultObject));\r\n\r\n    // Process results line by line,  appending the repoCode as an extra field as we go\r\n    for (const cfcNoticeEntry of cfcResultObject.noticeList)\r\n      // noticeEntry is an object\r\n      // We add the repoCode as an extra value\r\n      addNotice10({ ...cfcNoticeEntry, extra: repoCode });\r\n  }\r\n  // end of ourCheckFileContents function\r\n\r\n  // Main code for checkBookPackage()\r\n  // No point in passing the branch through as a parameter\r\n  //  coz if it's not 'master', it's unlikely to be common for all the repos\r\n  const branch = 'master';\r\n\r\n  const generalLocation = ` in ${languageCode} ${bookID} book package from ${username} ${branch} branch`;\r\n\r\n  if (bookID === 'OBS') {\r\n    // We use the generalLocation here (does not include repo name)\r\n    //  so that we can adjust the returned strings ourselves\r\n    // console.log(\"Calling OBS checkRepo()\");\r\n    checkBookPackageResult = await checkRepo(username, `${languageCode}_obs`, branch, generalLocation, setResultValue, newCheckingOptions); // Adds the notices to checkBookPackageResult\r\n    // console.log(`checkRepo() returned ${checkBookPackageResult.successList.length} success message(s) and ${checkBookPackageResult.noticeList.length} notice(s)`);\r\n    // console.log(\"crResultObject keys\", JSON.stringify(Object.keys(checkBookPackageResult)));\r\n\r\n    // Concat is faster if we don't need to process each notice individually\r\n    // checkBookPackageResult.successList = checkBookPackageResult.successList.concat(crResultObject.successList);\r\n    // checkBookPackageResult.noticeList = checkBookPackageResult.noticeList.concat(crResultObject.noticeList);\r\n    // checkedFileCount += crResultObject.fileCount;\r\n    addSuccessMessage(`Checked ${languageCode} OBS repo from ${username}`);\r\n  } else { // not OBS\r\n    // We also need to know the number for USFM books\r\n    let bookNumberAndName, whichTestament;\r\n    try {\r\n      bookNumberAndName = books.usfmNumberNameById(bookID);\r\n      whichTestament = books.testament(bookID); // returns 'old' or 'new'\r\n    } catch (bNNerror) {\r\n      if (books.isValidBookID(bookID)) // must be in FRT, BAK, etc.\r\n        whichTestament = 'other'\r\n      else {\r\n        addNotice10({ priority: 902, message: \"Bad function call: should be given a valid book abbreviation\", bookID, extract: bookID, location: ` (not '${bookID}')${generalLocation}` }); return checkBookPackageResult;\r\n      }\r\n    }\r\n    // console.log(`bookNumberAndName='${bookNumberAndName}' (${whichTestament} testament)`);\r\n\r\n    // So now we want to work through checking this one specified Bible book in various repos:\r\n    //  UHB/UGNT, ULT/GLT, UST/GST, TN, TQ\r\n    const getFile_ = (newCheckingOptions && newCheckingOptions.getFile) ? newCheckingOptions.getFile : getFileCached;\r\n    let checkedFileCount = 0, checkedFilenames = [], checkedFilenameExtensions = new Set(), totalCheckedSize = 0, checkedRepoNames = [];\r\n    const origLang = whichTestament === 'old' ? 'UHB' : 'UGNT';\r\n    const ULT = languageCode === 'en' ? 'ULT' : 'GLT';\r\n    const UST = languageCode === 'en' ? 'UST' : 'GST';\r\n\r\n    const repoCodeList = [origLang, ULT, UST, 'TN', 'TQ'];\r\n    for (const repoCode of repoCodeList) {\r\n      console.log(`Check ${bookID} in ${repoCode} (${languageCode} ${bookID} from ${username})`);\r\n      const repoLocation = ` in ${repoCode.toUpperCase()}${generalLocation}`;\r\n      const repoName = getRepoName(languageCode, repoCode);\r\n\r\n      // Update our \"waiting\" message\r\n      setResultValue(<p style={{ color: 'magenta' }}>Checking {username} {languageCode} <b>{bookID}</b> book package in <b>{repoCode}</b> (checked <b>{checkedRepoNames.length.toLocaleString()}</b>/{repoCodeList.length} repos)</p>);\r\n\r\n      let filename;\r\n      if (repoCode === 'UHB' || repoCode === 'UGNT' || repoCode === ULT || repoCode === UST) {\r\n        filename = `${bookNumberAndName}.usfm`;\r\n        checkedFilenameExtensions.add('usfm');\r\n      }\r\n      else if (repoCode === 'TN') {\r\n        filename = `${languageCode}_tn_${bookNumberAndName}.tsv`;\r\n        checkedFilenameExtensions.add('tsv');\r\n      }\r\n\r\n      if (repoCode === 'TQ') {\r\n        // This resource might eventually be converted to TSV tables\r\n        const tqResultObject = await checkTQbook(username, languageCode, repoName, branch, bookID, newCheckingOptions);\r\n        checkBookPackageResult.successList = checkBookPackageResult.successList.concat(tqResultObject.successList);\r\n        checkBookPackageResult.noticeList = checkBookPackageResult.noticeList.concat(tqResultObject.noticeList);\r\n        checkedFilenames = checkedFilenames.concat(tqResultObject.checkedFilenames);\r\n        checkedFilenameExtensions = new Set([...checkedFilenameExtensions, ...tqResultObject.checkedFilenameExtensions]);\r\n        checkedFileCount += tqResultObject.checkedFileCount;\r\n        totalCheckedSize += tqResultObject.totalCheckedSize;\r\n        checkedRepoNames.push(repoCode);\r\n      } else { // For repos other than TQ, we only have one file to check\r\n        // console.log(\"Try to load\", username, repoName, filename, branch);\r\n        let repoFileContent;\r\n        try {\r\n          repoFileContent = await getFile_({ username, repository: repoName, path: filename, branch });\r\n          // console.log(\"Fetched file_content for\", repoName, filename, typeof repoFileContent, repoFileContent.length);\r\n          checkedFilenames.push(filename);\r\n          totalCheckedSize += repoFileContent.length;\r\n          checkedRepoNames.push(repoCode);\r\n        } catch (cBPgfError) {\r\n          console.log(\"ERROR: Failed to load\", username, repoName, filename, branch, cBPgfError + '');\r\n          addNotice10({ priority: 996, message: \"Failed to load\", bookID, repoName, filename, location: `${repoLocation}: ${cBPgfError}`, extra: repoCode });\r\n          continue;\r\n        }\r\n\r\n        // We use the generalLocation here (does not include repo name)\r\n        //  so that we can adjust the returned strings ourselves\r\n        await ourCheckFileContents(repoCode, filename, repoFileContent, generalLocation, newCheckingOptions); // Adds the notices to checkBookPackageResult\r\n        checkedFileCount += 1;\r\n        addSuccessMessage(`Checked ${repoCode.toUpperCase()} file: ${filename}`);\r\n      }\r\n    }\r\n\r\n    // Add some extra fields to our checkFileResult object\r\n    //  in case we need this information again later\r\n    checkBookPackageResult.checkedFileCount = checkedFileCount;\r\n    checkBookPackageResult.checkedFilenames = checkedFilenames;\r\n    checkBookPackageResult.checkedFilenameExtensions = [...checkedFilenameExtensions]; // convert Set to Array\r\n    checkBookPackageResult.checkedFilesizes = totalCheckedSize;\r\n    checkBookPackageResult.checkedRepoNames = checkedRepoNames;\r\n    // checkBookPackageResult.checkedOptions = newCheckingOptions; // This is done at the caller level\r\n  }\r\n\r\n  checkBookPackageResult.elapsedSeconds = (new Date() - startTime) / 1000; // seconds\r\n  // console.log(\"checkBookPackageResult:\", JSON.stringify(checkBookPackageResult));\r\n  return checkBookPackageResult;\r\n};\r\n// end of checkBookPackage()\r\n","// utilities\r\nimport * as books from 'uw-content-validation';\r\n\r\n// function to convert an array to an object\r\n// with keys being 0..n\r\nexport const array_to_obj = ( (ar: any) => {\r\n    const ob = {};\r\n    Object.assign(ob,ar);\r\n    return ob;\r\n});\r\n\r\n// function to convert map to object\r\nexport const map_to_obj = ( (mp: any[]) => {\r\n    const ob: any = {};\r\n    mp.forEach((v: any,k: any) => {ob[k]=v});\r\n    return ob;\r\n});\r\n\r\n// function to convert object to a map\r\nexport const obj_to_map = ( (ob: { [x: string]: any; }) => {\r\n    const mp = new Map();\r\n    Object.keys ( ob ).forEach (k => { mp.set(k, ob[k]) });\r\n    return mp;\r\n});\r\n\r\n\r\ninterface ObjectLiteral {\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * create link to repo\r\n * @param repo\r\n * @param username\r\n * @param languageCode\r\n * @param bookID\r\n * @param lineNum\r\n * @param branch\r\n */\r\nexport const getLink = (repo: string, username: string, languageCode: string, bookID: string, lineNum: string, branch = `master`) => {\r\n    let repoName = `${languageCode.toLowerCase()}_${repo.toLowerCase()}`;\r\n    let extension = 'usfm';\r\n    let view = 'src';\r\n    let namePrefix = '';\r\n    let repoUC = repo.toUpperCase();\r\n    if (repoUC === 'UHB') {\r\n        repoName = 'hbo_uhb';\r\n    }\r\n    if (repoUC === 'UGNT') {\r\n        repoName = 'el-x-koine_ugnt';\r\n    }\r\n    if (repoUC === 'TN') {\r\n        view = 'blame';\r\n        extension = 'tsv';\r\n        namePrefix = `${repoName}_`;\r\n    }\r\n    if (['TN', 'UHB', 'UGNT', 'ULT', 'UST'].includes(repoUC)) {\r\n        let bookNumberAndName;\r\n        try {\r\n            bookNumberAndName = books.usfmNumberName(bookID).toUpperCase();\r\n            let link = `https://git.door43.org/${username}/${repoName}/${view}/branch/${branch}/${namePrefix}${bookNumberAndName}.${extension}`;\r\n            if (lineNum) {\r\n                link += `#L${lineNum}`;\r\n            }\r\n            return link;\r\n            // const anchor = `<a href=\"${link}\" target=\"_blank\">${lineNum}</a>`;\r\n            // return anchor;\r\n        } catch (e) {}\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * remove columns that don't have any data\r\n * @param rows\r\n * @param columns\r\n */\r\nexport const trimColumns = (rows: any[], columns: any[]) => {\r\n    const newColumns = [];\r\n    for (let column of columns) {\r\n        const { field, title } = column;\r\n        let hasData = false;\r\n\r\n        for (let row of rows) {\r\n            const cellData = row[field]\r\n            if (cellData) {\r\n                hasData = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (hasData) {\r\n            newColumns.push(column);\r\n        } else {\r\n            console.log(`Removing column \"${title}\" because no data found`);\r\n        }\r\n    }\r\n    return newColumns;\r\n}\r\n\r\n/**\r\n * converts strings to numbers\r\n * @param value\r\n */\r\nexport const stringToNumber = (value: any) => {\r\n    if (typeof value === 'string') {\r\n        const num = parseInt(value, 10);\r\n        if (!isNaN(num)) {\r\n            return num;\r\n        }\r\n    }\r\n    return NaN;\r\n}\r\n\r\n/**\r\n * string compare that attempts to do numerical sorting fist and then will sort by string\r\n * @param a\r\n * @param b\r\n */\r\nexport const somewhatNumericalSort = (a: any, b: any) => {\r\n    const aNum = stringToNumber(a);\r\n    const bNum = stringToNumber(b);\r\n    const aStr = a || \"\";\r\n    const bStr = b || \"\";\r\n\r\n    if (!isNaN(aNum) && !isNaN(bNum)) { // if both are numbers then do numerical compare\r\n        return aNum - bNum;\r\n    }\r\n\r\n    if (isNaN(aNum) && isNaN(bNum)) { // if both are not numbers then do a string compare\r\n        return aStr > bStr ? 1 : ( aStr === bStr ? 0 : -1);\r\n    }\r\n\r\n    if (isNaN(aNum)) {\r\n        return -1;  // non-numeric strings less than numbers\r\n    }\r\n    return 1;\r\n}\r\n\r\n/**\r\n * sort by chapter first and then by verse if same chapter\r\n * @param a\r\n * @param b\r\n */\r\nexport const sortChapterVerse = (a: any, b: any) => {\r\n    let results = somewhatNumericalSort(a.C, b.C);\r\n    if (results === 0) { // if chapters are same, then sort on verse\r\n        results = somewhatNumericalSort(a.V, b.V);\r\n    }\r\n    return results;\r\n}\r\n\r\n/* Sample of Warnings List:\r\n    C: \"1\"\r\n    V: \"1\"\r\n    bookID: \"2PE\"\r\n    characterIndex: undefined\r\n    extract: undefined\r\n    lineNumber: 4\r\n    location: \" with ID 'n1di' en 2pe book package from unfoldingword\"\r\n    message: \"TN Missing OrigQuote field\"\r\n    priority: 276\r\n*/\r\n// function to convert word frequency map\r\n// to an object suitable for MaterialTable\r\nexport const notices_to_mt = ( ob: { [x: string]: any; }, username: string, languageCode: string, bookID: string, \r\n    renderLink: any, renderWithUnicodeLink: any, renderPriority: any) => \r\n{\r\n    let mt: ObjectLiteral = {};\r\n    mt.title = \"Validation Notices\";\r\n    mt.columns = [\r\n        { title: 'Repo', field: 'extra' },\r\n        { \r\n            title: 'Pri', \r\n            field: 'priority',\r\n            render: (rowData: any) => (renderPriority(rowData.priority))\r\n        },\r\n        {\r\n            title: 'Ch',\r\n            field: 'C',\r\n            customSort: (a: any, b: any) => sortChapterVerse(a, b)\r\n        },\r\n        {\r\n            title: 'Vs',\r\n            field: 'V',\r\n            customSort: (a: any, b: any) => somewhatNumericalSort(a.V, b.V)\r\n        },\r\n        {\r\n            title: 'Line',\r\n            field: 'lineNumber',\r\n            render: (rowData: any) => (renderLink(rowData.link, rowData.lineNumber))\r\n        },\r\n        { title: 'Row ID', field: 'rowID' },\r\n        { title: 'Field Name', field: 'fieldName' },\r\n        { title: 'Details', field: 'details' },\r\n        { title: 'Char Pos', field: 'charPos' },\r\n        {\r\n            title: 'Excerpt',\r\n            field: 'excerpt',\r\n            cellStyle: {\r\n                fontFamily: \"Ezra, Roboto, Helvetica, Arial, sans-serif\"\r\n            },\r\n            render: (rowData: any) => (renderWithUnicodeLink(rowData.excerpt))\r\n        },\r\n        {\r\n            title: 'Message',\r\n            field: 'message',\r\n            cellStyle: {\r\n                fontFamily: \"Ezra, Roboto, Helvetica, Arial, sans-serif\",\r\n                width: `400px`\r\n            },\r\n        },\r\n        { title: 'Location', field: 'location' },\r\n    ];\r\n    mt.data = [];\r\n    Object.keys(ob).forEach ( key => {\r\n        const rowData = ob[key];\r\n        let _location = rowData.location;\r\n        _location = _location.replace(/en ... book package from unfoldingword/, '' );\r\n        let _link = getLink(rowData.extra, username, languageCode, bookID, rowData.lineNumber);\r\n        mt.data.push({\r\n            extra: rowData.extra,\r\n            priority: rowData.priority,\r\n            C: rowData.C,\r\n            V: rowData.V,\r\n            lineNumber: rowData.lineNumber,\r\n            rowID: rowData.rowID,\r\n            charPos: rowData.characterIndex,\r\n            excerpt: rowData.extract,\r\n            link: _link,\r\n            location: _location,\r\n            message: rowData.message,\r\n            fieldName: rowData.fieldName,\r\n            details: rowData.details,\r\n        })\r\n    })\r\n\r\n    // @ts-ignore\r\n    mt.data = mt.data.sort((a: object, b: object) => (a.priority > b.priority ? -1 : 1) ); // sort highest priority to the top of the table\r\n\r\n    mt.columns = trimColumns(mt.data, mt.columns);\r\n\r\n    mt.options = {\r\n        sorting: true,\r\n        // padding: 'dense',\r\n        exportButton: true,\r\n        exportAllData: true,\r\n        // tableLayout: 'auto',\r\n        columnsButton: true,\r\n        filtering: true,\r\n        pageSize: 10,\r\n    };\r\n\r\n    return mt;\r\n};\r\n\r\n/*\r\n// function to convert an array of words to\r\n// an object suitable for MaterialTable\r\nexport const aw_to_mt = ( ar => {\r\n    // first convert array to object\r\n    const ob = array_to_obj(ar);\r\n    const mt = {};\r\n    mt.title = \"All Words in Text Order\";\r\n    mt.columns = [\r\n        { title: 'Order', field: 'order' , type: 'numeric'},\r\n        { title: 'Word', field: 'word' },\r\n    ];\r\n    mt.data = [];\r\n    Object.keys(ob).forEach ( n => {\r\n        mt.data.push({ order: n, word: ob[n] })\r\n    });\r\n\r\n    mt.options = { sorting: true };\r\n\r\n    return mt;\r\n});\r\n*/","import React from 'react';\r\nimport { forwardRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\nimport AddBox from '@material-ui/icons/AddBox';\r\nimport ArrowDownward from '@material-ui/icons/ArrowDownward';\r\nimport Check from '@material-ui/icons/Check';\r\nimport ChevronLeft from '@material-ui/icons/ChevronLeft';\r\nimport ChevronRight from '@material-ui/icons/ChevronRight';\r\nimport Clear from '@material-ui/icons/Clear';\r\nimport DeleteOutline from '@material-ui/icons/DeleteOutline';\r\nimport Edit from '@material-ui/icons/Edit';\r\nimport FilterList from '@material-ui/icons/FilterList';\r\nimport FirstPage from '@material-ui/icons/FirstPage';\r\nimport LastPage from '@material-ui/icons/LastPage';\r\nimport Remove from '@material-ui/icons/Remove';\r\nimport SaveAlt from '@material-ui/icons/SaveAlt';\r\nimport Search from '@material-ui/icons/Search';\r\nimport ViewColumn from '@material-ui/icons/ViewColumn';\r\n\r\nimport MaterialTable from 'material-table';\r\nimport * as util from './core/utilities.ts';\r\n\r\nconst tableIcons = {\r\n  Add: forwardRef((props, ref) => <AddBox {...props} ref={ref} />),\r\n  Check: forwardRef((props, ref) => <Check {...props} ref={ref} />),\r\n  Clear: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n  Delete: forwardRef((props, ref) => <DeleteOutline {...props} ref={ref} />),\r\n  DetailPanel: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n  Edit: forwardRef((props, ref) => <Edit {...props} ref={ref} />),\r\n  Export: forwardRef((props, ref) => <SaveAlt {...props} ref={ref} />),\r\n  Filter: forwardRef((props, ref) => <FilterList {...props} ref={ref} />),\r\n  FirstPage: forwardRef((props, ref) => <FirstPage {...props} ref={ref} />),\r\n  LastPage: forwardRef((props, ref) => <LastPage {...props} ref={ref} />),\r\n  NextPage: forwardRef((props, ref) => <ChevronRight {...props} ref={ref} />),\r\n  PreviousPage: forwardRef((props, ref) => <ChevronLeft {...props} ref={ref} />),\r\n  ResetSearch: forwardRef((props, ref) => <Clear {...props} ref={ref} />),\r\n  Search: forwardRef((props, ref) => <Search {...props} ref={ref} />),\r\n  SortArrow: forwardRef((props, ref) => <ArrowDownward {...props} ref={ref} />),\r\n  ThirdStateCheck: forwardRef((props, ref) => <Remove {...props} ref={ref} />),\r\n  ViewColumn: forwardRef((props, ref) => <ViewColumn {...props} ref={ref} />)\r\n};\r\n\r\n/**\r\n * Colorized priority according to severity of notice\r\n * @param content\r\n * @return {JSX.Element|string}\r\n */\r\nexport const renderPriority = (content) => {\r\n  // breaking changes: 800 and above\r\n  if ( content >= 800 ) {\r\n      return <p style={{ color: 'red', fontWeight: 'bold' }}>{content}</p>;\r\n  }\r\n\r\n  // non-breaking changes: 600 to 799\r\n  if ( content >= 600 ) {\r\n    return <p style={{ color: 'blue', fontWeight: 'bold' }}>{content}</p>\r\n  }\r\n\r\n  // below 600 are warnings\r\n  return <p style={{ color: 'green', fontWeight: 'bold' }}>{content}</p>;\r\n}\r\n\r\n/**\r\n * creates a link to external URL\r\n * @param link\r\n * @param content\r\n * @return {JSX.Element|string}\r\n */\r\nexport const renderLink = (link, content) => {\r\n  if (link) {\r\n    return <a href={link} target=\"_blank\" rel=\"noopener noreferrer\">{content}</a>\r\n  } else if (content) {\r\n    return `${content}`\r\n  }\r\n  return \"\";\r\n}\r\n\r\n/**\r\n * replaces unicode references with link to webpage describing the character\r\n * @param content\r\n * @return {JSX.Element|string}\r\n */\r\nexport const renderWithUnicodeLink = (content) => {\r\n  if ( !content ) {\r\n    return \"\";\r\n  }\r\n  // find unicode refs that look like '( =D8288/H2060)'\r\n  const getUnicodeRegEx = new RegExp(/=D(\\d+)\\/H(\\w+)\\)/, 'g');\r\n  let match;\r\n  let lastPos = 0;\r\n  const output = [];\r\n  // eslint-disable-next-line no-cond-assign\r\n  while (match = getUnicodeRegEx.exec(content)) {\r\n    if (match.index > 0) {\r\n      output.push(content.substring(lastPos, match.index));\r\n    }\r\n    let matchLen = match[0].length;\r\n    const unicode = match[2];\r\n    output.push (\r\n      <a href={`http://www.fileformat.info/info/unicode/char/${unicode}/index.htm`} target=\"_blank\" rel=\"noopener noreferrer\">U+{unicode}</a>\r\n    )\r\n    lastPos = match.index + matchLen - 1; // update start position\r\n  }\r\n  if (lastPos < content.length) {\r\n    output.push(content.substring(lastPos, content.length));\r\n  }\r\n\r\n  // assemble all the strings and anchors into one segment\r\n  return <> {output} </>\r\n};\r\n\r\nfunction ValidationWarnings({\r\n    results,\r\n    username,\r\n    languageCode,\r\n    bookID,\r\n  }) {\r\n\r\n    let mt = util.notices_to_mt(results, username, languageCode, bookID, renderLink, renderWithUnicodeLink, renderPriority);\r\n    return (\r\n      <Paper>\r\n        <MaterialTable\r\n          icons={tableIcons}\r\n          title={mt.title}\r\n          columns={mt.columns}\r\n          data={mt.data}\r\n          options={mt.options}\r\n        />\r\n      </Paper>\r\n    );\r\n  };\r\n\r\n  ValidationWarnings.propTypes = {\r\n    /** @ignore */\r\n    results: PropTypes.array.isRequired,\r\n  };\r\n\r\n  const styles = theme => ({\r\n    root: {\r\n    },\r\n  });\r\n\r\n  export default withStyles(styles)(ValidationWarnings);\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Typography } from '@material-ui/core';\r\n\r\nimport {checkBookPackage} from './core/book-package-check';\r\nimport ValidationNotices from './ValidationNotices';\r\n\r\nfunction BookPackageContentValidator({bookID, username, language_code}) {\r\n    //const username = 'unfoldingword';\r\n    //const language_code = 'en';\r\n    //const branch = 'master';\r\n    // Check a single Bible book across many repositories\r\n    const [result, setResultValue] = useState(\"Waiting-CheckBookPackage\");\r\n\r\n    let checkingOptions = { // Uncomment any of these to test them\r\n        // 'extractLength': 25,\r\n    };\r\n\r\n    useEffect(() => {\r\n        // Use an IIFE (Immediately Invoked Function Expression)\r\n        //  e.g., see https://medium.com/javascript-in-plain-english/https-medium-com-javascript-in-plain-english-stop-feeling-iffy-about-using-an-iife-7b0292aba174\r\n        (async () => {\r\n\r\n            // Display our \"waiting\" message\r\n            setResultValue(<p style={{ color: 'red' }}>Waiting for check results for {username} {language_code} <b>{bookID}</b> book package</p>);\r\n\r\n            const rawCBPResults = await checkBookPackage(username, language_code, bookID, setResultValue, checkingOptions);\r\n            //console.log(\"rawCBPResults=\", rawCBPResults);\r\n            // Add some extra fields to our rawCBPResults object in case we need this information again later\r\n            rawCBPResults.checkType = 'BookPackage';\r\n            rawCBPResults.username = username;\r\n            rawCBPResults.language_code = language_code;\r\n            rawCBPResults.bookID = bookID;\r\n            rawCBPResults.checkedOptions = checkingOptions;\r\n\r\n            function renderSummary(rawCBPResults) {\r\n                return (\r\n                    <>\r\n                    <Typography>\r\n                        Successfully checked&nbsp;\r\n                        {rawCBPResults.checkedFileCount.toLocaleString()}&nbsp;\r\n                        files in&nbsp;\r\n                        {rawCBPResults.elapsedSeconds}&nbsp;\r\n                        seconds\r\n                    </Typography>\r\n                    <Typography>\r\n                        There were {rawCBPResults.noticeList.length} notices.\r\n                    </Typography>\r\n                </>\r\n            );\r\n            }\r\n\r\n            setResultValue(<>\r\n                {renderSummary(rawCBPResults)}\r\n                {rawCBPResults.noticeList.length ?\r\n                  <ValidationNotices\r\n                    results={rawCBPResults.noticeList}\r\n                    username={username}\r\n                    languageCode={language_code}\r\n                    bookID={bookID}\r\n                  />\r\n                : <br/> }\r\n            </>);\r\n\r\n        })(); // end of async part in unnamedFunction\r\n        // eslint-disable-next-line\r\n    }, []); // end of useEffect part\r\n\r\n    // {/* <div className={classes.root}> */}\r\n    return (\r\n        <div>\r\n        {result}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default BookPackageContentValidator;\r\n","import React from 'react';\nimport clsx from 'clsx';\n//import { withStyles, makeStyles, useTheme, Theme, createStyles } from '@material-ui/core/styles';\nimport { makeStyles, useTheme, Theme, createStyles } from '@material-ui/core/styles';\nimport Paper from '@material-ui/core/Paper';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\n//import CircularProgress from '@material-ui/core/CircularProgress';\n//import Popover from '@material-ui/core/Popover';\n\nimport FormLabel from '@material-ui/core/FormLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormGroup from '@material-ui/core/FormGroup';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormHelperText from '@material-ui/core/FormHelperText';\n//import Checkbox, { CheckboxProps } from '@material-ui/core/Checkbox';\nimport Checkbox from '@material-ui/core/Checkbox';\n\nimport AppBar from '@material-ui/core/AppBar';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport Drawer from '@material-ui/core/Drawer';\nimport Divider from '@material-ui/core/Divider';\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\n\n\n//import { green } from '@material-ui/core/colors';\nimport * as books from '../src/core/books';\nimport { Container, CssBaseline, Grid, RadioGroup, Radio } from '@material-ui/core';\n\nimport BookPackageContentValidator from './BookPackageContentValidator';\nimport {clearCacheAndPreloadRepos} from 'uw-content-validation';\n\nasync function doInitialization() {\n  const username = 'unfoldingword';\n  const language_code = 'en';\n  const branch = 'master'\n  const success = await clearCacheAndPreloadRepos(username, language_code, [], branch);\n  if (!success) {\n      console.log(`Failed to pre-load all repos`)\n  }      \n}\n\nconst drawerWidth = 240;\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      width: '100%',\n      flexGrow: 1,\n      display: 'flex',\n    },\n    menuButton: {\n      marginRight: theme.spacing(2),\n    },\n    appBar: {\n      transition: theme.transitions.create(['margin', 'width'], {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.leavingScreen,\n      }),\n    },\n    appBarShift: {\n      width: `calc(100% - ${drawerWidth}px)`,\n      marginLeft: drawerWidth,\n      transition: theme.transitions.create(['margin', 'width'], {\n        easing: theme.transitions.easing.easeOut,\n        duration: theme.transitions.duration.enteringScreen,\n      }),\n    },\n    title: {\n      flexGrow: 1,\n    },\n    formControl: {\n      margin: theme.spacing(3),\n    },\n    button: {\n      marginRight: theme.spacing(1),\n    },\n    instructions: {\n      marginTop: theme.spacing(1),\n      marginBottom: theme.spacing(1),\n    },\n    hide: {\n      display: 'none',\n    },\n    drawer: {\n      width: drawerWidth,\n      flexShrink: 0,\n    },\n    drawerPaper: {\n      width: drawerWidth,\n    },\n    drawerHeader: {\n      display: 'flex',\n      alignItems: 'center',\n      padding: theme.spacing(0, 1),\n      ...theme.mixins.toolbar,\n      justifyContent: 'flex-end',\n    },\n    content: {\n      flexGrow: 1,\n      padding: theme.spacing(3),\n      transition: theme.transitions.create('margin', {\n        easing: theme.transitions.easing.sharp,\n        duration: theme.transitions.duration.leavingScreen,\n      }),\n      marginLeft: -drawerWidth,\n    },\n    contentShift: {\n      transition: theme.transitions.create('margin', {\n        easing: theme.transitions.easing.easeOut,\n        duration: theme.transitions.duration.enteringScreen,\n      }),\n      marginLeft: 0,\n    },\n    alignItemsAndJustifyContent: {\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n    },  \n    offset: {...theme.mixins.toolbar},\n  }),\n);\n\ninterface bpStateIF { [x: string]: boolean[]; };\n\nfunction joinBookIds(state: bpStateIF ): string[] {\n  const x = Object.keys(state);\n  let y: string[] = [];\n  for (let i=0; i<x.length; i++) {\n    if ( state[x[i]][0] ) {\n      y.push(books.bookIdByTitle(x[i]));\n    }\n  }\n  return y;\n}\n\n    \nfunction getSteps() {\n  return ['Select Organization and Language', 'Select Books', 'Content Validation Details'];\n}\n\nfunction getStepContent(step: number) {\n  switch (step) {\n    case 0:\n      return 'Select Organization and Language';\n    case 1:\n      return 'Select books, then click Next to generate book package details';\n    case 2:\n      return 'Content Validation Results';\n    default:\n      return 'Unknown step';\n  }\n}\n\n// A custom hook that builds on useLocation to parse\n// the query string for you.\nlet queryProcessedOnce = false;\nfunction useQuery() {\n  let search = window.location.search;\n  //console.log(\"url=\",window.location.origin,window.location.pathname)\n  return new URLSearchParams(search);\n}\n\nexport default function App() {\n  const [state, setState] = React.useState({ ...books.titlesToBoolean() }); \n  const [activeStep, setActiveStep] = React.useState(0);\n  const [skipped, setSkipped] = React.useState(new Set<number>());\n  const [org, setOrg]   = React.useState('unfoldingword');\n  const [lang, setLang] = React.useState('en');\n\n  /* ----------------------------------------------------------\n      Stepper\n  */\n  const steps = getSteps();\n\n  const isStepOptional = (step: number) => {\n    return false;\n  };\n\n  const isStepSkipped = (step: number) => {\n    return skipped.has(step);\n  };\n\n\n  const handleBack = () => {\n    setActiveStep(prevActiveStep => prevActiveStep - 1);\n  };\n\n  const handleSkip = () => {\n    if (!isStepOptional(activeStep)) {\n      // You probably want to guard against something like this,\n      // it should never occur unless someone's actively trying to break something.\n      throw new Error(\"You can't skip a step that isn't optional.\");\n    }\n\n    setActiveStep(prevActiveStep => prevActiveStep + 1);\n    setSkipped(prevSkipped => {\n      const newSkipped = new Set(prevSkipped.values());\n      newSkipped.add(activeStep);\n      return newSkipped;\n    });\n  };\n\n  const handleNext = () => {\n    let newSkipped = skipped;\n    if (isStepSkipped(activeStep)) {\n      newSkipped = new Set(newSkipped.values());\n      newSkipped.delete(activeStep);\n    }\n\n    setActiveStep(prevActiveStep => prevActiveStep + 1);\n    setSkipped(newSkipped);\n  };\n\n  let query = useQuery();\n  if ( activeStep === 0 && queryProcessedOnce === false ) {\n    doInitialization();\n    queryProcessedOnce = true;\n    let bks   = query.get(\"books\");\n    if ( bks !== null ) {\n      // user has launched the app with URL query parameters\n      let barrayIds = bks.split(',');\n      let barrayTitles: string[] = [];\n      for ( let i=0; i < barrayIds.length; i++ ) {\n        let x = books.bookTitleById(barrayIds[i]);\n        if ( x === \"\" ) {\n          alert(\"Invalid Book Id:\"+barrayIds[i]);\n          break;\n        }\n        barrayTitles.push(x);\n      }\n      for( let i=0; i < barrayTitles.length; i++) {\n        let name = barrayTitles[i];\n        console.log(\"name:\",name)\n        // set the state variables\n        state[name][0] = true;\n        state[name][1] = false;\n        let b: boolean[] = [];\n        b[0] = true;\n        b[1] = false;  \n      }\n      handleNext();\n    }\n  }\n\n\n  const classes = useStyles();\n  const theme = useTheme();\n\n  /* ----------------------------------------------------------\n      Menu drawer\n  */\n  const [open, setOpen] = React.useState(false);\n\n  const handleDrawerOpen = () => {\n    setOpen(true);\n  };\n\n  const handleDrawerClose = () => {\n    setOpen(false);\n  };\n\n  const handleSelectNoneOt = () => {\n    let states = books.oldTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = false;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = false;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  const handleSelectAllOt = () => {\n    let states = books.oldTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = true;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = true;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  const handleSelectNoneNt = () => {\n    let states = books.newTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = false;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = false;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  const handleSelectAllNt = () => {\n    let states = books.newTestament();\n    for( let i=0; i < states.length; i++) {\n      state[states[i]][0] = true;\n      state[states[i]][1] = false;\n      let name = states[i];\n      let b: boolean[] = [];\n      b[0] = true;\n      b[1] = false;  \n      setState({ ...state, [name]: b });\n    }\n  };\n\n  \n  /* ----------------------------------------------------------\n      Form/checkbox stuff \n  */\n  // these are for the initial book seletion\n  const handleChange = (name: string) => (event: React.ChangeEvent<HTMLInputElement>) => {\n    let b: boolean[] = [];\n    b[0] = event.target.checked;\n    b[1] = false;\n    setState({ ...state, [name]: b });\n  };\n\n  /* as of 2020-09-21:\n  The languages/orgs are:\n    Russian (RU)/ru_gl\n    Hindi (HI)/translationCore-Create-BCS\n    Kannada (KN)/translationCore-Create-BCS\n    Latin-American Spanish (ES-419)/Es-419_gl\n*/\n  const handleOrgLangChange = () => (event: React.ChangeEvent<HTMLInputElement>) => {\n    let val = (event.target as HTMLInputElement).value;\n    let org  = 'unfoldingword';\n    let lang = 'en';\n    if ( val === 'ru' ) {\n      org  = 'ru_gl';\n      lang = 'ru';\n    } else if ( val === 'hi' ) {\n      org  = 'translationCore-Create-BCS';\n      lang = 'hi';\n    } else if ( val === 'kn' ) {\n      org  = 'translationCore-Create-BCS';\n      lang = 'kn';\n    } else if ( val === 'es-419' ) {\n      org = 'Es-419_gl';\n      lang = 'es-419';\n    }\n    setOrg(org);\n    setLang(lang);\n  };\n  \n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <AppBar position=\"fixed\" \n          className={clsx(classes.appBar, {[classes.appBarShift]: open })}>\n        <Toolbar>\n          <IconButton\n            color=\"inherit\"\n            aria-label=\"open drawer\"\n            onClick={handleDrawerOpen}\n            edge=\"start\"\n            className={clsx(classes.menuButton, open && classes.hide)}\n          >\n            <MenuIcon />\n          </IconButton>\n          <Typography variant=\"h6\" className={classes.title}>\n            Book Package Content Validation\n          </Typography>\n        </Toolbar>\n      </AppBar>\n      <Drawer\n        className={classes.drawer}\n        variant=\"persistent\"\n        anchor=\"left\"\n        open={open}\n        classes={{\n          paper: classes.drawerPaper,\n        }}\n      >\n        <div className={classes.drawerHeader}>\n          <IconButton onClick={handleDrawerClose}>\n            {theme.direction === 'ltr' ? <ChevronLeftIcon /> : <ChevronRightIcon />}\n          </IconButton>\n        </div>\n        <Divider />\n          <Typography>Nothing here to see!</Typography>\n        <Divider />\n      </Drawer> \n      <Paper>\n        <Typography> <br/> <br/> </Typography>\n        <Stepper activeStep={activeStep}>\n          {steps.map((label, index) => {\n            const stepProps: { completed?: boolean } = {};\n            const labelProps: { optional?: React.ReactNode } = {};\n            if (isStepOptional(index)) {\n              labelProps.optional = <Typography variant=\"caption\">Optional</Typography>;\n            }\n            if (isStepSkipped(index)) {\n              stepProps.completed = false;\n            }\n            return (\n              <Step key={label} {...stepProps}>\n                <StepLabel {...labelProps}>{label}</StepLabel>\n              </Step>\n            );\n          })}\n        </Stepper>\n        <Container>\n          <div className={classes.alignItemsAndJustifyContent}>\n          <Typography className={classes.instructions}>{getStepContent(activeStep)}</Typography>\n          </div>\n\n          <div className={classes.alignItemsAndJustifyContent}>\n            <Button disabled={activeStep === 0} onClick={handleBack} color=\"primary\" variant=\"contained\" className={classes.button}>\n              Back\n            </Button>\n\n            {isStepOptional(activeStep) && (\n              <Button variant=\"contained\" color=\"primary\" onClick={handleSkip} className={classes.button}>\n                Skip\n              </Button>\n            )}\n\n            <Button disabled={activeStep === 2} variant=\"contained\" color=\"primary\" onClick={handleNext} className={classes.button}>\n              Next\n            </Button>\n\n          </div>\n\n          <div className={classes.alignItemsAndJustifyContent}>\n\n          {(activeStep === 0) && (\n              <>\n              <div>\n                <Paper>\n                  <FormControl component=\"fieldset\">\n                    <FormLabel component=\"legend\">Languages</FormLabel>\n                    <RadioGroup aria-label=\"orgLang\" name=\"orgLang\" value={lang} onChange={handleOrgLangChange()}>\n                      <FormControlLabel value=\"en\" control={<Radio />} label=\"English (unfoldingWord)\" />\n                      <FormControlLabel value=\"ru\" control={<Radio />} label=\"Russian (ru_gl)\" />\n                      <FormControlLabel value=\"hi\" control={<Radio />} label=\"Hindi (translationCore-Create-BCS)\" />\n                      <FormControlLabel value=\"kn\" control={<Radio />} label=\"Kannada (translationCore-Create-BCS)\" />\n                      <FormControlLabel value=\"es-419\" control={<Radio />} label=\"Latin-American Spanish (Es-419_gl)\" />\n                    </RadioGroup>\n                  </FormControl>\n                </Paper>\n              </div>\n              </>\n            )}\n\n\n            {(activeStep === 1) && (\n              <Grid container spacing={3}>\n                <Grid item xs={6}>\n                  <Paper>\n                    <Typography> <br/> </Typography>\n                    <div>\n                    <Button onClick={handleSelectAllOt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select All\n                    </Button>\n                    <Button onClick={handleSelectNoneOt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select None\n                    </Button>\n                    </div>\n                    <FormControl required component=\"fieldset\" className={classes.formControl}>\n                    <FormLabel component=\"legend\">Old Testament</FormLabel>\n                    <FormGroup>\n                      {books.oldTestament().map(t => \n                        <FormControlLabel\n                          control={<Checkbox checked={state[t][0]} onChange={handleChange(t)} value={t} />}\n                          label={t} key={t}\n                        />\n                      )}                \n                    </FormGroup>\n                    <FormHelperText />\n                    </FormControl>\n                  </Paper>\n                </Grid>\n                <Grid item xs={6}>\n                  <Paper>\n                    <Typography> <br/> </Typography>\n                    <div>\n                    <Button onClick={handleSelectAllNt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select All\n                    </Button>\n                    <Button onClick={handleSelectNoneNt} color=\"primary\" variant=\"contained\" className={classes.button}>\n                      Select None\n                    </Button>\n                    </div>\n\n                    <FormControl required component=\"fieldset\" className={classes.formControl}>\n                    <FormLabel component=\"legend\">New Testament</FormLabel>\n                    <FormGroup>\n                      {books.newTestament().map(t => \n                        <FormControlLabel\n                          control={<Checkbox checked={state[t][0]} onChange={handleChange(t)} value={t} />}\n                          label={t} key={t}\n                        />\n                      )}                \n                    </FormGroup>\n                    <FormHelperText />\n                    </FormControl>\n                  </Paper>\n                </Grid>\n              </Grid>\n            )}\n\n\n            {(activeStep === 2) && (\n              <>\n              <div>\n                <Paper>\n                {\n                  joinBookIds(state).map(id => \n                    <div>\n                    <Typography variant=\"h6\" >Book Package for {books.bookTitleById(id)} </Typography>\n                    <BookPackageContentValidator bookID={id} key={id} username={org} language_code={lang} />\n                    </div>\n                  )\n                }\n                </Paper>\n              </div>\n              </>\n            )}\n\n\n          </div>\n        </Container>\n      </Paper>\n    </div>\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport './fonts/SILEOTSR.ttf';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","export * from './demos';\r\nexport * from './core';\r\n","const data = { \"gen\": {\"id\": \"gen\", \"title\": \"Genesis\", \"usfm\": \"01-GEN\", \"testament\": \"old\", \"verseCount\": 1533, \"chapters\": [31, 25, 24, 26, 32, 22, 24, 22, 29, 32, 32, 20, 18, 24, 21, 16, 27, 33, 38, 18, 34, 24, 20, 67, 34, 35, 46, 22, 35, 43, 55, 32, 20, 31, 29, 43, 36, 30, 23, 23, 57, 38, 34, 34, 28, 34, 31, 22, 33, 26]},\r\n\"exo\": {\"id\": \"exo\", \"title\": \"Exodus\", \"usfm\": \"02-EXO\", \"testament\": \"old\", \"verseCount\": 1213, \"chapters\": [22, 25, 22, 31, 23, 30, 25, 32, 35, 29, 10, 51, 22, 31, 27, 36, 16, 27, 25, 26, 36, 31, 33, 18, 40, 37, 21, 43, 46, 38, 18, 35, 23, 35, 35, 38, 29, 31, 43, 38]},\r\n\"lev\": {\"id\": \"lev\", \"title\": \"Leviticus\", \"usfm\": \"03-LEV\", \"testament\": \"old\", \"verseCount\": 859, \"chapters\": [17, 16, 17, 35, 19, 30, 38, 36, 24, 20, 47, 8, 59, 57, 33, 34, 16, 30, 37, 27, 24, 33, 44, 23, 55, 46, 34]},\r\n\"num\": {\"id\": \"num\", \"title\": \"Numbers\", \"usfm\": \"04-NUM\", \"testament\": \"old\", \"verseCount\": 1288, \"chapters\": [54, 34, 51, 49, 31, 27, 89, 26, 23, 36, 35, 16, 33, 45, 41, 50, 13, 32, 22, 29, 35, 41, 30, 25, 18, 65, 23, 31, 40, 16, 54, 42, 56, 29, 34, 13]},\r\n\"deu\": {\"id\": \"deu\", \"title\": \"Deuteronomy\", \"usfm\": \"05-DEU\", \"testament\": \"old\", \"verseCount\": 959, \"chapters\": [46, 37, 29, 49, 33, 25, 26, 20, 29, 22, 32, 32, 18, 29, 23, 22, 20, 22, 21, 20, 23, 30, 25, 22, 19, 19, 26, 68, 29, 20, 30, 52, 29, 12]},\r\n\"jos\": {\"id\": \"jos\", \"title\": \"Joshua\", \"usfm\": \"06-JOS\", \"testament\": \"old\", \"verseCount\": 658, \"chapters\": [18, 24, 17, 24, 15, 27, 26, 35, 27, 43, 23, 24, 33, 15, 63, 10, 18, 28, 51, 9, 45, 34, 16, 33]},\r\n\"jdg\": {\"id\": \"jdg\", \"title\": \"Judges\", \"usfm\": \"07-JDG\", \"testament\": \"old\", \"verseCount\": 618, \"chapters\": [36, 23, 31, 24, 31, 40, 25, 35, 57, 18, 40, 15, 25, 20, 20, 31, 13, 31, 30, 48, 25]},\r\n\"rut\": {\"id\": \"rut\", \"title\": \"Ruth\", \"usfm\": \"08-RUT\", \"testament\": \"old\", \"verseCount\": 85, \"chapters\": [22, 23, 18, 22]},\r\n\"1sa\": {\"id\": \"1sa\", \"title\": \"1 Samuel\", \"usfm\": \"09-1SA\", \"testament\": \"old\", \"verseCount\": 810, \"chapters\": [28, 36, 21, 22, 12, 21, 17, 22, 27, 27, 15, 25, 23, 52, 35, 23, 58, 30, 24, 42, 15, 23, 29, 22, 44, 25, 12, 25, 11, 31, 13]},\r\n\"2sa\": {\"id\": \"2sa\", \"title\": \"2 Samuel\", \"usfm\": \"10-2SA\", \"testament\": \"old\", \"verseCount\": 695, \"chapters\": [27, 32, 39, 12, 25, 23, 29, 18, 13, 19, 27, 31, 39, 33, 37, 23, 29, 33, 43, 26, 22, 51, 39, 25]},\r\n\"1ki\": {\"id\": \"1ki\", \"title\": \"1 Kings\", \"usfm\": \"11-1KI\", \"testament\": \"old\", \"verseCount\": 816, \"chapters\": [53, 46, 28, 34, 18, 38, 51, 66, 28, 29, 43, 33, 34, 31, 34, 34, 24, 46, 21, 43, 29, 53]},\r\n\"2ki\": {\"id\": \"2ki\", \"title\": \"2 Kings\", \"usfm\": \"12-2KI\", \"testament\": \"old\", \"verseCount\": 719, \"chapters\": [18, 25, 27, 44, 27, 33, 20, 29, 37, 36, 21, 21, 25, 29, 38, 20, 41, 37, 37, 21, 26, 20, 37, 20, 30]},\r\n\"1ch\": {\"id\": \"1ch\", \"title\": \"1 Chronicles\", \"usfm\": \"13-1CH\", \"testament\": \"old\", \"verseCount\": 942, \"chapters\": [54, 55, 24, 43, 26, 81, 40, 40, 44, 14, 47, 40, 14, 17, 29, 43, 27, 17, 19, 8, 30, 19, 32, 31, 31, 32, 34, 21, 30]},\r\n\"2ch\": {\"id\": \"2ch\", \"title\": \"2 Chronicles\", \"usfm\": \"14-2CH\", \"testament\": \"old\", \"verseCount\": 822, \"chapters\": [17, 18, 17, 22, 14, 42, 22, 18, 31, 19, 23, 16, 22, 15, 19, 14, 19, 34, 11, 37, 20, 12, 21, 27, 28, 23, 9, 27, 36, 27, 21, 33, 25, 33, 27, 23]},\r\n\"ezr\": {\"id\": \"ezr\", \"title\": \"Ezra\", \"usfm\": \"15-EZR\", \"testament\": \"old\", \"verseCount\": 280, \"chapters\": [11, 70, 13, 24, 17, 22, 28, 36, 15, 44]},\r\n\"neh\": {\"id\": \"neh\", \"title\": \"Nehemiah\", \"usfm\": \"16-NEH\", \"testament\": \"old\", \"verseCount\": 406, \"chapters\": [11, 20, 32, 23, 19, 19, 73, 18, 38, 39, 36, 47, 31]},\r\n\"est\": {\"id\": \"est\", \"title\": \"Esther\", \"usfm\": \"17-EST\", \"testament\": \"old\", \"verseCount\": 167, \"chapters\": [22, 23, 15, 17, 14, 14, 10, 17, 32, 3]},\r\n\"job\": {\"id\": \"job\", \"title\": \"Job\", \"usfm\": \"18-JOB\", \"testament\": \"old\", \"verseCount\": 1070, \"chapters\": [22, 13, 26, 21, 27, 30, 21, 22, 35, 22, 20, 25, 28, 22, 35, 22, 16, 21, 29, 29, 34, 30, 17, 25, 6, 14, 23, 28, 25, 31, 40, 22, 33, 37, 16, 33, 24, 41, 30, 24, 34, 17]},\r\n\"psa\": {\"id\": \"psa\", \"title\": \"Psalms\", \"usfm\": \"19-PSA\", \"testament\": \"old\", \"verseCount\": 2461, \"chapters\": [6, 12, 8, 8, 12, 10, 17, 9, 20, 18, 7, 8, 6, 7, 5, 11, 15, 50, 14, 9, 13, 31, 6, 10, 22, 12, 14, 9, 11, 12, 24, 11, 22, 22, 28, 12, 40, 22, 13, 17, 13, 11, 5, 26, 17, 11, 9, 14, 20, 23, 19, 9, 6, 7, 23, 13, 11, 11, 17, 12, 8, 12, 11, 10, 13, 20, 7, 35, 36, 5, 24, 20, 28, 23, 10, 12, 20, 72, 13, 19, 16, 8, 18, 12, 13, 17, 7, 18, 52, 17, 16, 15, 5, 23, 11, 13, 12, 9, 9, 5, 8, 28, 22, 35, 45, 48, 43, 13, 31, 7, 10, 10, 9, 8, 18, 19, 2, 29, 176, 7, 8, 9, 4, 8, 5, 6, 5, 6, 8, 8, 3, 18, 3, 3, 21, 26, 9, 8, 24, 13, 10, 7, 12, 15, 21, 10, 20, 14, 9, 6]},\r\n\"pro\": {\"id\": \"pro\", \"title\": \"Proverbs\", \"usfm\": \"20-PRO\", \"testament\": \"old\", \"verseCount\": 915, \"chapters\": [33, 22, 35, 27, 23, 35, 27, 36, 18, 32, 31, 28, 25, 35, 33, 33, 28, 24, 29, 30, 31, 29, 35, 34, 28, 28, 27, 28, 27, 33, 31]},\r\n\"ecc\": {\"id\": \"ecc\", \"title\": \"Ecclesiastes\", \"usfm\": \"21-ECC\", \"testament\": \"old\", \"verseCount\": 222, \"chapters\": [18, 26, 22, 16, 20, 12, 29, 17, 18, 20, 10, 14]},\r\n\"sng\": {\"id\": \"sng\", \"title\": \"Song of Songs\", \"usfm\": \"22-SNG\", \"testament\": \"old\", \"verseCount\": 117, \"chapters\": [17, 17, 11, 16, 16, 13, 13, 14]},\r\n\"isa\": {\"id\": \"isa\", \"title\": \"Isaiah\", \"usfm\": \"23-ISA\", \"testament\": \"old\", \"verseCount\": 1292, \"chapters\": [31, 22, 26, 6, 30, 13, 25, 22, 21, 34, 16, 6, 22, 32, 9, 14, 14, 7, 25, 6, 17, 25, 18, 23, 12, 21, 13, 29, 24, 33, 9, 20, 24, 17, 10, 22, 38, 22, 8, 31, 29, 25, 28, 28, 25, 13, 15, 22, 26, 11, 23, 15, 12, 17, 13, 12, 21, 14, 21, 22, 11, 12, 19, 12, 25, 24]},\r\n\"jer\": {\"id\": \"jer\", \"title\": \"Jermiah\", \"usfm\": \"24-JER\", \"testament\": \"old\", \"verseCount\": 1364, \"chapters\": [19, 37, 25, 31, 31, 30, 34, 22, 26, 25, 23, 17, 27, 22, 21, 21, 27, 23, 15, 18, 14, 30, 40, 10, 38, 24, 22, 17, 32, 24, 40, 44, 26, 22, 19, 32, 21, 28, 18, 16, 18, 22, 13, 30, 5, 28, 7, 47, 39, 46, 64, 34]},\r\n\"lam\": {\"id\": \"lam\", \"title\": \"Lamentations\", \"usfm\": \"25-LAM\", \"testament\": \"old\", \"verseCount\": 154, \"chapters\": [22, 22, 66, 22, 22]},\r\n\"ezk\": {\"id\": \"ezk\", \"title\": \"Ezekiel\", \"usfm\": \"26-EZK\", \"testament\": \"old\", \"verseCount\": 1273, \"chapters\": [28, 10, 27, 17, 17, 14, 27, 18, 11, 22, 25, 28, 23, 23, 8, 63, 24, 32, 14, 49, 32, 31, 49, 27, 17, 21, 36, 26, 21, 26, 18, 32, 33, 31, 15, 38, 28, 23, 29, 49, 26, 20, 27, 31, 25, 24, 23, 35]},\r\n\"dan\": {\"id\": \"dan\", \"title\": \"Daniel\", \"usfm\": \"27-DAN\", \"testament\": \"old\", \"verseCount\": 357, \"chapters\": [21, 49, 30, 37, 31, 28, 28, 27, 27, 21, 45, 13]},\r\n\"hos\": {\"id\": \"hos\", \"title\": \"Hosea\", \"usfm\": \"28-HOS\", \"testament\": \"old\", \"verseCount\": 197, \"chapters\": [11, 23, 5, 19, 15, 11, 16, 14, 17, 15, 12, 14, 16, 9]},\r\n\"jol\": {\"id\": \"jol\", \"title\": \"Joel\", \"usfm\": \"29-JOL\", \"testament\": \"old\", \"verseCount\": 73, \"chapters\": [20, 32, 21]},\r\n\"amo\": {\"id\": \"amo\", \"title\": \"Amos\", \"usfm\": \"30-AMO\", \"testament\": \"old\", \"verseCount\": 146, \"chapters\": [15, 16, 15, 13, 27, 14, 17, 14, 15]},\r\n\"oba\": {\"id\": \"oba\", \"title\": \"Obadiah\", \"usfm\": \"31-OBA\", \"testament\": \"old\", \"verseCount\": 21, \"chapters\": [21]},\r\n\"jon\": {\"id\": \"jon\", \"title\": \"Jonah\", \"usfm\": \"32-JON\", \"testament\": \"old\", \"verseCount\": 48, \"chapters\": [17, 10, 10, 11]},\r\n\"mic\": {\"id\": \"mic\", \"title\": \"Micah\", \"usfm\": \"33-MIC\", \"testament\": \"old\", \"verseCount\": 105, \"chapters\": [16, 13, 12, 13, 15, 16, 20]},\r\n\"nam\": {\"id\": \"nam\", \"title\": \"Nahum\", \"usfm\": \"34-NAM\", \"testament\": \"old\", \"verseCount\": 47, \"chapters\": [15, 13, 19]},\r\n\"hab\": {\"id\": \"hab\", \"title\": \"Habakkuk\", \"usfm\": \"35-HAB\", \"testament\": \"old\", \"verseCount\": 56, \"chapters\": [17, 20, 19]},\r\n\"zep\": {\"id\": \"zep\", \"title\": \"Zephaniah\", \"usfm\": \"36-ZEP\", \"testament\": \"old\", \"verseCount\": 53, \"chapters\": [18, 15, 20]},\r\n\"hag\": {\"id\": \"hag\", \"title\": \"Haggai\", \"usfm\": \"37-HAG\", \"testament\": \"old\", \"verseCount\": 38, \"chapters\": [15, 23]},\r\n\"zec\": {\"id\": \"zec\", \"title\": \"Zechariah\", \"usfm\": \"38-ZEC\", \"testament\": \"old\", \"verseCount\": 211, \"chapters\": [21, 13, 10, 14, 11, 15, 14, 23, 17, 12, 17, 14, 9, 21]},\r\n\"mal\": {\"id\": \"mal\", \"title\": \"Malachi\", \"usfm\": \"39-MAL\", \"testament\": \"old\", \"verseCount\": 55, \"chapters\": [14, 17, 18, 6]},\r\n\"mat\": {\"id\": \"mat\", \"title\": \"Matthew\", \"usfm\": \"41-MAT\", \"testament\": \"new\", \"verseCount\": 1071, \"chapters\": [25, 23, 17, 25, 48, 34, 29, 34, 38, 42, 30, 50, 58, 36, 39, 28, 27, 35, 30, 34, 46, 46, 39, 51, 46, 75, 66, 20]},\r\n\"mrk\": {\"id\": \"mrk\", \"title\": \"Mark\", \"usfm\": \"42-MRK\", \"testament\": \"new\", \"verseCount\": 678, \"chapters\": [45, 28, 35, 41, 43, 56, 37, 38, 50, 52, 33, 44, 37, 72, 47, 20]},\r\n\"luk\": {\"id\": \"luk\", \"title\": \"Luke\", \"usfm\": \"43-LUK\", \"testament\": \"new\", \"verseCount\": 1151, \"chapters\": [80, 52, 38, 44, 39, 49, 50, 56, 62, 42, 54, 59, 35, 35, 32, 31, 37, 43, 48, 47, 38, 71, 56, 53]},\r\n\"jhn\": {\"id\": \"jhn\", \"title\": \"John\", \"usfm\": \"44-JHN\", \"testament\": \"new\", \"verseCount\": 879, \"chapters\": [51, 25, 36, 54, 47, 71, 53, 59, 41, 42, 57, 50, 38, 31, 27, 33, 26, 40, 42, 31, 25]},\r\n\"act\": {\"id\": \"act\", \"title\": \"Acts\", \"usfm\": \"45-ACT\", \"testament\": \"new\", \"verseCount\": 1007, \"chapters\": [26, 47, 26, 37, 42, 15, 60, 40, 43, 48, 30, 25, 52, 28, 41, 40, 34, 28, 41, 38, 40, 30, 35, 27, 27, 32, 44, 31]},\r\n\"rom\": {\"id\": \"rom\", \"title\": \"Romans\", \"usfm\": \"46-ROM\", \"testament\": \"new\", \"verseCount\": 433, \"chapters\": [32, 29, 31, 25, 21, 23, 25, 39, 33, 21, 36, 21, 14, 23, 33, 27]},\r\n\"1co\": {\"id\": \"1co\", \"title\": \"1 Corinthians\", \"usfm\": \"47-1CO\", \"testament\": \"new\", \"verseCount\": 437, \"chapters\": [31, 16, 23, 21, 13, 20, 40, 13, 27, 33, 34, 31, 13, 40, 58, 24]},\r\n\"2co\": {\"id\": \"2co\", \"title\": \"2 Corinthians\", \"usfm\": \"48-2CO\", \"testament\": \"new\", \"verseCount\": 257, \"chapters\": [24, 17, 18, 18, 21, 18, 16, 24, 15, 18, 33, 21, 14]},\r\n\"gal\": {\"id\": \"gal\", \"title\": \"Galations\", \"usfm\": \"49-GAL\", \"testament\": \"new\", \"verseCount\": 149, \"chapters\": [24, 21, 29, 31, 26, 18]},\r\n\"eph\": {\"id\": \"eph\", \"title\": \"Ephesians\", \"usfm\": \"50-EPH\", \"testament\": \"new\", \"verseCount\": 155, \"chapters\": [23, 22, 21, 32, 33, 24]},\r\n\"php\": {\"id\": \"php\", \"title\": \"Phillipians\", \"usfm\": \"51-PHP\", \"testament\": \"new\", \"verseCount\": 104, \"chapters\": [30, 30, 21, 23]},\r\n\"col\": {\"id\": \"col\", \"title\": \"Colossians\", \"usfm\": \"52-COL\", \"testament\": \"new\", \"verseCount\": 95, \"chapters\": [29, 23, 25, 18]},\r\n\"1th\": {\"id\": \"1th\", \"title\": \"1 Thessalonians\", \"usfm\": \"53-1TH\", \"testament\": \"new\", \"verseCount\": 89, \"chapters\": [10, 20, 13, 18, 28]},\r\n\"2th\": {\"id\": \"2th\", \"title\": \"2 Thessalonians\", \"usfm\": \"54-2TH\", \"testament\": \"new\", \"verseCount\": 47, \"chapters\": [12, 17, 18]},\r\n\"1ti\": {\"id\": \"1ti\", \"title\": \"1 Timothy\", \"usfm\": \"55-1TI\", \"testament\": \"new\", \"verseCount\": 113, \"chapters\": [20, 15, 16, 16, 25, 21]},\r\n\"2ti\": {\"id\": \"2ti\", \"title\": \"2 Timothy\", \"usfm\": \"56-2TI\", \"testament\": \"new\", \"verseCount\": 83, \"chapters\": [18, 26, 17, 22]},\r\n\"tit\": {\"id\": \"tit\", \"title\": \"Titus\", \"usfm\": \"57-TIT\", \"testament\": \"new\", \"verseCount\": 46, \"chapters\": [16, 15, 15]},\r\n\"phm\": {\"id\": \"phm\", \"title\": \"Philemon\", \"usfm\": \"58-PHM\", \"testament\": \"new\", \"verseCount\": 25, \"chapters\": [25]},\r\n\"heb\": {\"id\": \"heb\", \"title\": \"Hebrews\", \"usfm\": \"59-HEB\", \"testament\": \"new\", \"verseCount\": 303, \"chapters\": [14, 18, 19, 16, 14, 20, 28, 13, 28, 39, 40, 29, 25]},\r\n\"jas\": {\"id\": \"jas\", \"title\": \"James\", \"usfm\": \"60-JAS\", \"testament\": \"new\", \"verseCount\": 108, \"chapters\": [27, 26, 18, 17, 20]},\r\n\"1pe\": {\"id\": \"1pe\", \"title\": \"1 Peter\", \"usfm\": \"61-1PE\", \"testament\": \"new\", \"verseCount\": 105, \"chapters\": [25, 25, 22, 19, 14]},\r\n\"2pe\": {\"id\": \"2pe\", \"title\": \"2 Peter\", \"usfm\": \"62-2PE\", \"testament\": \"new\", \"verseCount\": 61, \"chapters\": [21, 22, 18]},\r\n\"1jn\": {\"id\": \"1jn\", \"title\": \"1 John\", \"usfm\": \"63-1JN\", \"testament\": \"new\", \"verseCount\": 105, \"chapters\": [10, 29, 24, 21, 21]},\r\n\"2jn\": {\"id\": \"2jn\", \"title\": \"2 John\", \"usfm\": \"64-2JN\", \"testament\": \"new\", \"verseCount\": 13, \"chapters\": [13]},\r\n\"3jn\": {\"id\": \"3jn\", \"title\": \"3 John\", \"usfm\": \"65-3JN\", \"testament\": \"new\", \"verseCount\": 15, \"chapters\": [15]},\r\n\"jud\": {\"id\": \"jud\", \"title\": \"Jude\", \"usfm\": \"66-JUD\", \"testament\": \"new\", \"verseCount\": 25, \"chapters\": [25]},\r\n\"rev\": {\"id\": \"rev\", \"title\": \"Revelation\", \"usfm\": \"67-REV\", \"testament\": \"new\", \"verseCount\": 404, \"chapters\": [20, 29, 22, 11, 14, 17, 17, 13, 21, 11, 19, 17, 18, 20, 8, 21, 18, 24, 21, 15, 27, 21]}\r\n}\r\n\r\n//import data from './books.json';\r\n// import * as opt from './optimize'\r\n\r\n// export interface bookDataIF {\r\n//   \"id\";\r\n//   \"title\";\r\n//   \"usfm\";\r\n//   \"testament\";\r\n//   \"verseCount\": number;\r\n//   \"chapters\": number[];\r\n// }\r\n\r\nconst extraBookList = ['FRT','BAK'];\r\nexport const isValidBookID = (bookId) => {\r\n  return bookId.toLowerCase() in data || extraBookList.indexOf(bookId) >= 0;\r\n}\r\nexport const isOptionalValidBookID = (bookId) => {\r\n  return !bookId || bookId.toLowerCase() in data || extraBookList.indexOf(bookId) >= 0;\r\n}\r\nexport const isExtraBookID = (bookId) => {\r\n  return extraBookList.indexOf(bookId) >= 0;\r\n}\r\n\r\n\r\nexport const usfmNumberName = (bookId) => {\r\n  try {return data[bookId.toLowerCase()].usfm;}\r\n  catch(err) {throw new Error(`usfmNumberName() given invalid bookId: '${bookId}'`);}\r\n}\r\n\r\nexport const chaptersInBook = (bookId) => {\r\n  let chapters;\r\n  try {\r\n    chapters = data[bookId.toLowerCase()].chapters;\r\n  } catch (err) {\r\n    throw new Error(`chaptersInBook() given invalid bookId: '${bookId}'`);\r\n  }\r\n  if (chapters === undefined) {\r\n    throw new Error(`chaptersInBook(): Invalid bookId: '${bookId}'`);\r\n  }\r\n  return chapters;\r\n};\r\n\r\nexport const versesInChapter = (bookId, chapter) => {\r\n  const verses = chaptersInBook(bookId)[chapter - 1];\r\n  if (verses === undefined) {\r\n    throw new Error(`versesInChapter(${bookId}) given invalid chapter: ${chapter}`);\r\n  }\r\n  return verses;\r\n};\r\n\r\n// export const bookData = (bookId) => {\r\n//   const _bookData: bookDataIF = data.filter(row => row.id === bookId)[0];\r\n//   return _bookData;\r\n// };\r\n\r\nexport const testament = (bookId) => {\r\n  const _testament = data[bookId.toLowerCase()].testament;\r\n  return _testament;\r\n};\r\n\r\n// export const newTestament = () => {\r\n//   let list[] = [];\r\n//   for (const i=0; i < data.length; i++) {\r\n//     if ( data[i].testament === \"new\" ) {\r\n//       list.push( data[i].title )\r\n//     }\r\n//   }\r\n//   return list;\r\n// }\r\n\r\n// export const oldTestament = () => {\r\n//   let list[] = [];\r\n//   for (const i=0; i < data.length; i++) {\r\n//     if ( data[i].testament === \"old\" ) {\r\n//       list.push( data[i].title )\r\n//     }\r\n//   }\r\n//   return list;\r\n// }\r\n\r\n// export const bookDataTitles = () => {\r\n//   let list[] = [];\r\n//   for (const i=0; i < data.length; i++) {\r\n//       list.push( data[i].title )\r\n//   }\r\n//   return list;\r\n// }\r\n\r\n// export const titlesToBoolean = () => {\r\n//   let ob: opt.bpStateIF = {};\r\n//   let list = bookDataTitles();\r\n//   list.forEach((v,k) => {ob[v]= [false,false]});\r\n//   return ob;\r\n// }\r\n\r\n// export const bookIdByTitle = (title) => {\r\n//   for (const i=0; i < data.length; i++) {\r\n//     if ( data[i].title === title ) {\r\n//       return data[i].id;\r\n//     }\r\n//   }\r\n//   return \"\";\r\n// }\r\n\r\nexport const bookTitleById = (id) => {\r\n  for (let i=0; i < data.length; i++) {\r\n    if ( data[i].id === id ) {\r\n      return data[i].title;\r\n    }\r\n  }\r\n  return \"\";\r\n}\r\n\r\nconst oftenMissingList = [\r\n  // See https://en.wikipedia.org/wiki/List_of_New_Testament_verses_not_included_in_modern_English_translations\r\n  ['NEH', 7, 68], // ?\r\n  ['MAT', 16, 3],\r\n  ['MAT', 17, 21],\r\n  ['MAT', 18, 11],\r\n  // ['MAT', 20, 16b],\r\n  ['MAT', 23, 14],\r\n  // ['MRK', 6, 11b],\r\n  ['MRK', 7, 16],\r\n  ['MRK', 9, 44], ['MRK', 9, 46],\r\n  ['MRK', 11, 26],\r\n  ['MRK', 15, 28],\r\n  ['MRK', 16, 9], ['MRK', 16, 10], ['MRK', 16, 11], ['MRK', 16, 12], ['MRK', 16, 13], ['MRK', 16, 14],\r\n    ['MRK', 16, 15], ['MRK', 16, 16], ['MRK', 16, 17], ['MRK', 16, 18], ['MRK', 16, 19], ['MRK', 16, 20],\r\n  // ['LUK', 4, 8b],\r\n  // ['LUK', 9, 55], ['LUK', 9, 56],\r\n  ['LUK', 17, 36],\r\n  ['LUK', 22, 43], // ?\r\n  ['LUK', 22, 44], // ?\r\n  ['LUK', 23, 17],\r\n  ['JHN', 5, 3], ['JHN', 5, 4],\r\n  ['JHN', 7, 53], // ?\r\n  ['JHN', 8, 1], // ?\r\n  ['ACT', 8, 37],\r\n  // ['ACT', 9, 5], ['ACT', 9, 6],\r\n  // ['ACT', 13, 42],\r\n  ['ACT', 15, 34],\r\n  // ['ACT', 23, 9b],\r\n  ['ACT', 24, 6], ['ACT', 24, 7], ['ACT', 24, 8],\r\n  ['ACT', 28, 29],\r\n  ['ROM', 16, 24],\r\n  ['2CO', 13, 14], // ?\r\n  ['1JN', 5, 7], ['1JN', 5, 8],\r\n];\r\n\r\n\r\nexport function isOftenMissing(bookID,C,V) {\r\n  function matchBCV(entry) { return entry[0]===bookID && entry[1]===C && entry[2]===V; }\r\n\r\n  return oftenMissingList.find(matchBCV) !== undefined;\r\n}\r\n"],"sourceRoot":""}